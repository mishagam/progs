(function(k,g,z){if(k.hpmd&&hpmd.INITIALIZED)hpmd.sync&&(hpmd.push=function(a){a()});else{var fa="https:"==location.protocol?"https:":"http:",ga=!1,I,l,v=null,A=[],ha,P,B,Q=[],R=[],h,S=null,s,n={view:[],expand:[],collapse:[],interstitial:[],native:[]},t=0,T=null,U=null,u,w=null,V,ia,ja=!0,m,W,p,ka,la=!!k.hpmd,J={},ma={},X=[],x=la?hpmd:[],C=function(a){a.method||(a.method="POST");a.url||(a.url=fa+"//banner.hpmdnetwork.ru/");a.data?"string"==typeof a.data?a.type||(a.type="application/x-www-form-urlencoded"):
(a.data=JSON.stringify(a.data),a.type||(a.type="application/json")):a.data="";var b=new XMLHttpRequest;b.open(a.method,a.url,!0);b.withCredentials=!0;a.type&&b.setRequestHeader("Content-Type",a.type);a.success&&(b.onreadystatechange=function(){if(4==this.readyState){try{this.json=JSON.parse(this.responseText)}catch(b){this.json=null}a.success.bind(this).call()}});b.send(a.data)},K=function(a,b,c){var d="";c&&(d="; expires="+(new Date((new Date).valueOf()+1E3*c)).toUTCString());g.cookie=a+"="+b+"; path=/; domain="+
s+d},D=function(a){Q.push(a)},wa=function(){D=function(a){a()};Q.map(function(a){try{a()}catch(b){}});Q=null},na=function(a){h=a;K("hpmd_uid2",h,31536E3);D(function(){B.contentWindow.postMessage("hpmd.setuid"+h,"*")})},oa=function(){D(function(){var a=[];R.map(function(b){b[1]>h&&(a.push({view_id:b[0],from:b[1],to:h}),b[1]=h)});a.length&&C({data:{method:"ad.remap",data:{map:a}}})})},Y=function(a){try{a()}catch(b){k.console&&console.log("hpmd: callback error:",b)}},pa=function(a,b){if("undefined"==
typeof n[a])throw Error("Unknown event "+a);n[a].push(b)},qa=function(a,b){if("undefined"==typeof n[a])throw Error("Unknown event "+a);for(var c=0;c<n[a].length;c++)n[a][c]===b&&(n[a][c]=null)},E=function(a,b){if("close"==a){if(Z(),0!=A.length){var c=A[0];A=A.slice(1);L(c);$(c)}}else for(c=0;c<n[a].length;c++)if(n[a][c])try{n[a][c](b)}catch(d){}},M=[],aa,F=function(a){M.push(a);var b=function(){if(g.body){for(var a=0;a<M.length;a++)M[a]();M=[]}else aa||(aa=setTimeout(function(){aa=null;b()},300))};
b()},G=[],y=function(){switch(g.readyState){case "interactive":case "complete":g.removeEventListener("DOMContentLoaded",y);g.removeEventListener("readystatechange",y);k.removeEventListener("load",y);for(var a=0;a<G.length;a++)F(G[a]);G=[]}},xa=function(a){switch(g.readyState){case "interactive":case "complete":F(a);break;default:G.push(a),1==G.length&&(g.addEventListener("DOMContentLoaded",y),g.addEventListener("readystatechange",y),k.addEventListener("load",y))}},ba=[],ya=function(){for(var a=0;a<
ba.length;a++)ba[a]();N=function(a){a()}},N=function(a){ba.push(a)},ra=function(a,b){b||(b=m);b.hpmd.trackEvent("hpmd.js-exception",a.stack?{exception:{name:a.name,message:a.message,source:{file:a.fileName,line:a.lineNumber,char:a.columnNumber},stack:a.stack}}:{exception:{name:a.message?a.message:a.error}});k.console&&console.log("hpmd.banner: error: ",a)},$=function(a){F(function(){var b="interstitial"==a.format;if(b)W=a;else{try{Z()}catch(c){}m=a}"number"==typeof a.view||"teaser"!=a.format&&"fullscreen"!=
a.format||L(a);a.nodes=[];var d=g.createElement("style");d.setAttribute("type","text/css");d.innerHTML=a.data.css;g.getElementsByTagName("head")[0].appendChild(d);a.nodes.push(d);d=g.createElement("div");for(d.innerHTML=a.data.html;0<d.children.length;)a.nodes.push(d.children[0]),g.body.appendChild(d.children[0]);try{a.data.initializer&&z(a.data.initializer)(a.hpmd),z(a.data.js)(a.hpmd),b&&sa(a)}catch(e){if(a.imitation)a.onException(e);else ra(e)}})},za=function(a,b){var c=function(d){var e=d.target||
d.srcElement;if(e){var f=!1;do f=!!e.tagName&&"a"==e.tagName.toLowerCase(),f||(e=e.parentNode);while(e&&!f);if(f&&(!e.getAttribute("target")||"_self"==e.getAttribute("target"))){for(f=e;f&&f.getAttribute;){if(f.getAttribute("id")&&0==f.getAttribute("id").indexOf("hpmd")||-1<f.className.indexOf("hpmd"))return;f=f.parentNode}if((e=e.getAttribute("href"))&&!(-1<e.indexOf("#"))){g.documentElement.removeEventListener("click",c);f=function(){if(b){try{d.preventDefault()}catch(a){}try{d.stopPropagation()}catch(c){}return!1}};
try{a(e)}catch(ca){throw I&&f(),ca;}return f()}}}};g.documentElement.addEventListener("click",c)},sa=function(a){za(function(b){!u&&l&&Z();ha=b;!u&&l&&L(a,function(){E("interstitial")});a.hpmd.data.openBanner()},!0)},Z=function(){if(m){if(m.hpmd.data.destroy&&"function"==typeof m.hpmd.data.destroy)try{m.hpmd.data.destroy()}catch(a){}for(var b=0;b<m.nodes.length;b++)try{m.nodes[b].parentNode.removeChild(m.nodes[b])}catch(c){}}},L=function(a,b){C({data:{method:"ad.view",data:{view_id:a.view.id,hash:a.view.hash,
uid:a.view.uid}},success:function(){var c=this.json;!0===c.success&&(c=c.data.view_id,R.push([c,a.view.uid]),a.viewAllocated(c),oa(),b&&b())}})},Aa=function(){if(null!==S)return S;var a;if(g.referrer){var b;a=(b=/\/\/([^\/]+)\//.exec(g.referrer))?b[1]==s||b[1].indexOf("."+s)==b[1].length-s.length-1?!1:!0:!1}else a=!0;b=!/hpmd_session=/.exec(g.cookie);K("hpmd_session","1",1800);return S=a&&b},da=function(a){for(var b,c,d=0;d<a.length;d++){b=a[d];switch(b.type){case "native":c=r(1);break;case "native_wrapper":U=
b;c=r(2);break;default:c=null}try{b.id&&(ma[b.id]=c),function(a,b){var c=function(){z(a.js)(b)};F(c);"native_wrapper"==a.type&&(xa(c),k.addEventListener("load",function(){c();k.removeEventListener("load",c)}))}(b,c)}catch(e){k.console&&console.log("hpmd.plugins."+b.type,": error:",e)}}},Ba=function(a){ma.native.slotReady(a)},H=[],ea=function(a,b){var c=!1;try{if(!0===a.success){if(a.data.uid){var d=parseInt(a.data.uid);(!h||h>d)&&na(d)}a.data.segment&&(J=a.data.segment,J.site=l);a.data.config&&a.data.config.site&&
(P=a.data.config.site);if(c=!!a.data.banners&&!!a.data.banners.length){if(1==t)for(var e=a.data.banners.length,d=0;d<9*e;d++)a.data.banners[a.data.banners.length]=a.data.banners[d%e];for(var f=a.data.banners,ca=a.data.uid,e=!1,q,d=0;d<f.length;d++)q=f[d],"number"==typeof q.view&&R.push([q.view,ca]),r(0,q),"native"==q.format?H.push(q):e&&"interstitial"!=q.format?A.push(q):(e=!0,$(q));f.length&&(p=f[0],ua())}a.data.plugins&&a.data.plugins.length&&(da(a.data.plugins),0<X.length&&da(X));if(!a.data.supported&&
w)w.onUnsupported(void 0);V=a.data.initializer;oa()}else{if(1002==a.error&&w)w.onUnsupported(!0);ka=a}if(1<t){var ta=g.createElement("script");ta.setAttribute("src","//misc"+(2==t?"-dev.hpmdnetwork.ru":".hpmd.local")+"/native/debug/merge.js?"+Math.random());g.getElementsByTagName("head")[0].appendChild(ta)}}catch(k){}u||E("view",{hasBanner:c,isCommercial:!0,uid:h,context:b});ya()},va=function(a){a&&a.selectors&&(T=a);var b={uid:h,site_id:l,url:location.href.toString(),new_session:Aa()};v&&(b.section_id=
v);if(u)if(ja)b.demo=u,ja=!1;else{U&&da([U]);return}t&&(b.native=t);a&&(b.context={},["format","subformat","except_format","formats"].map(function(c){a[c]&&(b.context[c]=a[c])}));w&&(b.imitate_format=w);b={method:"ad.get",data:b};k.hpmd&&hpmd.sync&&(ga=!0);ga?(g.write('<script src="//banner.hpmdnetwork.ru/get?n='+hpmd.syncb.length+"&p="+encodeURIComponent(JSON.stringify(b))+'">\x3c/script>'),hpmd.syncb.push(function(b){ea(b,a)})):D(function(){b.data.uid=h;C({data:b,success:function(){ea(this.json,
a)}})})},Ca=function(){ia=!0},Da=function(a){va(a)},Ea=function(a){var b=[],c=[],d=[];a.viewAllocated=function(e){a.view=e;var f=a.hpmd;f.trackEvent=function(b,c){C({data:{method:"ad.event",data:{uid:h,banner_id:a.data.id,site_id:l,section_id:v,url:location.href.toString(),view:a.view,event:b,data:"undefined"==typeof c?null:c}}});if(a.data.pixels&&a.data.pixels[b])for(var d=a.data.pixels[b],e=function(a){var b=g.createElement("img");b.setAttribute("src",a.replace(/\{RND\}/g,function(){return Math.random()}));
b.style.cssText="position:absolute;left:-10000px;width:1px;height:1px";g.body.appendChild(b)},f=0;f<d.length;f++)e(d[f])};f.trackLink=function(a,b,c,d){c||(c={});a=f.prepareLink(a,b,d);c.newWindow?k.open(a,c.name?c.name:null,c.specs?c.specs:null,!!c.replace):location.href=a};f.prepareLink=function(b,c,d){b=fa+"//banner.hpmdnetwork.ru/track/event?uid="+h+"&banner_id="+a.data.id+"&site_id="+l+"&view="+a.view+"&event="+encodeURIComponent(b)+"&redirect_uri="+encodeURIComponent(c)+"&url="+encodeURIComponent(location.href.toString());
v&&(b+="&section_id="+v);d="undefined"==typeof d?null:d;null!==d&&(b+="&data="+encodeURIComponent(JSON.stringify(d)));return b};f.link=function(b){var c=arguments;b=b||0;var d;a.data.links&&(d=a.data.links[b]);d||(d="http://www.hpmdnetwork.ru/");d=d.replace(/\{RND\}/g,function(){return Math.random()});d=d.replace(/\{(\d+)\}/g,function(a,b){return b<c.length?c[b]:a});f.trackLink("hpmd.link"+b,d,{newWindow:!0})};f.ready=function(a){a()};f.asyncPrepareLink=function(a,b,c){arguments[arguments.length-
1](f.prepareLink.apply(this,[].slice.call(arguments,0,arguments.length-1)))};for(e=0;e<b.length;e++)f.trackEvent.apply(this,b[e]);for(e=0;e<c.length;e++)f.trackLink.apply(this,c[e]);for(e=0;e<d.length;e++)d[e]();d=c=b=null};"number"==typeof a.view?a.viewAllocated(a.view):(a.hpmd.trackEvent=function(){b.push([].slice.call(arguments))},a.hpmd.trackLink=function(){c.push([].slice.call(arguments))},a.hpmd.prepareLink=function(){throw Error("hpmd.banner: this banner has not been initialized yet");},a.hpmd.ready=
function(a){d.push(a)},a.hpmd.asyncPrepareLink=function(){var b=[].slice.call(arguments);a.hpmd.ready(function(){a.hpmd.asyncPrepareLink.apply(this,b)})})},O=function(a){return J[a]},Fa=function(a){C({data:{method:"ad.sysview",data:{banner_id:a.data.id,view_buffer_id:a.view.id,site_id:l,section_id:v,uid:h,url:location.href.toString()}}})},r=function(a,b){switch(a){case 3:var c={push:Y,events:{add:pa,remove:qa,fire:function(a,b){E(a,b)}},receive:function(a){ea({success:!0,data:a})},requestBanners:Da,
mute:Ca,INITIALIZED:!0,sync:k.hpmd&&hpmd.sync,syncb:[]};I&&(c.registerException=ra,c.getBannerInfo=function(a){N(function(){a(m?m:W?W:H.length?H[0]:null,ka)})},c.getUid=function(a){N(function(){D(function(){a(h)})})});return c;case 0:return b.hpmd={data:{},getSegment:O,getStylesheet:function(){return b.nodes[0].sheet},push:Y,events:{add:pa,remove:qa,fire:function(a,c){"interstitial"==b.format&&"close"==a?location.href=ha:E(a,c)}}},Ea(b),"native"==b.format&&(b.allocateView=function(){L(b);delete b.allocateView}),
function(a){var b;b=P?z(P)():{zIndex:{active:1E6,inactive:1E6}};a.getConfig=function(){return b}}(b.hpmd),l||(b.hpmd.setSegments=function(a){J=a}),b.hpmd;case 1:return{getSegment:O,banners:H,eval:z,sysview:Fa,events:{fire:E},context:T};case 2:return{getSegment:O,slotReady:Ba,context:T}}},ua=function(){if(la&&(!k.hpmd||!k.hpmd.INITIALIZED)&&(I?(hpmd=p?p.hpmd:l?r(3):r(0,{}),hpmd.initializeInterstitial=function(){sa({hpmd:hpmd})},u&&(hpmd.getViewId=function(){return p.view}),hpmd.imitate=function(a,
c){var d=function(){var d={data:{id:1,html:a.html,css:a.css,js:a.js,subformat:a.subformat},placement:a.placement,format:a.format,imitation:!0,onException:a.onException,onUnsupported:a.onUnsupported};V&&(d.data.initializer=V);"native"==d.format?(d.view={id:1,hash:"00000000000000000000000000000000"},r(0,d),H.push(d)):(d.view=1,r(0,d),$(d));c&&c()};"native"==a.format?d():N(d)},hpmd.imitatePlugins=function(a){X.push(a)},hpmd.imitateFormat=function(a,c,d){w={format:a,subformat:c,onUnsupported:d}}):hpmd=
r(3),t)){if(p)hpmd.trackEvent=p.hpmd.trackEvent,hpmd.trackLink=p.hpmd.trackLink,hpmd.prepareLink=p.hpmd.prepareLink,hpmd.asyncPrepareLink=p.hpmd.asyncPrepareLink;else{var a={data:{id:0}};r(0,a);hpmd.trackEvent=a.hpmd.trackEvent;hpmd.trackLink=a.hpmd.trackLink;hpmd.prepareLink=a.hpmd.prepareLink;hpmd.asyncPrepareLink=a.hpmd.asyncPrepareLink}hpmd.getSegment=O}};(function(){var a=1,b=location.host.split(".").length,c;do{s=location.host.split(".").splice(b-a,b).join(".");c=s+":"+Math.random();g.cookie=
"hpmd_cd="+c+"; path=/; domain="+s;if(-1<g.cookie.indexOf("hpmd_cd="+c))return;a++}while(a<=b);s=location.host})();(function(){for(var a=g.getElementsByTagName("script"),b,c=0;c<a.length;c++)if(a[c].hasAttribute("src")&&-1<(b=a[c].getAttribute("src")).indexOf(".hpmdnetwork.ru")){var d=/client\/(\d+)\.(min\.)?js/.exec(b);if(d&&d[1]){l=parseInt(d[1]);I=-1<[50,51,52].indexOf(l);break}}})();(function(){var a;if(a=/hpmd_demo=(\d+)\.([a-f0-9]{40})((\.\w+)+)?/.exec(location.href))u={banner_id:parseInt(a[1]),
hash:a[2]},a[3]&&(u.extra=a[3].substring(1,1E3).split("."));if(a=/hpmd_bind_native=([0-3])/.exec(location.href))"0"==a[1]?K("hpmd_bind","",-86400):(t=parseInt(a[1]),K("hpmd_bind",a[1]));else if(a=/hpmd_bind=([0-3])/.exec(g.cookie))t=parseInt(a[1])})();(function(a){if(a=/hpmd_uid2=(\d+)(;|$)/.exec(g.cookie))h=parseInt(a[1]);k.addEventListener("message",function(a){"https://banner.hpmdnetwork.ru"==a.origin&&"hpmd.uid"==a.data.substring(0,8)&&(a=parseInt(a.data.substring(8)),!isNaN(a)&&a<h&&(h=a),h&&
na(h),wa())});B=g.createElement("iframe");B.style.cssText="position:absolute;left:-100px;top:-100px;width:1px;height:1px;";B.setAttribute("src","https://banner.hpmdnetwork.ru/track/handler1.html");F(function(){g.body.appendChild(B)})})();ua();(function(){if(x.length)for(var a=0;a<x.length;a++)if(x[a])switch(typeof x[a]){case "string":0==x[a].indexOf("s/")&&(v=parseInt(x[a].substring(2,1E3)));break;case "function":Y(x[a])}})();ia||va()}})(window,document,function(){return function(k){return eval("(function(hpmd){"+
k+"})")}}());