if(!window.location.origin){window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}var queryStringObject=function(){if(!window.location.search){return{}}var b=window.location.search.slice(1).split("&");var d=b.length;var a={};for(var c=0;c<d;c++){var e=b[c].split("=");if(e[0]){if(e.length<2){e.push("")}a[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}}return a};var queryStringObj=queryStringObject();var createTemplate=function(){var a={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g};return function(c){var b=_.templateSettings;_.templateSettings=a;template=_.template(c);_.templateSettings=b;return template}}();function jwPlayerWrapper(){var KILOBIT=1000;var KIBIBIT=1024;var ONE_SECOND=1000;var ONE_MINUTE=60*ONE_SECOND;var ONE_HOUR=60*ONE_MINUTE;var ONE_DAY=24*ONE_HOUR;TWP=window.TWP||{};TWP.PostTV=TWP.PostTV||{};TWP.PostTV.players=TWP.PostTV.players||{};TWP.hpRefreshTests=TWP.hpRefreshTests||[];TWP.PostTV.adFrequency=TWP.PostTV.adFrequency||1/2;TWP.PostTV.inverseAdFrequency=TWP.PostTV.inverseAdFrequency||1/TWP.PostTV.adFrequency;TWP.PostTV.blankAdSetCode=TWP.PostTV.blankAdSetCode||"347e498d32924a56a51c7beca90b8b02";TWP.PostTV.jwPlayerConfig=TWP.PostTV.jwPlayerConfig||{};String.prototype.endsWith=function(suffix){return this.indexOf(suffix,this.length-suffix.length)!==-1};TWP.PostTV.EVENTS=$.extend(TWP.PostTV.EVENTS,{PLAYER_SERVICE_INITIALIZED:"playerServiceInitialized",DESTROY:"destroy",ERROR:"videoError",SEND_TRACKING_DATA:"sendTrackingData",SEEK:"seek",SET_VOLUME:"setVolume",SKIP_AD:"skipAd",PLAY:"play",PAUSE:"pause",PLAYING:"playing",PAUSED:"paused",PLAY_NEXT_VIDEO:"playNextVideo",PLAYER_CREATED:"playerCreated",OO_PLAYER_INITIALIZED:"ooPlayerInitialized",OO_PLUGIN_LOADED:"ooPluginLoaded",OO_PLUGIN_FULLY_LOADED:"ooPluginFullyLoaded",WILL_CHANGE_EMBED_CODE:"willChangeEmbedCode",CONTENT_TREE_FETCHED:"contentTreeFetched",PLAYBACK_READY:"playbackReady",PLAYHEAD_TIME_CHANGED:"playheadTimeChanged",COMPANION_ADS_DISPLAYED:"companionAdsDisplayed",AD_STARTED:"adStarted",ADS_CLEARED:"adsCleared",FIRST_FRAME:"firstFrame",EDITORIAL_PLAY_STARTED:"editorialPlayStarted",PLAY_COMPLETED:"ooPlayCompleted",NEED_RESIZE_VIDEO_ELEMENT:"needResizeVideoElement",SCRUBBER_NEEDS_ADJUSTMENT:"scrubberNeedsAdjustment",VOLUME_CHANGED:"volumeChanged",CAST_READY:"castReady",CAST_VIDEO:"castVideo",CAST_STARTED:"castStarted",CAST_FINISHED:"castFinished",CAST_PAUSE:"castPause",CAST_PLAY:"castPlay",CAST_SEEK:"castSeek",CAST_NEXT_VIDEO:"castNextVideo",CAST_PROGRESS:"castProgress",FULLSCREEN_CHANGED:"fullscreenChanged",SHOW_PROMO_SCREEN:"showPromoScreen"});TWP.PostTV.loadedResources=true;TWP.PostTV.isFlashEnabled=(function(){if(TWP.PostTV.mozFlashBlockedReason){return false}var hasFlash=false;try{var fo=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(fo){hasFlash=true}}catch(e){if(navigator.mimeTypes["application/x-shockwave-flash"]!=undefined){hasFlash=true}}return hasFlash})();TWP.PostTV.areCookiesEnabled=TWP.PostTV.areCookiesEnabled||function(){var cookieEnabled=(navigator.cookieEnabled)?true:false;if(typeof navigator.cookieEnabled=="undefined"&&!cookieEnabled){document.cookie="testcookie";cookieEnabled="testcookie" in document.cookie?true:false}return(cookieEnabled)};TWP.PostTV.getCookie=TWP.PostTV.getCookie||function(name){var nameEQ=name+"=";var ca=document.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" "){c=c.substring(1,c.length)}if(c.indexOf(nameEQ)==0){return c.substring(nameEQ.length,c.length)}}return null};TWP.PostTV.incrementCountingCookie=TWP.PostTV.incrementCountingCookie||function(name,options){if(!!name){options=options||{};TWP.PostTV.setCookie(name,TWP.PostTV.getCountingCookie(name)+1,options.expires,options.path,options.domain,options.secure)}};TWP.PostTV.getCountingCookie=TWP.PostTV.getIntegerCookie||function(name){var count=0;if(!!name&&TWP.PostTV.areCookiesEnabled()){var v=TWP.PostTV.getCookie(name);count=!isNaN(parseInt(v))?parseInt(v):0;count=(count<0)?0:count}return count};TWP.PostTV.getFlagCookie=TWP.PostTV.getFlagCookie||function(name){var flag=0;if(!!name&&TWP.PostTV.areCookiesEnabled()){var v=TWP.PostTV.getCookie(name);flag=!isNaN(parseInt(v))?parseInt(v):0;flag=(flag<0)?0:flag}return(flag%2)};TWP.PostTV.toggleFlagCookie=TWP.PostTV.toggleFlagCookie||function(name,options){if(!!name){options=options||{};TWP.PostTV.setCookie(name,(TWP.PostTV.getFlagCookie(name)+1)%2,options.expires,options.path,options.domain,options.secure)}};TWP.PostTV.setCookie=function(name,value,expires,path,domain,secure){document.cookie=name+"="+escape(value)+(expires?"; expires="+expires:"")+(path?"; path="+path:"; path=/")+(domain?"; domain="+domain:"; domain="+(/(?:[^\.]+)(\.([^\.]+\.){1,}[^\.]+)$/.test(document.location.host)?RegExp.$1:document.location.host))+(secure?"; secure":"")};TWP.PostTV.videoPlays=TWP.PostTV.videoPlays||0;TWP.PostTV.getCount=TWP.PostTV.getCount||function(){return((window.location.host.indexOf("local")>=0)||(location.port==="8080"))?function(){return TWP.PostTV.videoPlays}:function(){return TWP.PostTV.getCountingCookie("videoplays")}}();TWP.PostTV.incrementCount=TWP.PostTV.incrementCount||function(options){TWP.PostTV.videoPlays++;var expirationDate=new Date();expirationDate.setTime(expirationDate.getTime()+(10*60*ONE_SECOND));options=jQuery.extend(options,{expires:expirationDate.toGMTString()});TWP.PostTV.incrementCountingCookie("videoplays",options)};TWP.PostTV.getPreRollsBlocked=TWP.PostTV.getPreRollsBlocked||function(){return TWP.PostTV.getFlagCookie("adsflag")};TWP.PostTV.togglePreRollsBlocked=TWP.PostTV.togglePreRollsBlocked||function(options){TWP.PostTV.toggleFlagCookie("adsflag",options)};TWP.PostTV.isTWPBeta=(function(){var xWpSplit=TWP.PostTV.getCookie("X-WP-Split");return xWpSplit?xWpSplit.toUpperCase()==="B":false})();TWP.PostTV.BrowserInfo=TWP.PostTV.BrowserInfo||{init:function(userAgentStr){this.userAgentStr=userAgentStr;this.browser=this.searchString(this.dataBrowser)||"An unknown browser";this.version=this.searchVersion(this.userAgentStr)||this.searchVersion(navigator.appVersion)||"an unknown version";this.OS=this.searchString(this.dataOS)||"an unknown OS";this.deviceType=this.lookUpDeviceType(this.dataDeviceType)||0;this.webview=this.searchString(this.dataWebview)||"unknown";this.setupThinkAdBlock()},searchString:function(data){for(var i=0;i<data.length;i++){var dataString=typeof data[i].string==="undefined"?this.userAgentStr:data[i].string;var dataProp=data[i].prop;if(!this.version){this.versionSearchString=data[i].versionSearch||data[i].identity}if(dataString){if(dataString.indexOf(data[i].subString)!=-1){return data[i].identity}}else{if(dataProp){return data[i].identity}}}},searchVersion:function(dataString){var index=dataString.indexOf(this.versionSearchString);if(index==-1){return}return dataString.substring(index+this.versionSearchString.length+1).match(/\d+(\.\d+)+/g)[0]},lookUpDeviceType:function(data){var dataString;for(var i=0,l=data.length;i<l;i++){dataString=typeof data[i].string==="undefined"?this.userAgentStr:data[i].string;if(dataString){if($.isArray(data[i].subString)){for(var j=0,jl=data[i].subString.length;j<jl;j++){if(dataString.indexOf(data[i].subString[j])!=-1){return typeof data[i].type==="number"?data[i].type:this.lookUpDeviceType(data[i].type)}}}else{if(dataString.indexOf(data[i].subString)!=-1){return typeof data[i].type==="number"?data[i].type:this.lookUpDeviceType(data[i].type)}else{if(typeof data[i].otherwise!="undefined"){return data[i].otherwise}}}}}},setupThinkAdBlock:function(){var self=this;$(function(){var adBlockCanaryMarkup='<div id="ptvCanary" class="bottomAd" style="color: white; height: 2px"></div>';if($("#ptvCanary").length===0){$("body").append(adBlockCanaryMarkup)}self.thinkAdBlock=!!($("#ptvCanary").filter(":hidden").length>0||$("#ptvCanary").filter(":visible").length==0)})},dataBrowser:[{subString:"Silk",identity:"Silk"},{subString:"Edge",identity:"Edge",versionSearch:"Edge"},{subString:"Chrome",identity:"Chrome"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{subString:"Firefox",identity:"Firefox"},{subString:"Netscape",identity:"Netscape"},{subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{subString:"Trident",identity:"Explorer",versionSearch:"rv"},{subString:"Android",identity:"Android Stock Browser",versionSearch:"Android"},{subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{subString:"Silk",identity:"Android for Kindle"},{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{subString:"iPhone",identity:"iPhone"},{subString:"iPad",identity:"iPad"},{subString:"Android",identity:"Android"},{string:navigator.platform,subString:"Linux",identity:"Linux"}],dataDeviceType:[{subString:["iPhone","iPod"],type:1},{subString:["iPad","Silk"],type:2},{subString:["Android"],type:[{subString:["Firefox"],type:2},{subString:["Mobile"],type:1},{subString:null,otherwise:2}]},{subString:["Opera"],type:[{subString:["Mobi","Mini"],type:1}]},{subString:["AppleWebKit"],type:[{subString:["Mobile"],type:1}]},{subString:["Mobile"],type:1}],dataWebview:[{subString:"FBIOS",identity:"Facebook for iOS"},{subString:"FB4A",identity:"Facebook for Android"},{subString:"Twitter for iPhone",identity:"Twitter for iOS"},{subString:"TwitterAndroid",identity:"Twitter for Android"},{subString:" GSA/",identity:"Google Search App for iOS"},{subString:"CriOS",identity:"Chrome for iOS"}]};if(!TWP.PostTV.BrowserInfo.browser){TWP.PostTV.BrowserInfo.init(navigator.userAgent)}TWP.PostTV.isMobile=typeof TWP.PostTV.isMobile=="boolean"?TWP.PostTV.isMobile:(function(){return TWP.PostTV.BrowserInfo.deviceType==1})();TWP.PostTV.isTablet=(function(){return TWP.PostTV.BrowserInfo.deviceType==2})();TWP.PostTV.isDeskweb=!(TWP.PostTV.isMobile||TWP.PostTV.isTablet);TWP.PostTV.shouldNotPlayPrerollAds=typeof TWP.PostTV.shouldNotPlayPrerollAds!="undefined"?TWP.PostTV.shouldNotPlayPrerollAds:(function(){var prerollCookie=TWP.PostTV.getCookie("wapo_actmgmt"),kvs,v,kv;if(prerollCookie){kvs=prerollCookie.split("|");for(var i=0,l=kvs.length;i<l;i++){kv=kvs[i].split(":");if(kv[0]=="NO_PREROLL"){v=kv[1];break}}}return v==="1"})();TWP.PostTV.enablePageRefresh=!!$("#enable-page-refresh").data("enablePageRefresh");TWP.PostTV.mobileTabletPageRefresh=!!$("#mobile-tablet-page-refresh").data("mobileTabletPageRefresh");TWP.PostTV.shouldRefreshPage=(TWP.PostTV.enablePageRefresh&&TWP.PostTV.isDeskweb)||(TWP.PostTV.mobileTabletPageRefresh&&!TWP.PostTV.isDeskweb);TWP.PostTV.destroyWhenUpdate=!!$("#destroy-when-update").data("destroyWhenUpdate");TWP.PostTV.mobileTabletShowEndscreen=!!$("#mobile-tablet-show-endscreen").data("mobileTabletShowEndscreen");TWP.PostTV.mobileTabletPlayNext=$("#mobile-tablet-show-endscreen").length===0?true:!!$("#mobile-tablet-show-endscreen").data("mobileTabletPlayNext");TWP.PostTV.mobileForceAdSetCode=$("#mobile-force-adsetcode").length===0?undefined:$("#mobile-force-adsetcode").data("mobileForceAdsetcode");TWP.PostTV.tabletForceAdSetCode=$("#tablet-force-adsetcode").length===0?undefined:$("#tablet-force-adsetcode").data("tabletForceAdsetcode");TWP.PostTV.isUuidSpecifiedInUrl=$("#is-uuid-specified-in-url").data("isUuidSpecifiedInUrl");TWP.PostTV.RecommendedVideos=function(videoData,callback,errorback){var contextPath=window.wp_pb&&wp_pb.contextPath?wp_pb.contextPath:window.location.protocol+"//www.washingtonpost.com/video";var fullJsUrl=$('script[src*="jwPlayerWrapper.js"], script[src*="jwPlayerWrapper.min.js"]').attr("src");if(fullJsUrl){var fullJsUrlResources=fullJsUrl.indexOf("/static/js/posttv")>-1?fullJsUrl.indexOf("/static/js/posttv"):fullJsUrl.indexOf("/resources/js/posttv");if(fullJsUrlResources>-1){contextPath=fullJsUrl.substr(0,fullJsUrlResources);if(contextPath.indexOf("//")===0){contextPath=window.location.protocol+contextPath}}}var index=-1;var requested=false;var recommendedVideos=[];var verifyIndex=function(){if(recommendedVideos.length){while(index>=recommendedVideos.length){index=index-recommendedVideos.length}}else{index=-1}};var incIndex=function(incBy){if(index>=0){incBy=!isNaN(Number(incBy))?Number(incBy):1;index+=incBy;verifyIndex()}return index};var fetchRecommendedVideos=function(permaLinkURL,callback,errorback){var url=contextPath+"/c/recommended-videos/permaLinkUrl/"+encodeURIComponent(encodeURIComponent(permaLinkURL));var userParam=(function(){var i;var r;if(window.TWP&&TWP.PostTV&&TWP.PostTV.getCookie){i=TWP.PostTV.getCookie("wapo_login_id");if(i){r="/wapoLoginId/"+encodeURIComponent(i)}else{i=TWP.PostTV.getCookie("s_vi");if(i){r="/sVi/"+encodeURIComponent(i)}}}return r?r:""})();url=userParam?url+userParam:url;$.ajax({type:"GET",cache:true,url:url,data:{resType:"jsonp"},contentType:"application/json",jsonpCallback:"cb",dataType:"jsonp"}).success(callback).error(errorback)};var setup=function(videoData,callback,errorback){var callbackWrapper=function(data){index=data.length?0:-1;recommendedVideos=data;if(typeof callback==="function"){callback(recommendedVideos,index)}};var errorbackWrapper=function(error){if(typeof errorback==="function"){errorback(error)}else{console.error("RecommendedVideos - ERROR:",error)}};if(videoData&&videoData.contentConfig&&videoData.contentConfig.permaLinkURL){requested=true;fetchRecommendedVideos(videoData.contentConfig.permaLinkURL,callbackWrapper,errorbackWrapper)}else{errorbackWrapper({error:"videoData object missing contentConfig.permaLinkURL"})}};RecommendedVideos={setup:setup,fetch:setup,requested:function(){return requested},loaded:function(){return recommendedVideos.length?true:false},getAll:function(){return recommendedVideos},getVideo:function(){return recommendedVideos[index]?recommendedVideos[index]:null},getNextVideo:function(){incIndex();return recommendedVideos[index]?recommendedVideos[index]:null},getVideos:function(count){var cur=index;var videoList=[];if(recommendedVideos.length){while(videoList.length<count){videoList.push(recommendedVideos[cur]);cur++;if(cur>=recommendedVideos.length){cur=0}}}return videoList},getIndex:function(){return index},incIndex:incIndex};if(videoData){setup(videoData,callback,errorback)}return RecommendedVideos};TWP.PostTV.AdManager=function(settings){var ONE_SECOND=1000;var RATIO_16X9=9/16;var INVERSE_RATIO_16X9=16/9;var adSkipTime;var adSkipThreshold;var displayThreshold;var $playerContainer;var $companionAdContainer;var $adBarContainer;var $innerWrapper;var displayBlackBars=false;var $blackBars;var $adBar;var $adPlayControl;var $adMuteControl;var $adCountdown;var $skipCountdown;var $adSkipControl;var $adSkipContainer;var adRunning=false;var adClicked=false;var adTiming={};var adBarInterval;var creativeType;var player;var playerID;var onErrorCB;var skipAdCB;var showControlsCB;var hideControlsCB;var iconPlay="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAVCAIAAADNQonCAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAASdAAAEnQB3mYfeAAAAJ9JREFUOE+t1G0RgCAMAFAaEIEoRCEKUYhCFCIQQXe3O9QJG5vyz3M89oE698s6rOs6HQRDKo9d4yGlFGPc5OZEzhle1FpDCCLEEdgZ4Lz3DCQTENF7h9JWyhaB6UBd0wYpCIRKKaQuNYF1QYNGXRaCDEtNtNZIRxQEyV9dyLuLCmI1yy2Cv1EyId5rgRA/rXvAfCKfCMN/C/qtOpILPgG3iNE9V6J34wAAAABJRU5ErkJggg==";var iconPause="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAVCAIAAADNQonCAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAlwSFlzAAASdAAAEnQB3mYfeAAAAF1JREFUOE9jYKAK+E8uQNgONIEMp6DognPs7e3rkYC8vDzQaCCJLAhUA7EPuxFApch+gqgGksiCQDWjRkADZDQsECljpIQFFbIZSVkee06lyAgyyq39+/eTZCU+xQDTtEcPk8Cw2gAAAABJRU5ErkJggg==";var iconMute="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAlwSFlzAAASdAAAEnQB3mYfeAAAAJVJREFUOE/tk1ENwCAMREEJEpCABCQgAQlIQQoSkIIEdkkXtizA6PjdfTT8vHLptbLWKj5JSim+wSe1DmutrbXkkgeHEACg8mB8mHMGOYONMWjc5JzDJ957wl5gMtaUUgKM+sODqLYG1o0qxrg07dF1IOpSykvOk9NSSlHg7PVsTWEB4u121xHvqh4tLvg+z8U3bf6WDjULsaN9YNkfAAAAAElFTkSuQmCC";var iconMuted="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABUAAAAUCAIAAADtKeFkAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAASdAAAEnQB3mYfeAAAAOhJREFUOE+lk1ERhCAQQCWBEYhABCMYgQhGMAIRjGIEIxjBCNy72RvOw0XU48NBZx/7dhdN0zQxRp4PljHmTT3jvxS7dV27rqsqOOf6vpewH54XVgihbdvSKeM4EsNT4UmOQkmEtMuySA6d50gyk/8oMgyDfKzwYnUUmabpKu+9hz+KoLBtWz2/dEi6mIlYa+d5PqsfeeFTF1URXJT+y6fE71VLoyHmM+m0y3iEicBcHY3Ck4oj0qKd8PRf7YjCl24eNXN/stHc4KUKykkiMou8/ur/g8hZ/6v8PuBJ/iK/v+EX9zLdf9cL1wScCm37SQgAAAAASUVORK5CYII=";var vastAdBarTemplate=createTemplate('		<div			class="ptv-ad-bar-vast"			id="<%= playerID %>-ad-bar"			style="width: 100%; height: 22px; position: absolute; right: 0px; top: 0px; pointer-events: auto; font-family: Helvetica; background-color: #000; background-color: rgba(0,0,0, 0.7); z-index: 2;"		>			<% if (display.playPauseControl) { %><img id="<%= playerID %>-play-control" style="position: absolute; left: 0px; top: 0px; width: auto;"><% } %>			<% if (display.muteControl) { %><img id="<%= playerID %>-mute-control" style="position: absolute; left: 25px; top: 1px; width: auto;"><% } %>			<div id="<%= playerID %>-ad-countdown" class="ad-countdown" style="color: white; font-weight: 400; position: absolute; left: 50px; top: 3px; line-height: normal"></div>			<div class="skip-ad-container" style="width: 50%; position: absolute; right: 0px; top: 0px;">				<div id="<%= playerID %>-skip-countdown" style="color: white; font-weight: 400; position: absolute; top: 4px; right: 5px; line-height: normal"></div>				<a id="<%= playerID %>-skip-ad" style="display: none; color: white; font-weight: 400; position: absolute; top: 3px; right: 5px; cursor: pointer; line-height: normal">Skip</a>			</div>		</div>	');var googimaAdBarTemplate=createTemplate('		<div			class="ptv-ad-bar-googima"			id="<%= playerID %>-ad-bar"			style="width: 50%; height: 20px; position: absolute; right: 0px; top: 0px; pointer-events: auto; font-family: Helvetica; z-index: 2;"		>			<div class="skip-ad-container" style="width: 100%; position: absolute; right: 0px; top: 0px;">				<div id="<%= playerID %>-skip-countdown" style="color: white; font-size: 12px; font-weight: bold; position: absolute; top: 4px; right: 5px;"></div>				<a id="<%= playerID %>-skip-ad" style="display: none; color: white; font-size: 14px; font-weight: bold; position: absolute; top: 3px; right: 5px; cursor: pointer;">Skip</a>			</div>		</div>	');var adCountdownTemplate=createTemplate("<% if (!adClicked || !isVPaid) { %>This ad will close in <%= Math.ceil(time.duration - time.position) %> seconds<% } %>");var skipCountdownTemplate=createTemplate("You can skip this ad in <%= Math.ceil(adSkipTime - time.position) %> seconds");var blackBarsTemplate=createTemplate('		<div class="black-bar" style="position: absolute; left:   0px; width: 12.75%; height: 100%; pointer-events: auto; background-color: #000;"></div>		<div class="black-bar" style="position: absolute; right: -1px; width: 12.75%; height: 100%; pointer-events: auto; background-color: #000;"></div>	');var companionAdTemplate=createTemplate('		<div style="padding: 0px 0px 20px 20px">			<% if (companionAd.type === "static") { %>				<a href="<%= companionAd.click %>" target="_blank"><img src="<%= companionAd.resource %>"></a>			<% } else if (companionAd.type === "html") { %>				<%= companionAd.resource %>			<% } else if (companionAd.type === "iframe") { %>				<iframe src="<%= companionAd.resource %>" width="<%= companionAd.width %>" height="<%= companionAd.height %>" allowtransparency="true" marginwidth="0" marginheight="0" hspace="0" vspace="0" frameborder="0" scrolling="no"/>			<% }  %>		</div>	');var showCompanionAd=function(companionAds){if($companionAdContainer&&companionAds.companions.length){var adCompanion=companionAds.companions[0];$companionAdContainer.hide().html(companionAdTemplate({companionAd:adCompanion})).slideDown()}};var removeCompanionAd=function(){if($companionAdContainer){$companionAdContainer.slideUp(function(){$companionAdContainer.empty()})}};var pause=function(){if(player){player.pauseAd()}};var play=function(){resetInnerWrapper();pause()};var setPlayer=function(newPlayer){if(!newPlayer.player){console.log("AdManager - Error: no player object");return}if(!newPlayer.$playerContainer){console.log("AdManager - Error: no $playerContainer object");return}player=newPlayer.player;$playerContainer=newPlayer.$playerContainer;$innerWrapper=newPlayer.$innerWrapper||$innerWrapper;$adBarContainer=newPlayer.$adBarContainer||$adBarContainer};var setPaused=function(){adTiming.paused=true;if(!isVPaid()){$innerWrapper.css("pointer-events","auto");$innerWrapper.click(play)}else{adClick()}updatePlayControl()};var setPlaying=function(){adTiming.paused=false;updatePlayControl()};var isAdPaused=function(){return adTiming.paused};var isAdPlaying=function(){return !isAdPaused()};var mute=function(){if(player){player.setMute()}};var adClick=function(){adClicked=true;setTimeout(function(){if(isAdPlaying()){clearCountdowns()}},ONE_SECOND)};var isMuted=function(){return player?player.getMute():true};var isVPaid=function(){return creativeType==="vpaid"};var isGoogima=function(){return settings.adType==="googima"};var isVast=function(){return settings.adType==="vast"};var shouldShowPlayPauseControl=function(){return isVPaid()||isGoogima()?false:true};var shouldShowMuteControl=function(){return TWP.PostTV.isDeskweb&&!isGoogima()};var resetInnerWrapper=function(){$innerWrapper.off("click");$innerWrapper.css("pointer-events","none")};var updateAdControls=function(){if(shouldShowPlayPauseControl()){$adPlayControl.show();if(shouldShowMuteControl()){$adMuteControl.css("left","25px");$adCountdown.css("left","50px")}else{$adCountdown.css("left","25px")}}else{$adPlayControl.hide();if(shouldShowMuteControl()){$adMuteControl.css("left","0px");$adCountdown.css("left","25px")}else{$adCountdown.css("left","25px")}}};var updatePlayControl=function(){$adPlayControl.attr("src",isAdPaused()?iconPlay:iconPause)};var updateMuteControl=function(){$adMuteControl.attr("src",isMuted()?iconMuted:iconMute)};var resetAdStatus=function(adMeta){var now=_.now();adRunning=true;adClicked=false;adSkipTime=settings.adSkipTime||15;creativeType=adMeta&&adMeta.creativetype?adMeta.creativetype:"";adTiming={paused:false,position:0,duration:0,lastUpdate:now,shadowTiming:false};updateAdControls();updatePlayControl();updateMuteControl();$adCountdown.text("");$adSkipControl.hide();if(TWP.PostTV.isDeskweb){$skipCountdown.text("").show()}else{$skipCountdown.text("").hide()}};var showAdBar=function(){if($adBar){hideControlsCB();$adBarContainer.prepend($adBar);if(displayBlackBars){$innerWrapper.append($blackBars)}}};var hideAdBar=function(){if($adBar&&$adBar.length>0){$adBar.detach()}if(displayBlackBars){$blackBars.remove()}};var shouldDisplaySkipCountdown=function(){return !adTiming.duration||(Math.floor(adTiming.duration)>(adSkipTime+adSkipThreshold))};var clearCountdowns=function(){$adCountdown.text("");$skipCountdown.hide();if(TWP.PostTV.isDeskweb){$adSkipControl.show()}};var updateAdBar=function(){if(isAdPlaying()){var now=_.now();if(isVPaid()&&((now-adTiming.lastUpdate)>ONE_SECOND)){adTiming.shadowTiming=true;adTiming.position+=(now-adTiming.lastUpdate)/ONE_SECOND;adTiming.lastUpdate=now;if(adTiming.duration&&(adTiming.position>=adTiming.duration)){adClick();clearCountdowns()}}if(adTiming.position>displayThreshold){if(adTiming.duration){$adCountdown.text(adCountdownTemplate({time:adTiming,adSkipTime:adSkipTime,adSkipThreshold:adSkipThreshold,adClicked:adClicked,isVPaid:isVPaid()}))}if(TWP.PostTV.isDeskweb&&shouldDisplaySkipCountdown()){if(isVast()){$adCountdown.hide();$adSkipContainer.css("width","100%")}if(Math.ceil(adTiming.position)>adSkipTime){$skipCountdown.hide();$adSkipControl.show()}else{$skipCountdown.text(skipCountdownTemplate({time:adTiming,adSkipTime:adSkipTime,adSkipThreshold:adSkipThreshold}))}}}}else{if(adClicked){clearCountdowns()}}};var stopUpdating=function(){clearInterval(adBarInterval);adBarInterval=null};var createAdBar=function(){$adBar=isGoogima()?$(googimaAdBarTemplate({playerID:playerID})):$(vastAdBarTemplate({display:{playPauseControl:shouldShowPlayPauseControl(),muteControl:shouldShowMuteControl()},playerID:playerID}));$adPlayControl=$adBar.find("#"+playerID+"-play-control");$adMuteControl=$adBar.find("#"+playerID+"-mute-control");$adCountdown=$adBar.find("#"+playerID+"-ad-countdown");$skipCountdown=$adBar.find("#"+playerID+"-skip-countdown");$adSkipControl=$adBar.find("#"+playerID+"-skip-ad");$adSkipContainer=$adBar.find(".skip-ad-container")};var checkSetup=function(){var errorMessage="";if(!skipAdCB){errorMessage="AdManager: No ad skip callback specified"}if(!playerID){errorMessage="AdManager: No player ID specified"}return errorMessage};var init=function(settings){adSkipTime=settings.adSkipTime||15;adSkipThreshold=settings.adSkipThreshold||3;displayThreshold=settings.displayThreshold||0.25;playerID=settings.playerID;$companionAdContainer=settings.$companionAdContainerID||$("#"+settings.companionAdContainerID);skipAdCB=settings.skipAd;onErrorCB=settings.onError;showControlsCB=settings.showControls;hideControlsCB=settings.hideControls;var errors=checkSetup();if(errors){if(onErrorCB){onErrorCB(errors)}console.log(errors);return false}else{createAdBar();$adPlayControl.click(play);$adMuteControl.click(mute);$adSkipControl.click(skipAdCB);if(displayBlackBars){$blackBars=$(blackBarsTemplate())}return true}};var AdManager={setPlayer:setPlayer,adStart:function(adMeta){if(!adRunning){resetAdStatus(adMeta);showAdBar();updateAdBar();adBarInterval=setInterval(updateAdBar,ONE_SECOND/10)}else{this.setPlaying()}},adComplete:function(){if(adRunning){adRunning=false;resetInnerWrapper();showControlsCB();stopUpdating();hideAdBar();removeCompanionAd()}},updateAdTime:function(adTime){_.extend(adTiming,adTime,{lastUpdate:_.now()});if(adTiming.duration>(30+adSkipThreshold)){adSkipTime=30}if(adTime.position&&adTiming.shadowTiming){if(isAdPaused()){setPlaying()}else{setPaused()}}},showCompanionAd:showCompanionAd,removeCompanionAd:removeCompanionAd,setPaused:setPaused,setPlaying:setPlaying,getAdPaused:isAdPaused,getAdPlaying:isAdPlaying,mute:mute,isMuted:isMuted,setMute:updateMuteControl,adClick:adClick,getAdRunning:function(){return adRunning}};if(init(settings)){return AdManager}};var JWPlayerWrapper=function(SETTINGS,callbacks,videoJSON){videoJSON=videoJSON||{};var ONE_SECOND=1000;var SPINNER_WAIT_TIME=1;var delta=function(start,end){return(end-start)/ONE_SECOND};var getAdTagCB;var shouldPlayAdCB;var timing={};var player={};var debug=true;var alwaysDebug=["onSetupError","onError","onAdError"];var skin="";var autoplay=false;var allowControls=true;var hideBuffering=true;var $playerContainer;var $innerWrapper;var firstFrame=true;var firstOnBeforePlay=true;var playedAd=false;var playingAd=false;var skippingAd=false;var playingVideo=false;var buffering=false;var bufferingExpected=false;var playerDestroyed=false;var videosPlayed=0;var contextPath;var externalContext;var cachedVideoData;var jwPlaylist=[];var youtubeStream=false;var adMeta={};var adConfig;var adManager;var adTimeout;var adLoadWaitTime;var checkedShouldPlayAd=false;var cloneObject=function(obj){return JSON.parse(JSON.stringify(obj))};var camelCase=function(){var hyphenHunter=/-(\w)?/g;return function(hyphenatedString){return hyphenatedString.replace(hyphenHunter,function(captured,firstCapturingGroup){return firstCapturingGroup?firstCapturingGroup.toUpperCase():""})}}();var globalize=function(obj,identifier){var count=1;var camelCased=camelCase(identifier);var globalName=camelCased+count;while(window[globalName]){count++;globalName=camelCased+count}window[globalName]=obj;console.log("jw:",globalName)};var innerWrapperTemplate=createTemplate('		<div class="inner-wrapper <%= config.className ? config.className : "" %>"			style="position:absolute;				top:0;				left:0;				pointer-events: none;				height: <%= config.height ? config.height : "100%" %>;				width: <%= config.width ? config.width : "100%" %>;">			<%= config.html ? config.html : "" %>		</div>	');var loggers={onTime:_.noop,onAdTime:_.noop,onBufferChange:_.noop,onFirstFrame:function onFirstFrameLogger(name,args){console.debug("firstFrame:",{timing:delta(timing.load,timing.firstFrame)})},onReady:function onReadyLogger(name,args){console.debug("onReady:",{renderingMode:player.getProvider(),timing:delta(timing.created,timing.now)})},onRecreated:function onRecreatedLogger(name,args){console.debug("onRecreated:",{renderingMode:player.getProvider(),timing:delta(timing.created,timing.now)})},onSetupError:function onSetupErrorLogger(name,args){console.debug("onSetupError:",{fallback:args[0],message:args[1]})},onMeta:function onMetaLogger(metadata){},defaultLogger:function defaultLogger(name,args){console.debug(name,args.length?args:{})}};var log=function(name,args){if(debug||_.contains(alwaysDebug,name)){(loggers[name]?loggers[name]:loggers.defaultLogger)(name,args)}};var get$playerContainer=function(){return $playerContainer};var get$innerWrapper=function(){return $innerWrapper};var isFullscreen=function(){return player?player.getFullscreen():false};var getVolume=function(){return player?player.getVolume():null};var setVolume=function(volume){if(player){volume=(volume>0)&&(volume<1)?volume*100:(volume>100)?100:(volume<0)?0:volume;player.setVolume(volume)}};var showControls=function(time){if(player){if(allowControls&&(!time||(time.position>SPINNER_WAIT_TIME))){player.setControls(true)}}};var hideControls=function(){if(player){player.setControls(false)}};var hidePlayer=function(state){if(!state||(state.oldstate!=="PLAYING")){$playerContainer.css("opacity",0)}};var showPlayer=function(){$playerContainer.css("opacity",1)};var setAutoplay=function(newValue){if(newValue!==undefined){autoplay=newValue?true:false}};var hideAndroidFullscreen=function(){var osType=TWP.PostTV.BrowserInfo.OS.toLowerCase();var isAndroid=osType.indexOf("android")>-1;var isOldAndroidChrome=isAndroid;try{isOldAndroidChrome=isAndroid&&parseInt(TWP.PostTV.BrowserInfo.version)<43}catch(e){console.log(e)}return function(){if(isOldAndroidChrome&&isEmbed()){$playerContainer.attr("data-disable-fullscreen",1)}}}();var play=function(){if(player&&!isPlaying()){player.play()}};var forcePlay=function(){if(player){if(playingAd){player.pauseAd()}else{player.pause();player.play()}}};var pause=function(){if(player&&!isPaused()&&!isIdle()){player.pause()}};var stop=function(){if(player){player.stop()}};var seek=function(position){if(player){player.seek(position)}};var load=function(videoData){var shouldRecreate=isFlash();if(playingAd){endAd();if(videoData!==cachedVideoData){skippingAd=false;videoEnded()}}if(playingVideo){videoEnded()}cachedVideoData=videoData||cachedVideoData;if(shouldRecreate){recreatePlayer()}else{player.load(_.isArray(cachedVideoData)?cachedVideoData:[cachedVideoData])}};var clearAdTimeout=function(){if(adTimeout){clearTimeout(adTimeout);adTimeout=null}};var setAdTimeout=function(){if(!adTimeout&&TWP.PostTV.isDeskWeb){adTimeout=setTimeout(adTimedOut,adLoadWaitTime)}};var loadAd=function(adTag){if(player){adTag=adTag||getAdTagCB();adMeta=adMeta||{};adMeta.adTag=adTag;adMeta.adType=getAdType();setTimeout(function(){player.playAd(adTag);setAdTimeout()},0)}};var pauseAd=function(){if(player){player.pauseAd()}};var playAd=function(){pauseAd()};var endAd=function(){skippingAd=true;adSkipped();adEnded()};var skipAd=function(){endAd();load(cachedVideoData)};var shouldPlayAd=function(){var playAd=!checkedShouldPlayAd&&!playingVideo&&shouldPlayAdCB();checkedShouldPlayAd=true;return playAd};var getElementID=function(){return player?player.id:""};var isPlaying=function(){return player&&player.getState()=="playing"?true:false};var isPaused=function(){return player&&player.getState()=="paused"?true:false};var isIdle=function(){return player&&player.getState()=="idle"?true:false};var getPosition=function(){return player?player.getPosition():null};var findFlash=/flash/i;var getProvider=function(){var provider=player?player.getProvider():{};return provider&&provider.name?findFlash.test(provider.name)?"flash":provider.name:""};var isFlash=function(){return getProvider()==="flash"};var isHTML5=function(){return getProvider()==="html5"};var isYouTube=function(){return youtubeStream};var ptvCallbackHandlers={};var adEnded=function(){ptvCallbackHandlers.onAdEnd(adMeta)};var adSkipped=function(){ptvCallbackHandlers.onAdSkip()};var adTimedOut=function(){ptvCallbackHandlers.onAdTimeout(adMeta)};var videoEnded=function(){ptvCallbackHandlers.onVideoEnd()};var destroyingPlayer=function(){ptvCallbackHandlers.onDestroyPlayer()};var bufferingCompleted=function(time){if(buffering){ptvCallbackHandlers.onBufferingComplete(time)}buffering=false;bufferingExpected=false};var reportFirstFrame=function(time){if(firstFrame){var adOrVideoCallback=_.noop;timing.firstOverallFrame=timing.firstFrame?false:true;firstFrame=false;timing.firstFrame=timing.now;if(playingAd){if(!timing.firstAdFrame){timing.firstAdFrame=timing.firstFrame;adOrVideoCallback=ptvCallbackHandlers.onFirstAdFrame}}else{if(!timing.firstVideoFrame){timing.firstVideoFrame=timing.firstFrame;adOrVideoCallback=ptvCallbackHandlers.onFirstVideoFrame}}var firstFrameTiming=_.chain({time:time,delta:delta(timing.load,timing.firstFrame)}).extend(_.pick(timing,["load","firstFrame","firstOverallFrame","firstAdFrame","firstVideoFrame"])).pick(_.identity).value();ptvCallbackHandlers.onFirstFrame(firstFrameTiming);adOrVideoCallback(firstFrameTiming)}};var ptvCallbacks={onDestroyPlayer:function onDesctroyPlayer(){},onBufferingComplete:function onBufferingComplete(time){if(!playingAd){setTimeout(showControls,SPINNER_WAIT_TIME)}},onFirstFrame:function onFirstFrame(){},onInitialAdPlay:function onInitialAdPlay(){},onFirstAdFrame:function onFirstAdFrame(timing){_.extend(adMeta,_.pick(timing.time,"duration"));clearAdTimeout()},onAdTimeout:function onAdTimeout(){adMeta.timeout=delta(timing.load,timing.now);skipAd()},onAdSkip:function onAdSkip(){},onAdEnd:function onAdEnd(adMeta){clearAdTimeout();firstFrame=true;playedAd=true;playingAd=false;if(isHTML5()){timing.load=timing.now}adManager.adComplete();if(hideBuffering){hideControls()}},onInitialVideoPlay:function onInitialVideoPlay(){},onFirstVideoFrame:function onFirstVideoFrame(){skippingAd=false},onVideoEnd:function onVideoEnd(){firstOnBeforePlay=true;firstFrame=true;videosPlayed++;adMeta={};playedAd=false;playingVideo=false;checkedShouldPlayAd=false;timing.firstFrame=null;timing.firstAdFrame=null;timing.firstVideoFrame=null;if(hideBuffering){hideControls()}}};var jwSetupCallbacks={onReady:function onReady(){timing.ready=timing.now;$playerContainer=$("#"+getElementID());$innerWrapper=$(innerWrapperTemplate({config:{height:"100%",width:"100%"}}));$playerContainer.append($innerWrapper);hideAndroidFullscreen();adManager.setPlayer({player:player,$adBarContainer:$playerContainer.parent(),$playerContainer:$playerContainer,$innerWrapper:$innerWrapper})},onRecreated:function onRecreated(){playerDestroyed=false;timing.ready=timing.now;$playerContainer=$("#"+getElementID());$playerContainer.append($innerWrapper);hideAndroidFullscreen();adManager.setPlayer({player:player,$playerContainer:$playerContainer})},onSetupError:function onSetupError(fallback,message){}};var jwPlaylistCallbacks={onPlaylist:function onPlaylist(playlist){jwPlaylist=playlist.playlist||[];if(TWP.PostTV.isDeskweb&&(autoplay||skippingAd)){play()}},onPlaylistItem:function onPlaylistItem(playlistItem){var playlistVideo=jwPlaylist[playlistItem.index]||{};youtubeStream=playlistVideo.file&&(playlistVideo.file.indexOf("youtube")>-1);if(playingVideo){videoEnded()}},onPlaylistComplete:function onPlaylistComplete(){}};var jwBufferCallbacks={onBufferChange:function onBufferChange(bufferStatus){}};var jwPlaybackCallbacks={onPlay:function onPlay(state){if(!playingVideo){playingVideo=true;adManager.adComplete();ptvCallbackHandlers.onInitialVideoPlay()}},onPause:function onPause(state){},onBuffer:function onBuffer(state){buffering=true},onIdle:function onIdle(state){},onComplete:function onComplete(){videoEnded()},onError:function onError(message){videoEnded()}};var jwSeekCallbacks={onSeek:function onSeek(seek){bufferingExpected=true},onTime:function onTime(time){reportFirstFrame(time);bufferingCompleted(time)}};var jwVolumeCallbacks={onMute:function onMute(mute){adManager.setMute()},onVolume:function onVolume(volume){adManager.setMute()}};var jwResizeCallbacks={onFullscreen:function onFullscreen(fullscreen){},onResize:function onResize(size){}};var jwQualityCallbacks={onQualityLevels:function onQualityLevels(levels){},onQualityChange:function onQualityChange(){}};var jwCaptionsCallbacks={onCaptionsList:function onCaptionsList(tracks){},onCaptionsChange:function onCaptionsChange(track){}};var jwControlsCallbacks={onDisplayClick:function onDisplayClick(){if(TWP.PostTV.isMobile||TWP.PostTV.isTablet){if(isPlaying()){pause()}else{if(isPaused()){play()}}}}};var jwAdvertisingCallbacks={onAdClick:function onAdClick(adClick){adManager.adClick()},onAdCompanions:function onAdCompanions(adCompanions){adManager.showCompanionAd(adCompanions);_.extend(adMeta,adCompanions)},onAdComplete:function onAdComplete(adComplete){adEnded()},onAdSkipped:function onAdSkipped(){adEnded()},onAdError:function onAdError(error){_.extend(adMeta,error);adEnded()},onAdImpression:function onAdImpression(adImpression){_.extend(adMeta,adImpression)},onAdMeta:function(metadata){_.extend(adMeta,metadata)},onAdTime:function onAdTime(time){if(!skippingAd){playingAd=true;reportFirstFrame(time);bufferingCompleted(time);adManager.updateAdTime(time)}},onBeforePlay:function onBeforePlay(){timing.load=timing.now;bufferingExpected=true;if(shouldPlayAd()){skippingAd=false;loadAd()}},onBeforeComplete:function onBeforeComplete(){},onAdPause:function onAdPause(adPause){adManager.setPaused(adPause)},onAdPlay:function onAdPlay(adPlay){if(!playingAd){ptvCallbackHandlers.onInitialAdPlay();firstFrame=true}adManager.adStart(adMeta);playingAd=true}};var jwMetadataCallbacks={onMeta:function onMeta(metadata){}};var isLeafPage=function(){return SETTINGS.ptvType==="posttv-player"&&TWP.isLeafPage};var isEmbed=function(){return SETTINGS.ptvType==="posttv-embed"};var getAdType=function(){return adConfig.adType?adConfig.adType:""};var isGoogima=function(){return getAdType()==="googima"};var isVast=function(){return getAdType()==="vast"};var getPlayerSettings=function(){var jwSetupTitle=function(){return{displaytitle:false,displaydescription:false,title:cachedVideoData.title}};var jwSetupImage=function(){return{image:cachedVideoData.image}};var jwSetupAdvertising=function(){var getGoogimaSetup=function(videoData){return{advertising:{client:"googima"}}};var getVastSetup=function(){return{advertising:{client:"vast"}}};var adSetup={googima:getGoogimaSetup,vast:getVastSetup};return adSetup[getAdType()]?adSetup[getAdType()]():{}};var jwSetupInitialPlaylist=function(videoData,playerType){videoData=videoData||cachedVideoData;var playlist=_.isArray(videoData)?videoData:[videoData];return{playlist:playlist,primary:playerType||SETTINGS.playerType,androidhls:true}};var jwSetupAutostart=function(){var autostart=autoplay||skippingAd;return{autostart:TWP.PostTV.isDeskweb?autostart:false}};var jwSetupSize=function(){return{width:"100%",aspectratio:isLeafPage()?"16:9":SETTINGS.aspectRatio}};var jwSetupScripts=function(){var flashplayer=contextPath+"/static/js/posttv/vendor/jwplayer/jw-7.1.4/jwplayer.flash.swf";var base=contextPath+"/static/js/posttv/vendor/jwplayer/jw-7.1.4/";return{flashplayer:flashplayer,base:base}};var jwSetupPlugins=function(){var isDevelopment=window.wp_pb&&wp_pb.environment==="development";var sharing=isDevelopment?contextPath+"/static/js/posttv/jwPlayer/jwPlayerSharing.js":contextPath+"/static/js/posttv/jwPlayer/jwPlayerSharing.min.js";var plugins={};if(SETTINGS.showSharingOverlay){plugins[sharing]={videoJson:videoJSON,playerContainerId:SETTINGS.playerContainerID,hideButtons:SETTINGS.hideOverlayButtons}}return{plugins:plugins}};var jwSetupSkin=function(){var skinName=queryStringObj.skin?queryStringObj.skin:"bekle";return{skin:{name:skinName}}};var jwSetupAbout=function(){return{abouttext:"PostTV - Washington Post",aboutlink:contextPath+"/c/video/topic/topnews"}};var jwSetupCookies=function(){if(!isNaN(parseInt(SETTINGS.customVolume))){return{cookies:false}}};var settings=cloneObject(SETTINGS);_.extend(settings,jwSetupTitle(),jwSetupImage(),jwSetupAdvertising(),jwSetupInitialPlaylist(),jwSetupAutostart(),jwSetupSize(),jwSetupPlugins(),jwSetupScripts(),jwSetupSkin(),jwSetupAbout(),jwSetupCookies());return settings};var decorator=function(context,wrapped,name){context.externals[name]=typeof context.externals[name]==="function"?context.externals[name]:_.noop;return function(){timing.now=_.now();log(name,arguments);wrapped.apply(context,arguments);context.externals[name].apply(externalContext,arguments)}};var recreatePlayer=function(){destroyPlayer();createPlayer(JWPlayerWrapper)};var destroyPlayer=function(){if(player){destroyingPlayer();$innerWrapper.detach();player.stop();$playerContainer.off();player.remove();player=null;playerDestroyed=true}};var createPlayer=function(context){var playerSettings=getPlayerSettings();timing.created=_.now();player=jwplayer(SETTINGS.playerContainerID).setup(playerSettings);if(!_.isEmpty(player)){if(debug&&!playerDestroyed){globalize(context,SETTINGS.playerContainerID)}var callbacks=_.extend({},ptvCallbacks,jwSetupCallbacks,jwPlaylistCallbacks,jwBufferCallbacks,jwPlaybackCallbacks,jwSeekCallbacks,jwVolumeCallbacks,jwResizeCallbacks,jwQualityCallbacks,jwCaptionsCallbacks,jwControlsCallbacks,jwAdvertisingCallbacks,jwMetadataCallbacks);_.each(callbacks,_.bind(function(callback,name){if(typeof callback==="function"){if(ptvCallbacks[name]){ptvCallbackHandlers[name]=decorator(context,callback,name)}else{if(player[name]){if(!playerDestroyed||(name!=="onReady")){player[name](decorator(context,callback,name))}}else{if(playerDestroyed&&(name==="onRecreated")){player.onReady(decorator(context,callback,name))}}}}},context));return context}};var init=function(context){debug=_.has(SETTINGS,"debug")?SETTINGS.debug:debug;context.externals=callbacks||{};cachedVideoData=SETTINGS.videoData||{};externalContext=SETTINGS.context||context;contextPath=SETTINGS.contextPath||"//www.washingtonpost.com/posttv";adConfig=SETTINGS.adConfig||{};autoplay=SETTINGS.autoplay||false;getAdTagCB=adConfig.getAdTag||_.noop;shouldPlayAdCB=adConfig.shouldPlayAd||_.noop;adLoadWaitTime=adConfig.adLoadWaitTime||3*ONE_SECOND;delete SETTINGS.context;allowControls=_.has(SETTINGS,"allowControls")?SETTINGS.allowControls:allowControls;hideBuffering=_.has(SETTINGS,"hideBuffering")?SETTINGS.hideBuffering:hideBuffering;SETTINGS.controls=allowControls&&!hideBuffering;adManager=TWP.PostTV.AdManager({adType:getAdType(),adSkipTime:adConfig.adSkipTime||15,adSkipThreshold:adConfig.adSkipThreshold||3,playerID:SETTINGS.playerContainerID,companionAdContainerID:SETTINGS.companionAdContainerID,skipAd:skipAd,showControls:showControls,hideControls:hideControls});return createPlayer(context)};var JWPlayerWrapper={setVideoJSON:function(newVideoJSON){videoJSON=newVideoJSON},play:play,forcePlay:forcePlay,pause:pause,stop:stop,seek:seek,load:load,loadAd:loadAd,pauseAd:pauseAd,playAd:playAd,skipAd:skipAd,getState:function(){return player?player.getState():null},getVideosPlayed:function(){return videosPlayed},isPaused:isPaused,isPlaying:isPlaying,getPosition:getPosition,getElementID:getElementID,isFullscreen:isFullscreen,getProvider:getProvider,isFlash:isFlash,isHTML5:isHTML5,isYouTube:isYouTube,hasPlayedAd:function(){return playedAd},isPlayingAd:function(){return playingAd},isPlayingVideo:function(){return playingVideo},isBuffering:function(){return buffering},isBufferingExpected:function(){return bufferingExpected},getSkin:function(){return skin},getAdMeta:function(){return adMeta},get$playerContainer:get$playerContainer,get$innerWrapper:get$innerWrapper,getVolume:getVolume,setVolume:setVolume,hideControls:hideControls,showControls:showControls,hidePlayer:hidePlayer,showPlayer:showPlayer,setAutoplay:setAutoplay,getAutoplay:function(){return autoplay},destroyPlayer:destroyPlayer};return init(JWPlayerWrapper)};TWP.PostTV.PlayerJW=(function($,_,undefined){return function(args){var PLAYER_VENDOR="jw";var AD_LOAD_WAIT_TIME=(TWP.PostTV.jwPlayerConfig.adLoadWaitTime||3)*ONE_SECOND;var EDITORIAL_PLAYBACK_WAIT_TIME=TWP.PostTV.jwPlayerConfig.editorialPlaybackWaitTime||5;var CAPITIONS_CONFIDENCE_MINIMUM=TWP.PostTV.jwPlayerConfig.captionsConfidenceMinimum||0.75;var SPINNER_WAIT_TIME=TWP.PostTV.jwPlayerConfig.spinnerWaitTime||1;var DEFAULT_ADZONE="wpni.video.oodef";var RATIO_16X9=9/16;var INVERSE_RATIO_16X9=16/9;var BLANK_AD="/resources/assets/adTags/blankAd.xml";var WHEN_TO_LOAD_RECOMMENDED_VIDEOS=0.8;var self=this;var playbackReady=false;var currentVideoTitle=null;var previousVideoTitle=null;var playheadTimeChangedArgs={};var adSkipTime=args.adSkipTime||15;var adSkipThreshold=args.adSkipThreshold||3;self.debug=(window.wp_pb&&wp_pb.contextPath&&wp_pb.contextPath!=="/posttv"&&wp_pb.contextPath!=="/pb"&&wp_pb.contextPath!=="/video")||(window.location.host.indexOf("local")>-1)||(window.queryStringObj&&queryStringObj.ptvdebug=="true")?true:false;self.debugTracking=(window.queryStringObj&&queryStringObj.ptvdebugtracking=="true")?true:false;self.debugInfo={};var contextPath=window.wp_pb&&wp_pb.contextPath?wp_pb.contextPath:window.location.protocol+"//www.washingtonpost.com/posttv";var fullJsUrl=$('script[src*="jwPlayerWrapper.js"], script[src*="jwPlayerWrapper.min.js"]').attr("src");if(fullJsUrl){var fullJsUrlResources=fullJsUrl.indexOf("/static/js/posttv")>-1?fullJsUrl.indexOf("/static/js/posttv"):fullJsUrl.indexOf("/resources/js/posttv");if(fullJsUrlResources>-1){contextPath=fullJsUrl.substr(0,fullJsUrlResources);if(contextPath.indexOf("//")===0){contextPath=window.location.protocol+contextPath}}}if(self.debug){console.debug("contextPath:",contextPath)}var titleOverlayTemplate=createTemplate('<div class="ptv-video-headline-container"><span class="ptv-video-headline"><%= headline.title ? headline.title : "" %></span></div>');var msgBoxTemplate=createTemplate('			<div class="ptv-msg-box <%= config.className ? config.className : "" %>" style="position: absolute; top: 0; right: 0; <%= config.style ? config.style : "" %>">				<%= config.html ? config.html : "" %>			</div>		');var debugOverlayTemplate=createTemplate('			<div class="debug-overlay" style="width: 50%; height: 100%; pointer-events: auto; background-color: #000; opacity: 0.7; padding: 5px">			</div>		');var debugContentTemplate=createTemplate('			<div class="debug-content" style="color: #CCC; text-shadow: 0px 0px 3px rgba(0, 0, 0, 0.75);">			<% _.each(debug, function(value, key) { %>				<p><%= key %>: <%= value %></p>			<% }); %>			</div>		');var gptTemplate=createTemplate('//pubads.g.doubleclick.net/gampad/ads?sz=640x480&iu=%2F701%2F<%= adConfig.adSetConfig && adConfig.adSetConfig.adSetZone ? adConfig.adSetConfig.adSetZone : DEFAULT_ADZONE %><%= client.isMobile ? "_mweb" : client.isTablet ? "_tablet": "" %>&ciu_szs=300x250&impl=s&gdfp_req=1&env=vp&output=vast&unviewed_position_start=1&url=<%= encodeURI(window.location.href) %>&correlator=<%= _.now() %>&scp=&cust_params=<%= isTrending ? encodeURIComponent("tv=y&") : "" %><%= jw_pt ? encodeURIComponent("jw_pt=" + jw_pt + "&") : "" %><%= shape ? encodeURIComponent("shape=" + shape + "&") : "" %><%= excl_cat ? encodeURIComponent("excl_cat=" + excl_cat + "&") : "" %><%= adTagSuffix ? encodeURIComponent(adTagSuffix) : encodeURIComponent("vid=15,30") %>');var pfadxTemplate=createTemplate('//ad.doubleclick.net/N701/pfadx/<%= adConfig.adSetConfig && adConfig.adSetConfig.adSetZone ? adConfig.adSetConfig.adSetZone : DEFAULT_ADZONE %><%= client.isMobile ? "_mweb" : client.isTablet ? "_tablet": "" %>;frmt=2;frmt=1;frmt=0;sz=640x480;tp_video=null;dmct=text/html;ord=<%= _.now() %><%= adTagSuffix ? adTagSuffix : ";vid=15;vid=30" %>');var blankAdTag=function(){return contextPath+BLANK_AD};self.isTrending=function(videoData,trendingData){videoData=videoData||self.json;trendingData=trendingData||self.trendingJson;var trendingEnabled=_.has(queryStringObj,"trendingEnabled")?Boolean(parseInt(queryStringObj.trendingEnabled)):true;var uuid=videoData.contentConfig.uuid;if(trendingEnabled&&trendingData&&trendingData.topVideos&&trendingData.topVideos.length){for(var i=0;i<trendingData.topVideos.length;i++){if(trendingData.topVideos[i].videoId===uuid){return true}}}return false};self.getAdTag=function(videoData){videoData=videoData||self.json;var config={adConfig:queryStringObj.adSetZone?{adSetConfig:{adSetZone:queryStringObj.adSetZone}}:(args.adSetZone&&args.adSetZone.length>0)?{adSetConfig:{adSetZone:args.adSetZone}}:videoData.adConfig,adTagSuffix:queryStringObj.adTagSuffix?queryStringObj.adTagSuffix:args.adTagSuffix,client:queryStringObj.adSetZone?{}:{isMobile:TWP.PostTV.isMobile,isTablet:TWP.PostTV.isTablet},isTrending:self.isTrending(),jw_pt:(function(){var toReturn;toReturn=TWP.PostTV.isFlashEnabled&&args.args.type!=="html5"?"flash":"html5";if(self.isEmbed()){toReturn+="_embed"}else{if(self.isLeafPage()){toReturn+="_leaf"}else{toReturn+="_other"}}if(self.debug){console.log("jw_pt:",toReturn)}return toReturn})(),shape:(function(){if(videoData.contentConfig.vertical){return"v"}else{return undefined}})(),excl_cat:(function(){var toReturn,toScan=[];try{if(videoData.contentConfig.title){toScan.unshift(videoData.contentConfig.title)}if(videoData.contentConfig.blurb){toScan.unshift(videoData.contentConfig.blurb)}if(videoData.metaConfig.tags){toScan.unshift(videoData.metaConfig.tags)}if(window.vidExclusions&&toScan.length>0){toReturn=window.vidExclusions(toScan)}}catch(e){if(self.debug){console.log("Unable to find exclusion cats",e)}}return(toReturn&&toReturn.length>0)?toReturn.join(","):undefined})(),DEFAULT_ADZONE:DEFAULT_ADZONE};var adTag=queryStringObj.adTagType==="pfadx"?pfadxTemplate(config):gptTemplate(config);if(self.debug||queryStringObj.adSetZone||queryStringObj.adTagType||queryStringObj.adTagSuffix){console.debug({adTag:adTag})}return adTag};self.recommendedVideos=TWP.PostTV.RecommendedVideos();self.create=function(){var createSettings=function(callback){var settings={debug:self.debug,context:self,contextPath:contextPath,playerContainerID:self.playerElementId,companionAdContainerID:"companion-ad-container",hideBuffering:true,autoplay:self.autoplay,aspectRatio:args.aspectRatio,allowControls:args.allowControls,showEndscreen:self.showEndscreen,autoplayPlaylist:self.mobilePlaylist,showSharingOverlay:self.showSharingOverlay,hideOverlayButtons:self.hideOverlayButtons,ptvType:self.playerType,playerType:args.args.type&&args.args.type==="html5"?"html5":"flash",adConfig:{adType:queryStringObj.adType?queryStringObj.adType:"googima",adLoadWaitTime:AD_LOAD_WAIT_TIME,adSkipTime:adSkipTime,adSkipThreshold:adSkipThreshold,shouldPlayAd:self.shouldPlayAd,getAdTag:self.getAdTag},customVolume:args.customVolume};if(self.debug){console.log("ad client:",settings.adConfig.adType)}if(self.mobilePlaylist){self.jwSetupAutoplayPlaylist(self.json,function(playlist){settings.videoData=playlist;callback(settings)})}else{settings.videoData=self.jwSetupVideoData(self.json);callback(settings)}};var createPlayer=function(settings){self.playerLoadTime=_.now();self.player=JWPlayerWrapper(settings,self.jwCallbacks,self.json);PubSub.publish(TWP.PostTV.EVENTS.OO_PLAYER_INITIALIZED,args)};if(typeof window.jwplayer!=="undefined"){createSettings(createPlayer)}else{console.debug("jwplayer is undefined!");self.sendTrackingData("PostTV Player JW Error",["event9997"],{errorCode:"ptv_jwUndefined",errorText:"JW is undefined."},{splunk:true,omniture:true,nielsen:true})}};self.jwSetupTitle=function(json){json=json||self.json;var title=json.contentConfig&&json.contentConfig.title?json.contentConfig.title:"";return{title:title}};self.imageResizeService=function(src,width,height){src=src?src:"http://www.washingtonpost.com/posttv/static/img/posttv/posttv_error_black.jpg";width=width?width:"";if(args.json.contentConfig.vertical){height=""}else{height=height?height:width?width*RATIO_16X9:""}width=width?"&w="+width:"";height=height?"&h="+Math.ceil(height):"";return"//img.washingtonpost.com/wp-apps/imrs.php?src="+src+width+height};self.jwSetupImage=function(json){try{var desiredWidth=self.isLeafPage()?640:window.frameElement&&$(window.frameElement).attr("data-promo-width")?$(window.frameElement).attr("data-promo-width"):self.$playerContainer.width();json.promoImage.image=json.promoImage.image||{};json.promoImage.image.resized=json.promoImage.image.resized?json.promoImage.image.resized:json.promoImage.image.url?self.imageResizeService(json.promoImage.image.url,desiredWidth):""}catch(e){console.log("error resizing endscreen image")}return{image:json.promoImage.image.resized}};self.jwSetupClosedCaptions=function(videoData){var closedCaptions={};var subtitlesConfig=videoData.subtitlesConfig||{};if(TWP.PostTV.isMobile||TWP.PostTV.isTablet){return closedCaptions}if(subtitlesConfig.confidence&&(subtitlesConfig.confidence>=CAPITIONS_CONFIDENCE_MINIMUM)){if(subtitlesConfig.subtitlesUrls&&subtitlesConfig.subtitlesUrls.length>0){var ccURLs=_.filter(subtitlesConfig.subtitlesUrls,function(cc){return _.contains(["DFXP","SRT","WEB_VTT"],cc.format)});if(ccURLs.length>0){var englishCaptions={file:ccURLs[0].url,label:"English",kind:"captions","default":false};closedCaptions.tracks=[englishCaptions]}}}if(self.debug){console.debug("CC data:",videoData.subtitlesConfig);console.debug("CC config:",closedCaptions)}return closedCaptions};self.bestAvailableStream=function(streams,maxBitrate,preference){var config=TWP.PostTV.jwPlayerConfig||{};var clientType=TWP.PostTV.isMobile?"mobile":TWP.PostTV.isTablet?"tablet":"desktop";if(config&&config.maxBitrates&&config.maxBitrates[clientType]&&config.maxBitrates[clientType][preference]&&config.maxBitrates[clientType][preference].maxBitrate&&!queryStringObj.maxBitrate){maxBitrate=config.maxBitrates[clientType][preference].maxBitrate}return streams?_.chain(streams).reject(function(stream){if(typeof maxBitrate=="undefined"||maxBitrate<=0){return false}return stream.bitrate>maxBitrate?true:false}).map(function(stream){return _.extend(stream,{height:_.isNumber(stream.height)?stream.height:0,width:_.isNumber(stream.width)?stream.width:0,bitrate:_.isNumber(stream.bitrate)?stream.bitrate:0})}).max(function(stream){return stream.height+stream.width+stream.bitrate}).value():{}};self.fallbackStream=function(streams){var config=TWP.PostTV.jwPlayerConfig||{};var clientType=TWP.PostTV.isMobile?"mobile":TWP.PostTV.isTablet?"tablet":"desktop";var fallbackBitrate;if(config&&config.maxBitrates&&config.maxBitrates[clientType]&&config.maxBitrates[clientType].fallback){fallbackBitrate=config.maxBitrates[clientType].fallback}if(_.isNumber(queryStringObj.fallbackBitrate)){fallbackBitrate=queryStringObj.fallbackBitrate}return(fallbackBitrate&&streams)?_.chain(streams).reject(function(stream){return stream.bitrate>fallbackBitrate?true:false}).map(function(stream){return _.extend(stream,{height:_.isNumber(stream.height)?stream.height:0,width:_.isNumber(stream.width)?stream.width:0,bitrate:_.isNumber(stream.bitrate)?stream.bitrate:0})}).max(function(stream){return stream.height+stream.width+stream.bitrate}).value():{}};self.jwSetupVideoData=function(videoData){var streams=videoData.contentConfig.streams;var config=TWP.PostTV.jwPlayerConfig||{};var ooStreamLoadSent=false;var osType=TWP.PostTV.BrowserInfo.OS.toLowerCase();var browserType=TWP.PostTV.BrowserInfo.browser.toLowerCase();var clientType=TWP.PostTV.isMobile?"mobile":TWP.PostTV.isTablet?"tablet":"desktop";osType=osType.indexOf("kindle")>=0?"android":osType;var title=self.jwSetupTitle(videoData);var image=self.jwSetupImage(videoData);var tracks=self.jwSetupClosedCaptions(videoData);var maxBitrate=queryStringObj.maxBitrate?_.intersection([queryStringObj.maxBitrate],["160","300","600","1200","2000","5400"]):config.maxBitrates&&config.maxBitrates[clientType]&&config.maxBitrates[clientType][osType]?config.maxBitrates[clientType][osType].maxBitrate:config.maxBitrates&&config.maxBitrates[clientType]?config.maxBitrates[clientType].maxBitrate:config.maxBitrates?config.maxBitrates.maxBitrate:null;maxBitrate=maxBitrate||({mobile:300,tablet:600,desktop:2000})[clientType];var streamPreference=queryStringObj.streamPreference?_.intersection(queryStringObj.streamPreference.split("|"),["_master.m3u8",".m3u8",".smil",".mp4",".webm",".m4v"]):config.streamPreferences&&config.streamPreferences[clientType]&&config.streamPreferences[clientType][args.args.type]?config.streamPreferences[clientType][args.args.type].streamPreference:config.streamPreferences&&config.streamPreferences[clientType]&&config.streamPreferences[clientType][osType]?config.streamPreferences[clientType][osType].streamPreference:config.streamPreferences&&config.streamPreferences[clientType]&&config.streamPreferences[clientType][browserType]?config.streamPreferences[clientType][browserType].streamPreference:config.streamPreferences&&config.streamPreferences[clientType]?config.streamPreferences[clientType].streamPreference:config.streamPreferences?config.streamPreferences.streamPreference:null;streamPreference=streamPreference||["_master.m3u8",".m3u8",".smil",".mp4",".webm",".m4v"];var grouped=_.groupBy(streams,function(stream){return _.find(streamPreference,function(preference){return stream.url.endsWith(preference)})});var sources;if(queryStringObj.source){sources=[{"default":true,file:queryStringObj.source}]}else{sources=_.chain(streamPreference).map(function(preference){return self.bestAvailableStream(grouped[preference],maxBitrate,preference)}).compact().map(function(stream){return _.isEmpty(stream)?null:{file:stream.url}}).compact().value()}if(!sources.length){if(self.debug){console.debug("normal source not found, searching for fallback ")}sources=_.chain(streamPreference).map(function(preference){return self.fallbackStream(grouped[preference])}).compact().map(function(stream){return _.isEmpty(stream)?null:{file:stream.url}}).compact().value();if(sources.length){if(self.debug){console.debug("using fallback ")}self.sendTrackingData("PostTV Player JW Fallback Stream",["event9995_01"],{errorCode:"ptv_fallbackStream",errorText:"PostTV video is using a fallback stream."},{splunk:true,omniture:true,nielsen:true})}}if(self.debug&&!sources.length){console.debug("no source found")}_.each(sources,function(source){if(config.httpsToHttp||queryStringObj.httpsToHttp==="true"){source.file=source.file.replace("https://","http://")}if(source.file&&source.file.indexOf("ooyala.com")>-1&&!ooStreamLoadSent){self.sendTrackingData("PostTV Player JW Ooyala Stream",["event9989_03"],{errorCode:"ptv_ooStreamLoad",errorText:"ooyala stream loaded"},{splunk:true});ooStreamLoadSent=true}});if(videoData.youtubeConfig&&videoData.youtubeConfig.youtubeVideoId){sources.push({file:"//www.youtube.com/watch?v="+videoData.youtubeConfig.youtubeVideoId})}if((videoData.contentConfig.dateConfig&&videoData.contentConfig.dateConfig.publicationEndDate&&_.now()>=videoData.contentConfig.dateConfig.publicationEndDate)||_.has(queryStringObj,"noSources")){sources=[]}if(self.debug){console.debug("sources: ",sources)}return _.extend({sources:sources},title,image,tracks)};self.jwSetupAutoplayPlaylist=function(videoData,callback){self.recommendedVideos.fetch(videoData,function(data){data.unshift(videoData);self.videoDataList=data;var playlist=_.map(data,self.jwSetupVideoData);callback(playlist)})};self.jwSetupFile=function(json){var streams=json.contentConfig.streams;var config=TWP.PostTV.jwPlayerConfig;config.presets={presets:["_master.m3u8",".m3u8",".smil",".mp4",".webm"],fallback:[".webm",".mp4"]};var predicate=function(tail){return !_.isEmpty(_.filter(streams,function(stream){return stream.url.endsWith(tail)}))};var media=_.find(config.presets,predicate);var fallback=_.find(config.fallback,predicate);var fileObj=streams?_.chain(streams).filter(function(stream){return stream.url.endsWith(media)}).max(function(stream){return stream.width+stream.height+(_.isNumber(stream.bitrate)?stream.bitrate:0)}).value():{};var fallbackObj=fallback?_.chain(streams).filter(function(stream){return stream.url.endsWith(fallback)}).max(function(stream){return stream.width+stream.height+(_.isNumber(stream.bitrate)?stream.bitrate:0)}).value():{};return{file:fileObj.url,fallback:fallbackObj.url}};self.setVolumeInCookie=function(volume){try{TWP.PostTV.setCookie("videovolume",parseInt(volume),new Date("1/1/2025"))}catch(e){}};self.getVolumeFromCookie=function(){var volume=parseInt(TWP.PostTV.getCookie("videovolume"));volume=isNaN(volume)?0:volume>100?100:volume<0?0:volume;return volume};self.update=function(json,args){var videoData=self.jwSetupVideoData(json);var methodeUuid=json.contentConfig&&json.contentConfig.uuid?json.contentConfig.uuid:"";if(self.isLeafPage()&&TWP.PostTV.shouldRefreshPage){if(document.URL.indexOf("www.washingtonpost.com/posttv/")>-1||document.URL.indexOf("www.washingtonpost.com/video/")>-1){window.location.href=json.contentConfig.permaLinkURL}else{window.location.href=contextPath+"/c/video/"+json.contentConfig.uuid}return}self.json=json;self.args=args;self.player.setVideoJSON(json);self.updateChartbeatID(methodeUuid);args=_.extend(args,{videoJson:json,adSetCode:self.adSetCode,hide:self.hide,methodeUuid:methodeUuid});self.methodeUuid=methodeUuid;if(args.isAutoPlaying){self.isAutoplaying=true}self.player.load(videoData);PubSub.publish(TWP.PostTV.EVENTS.WILL_CHANGE_EMBED_CODE,args);if(args.updateURL){self.updatePermalink(json)}if(self.isLeafPage()){if(json.contentConfig&&json.contentConfig.disableExternalEmbed===true){$('[data-toggle-overlay="embed"]').addClass("hide")}else{$('[data-toggle-overlay="embed"]').removeClass("hide")}}if(typeof args.callback==="function"){args.callback.call()}return self};self.isLeafPage=function(){return self.playerType==="posttv-player"&&TWP.isLeafPage};self.isEmbed=function(){return self.playerType==="posttv-embed"};self.getProvider=function(){return self.player.getProvider()};self.updatePermalink=function(json){try{var permaLinkURL=TWP.PostTV.Util.getPermaLinkURL(json,self.isEmbed());if(typeof permaLinkURL==="undefined"){return}document.title=json.contentConfig.title;if(!self.isEmbed()){history.pushState({data:json},json.contentConfig.title,permaLinkURL)}}catch(e){console.error(e)}window.onpopstate=function(event){if(event&&event.state&&event.state.data){self.update(event.state.data,{})}}};self.onPlayNextVideo=function(args){var json=args.json;var ajaxUrl;if($.isEmptyObject(json)){if(args.methodeUuid){$.ajax({type:"GET",url:ajaxUrl="//www.washingtonpost.com/posttv/c/videojson/"+args.methodeUuid,contentType:"application/json",jsonpCallback:"cb_"+args.methodeUuid.replace(/-/g,""),data:{resType:"jsonp"},dataType:"jsonp",cache:true,success:function(data){self.update(data[0],args)},error:function(e){if(typeof window.console==="function"){console.error("Failed to fetch video data for video: "+args.methodeUuid+", e: "+e.message)}self.sendTrackingData("PostTV Player Error",["event999"],{errorCode:"ptv_cannotRetrieveVideoJson",errorText:"Cannot retrieve video json data at: "+ajaxUrl},{splunk:true,omniture:true,nielsen:true})}})}else{console.error("At least one of video json or uuid is required for updating the player to play the next video.");self.sendTrackingData("PostTV Player Data Error",["event999"],{errorCode:"ptv_unableToPlayNextVideo",errorText:"At least one of video json or uuid is required for updating the player to play the next video."},{splunk:true,omniture:true,nielsen:true})}}else{self.update(json,args)}self.autoDisplayHeadline=args.autoDisplayHeadline?true:false;if(!self.autoplay){TWP.PostTV.playButtonClickedTime=null}};self.handleTrackingData=function(evt,args){if(args&&args.evtName&&args.evtType){self.sendTrackingData(args.evtName,args.evtType,args,{splunk:true,omniture:true,nielsen:true})}};self.adsAllowed=function(json){var videoAllowsAds=(args.allowAd&&!TWP.PostTV.getPreRollsBlocked()&&!TWP.PostTV.shouldNotPlayPrerollAds&&(self.player&&!self.player.isYouTube())&&(json.adConfig&&json.adConfig.playVideoAds));if(self.debug&&!videoAllowsAds){var reason=!args.allowAd?"args.allowAd":TWP.PostTV.getPreRollsBlocked()?"TWP.PostTV.getPreRollsBlocked()":TWP.PostTV.shouldNotPlayPrerollAds?"TWP.PostTV.shouldNotPlayPrerollAds":(self.player&&self.player.isYouTube())?"youtube":(json.adConfig&&json.adConfig.playVideoAds)?"json.adConfig.playVideoAds":"default";console.debug("Ads not allowed:",reason)}return videoAllowsAds};self.isDueForAnAd=(function(){var adFreq=typeof args.adFreq!=="undefined"?args.adFreq:TWP.PostTV.adFrequency;if(!isNaN(parseInt(adFreq))&&!isNaN(parseFloat(adFreq))){adFreq=eval(adFreq)}if(isNaN(adFreq)||adFreq<0||adFreq>1){adFreq=TWP.PostTV.adFrequency}var inverseAdFreq=adFreq===0?Infinity:1/adFreq;return function(){var dueForAnAd=inverseAdFreq!==Infinity&&((TWP.PostTV.getCount()%inverseAdFreq)<1);return dueForAnAd}})();self.shouldPlayAd=function(json){json=json||self.json;var playAd=true;var reason="default";if(self.adsAllowed(json)){if(typeof self.args.shouldPlayAd!=="undefined"){playAd=self.args.shouldPlayAd?true:false;self.args.shouldPlayAd=false;reason="self.args.shouldPlayAd"}else{if((json.adConfig&&json.adConfig.forceAd)){playAd=true;reason="json.adConfig.forceAd"}else{if(self.showAdsForFirstVideoOnly){playAd=!self.showedAdsForFirstVideo;reason="show ads for first video only"}else{if(args.adPattern&&args.adPattern.length){var spotInPattern=TWP.PostTV.getCount()%args.adPattern.length;playAd=args.adPattern[spotInPattern]==="1";reason="ad pattern"}else{if(self.isTrending()){playAd=true;reason="trending video"}else{playAd=self.isDueForAnAd();reason="due for an ad"}}}}}}else{reason="ads not allowed";playAd=false}if(self.debug){console.debug("shouldPlayAd:",playAd,"-",reason)}return playAd};self.removeHeadline=function(){if(self.$headline){clearTimeout(self.$headline.timeoutID);self.$headline.remove();self.player.get$playerContainer().off("mouseenter");self.player.get$playerContainer().off("mouseleave");self.player.get$playerContainer().off("touchstart")}};self.setupHeadline=function(){if(self.isEmbed()){var timeoutID;self.removeHeadline();self.$headline=$(titleOverlayTemplate({headline:self.jwSetupTitle()}));self.player.get$innerWrapper().append(self.$headline);if(self.autoDisplayHeadline){if(!self.player.isPlayingAd()){self.autoDisplayHeadline=false;clearTimeout(self.$headline.timeoutID);self.$headline.show();self.$headline.timeoutID=setTimeout(function(){self.$headline.fadeOut()},4*ONE_SECOND)}}self.player.get$playerContainer().mouseenter(function(){if(!self.player.isPlayingAd()){self.$headline.show()}});self.player.get$playerContainer().mouseleave(function(){self.$headline.hide()});self.player.get$playerContainer().on("touchstart",function(){if(!self.player.isPlayingAd()){clearTimeout(self.$headline.timeoutID);self.$headline.fadeIn();self.$headline.timeoutID=setTimeout(function(){self.$headline.fadeOut()},4*ONE_SECOND)}})}};self.updatePlayLocalStorage=function(){if(!window.localStorage){return false}try{var ls=$.parseJSON(localStorage.getItem("twpVideoHistory"))||{},now=_.now();ls[self.methodeUuid]=ls[self.methodeUuid]||{};ls[self.methodeUuid].timestamp=now;$.each(ls,function(uuid,val){if(!val.timestamp||((now-val.timestamp)>ONE_DAY)){delete ls[uuid]}});localStorage.setItem("twpVideoHistory",JSON.stringify(ls))}catch(e){}};self.initPlaybackTimeoutChecker=function(){var i=0;var maxRuns=EDITORIAL_PLAYBACK_WAIT_TIME;var intervalTime=ONE_SECOND;var intervalId;function stopChecker(reason){reason=reason||"";if(self.debug){console.debug("stopping checker due to "+reason)}clearInterval(intervalId)}function checker(){i++;if(!self.player.isPlaying()){stopChecker(self.player.getState())}if(i>maxRuns){stopChecker(((maxRuns*intervalTime)/ONE_SECOND)+" seconds passed.");if(self.playheadTime==0){self.sendTrackingData("JW Player Editorial Playback Timeout","event9990",{errorCode:"ptv_jwEditorialTimeout",errorText:"Player reports playheadTime of "+self.playheadTime+" after "+((maxRuns*intervalTime)/ONE_SECOND)+" seconds.  Player state: "+self.player.getState()},{splunk:true,omniture:true,nielsen:true});self.player.seek(5)}}}intervalId=setInterval(checker,intervalTime)};self.getEventCode=function(){var eventCodes={errorLoadingPlugin:{code:"event9991_01",text:"error loading plugin"},errorLoadingSkin:{code:"event9991_02",text:"error loading skin"},errorLoadingPluginFnf:{code:"event9991_03",text:"could not load plugin: file not found"}};return function(eventMessage,defaultEventCode){var eventMessageString=JSON.stringify(eventMessage).toLowerCase();var matchedEvent=_.find(eventCodes,function(eventCodeObj){return eventMessageString.indexOf(eventCodeObj.text)>=0});return matchedEvent?matchedEvent.code:defaultEventCode}}();self.hideSocialSharing=function(){self.$socialSharing=self.$socialSharing||$("#canvas").find(".show-for-medium-up .social ul, .show-for-small-only.social ul, .social-share-link");if(self.$socialSharing){self.$socialSharing.hide()}};self.showSocialSharing=function(){self.$socialSharing=self.$socialSharing||$("#canvas").find(".show-for-medium-up .social ul, .show-for-small-only.social ul, .social-share-link");if(self.$socialSharing){self.$socialSharing.show()}};self.showPromoScreen=function(){self.$promo=self.$promo||$(".plugins .ptv-promo");self.$promo.addClass("ptv-promo-loaded").show();self.$promo.find(".ptv-promo-video-headline-container").show();if(TWP.PostTV.isDeskweb){self.$promo.one("click",function(e){self.$promo.hide();self.play()})}};self.ptvCallbacks={onDestroyPlayer:function(){window._cbv.push(["removePlayer",jwplayer(self.playerElementId)])},onBufferingComplete:function(){if(self.player.isBufferingExpected()){self.sendTrackingData("Player buffered",["event114"],{},{splunk:true})}else{self.sendTrackingData("Player buffered",["event9993"],{},{splunk:true})}},onFirstFrame:function(time){PubSub.publish(TWP.PostTV.EVENTS.FIRST_FRAME);self.preventHpRefresh();if(time.firstOverallFrame){TWP.PostTV.incrementCount()}var genesis=self.isEmbed()?TWP.PostTV.playButtonClickedTime:TWP.PostTV.pageLoadTime;self.debugInfo.pageLoadDelta=self.debugInfo.pageLoadDelta||(time.firstFrame-genesis)/ONE_SECOND;self.debugInfo.playerLoadDelta=self.debugInfo.playerLoadDelta||(time.firstFrame-self.playerLoadTime)/ONE_SECOND},onInitialAdPlay:function(){self.sendTrackingData("onInitialAdPlay","adPlay",{},{comscore:true})},onFirstAdFrame:function(time){self.debugInfo.adLoadDelta=time.delta;self.hideSocialSharing();self.removeHeadline();if(self.trackingLevel==="player-default-tracking"){var adMeta=self.player.getAdMeta();var params={creativeType:adMeta&&adMeta.creativetype?adMeta.creativetype:"",videosPlayed:self.player.getVideosPlayed(),adLoadDelta:self.debugInfo.adLoadDelta};if(self.player.getVideosPlayed()===0){_.extend(params,{pageLoadDelta:self.debugInfo.pageLoadDelta,playerLoadDelta:self.debugInfo.playerLoadDelta})}self.sendTrackingData("Video Ad Start",["event7"],params,{splunk:true,omniture:true,nielsen:true})}if(self.debug){if(self.player.getVideosPlayed()===0){console.debug("Page load to first frame:",self.debugInfo.pageLoadDelta);console.debug("Player load to first frame:",self.debugInfo.playerLoadDelta)}console.debug("Ad load to first frame:",self.debugInfo.adLoadDelta)}},onAdTimeout:function(adMeta){if(self.trackingLevel==="player-default-tracking"){self.sendTrackingData("Video Ad Error",["event9996_1"],{adError:JSON.stringify(adMeta)},{splunk:true})}},onAdSkip:function(){if(self.trackingLevel=="player-default-tracking"){self.sendTrackingData("Skip Ad Button Clicked",["event34"],{},{splunk:true,omniture:true,nielsen:true})}},onAdEnd:function(adMeta){self.showSocialSharing();self.allowHpRefresh();if(typeof self.callbacks.adCompleted=="function"){self.callbacks.adCompleted(self)}PubSub.publish(TWP.PostTV.EVENTS.ADS_CLEARED,args);self.sendTrackingData("onAdEnd","stop",{},{comscore:true})},onInitialVideoPlay:function(){self.initPlaybackTimeoutChecker()},onFirstVideoFrame:function(time){self.debugInfo.videoLoadDelta=time.delta;if(self.trackingLevel==="player-default-tracking"){var loadTimes=self.player.getVideosPlayed()===0?{videosPlayed:self.player.getVideosPlayed(),hasPlayedAd:self.player.hasPlayedAd(),videoLoadDelta:self.debugInfo.videoLoadDelta,pageLoadDelta:self.debugInfo.pageLoadDelta,playerLoadDelta:self.debugInfo.playerLoadDelta}:{videosPlayed:self.player.getVideosPlayed(),hasPlayedAd:self.player.hasPlayedAd(),videoLoadDelta:self.debugInfo.videoLoadDelta};self.trackProgress(0,loadTimes)}self.setupHeadline();PubSub.publish(TWP.PostTV.EVENTS.EDITORIAL_PLAY_STARTED);self.updatePlayLocalStorage();if(typeof self.callbacks.editorialPlayStarted=="function"){self.callbacks.editorialPlayStarted(self)}if(self.debug){if(self.player.getVideosPlayed()===0){console.debug("Page load to first frame:",self.debugInfo.pageLoadDelta);console.debug("Player load to first frame:",self.debugInfo.playerLoadDelta)}console.debug("Video load to first frame:",self.debugInfo.videoLoadDelta)}},onVideoEnd:function(){delete self.debugInfo.bandwidths;delete self.debugInfo.bandwidthLow;delete self.debugInfo.bandwidthHigh;self.showedAdsForFirstVideo=true;self.removeHeadline();self.allowHpRefresh();self.switchVideo=true;if(self.desktopPlaylist){var nextVideo=self.recommendedVideos.getNextVideo();if(nextVideo){self.player.setAutoplay(true);self.update(nextVideo,self.args)}else{self.showPromoScreen()}}}};self.jwSetupCallbacks={onReady:function(){self.debugInfo.renderingMode=self.player.getProvider();if(self.initialTime){self.player.seek(self.initialTime)}self.playerCreated=true;if(typeof self.callbacks.playerCreated==="function"){self.callbacks.playerCreated(self)}PubSub.publish(TWP.PostTV.EVENTS.PLAYER_CREATED,{videoJson:self.json});PubSub.publish(TWP.PostTV.EVENTS.WILL_CHANGE_EMBED_CODE,{videoJson:self.json});self.sendTrackingData("Player Created",["event110"],{},{splunk:true});self.setupOverlays();self.loadChartbeatVideoScript();if(!isNaN(Number(args.customVolume))){self.player.setVolume(Number(args.customVolume)*100)}},onRecreated:function(){self.debugInfo.renderingMode=self.player.getProvider();if(self.initialTime){self.player.seek(self.initialTime)}self.playerCreated=true;self.sendTrackingData("Player Recreated",["event110"],{},{splunk:true});self.sendTrackingData("Player Recreated",["event110_01"],{},{splunk:true});self.setupOverlays();self.loadChartbeatVideoScript()},onSetupError:function(error){if(self.debug){console.debug("onSetupError:",error)}var isNoSourcesFound=error.message.indexOf("No playable sources found")>-1;var isImgNotFound=error.message.indexOf("Skin image not found: data:image")>-1;if(isNoSourcesFound){$(".ptv-promo").hide();$(".ptv-not-support-msg, .ptv-no-sources-msg").show();self.sendTrackingData("PostTV Player JW Error",["event9995"],{errorCode:"ptv_missingPTSStreams",errorText:"PostTV video is missing PTS streams."},{splunk:true,omniture:true,nielsen:true})}else{if(error.fallback===true&&!TWP.PostTV.isFlashEnabled&&TWP.PostTV.isDeskweb){$(".ptv-not-support-msg, .ptv-flash-required-msg").show()}}var skin=self.player.getSkin();if(!isNoSourcesFound&&(!isImgNotFound||!self.isImgNotFoundSent)){self.sendTrackingData("JW Player Setup Error",self.getEventCode(error,"event9994"),{errorCode:"ptv_jwSetupError",errorText:JSON.stringify(error),skin:skin?skin:"(default)"},{splunk:true,omniture:true,nielsen:true})}if(typeof $.fn.wpLazyLoad!=="undefined"){$("#video-details-module-container, .playlist, .series-playlist").wpLazyLoad({breakpoints:[165,270]})}TWP.PostTV.shouldRefreshPage=true;if(isImgNotFound){self.isImgNotFoundSent=true}}};self.jwPlaylistCallbacks={onPlaylist:function(playlist){if(!TWP.PostTV.isDeskweb&&!self.player.getAutoplay()){self.showPromoScreen()}},onPlaylistItem:function(playlistItem){if(self.mobilePlaylist){self.json=self.videoDataList[playlistItem.index];var methodeUuid=self.json.contentConfig&&self.json.contentConfig.uuid?self.json.contentConfig.uuid:"";self.methodeUuid=methodeUuid;self.updateChartbeatID(methodeUuid);PubSub.publish(TWP.PostTV.EVENTS.WILL_CHANGE_EMBED_CODE,{videoJson:self.json})}if(self.player.isYouTube()){self.sendTrackingData("PostTV Player JW YouTube Stream",["event9995_02"],{errorCode:"ptv_youtubeStream",errorText:"PostTV video is using a YouTube stream."},{splunk:true,omniture:true,nielsen:true})}var params={};if(!self.isContentViewed){if(self.trackingLevel==="player-default-tracking"){self.sendTrackingData("Content View",["event30"],params,{splunk:true,omniture:true,nielsen:true})}self.isContentViewed=true}self.initProgress();if(typeof self.callbacks.embedCodeChanged=="function"){self.callbacks.embedCodeChanged(self)}if(!$.isEmptyObject(self.json)){self.$playerContainer.data("videoJson",self.json)}},onPlaylistComplete:function(){if(self.isEmbed()&&(self.mobilePlaylist||!self.showEndscreen)){self.showPromoScreen()}}};self.jwBufferCallbacks={onBufferChange:function(percentage){}};self.jwPlaybackCallbacks={onPlay:function(state){PubSub.publish(TWP.PostTV.EVENTS.PLAYING,args);self.sendTrackingData("onPlay","play",{},{comscore:true});if(state.oldstate==="PAUSED"){self.sendTrackingData("resume","event16",{},{splunk:true})}},onPause:function(state){if(typeof self.callbacks.onPause==="function"){self.callbacks.onPause(state)}PubSub.publish(TWP.PostTV.EVENTS.PAUSED,args);self.sendTrackingData("pause","event15",{},{splunk:true});self.sendTrackingData("onPause","stop",{},{comscore:true})},onBuffer:function(state){if(state.oldstate==="PLAYING"&&!self.player.isBufferingExpected()){self.sendTrackingData("Player buffering",["event9992"],{},{splunk:true})}else{self.sendTrackingData("Player buffering",["event113"],{},{splunk:true})}},onIdle:function(state){},onComplete:function(){if(typeof self.callbacks.playCompleted==="function"){self.callbacks.playCompleted(self)}if(self.trackingLevel==="player-default-tracking"){self.trackProgress(100)}PubSub.publish(TWP.PostTV.EVENTS.PLAY_COMPLETED,args);self.sendTrackingData("onComplete","stop",{},{comscore:true})},onError:function(error){console.debug("onError:",error);self.sendTrackingData("JW Player Error",self.getEventCode(error,"event9999"),{errorCode:"ptv_jwError",errorText:JSON.stringify(error)},{splunk:true,omniture:true,nielsen:true});self.addMsg({msg:error.message,className:"ptv-error-msg",time:10*ONE_SECOND});if(typeof self.callbacks.videoError=="function"){self.callbacks.videoError(self)}PubSub.publish(TWP.PostTV.EVENTS.ERROR,error.message)}};self.jwSeekCallbacks={onSeek:function(seek){if(typeof self.callbacks.onSeek==="function"){self.callbacks.onSeek(seek)}},onTime:function(time){self.playheadTime=time.position;self.time=time.duration;if(self.trackingLevel=="player-default-tracking"){self.trackProgress()}if(self.desktopPlaylist&&!self.recommendedVideos.requested()){if(!isNaN(time.duration)&&!isNaN(time.position)&&time.position<=time.duration){if(time.position/time.duration>WHEN_TO_LOAD_RECOMMENDED_VIDEOS){self.recommendedVideos.fetch(self.json)}}}var times={time:self.playheadTime,duration:self.time,buffer:"",playStarted:self.player.isPlayingVideo()};if(typeof self.callbacks.playheadTimeChanged==="function"){self.callbacks.playheadTimeChanged(times)}var hasShownControls=false;if(!hasShownControls&&self.playheadTime>2){hasShownControls=true;self.player.showControls()}PubSub.publish(TWP.PostTV.EVENTS.PLAYHEAD_TIME_CHANGED,times)}};self.jwVolumeCallbacks={onMute:function(mute){},onVolume:function(volume){self.setVolumeInCookie(self.volume);if(typeof self.callbacks.volumeChanged==="function"){self.callbacks.volumeChanged(self)}PubSub.publish(TWP.PostTV.EVENTS.VOLUME_CHANGED)}};self.jwResizeCallbacks={onFullscreen:function(fullscreen){PubSub.publish(TWP.PostTV.EVENTS.FULLSCREEN_CHANGED,self.player.isFullscreen())},onResize:function(size){}};self.jwQualityCallbacks={onQualityLevels:function(levels){self.sendTrackingData("Video Data Fetched",["event111"],{},{splunk:true});PubSub.publish(TWP.PostTV.EVENTS.CONTENT_TREE_FETCHED)},onQualityChange:function(){}};self.jwCaptionsCallbacks={onCaptionsList:function(tracks){},onCaptionsChange:function(track){}};self.jwControlsCallbacks={onDisplayClick:function(){}};self.jwAdvertisingCallbacks={onAdClick:function(adClick){},onAdCompanions:function(adCompanions){},onAdComplete:function(adComplete){if(self.trackingLevel=="player-default-tracking"){self.sendTrackingData("Video Ad Complete",["event8"],{},{splunk:true,omniture:true,nielsen:true})}},onAdError:function(error){console.debug("onAdError",error);if(self.trackingLevel=="player-default-tracking"){error.adMeta=self.player.getAdMeta();self.sendTrackingData("Video Ad Error",["event9996"],{adError:JSON.stringify(error)},{splunk:true})}},onAdImpression:function(adImpression){},onAdMeta:function(metadata){},onAdPause:function(adPause){},onAdPlay:function(adPlay){PubSub.publish(TWP.PostTV.EVENTS.AD_STARTED,args);if(typeof self.callbacks.adStarted==="function"){self.callbacks.adStarted(self)}},onAdSkipped:function(){if(self.trackingLevel=="player-default-tracking"){self.sendTrackingData("Skip Ad Button Clicked",["event34"],{},{splunk:true,omniture:true,nielsen:true})}},onAdTime:function(time){},onBeforePlay:function(){if(!playbackReady){playbackReady=true;self.sendTrackingData("Player Controls Ready",["event112"],{},{splunk:true});PubSub.publish(TWP.PostTV.EVENTS.PLAYBACK_READY,args)}},onBeforeComplete:function(){}};self.jwMetadataCallbacks={onMeta:function(metadata){metadata=metadata.metadata||metadata;if(metadata.bandwidth&&metadata.bandwidth<1000000000){metadata.bandwidth=parseFloat((metadata.bandwidth/KIBIBIT).toFixed(3));self.debugInfo.bandwidths=self.debugInfo.bandwidths||[];self.debugInfo.bandwidthLow=self.debugInfo.bandwidthLow||Infinity;self.debugInfo.bandwidthHigh=self.debugInfo.bandwidthHigh||-Infinity;self.debugInfo.bandwidths.push(metadata.bandwidth);self.debugInfo.bandwidthLow=metadata.bandwidth<self.debugInfo.bandwidthLow?metadata.bandwidth:self.debugInfo.bandwidthLow;self.debugInfo.bandwidthHigh=metadata.bandwidth>self.debugInfo.bandwidthHigh?metadata.bandwidth:self.debugInfo.bandwidthHigh}self.debugInfo=self.debugInfo?_.extend(self.debugInfo,metadata):metadata;if(self.$debugOverlay){self.$debugOverlay.html(debugContentTemplate({debug:_.omit(self.debugInfo,["bandwidths","segment"])}))}}};self.jwCallbacks=_.extend({},self.ptvCallbacks,self.jwSetupCallbacks,self.jwPlaylistCallbacks,self.jwBufferCallbacks,self.jwPlaybackCallbacks,self.jwSeekCallbacks,self.jwVolumeCallbacks,self.jwResizeCallbacks,self.jwQualityCallbacks,self.jwCaptionsCallbacks,self.jwControlsCallbacks,self.jwAdvertisingCallbacks,self.jwMetadataCallbacks);self.addMsg=function(params){var time=params.time||2000;this.$msgBox=$(msgBoxTemplate({config:params}));self.player.get$innerWrapper().append(this.$msgBox);this.$msgBox.fadeOut(time,_.bind(function(){this.$msgBox.remove()},this))};self.setupOverlays=function(){var stringContainsIpRegex=/.*(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]).*/g;var isLocal=(document.URL.indexOf("localhost")>-1)||stringContainsIpRegex.test(document.URL);var adBlock={regEx:/ads/i,callback:_.bind(function(){var params={className:"ptv-ad-blocker",style:"color: #CCC; text-shadow: 0px 0px 3px rgba(0, 0, 0, 0.75); margin: 5px;"};TWP.PostTV.togglePreRollsBlocked({expires:new Date("1/1/2022").toGMTString()});if(TWP.PostTV.getPreRollsBlocked()||isLocal){params.html="<strong>Ads disabled</strong>";if(this.player.isPlayingAd()){this.player.skipAd()}}else{params.html="<strong>Ads enabled</strong>"}this.addMsg(params);value=""},self)};PubSub.subscribe(TWP.PostTV.EVENTS.SKIP_AD_DEMO,adBlock.callback);var debug={regEx:/debug/i,callback:_.bind(function(){if(this.$debugOverlay){this.$debugOverlay.remove();delete this.$debugOverlay}else{this.$debugOverlay=$(debugOverlayTemplate());self.player.get$innerWrapper().append(this.$debugOverlay)}value=""},self)};return function(){self.player.get$playerContainer().on("mouseenter.overlay",function(mouseenter){var $this=$(this);var $document=$(document);var value="";$document.off("keypress.overlay").on("keypress.overlay",function(e){value+=String.fromCharCode(e.which);if(adBlock.regEx.test(value)){adBlock.callback()}if(debug.regEx.test(value)){debug.callback()}e.stopPropagation()});$this.on("mouseleave.overlay",function(e){$document.off("keypress.overlay");$this.off("mouseleave.overlay");value=""})})}}();self.bindBlurEvents=function(){$(window).on("focus",function(){self.pause()});$(window).on("blur",function(){self.pause()})};self.unbindBlurEvents=function(){$(window).off("focus blur")};self.preventHpRefresh=function(){try{if(!self.isModal){TWP.hpRefreshTests[self.playerContainerId]=function(){return false}}}catch(e){}};self.allowHpRefresh=function(){try{if(!self.isModal){delete TWP.hpRefreshTests[self.playerContainerId]}}catch(e){}};self.digestBandwidth=function(){var bandwidthInfo={};if(self.debugInfo.bandwidthLow&&self.debugInfo.bandwidthHigh&&self.debugInfo.bandwidths&&self.debugInfo.bandwidths.length){self.debugInfo.bandwidthAvg=_.reduce(self.debugInfo.bandwidths,function(memo,num){return memo+num},0);self.debugInfo.bandwidthAvg=parseFloat((self.debugInfo.bandwidthAvg/self.debugInfo.bandwidths.length).toFixed(3));bandwidthInfo={bandwidthLow:self.debugInfo.bandwidthLow,bandwidthHigh:self.debugInfo.bandwidthHigh,bandwidthAvg:self.debugInfo.bandwidthAvg}}return bandwidthInfo};self.trackProgress=function(key,params){key=key||(key===0)?key:Math.round(100*self.playheadTime/self.time);if(_.has(self.progress,key)&&!self.progress[key].triggered){var progressInterval=self.progress[key];progressInterval.triggered=true;_.extend(progressInterval.tracking.props,params);_.extend(progressInterval.tracking.props,self.digestBandwidth());var name=progressInterval.tracking.name;var event=progressInterval.tracking.event;var props=progressInterval.tracking.props;var trackers=progressInterval.tracking.trackers;self.sendTrackingData(name,event,props,trackers)}};self.initProgress=function(){var duration=0!==self.time&&isFinite(self.time)?self.time:self.json.contentConfig.videoDuration/ONE_SECOND;var key,linkName,event,props;self.progress={};for(var i=0;i<=self.progressIntervals;i++){key=""+Math.round(100*i/self.progressIntervals);switch(key){case"0":linkName="Video Start";event="event9";props={};break;case"25":linkName="Video 25% Complete";event="event10";props={};break;case"50":linkName="Video 50% Complete";event="event11";props={};break;case"75":linkName="Video 75% Complete";event="event12";props={};break;case"100":linkName="Video Complete";event="event13";props={};break;default:linkName="";event="";props={};break}self.progress[key]={triggered:false,tracking:{name:linkName,event:event,props:props,trackers:{nielsen:true,omniture:true,splunk:true}}}}key=Math.round(100*(duration-15)/duration);self.progress[key]={triggered:false,tracking:{name:"Video 15s prior to Complete",event:"event13_01",props:{},trackers:{splunk:true}}}};self.imageForNielsenBeacon=null;self.getSectionAsPrefix=function(){var sectionAsPrefix=args.section?args.section.toLowerCase():self.json.metaConfig&&self.json.metaConfig.section?self.json.metaConfig.section.toLowerCase():"";if(/^\/([^\/]+)/.test(sectionAsPrefix)){sectionAsPrefix=(RegExp.$1).toLowerCase()}sectionAsPrefix+=(!!sectionAsPrefix)?":":"";return sectionAsPrefix};self.getEstDateString=function(epoch){var localDate=new Date(epoch),estDate=new Date(epoch+localDate.getTimezoneOffset()*60000-300*60000),month=estDate.getMonth()+1;return month+"/"+estDate.getDate()+"/"+estDate.getFullYear()};self.getParentTrackingData=function(){if(typeof self.parentTrackingData==="undefined"&&window!=window.parent){try{if(typeof window.parent.s!="undefined"){self.parentTrackingData={channel:window.parent.s.channel,type:window.parent.s.prop3,pageName:window.parent.s.pageName}}if(window.frameElement){self.embedTrackingData={offsetTop:$(window.frameElement).parent().attr("data-offset-top"),nthVideoOnPage:$(window.frameElement).parent().attr("data-nth-video-on-page")};TWP.Data.VideoData.props.offsetTop=self.embedTrackingData.offsetTop;TWP.Data.VideoData.props.nthVideoOnPage=self.embedTrackingData.nthVideoOnPage}}catch(e){}}};self.getTrackingData=function(){var specialCharacters=/[^\w\s\-.,]/g;var extraWhitespace=/\s+/g;var encodedQuotes=/%22|%27/g;var cleanTitle=function(title){return title.toLowerCase().replace(specialCharacters,"").replace(extraWhitespace," ").replace(encodedQuotes,"")};return function(params){self.json=self.json||{};self.json.metaConfig=self.json.metaConfig||{};self.json.showsConfig=self.json.showsConfig||{};self.json.contentConfig=self.json.contentConfig||{};self.json.liveEventConfig=self.json.liveEventConfig||{};self.json.contentConfig.dateConfig=self.json.contentConfig.dateConfig||{};params=params||{};var isAd=self.player&&self.player.isPlayingAd();var credit=self.json.contentConfig.credits||{};var date=self.json.contentConfig.dateConfig.dateFirstPublished?self.json.contentConfig.dateConfig.dateFirstPublished:self.json.contentConfig.dateConfig.displayDate?self.json.contentConfig.dateConfig.displayDate:"";var dateString=self.getEstDateString(date);var isLiveEvent=self.json.liveEventConfig?true:false;var sectionAsPrefix=self.getSectionAsPrefix();var duration=0!==self.time&&isFinite(self.time)?self.time:self.json.contentConfig.videoDuration?self.json.contentConfig.videoDuration/ONE_SECOND:0;var order=self.json.metaConfig.order&&isFinite(self.json.metaConfig.order)?self.json.metaConfig.order:self.json.showsConfig.length?self.json.showsConfig[0].clipDisplayOrder:0;var title=cleanTitle(args.title||self.json.contentConfig.title||"no title");if(self.switchVideo){previousVideoTitle=currentVideoTitle;self.switchVideo=false}currentVideoTitle=sectionAsPrefix+"video - "+dateString+" - "+title;self.getParentTrackingData();return $.extend({UUID:self.json.contentConfig.uuid||"",vendor:PLAYER_VENDOR,sessionId:TWP.PostTV.getCookie("s_vi"),page:self.parentTrackingData&&self.parentTrackingData.pageName?self.parentTrackingData.pageName:currentVideoTitle,channel:self.parentTrackingData&&self.parentTrackingData.channel?self.parentTrackingData.channel:"wp - posttv",video:currentVideoTitle,title:currentVideoTitle,type:self.parentTrackingData&&self.parentTrackingData.type?self.parentTrackingData.type:"video",section:(args.section||self.json.metaConfig.section||"").toLowerCase(),subsection:(args.subsection||self.json.metaConfig.subsection||"").toLowerCase(),source:credit.source?credit.source.toLowerCase():"",dateFirstPublished:self.json.contentConfig.dateConfig.dateFirstPublished?self.json.contentConfig.dateConfig.dateFirstPublished:"",dateLastPublished:self.json.contentConfig.dateConfig.dateLastPublished?self.json.contentConfig.dateConfig.dateLastPublished:"",videoName:credit.editor?credit.editor.toLowerCase():"",userInfo:TWP.PostTV.BrowserInfo.OS.toLowerCase()+" "+TWP.PostTV.BrowserInfo.browser.toLowerCase()+" v"+TWP.PostTV.BrowserInfo.version,browser:TWP.PostTV.BrowserInfo.browser.toLowerCase(),os:TWP.PostTV.BrowserInfo.OS.toLowerCase(),browserVersion:TWP.PostTV.BrowserInfo.version,webview:TWP.PostTV.BrowserInfo.webview,flashVersion:typeof swfobject==="undefined"?"n/a":swfobject.getFlashPlayerVersion().major+"."+swfobject.getFlashPlayerVersion().minor+"."+swfobject.getFlashPlayerVersion().release,previousVideo:previousVideoTitle,adsDuration:self.ads&&self.ads.duration?self.ads.duration:"",playerType:self.playerType,videoType:self.isLiveStream?"livestream":"vod",isLiveStream:self.isLiveStream||isLiveEvent||self.json.contentConfig.type==="live",isAd:isAd,adSetCode:self.adSetCode,isFullEpisode:self.json.contentConfig.type==="episode",isClip:!isAd&&self.json.contentConfig.type==="clip",segment:order,durationInSeconds:isAd&&self.ads?self.ads.duration:Math.round(duration),countOfClips:0,offsetTop:self.embedTrackingData&&self.embedTrackingData.offsetTop,nthVideoOnPage:self.embedTrackingData&&self.embedTrackingData.nthVideoOnPage,renderingMode:self.player&&self.player.getProvider?self.player.getProvider():""},params)}}();self.sendTrackingData=function(name,event,params,trackers){var trackingServices={comscore:self.sendDataToComscore,nielsen:self.sendDataToNielsen,omniture:self.sendDataToOmniture,splunk:self.sendDataToSplunk};trackers=_.isEmpty(trackers)?trackingServices:_.pick(trackingServices,function(value,key){return trackers[key]});params=self.getTrackingData(params);if(self.debugTracking){console.debug("sendTrackingData",name,event,params)}_.each(trackers,function(tracker){tracker(name,event,params)});return self};self.equalsOrIsInArray=function(stringVal,arrayOrString){return(arrayOrString===stringVal)||($.isArray(arrayOrString)&&(-1!=$.inArray(stringVal,arrayOrString)))};self.sendDataToNielsen=function(n,e,params){var isAd=self.equalsOrIsInArray("event7",e);var isContent=!isAd&&self.equalsOrIsInArray("event9",e);if(isContent){var titleParamPrefix="&tl=dav0-";var sectionAsPrefix=self.getSectionAsPrefix();var currentVideoTitle;currentVideoTitle=args.title?args.title:self.json.contentConfig&&self.json.contentConfig.title?self.json.contentConfig.title:"";currentVideoTitle=sectionAsPrefix+currentVideoTitle.toLowerCase();var currentVideoCategory="";var paramCi="ci=us-904793";var paramC6="&c6=vc,b01";var paramCc="&cc=1";var paramRnd="&rnd="+Math.ceil(Math.random()*1000000000);var paramTl="&tl=dav0-"+encodeURIComponent(currentVideoTitle);var paramCg="&cg="+encodeURIComponent(currentVideoCategory);var optionalParams="";var url="//secure-us.imrworldwide.com/cgi-bin/m?"+paramCi+paramC6+paramCc+paramRnd+paramTl+paramCg+optionalParams;self.imageForNielsenBeacon="";self.imageForNielsenBeacon=new Image();self.imageForNielsenBeacon.src=url;if(self.debugTracking){console.debug("sendDataToNielsen()",url)}}};self.calcTrackingEVarValue=function(evar,params){var val="";switch(evar){case"eVar41":if(!!self.json.videoCategoryConfig&&!!self.json.videoCategoryConfig[0]&&!!self.json.videoCategoryConfig[0].seriesConfig){val="series"}else{if(!!self.json.videoCategoryConfig&&!!self.json.videoCategoryConfig[0]){val=self.json.videoCategoryConfig[0].id}else{val=params.section}}break;case"eVar43":if(!!self.json.producerConfig&&!!self.json.producerConfig.createdBy&&!!self.json.producerConfig.createdBy.name&&!!self.json.producerConfig.createdBy.lastname){val=self.json.producerConfig.createdBy.name+" "+self.json.producerConfig.createdBy.lastname}break;default:break}return val};self.sendDataToOmniture=function(n,e,params){if(!!window.s&&typeof s.sendDataToOmniture=="function"&&!!params){try{var data=$.extend({eVar1:params.page,eVar2:params.channel,eVar6:params.video,eVar8:params.videoName,eVar12:params.UUID,eVar13:params.title,eVar17:params.type,prop19:params.evtAction?"posttv - "+params.evtModule+" - "+params.evtAction:"",eVar36:(params.nthVideoOnPage&&params.offsetTop)?params.nthVideoOnPage+":"+params.offsetTop:"",eVar41:self.calcTrackingEVarValue("eVar41",params),eVar42:params.source,eVar43:self.calcTrackingEVarValue("eVar43",params),eVar44:params.userInfo,eVar46:params.previousVideo,eVar47:params.subsection,eVar48:params.adsDuration,eVar49:params.playerType,eVar50:params.renderingMode},self.appendToOmniture,params);n=n||"";e=e||[];if(self.debugTracking){console.debug("sendDataToOmniture()",n,e,[data])}s.sendDataToOmniture(n,e,data)}catch(e){console.debug("Unable to send tracking data to omniture: "+e.stack)}}return self};self.sendDataToSplunk=function(n,e,params){var now=_.now();var data={browser:params.browser,os:params.os,browserVersion:params.browserVersion,webview:params.webview,flashVersion:params.flashVersion,vendor:params.vendor,sessionId:params.sessionId,page:params.page,channel:params.channel,video:params.title,videoId:self.methodeUuid,videoName:params.title,videoType:params.videoType,videoSource:params.source,dateFirstPublished:params.dateFirstPublished,dateLastPublished:params.dateLastPublished,type:params.type,creativeType:params.creativeType,section:params.section,url:document.URL,HTTP_REFERER:document.referrer,adsDuration:params.adsDuration,playerType:params.playerType,adSetCode:params.adSetCode,evtName:n,evtType:typeof e=="string"?e:e[0]||"",evtAction:params.evtAction,evtGroup:params.evtGroup,evtModule:params.evtModule,evtTime:now,targetUrl:params.targetUrl,errorCode:params.errorCode,errorText:params.errorText,offsetTop:params.offsetTop,nthVideoOnPage:params.nthVideoOnPage,skin:params.skin,xWpSplit:TWP.PostTV.getCookie("X-WP-Split"),thinkAdBlock:TWP.PostTV.BrowserInfo.thinkAdBlock,isUnloading:JSON.stringify(TWP.isUnloading),renderingMode:params.renderingMode};var errors=_.pick(params,["errorText","adError"]);var loadTimes=_.pick(params,["adLoadDelta","hasPlayedAd","pageLoadDelta","playerLoadDelta","videoLoadDelta"]);var bandwidthStats=_.pick(params,["bandwidthLow","bandwidthHigh","bandwidthAvg"]);errors=_.pick(errors,_.identity);loadTimes=_.pick(loadTimes,_.identity);bandwidthStats=_.pick(bandwidthStats,_.identity);loadTimes.videosPlayed=params.videosPlayed;_.extend(data,errors,loadTimes,bandwidthStats);if(params){try{e=typeof e=="undefined"?"":typeof e=="string"?e:$.isArray(e)?e[0]:"";now=params.evtTime||now;if(self.debugTracking){console.debug("sendDataToSplunk()",n,e,[data])}$.ajax({url:"//videotracker.washingtonpost.com/index.html",dataType:"jsonp",cache:false,timeout:3000,data:data});if(window.TWP&&TWP.Data&&TWP.Data.Splunk){if(TWP.Data.Splunk.addToHistory){TWP.Data.Splunk.addToHistory(self.methodeUuid,e,now)}if(TWP.Data.Splunk.sendQueued){TWP.Data.Splunk.sendQueued()}}}catch(e){console.log("Unable to send tracking data: "+e.stack)}}};self.sendDataToComscore=function(name,event){self.comscoreTag=self.comscoreTag||new ns_.StreamingTag({customerC2:"3005617"});if(event==="play"){self.comscoreTag.playVideoContentPart({ns_st_ci:self.json.contentConfig.uuid,c3:"*null",c4:"*null",c6:"*null"})}else{if(event==="adPlay"){self.comscoreTag.playVideoAdvertisement()}else{if(event==="stop"){self.comscoreTag.stop()}}}};self.updateChartbeatID=function(videoID){window._cbv=window._cbv||[];videoID=videoID||self.json.contentConfig.uuid;window._cbv.push(["setProps",{player:jwplayer(self.playerElementId),videopath:videoID}])};self.loadChartbeatVideoScript=function(){window._cbv=[];$.getScript("//static.chartbeat.com/js/chartbeat_video.js",function(data,textStatus,jqxhr){self.updateChartbeatID(self.json.contentConfig.uuid)})};self.updateMetaTag=function(params){if($(params.selector).length){$(params.selector).attr("content",params.content)}else{var opts={};opts[params.nameAttr]=params.name;opts.content=params.content;$("<meta/>",opts).appendTo("head")}};self.onPlayerCreated=function(callback){self.callbacks.playerCreated=callback;return self};self.onEmbedCodeChanged=function(callback){self.callbacks.embedCodeChanged=callback;return self};self.onContentTreeFetched=function(callback){self.callbacks.contentTreeFetched=callback;return self};self.onPlayStarted=function(callback){self.callbacks.editorialPlayStarted=callback;return self};self.onPlayCompleted=function(callback){self.callbacks.playCompleted=callback;return self};self.onSeek=function(callback){self.callbacks.onSeek=callback;return self};self.onPause=function(callback){self.callbacks.onPause=callback;return self};self.onCompanionAdsReady=function(callback){self.callbacks.companionAds=callback;return self};self.onAdStarted=function(callback){self.callbacks.adStarted=callback;return self};self.onAdCompleted=function(callback){self.callbacks.adCompleted=callback;return self};self.onPlayheadTimeChanged=function(callback){self.callbacks.playheadTimeChanged=callback;return self};self.onVolumeChanged=function(callback){self.callbacks.volumeChanged=callback;return self};self.onVideoError=function(callback){self.callbacks.videoError=callback;return self};self.play=function(){if(self.player){self.player.play()}};self.forcePlay=function(){if(self.player){self.player.forcePlay()}};self.pause=function(){if(self.player){self.player.pause()}};self.stop=function(){if(self.player){self.player.stop()}};self.seek=function(time){if(self.player){self.player.seek(time)}};self.skipAd=function(){if(self.player){self.player.skipAd()}};self.setAutoplay=function(value){if(self.player){self.player.setAutoplay(value)}};self.destroy=function(){if(self.player){self.player.destroyPlayer()}};self.bindPlayerContainerHandlers=function(){var self=this;if(!!self.$playerContainer.data("autopreview")){PubSub.subscribe(TWP.PostTV.EVENTS.VISIBILITY_CHANGED,self.handleVisibilityChanged)}PubSub.subscribe(TWP.PostTV.EVENTS.PLAY,self.play);PubSub.subscribe(TWP.PostTV.EVENTS.PAUSE,self.pause);PubSub.subscribe(TWP.PostTV.EVENTS.STOP,self.stop);PubSub.subscribe(TWP.PostTV.EVENTS.DESTROY,self.destroy);PubSub.subscribe(TWP.PostTV.EVENTS.SKIP_AD,self.skipAd);PubSub.subscribe(TWP.PostTV.EVENTS.SHOW_PROMO_SCREEN,self.showPromoScreen);PubSub.subscribe(TWP.PostTV.EVENTS.PLAY_NEXT_VIDEO,function(){self.onPlayNextVideo.apply(self,(Array.prototype.slice.call(arguments,1)))});PubSub.subscribe(TWP.PostTV.EVENTS.SET_VOLUME,function(){self.player.setVolume.apply(self,(Array.prototype.slice.call(arguments,1)))});PubSub.subscribe(TWP.PostTV.EVENTS.SEEK,function(){self.player.seek.apply(self,(Array.prototype.slice.call(arguments,1)))});PubSub.subscribe(TWP.PostTV.EVENTS.SEND_TRACKING_DATA,self.handleTrackingData);TWP.PostTV.isPubSub=true};return(function(){self.json=args.json||{};self.args=args.args||{};self.trendingJson=args.trendingJson||{};self.embedCode=args.embedCode||("contentConfig" in self.json?self.json.contentConfig.videoContentId:"");self.methodeUuid=("contentConfig" in self.json?self.json.contentConfig.uuid:"");self.playerContainerId=args.playerContainerId||"posttv-player-container";self.playerElementId=self.playerContainerId+"-JW";self.$playerContainer=$("#"+self.playerContainerId);self.$playerContainer.append('<div id="'+self.playerElementId+'"></div>');self.bindPlayerContainerHandlers();self.playerType=args.playerType||"";self.isModal=self.$playerContainer.hasClass("modal");self.isAutoplaying=false;self.width=args.width||self.$playerContainer.width()||480;self.height=args.height||parseInt(self.width*RATIO_16X9)||270;self.jwArgs=args.jwArgs||{};self.player=null;self.callbacks={};self.mbSubscriber=args.playerType||"default-video-page";self.autoplay=TWP.PostTV.isTablet||TWP.PostTV.isMobile?false:typeof args.autoplay=="string"?!!parseInt(args.autoplay):args.autoplay||false;self.initialTime=args.initialTime||0;self.wmode=args.wmode||"opaque";self.showEndscreen=(typeof args.showEndscreen!="undefined"?args.showEndscreen:false);self.desktopPlaylist=self.showEndscreen&&TWP.PostTV.isDeskweb&&(args.playerType==="posttv-embed");self.mobilePlaylist=self.showEndscreen&&(TWP.PostTV.isMobile||TWP.PostTV.isTablet)&&(args.playerType==="posttv-embed");self.hide=!!args.hide?args.hide:self.showEndscreen?"info,sharing,channels,embed":"info,sharing,channels,embed,endscreen";self.showSharingOverlay=args.showSharingOverlay;self.hideOverlayButtons=args.hideOverlayButtons;self.flashParams=args.flashParams||{};self.locale=args.locale||{};self.loop=!!args.loop||false;self.version=args.version||1;self.playheadTime=0;self.volume=isNaN(Number(args.volume))?self.getVolumeFromCookie():Number(args.volume);self.playerCreated=false;self.showAdsForFirstVideoOnly=typeof args.showAdsForFirstVideoOnly==="boolean"?args.showAdsForFirstVideoOnly:false;self.showCompanionAdIfAny=args.showCompanionAdIfAny?true:false;self.appendToOmniture={};self.trackingLevel=args.trackingLevel||"player-default-tracking";self.progressIntervals=parseInt(4);self.isPlaylist=args.isPlaylist||false;self.initProgress();TWP.PostTV.players[self.playerContainerId]=self})()}}(jQuery,_));TWP.PostTV.Player=TWP.PostTV.PlayerJW;TWP.PostTV.InlinePlayerCounter=isNaN(TWP.PostTV.InlinePlayerCounter)?0:TWP.PostTV.InlinePlayerCounter;(function($){TWP.PostTV.InlinePlayerJW=TWP.PostTV.InlinePlayerJW||function(el,args){args=args||{};var self=this;var isIE7=(document.all&&!document.querySelector)?true:false;var init=function(el){self.json=args.json||{};self.trendingJson=(window.TWP&&TWP.videoDataId)?$.parseJSON($("#"+TWP.videoDataId+"-trending").html()):{};self.callback=args.onload||null;self.preparePlayerContainer(el);return self};var isTruthy=function(str){return(str===true)||(typeof(str)==="string"&&str.toLowerCase()==="true")||(parseInt(str)===1)};var isFalsy=function(str){return !isTruthy(str)};var isExplicitlyFalsy=function(str){return(str!==undefined)&&(str!=="")&&isFalsy(str)};self.preparePlayerContainer=function(el){var $container=$(el);var autoplay=isTruthy($container.attr("data-autoplay"));var ajaxUrl=(typeof $container.attr("data-video-uuid")!="undefined"?"//www.washingtonpost.com/posttv/c/videojson/"+$container.attr("data-video-uuid"):"");var trendingUrl="//analytics.posttv.com/trending-videos-overall.json";var needVideoJson=$.isEmptyObject(self.json);var needTrendingJson=$.isEmptyObject(self.trendingJson);self.showEndscreen=(typeof $container.attr("data-show-endscreen")=="undefined")||(typeof $container.attr("data-show-endscreen")!="undefined"&&$container.attr("data-show-endscreen")==1);self.showSharingOverlay=isTruthy($container.attr("data-show-posttv-overlay"));self.playerType=(typeof $container.attr("data-player-type")!="undefined"?$container.attr("data-player-type"):"");self.initialTime=(typeof $container.attr("data-initial-time")!="undefined"?(isNaN(parseFloat($container.attr("data-initial-time")))?0:parseFloat($container.attr("data-initial-time"))/ONE_SECOND):0);self.loop=isTruthy($container.attr("data-loop"));self.wmode=(typeof $container.attr("data-wmode")!="undefined"?$container.attr("data-wmode"):"");self.hide=(typeof $container.attr("data-hide")!="undefined"?$container.attr("data-hide"):"");self.trackingLevel=(typeof $container.attr("data-tracking-level")!="undefined"?$container.attr("data-tracking-level"):"");self.showCompanionAdIfAny=isTruthy($container.attr("data-companion-ad"));self.adSetCode=(typeof $container.attr("data-adset-code")!="undefined"?$container.attr("data-adset-code"):"");self.adSetZone=(typeof $container.attr("data-adset-zone")!="undefined"?$container.attr("data-adset-zone"):"");self.adLengthParam=(typeof $container.attr("data-ad-length-param")!="undefined"?$container.attr("data-ad-length-param"):"");self.adZone=(typeof $container.attr("data-ad-zone")!="undefined"?$container.attr("data-ad-zone"):"");self.adFreq=(typeof $container.attr("data-ad-freq")!="undefined"?$container.attr("data-ad-freq"):TWP.PostTV.adFrequency);self.allowAd=!isExplicitlyFalsy($container.attr("data-show-ad"))&&!isExplicitlyFalsy(queryStringObj.showAds);self.showAdsForFirstVideoOnly=isTruthy($container.attr("data-show-ads-for-first-video-only"));self.adPattern=(typeof $container.attr("data-ad-pattern")!="undefined"?$container.attr("data-ad-pattern"):"");self.adPattern=self.adPattern.split("");self.adTagSuffix=(typeof $container.attr("data-adtagurl-suffix")!="undefined"?$container.attr("data-adtagurl-suffix"):"");self.volume=isNaN(Number($container.attr("data-volume")))?1:$container.attr("data-volume");self.customVolume=$container.attr("data-volume");self.useCustomScrubber=(typeof $container.attr("data-use-custom-scrubber")!="undefined"?$container.attr("data-use-custom-scrubber")==1:false);self.aspectRatio=(typeof $container.attr("data-aspect-ratio")=="undefined"?"16:9":$container.attr("data-aspect-ratio"));self.hideOverlayButtons=$container.attr("data-hide-posttv-overlay-buttons");self.allowControls=(typeof $container.attr("data-allow-controls")=="undefined")?true:$container.attr("data-allow-controls")==1?true:false;if(!TWP.PostTV.isDeskweb&&!TWP.PostTV.mobileTabletShowEndscreen){self.showEndscreen=false}var createPlayer=function(json){self.player=new TWP.PostTV.PlayerJW({args:args,json:json,trendingJson:self.trendingJson,playerContainerId:$container.attr("id"),autoplay:autoplay,playerType:self.playerType,initialTime:self.initialTime,loop:self.loop,wmode:self.wmode,css:self.css,trackingLevel:self.trackingLevel,showCompanionAdIfAny:self.showCompanionAdIfAny,adSetCode:self.adSetCode,adSetZone:self.adSetZone,adLengthParam:self.adLengthParam,adZone:self.adZone,adFreq:self.adFreq,adPattern:self.adPattern,adTagSuffix:self.adTagSuffix,allowAd:self.allowAd,showAdsForFirstVideoOnly:self.showAdsForFirstVideoOnly,volume:self.volume,customVolume:self.customVolume,hide:!!self.hide?self.hide:self.useCustomScrubber?"all":"",showEndscreen:self.showEndscreen,showSharingOverlay:self.showSharingOverlay,hideOverlayButtons:self.hideOverlayButtons,aspectRatio:self.aspectRatio,allowControls:self.allowControls});self.player.onCompanionAdsReady(function(){if(self.player.showCompanionAdIfAny&&!self.player.isFullscreen()){self.player.companionOpts=!$.isEmptyObject(args.companionOpts)?args.companionOpts:{companionClassName:"mp-companion-ad"};if(isIE7){var ie7Styles={style:{position:"absolute",paddingLeft:"25px"}};jQuery.extend(true,self.player.companionOpts,ie7Styles)}}if(!!args.callbacks&&typeof args.callbacks.onCompanionAdsReady=="function"){args.callbacks.onCompanionAdsReady(self.player)}return self.player});self.player.onAdCompleted(function(){if(!!args.callbacks&&typeof args.callbacks.onAdCompleted=="function"){args.callbacks.onAdCompleted(self.player)}return self.player});self.player.onPlayStarted(function(){if(!!args.callbacks&&typeof args.callbacks.onPlayStarted=="function"){args.callbacks.onPlayStarted(self.player)}});if(self.callback){self.player.onEmbedCodeChanged(function(){self.callback(self.player)})}if(!!args.callbacks){if(typeof args.callbacks.onPlayerCreated=="function"){self.player.onPlayerCreated(function(){args.callbacks.onPlayerCreated(self.player)})}if(typeof args.callbacks.onEmbedCodeChanged=="function"){self.player.onEmbedCodeChanged(function(){args.callbacks.onEmbedCodeChanged(self.player)})}if(typeof args.callbacks.onContentTreeFetched=="function"){self.player.onContentTreeFetched(function(){args.callbacks.onContentTreeFetched(self.player)})}if(typeof args.callbacks.onPlayCompleted=="function"){self.player.onPlayCompleted(function(){args.callbacks.onPlayCompleted(self.player)})}if(typeof args.callbacks.onSeek=="function"){self.player.onSeek(function(seek){args.callbacks.onSeek(self.player,seek)})}if(typeof args.callbacks.onPause=="function"){self.player.onPause(function(state){args.callbacks.onPause(self.player,state)})}if(typeof args.callbacks.onAdStarted=="function"){self.player.onAdStarted(function(){args.callbacks.onAdStarted(self.player)})}if(typeof args.callbacks.onPlayheadTimeChanged=="function"){self.player.onPlayheadTimeChanged(function(times){args.callbacks.onPlayheadTimeChanged(self.player,times)})}if(typeof args.callbacks.onVolumeChanged=="function"){self.player.onVolumeChanged(function(){args.callbacks.onVolumeChanged(self.player)})}if(typeof args.callbacks.onVideoError=="function"){self.player.onVideoError(function(){args.callbacks.onVideoError(self.player)})}}self.player.create()};$.when(needVideoJson?$.ajax({type:"GET",url:ajaxUrl,contentType:"application/json",jsonpCallback:"cb_"+$container.attr("data-video-uuid").replace(/-/g,""),data:{resType:"jsonp"},dataType:"jsonp",cache:true,error:function(e){if(typeof window.console==="object"){console.log("Failed to fetch video jsonp at: "+ajaxUrl+", e: ",e)}self.sendTrackingData("PostTV Player Data Error",["event999"],{errorCode:"ptv_cannotRetrieveVideoJson",errorText:"Cannot retrieve video json data at: "+ajaxUrl},{splunk:true,omniture:true,nielsen:true})}}):undefined,needTrendingJson?$.ajax({type:"GET",url:trendingUrl,contentType:"application/json",cache:true,error:function(e){if(typeof window.console==="object"){console.log("Failed to fetch trending video json at: "+trendingUrl+", e: ",e)}}}):undefined).then(function(videoJson,trendingJson){if(videoJson&&videoJson[1]==="success"&&videoJson[0]&&videoJson[0][0]){self.json=videoJson[0][0]}if(trendingJson&&trendingJson[1]==="success"&&trendingJson[0]){self.trendingJson=trendingJson[0]}}).always(function(){createPlayer(self.json)});return self};return init(el)};TWP.PostTV.InlinePlayer=TWP.PostTV.InlinePlayer||TWP.PostTV.InlinePlayerJW;TWP.PostTV.initInlinePlayerJW=TWP.PostTV.initInlinePlayerJW||function(obj,args){args=args||{};var $video=$(obj).filter(":not(.ooyala-player-processed)");if($video.size()){new TWP.PostTV.InlinePlayerJW($video.get(0),args);$video.removeClass("ooyala-player").addClass("ooyala-player-processed")}};TWP.PostTV.initInlinePlayer=TWP.PostTV.initInlinePlayer||TWP.PostTV.initInlinePlayerJW})(jQuery)}if(typeof EMBED_PLAYER_TYPE=="undefined"){var isYoutubeEmbed=function(a){return a&&a.embedConfig&&a.embedConfig.embedType&&a.embedConfig.embedType.toLowerCase()=="youtube"};var queryStringObj=queryStringObject();var videoJson=(window.TWP&&TWP.videoDataId)?$.parseJSON($("#"+TWP.videoDataId).html()):{};if(!isYoutubeEmbed(videoJson)){jwPlayerWrapper()}};