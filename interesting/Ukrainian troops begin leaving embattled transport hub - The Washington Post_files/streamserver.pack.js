/**
 * Copyright 2012-2015 Echo.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Version: 3.0.29 (2015-01-22 11:45:29 UTC)
 */
!function(a){"use strict";var b=a,c=Echo.Control.manifest("Echo.StreamServer.Controls.Counter");Echo.Control.isDefined(c)||(c.init=function(){if(this.checkAppKey()){var a=this.config.get("liveUpdates.timeout");"undefined"!=typeof a&&this.config.set("liveUpdates.polling.timeout",a),this.request=this._getRequestObject(),b.isEmptyObject(this.get("data"))?this.request.send():(this.render(),this.ready(),this.request&&this.request.send({skipInitialRequest:!0}))}},c.config={data:void 0,liveUpdates:{enabled:!0,polling:{timeout:10}},infoMessages:{layout:"compact"}},c.templates.main="<span>{data:count}</span>",c.methods._getRequestObject=function(a){return Echo.StreamServer.API.request(b.extend(!0,{endpoint:"count",data:{q:this.config.get("query"),appkey:this.config.get("appkey")},liveUpdates:this.config.get("liveUpdates"),secure:this.config.get("useSecureAPI"),apiBaseURL:this.config.get("apiBaseURL"),onError:b.proxy(this._error,this),onData:b.proxy(this._handleResponse,this)},a))},c.methods._maybeUpdate=function(a){(b.isEmptyObject(this.data)||this.data.count!==a.count)&&(this.events.publish({topic:"onUpdate",data:{data:a,query:this.config.get("query"),target:this.config.get("target").get(0)}}),this.set("data",a),this.render())},c.methods._handleResponse=function(a,b){this._maybeUpdate(a),"initial"===b.requestType&&this.ready()},c.methods._error=function(a,b){this.events.publish({topic:"onError",data:{data:a,query:this.config.get("query"),target:this.config.get("target").get(0)}}),"more_than"===a.errorCode?(this.set("data.count",a.errorMessage+"+"),this.render()):("undefined"==typeof b.critical||b.critical&&"initial"===b.requestType)&&this.showMessage({type:"error",data:a,message:a.errorMessage}),this.ready()},Echo.Control.create(c))}(Echo.jQuery);
!function(a){"use strict";var b=a,c=Echo.Control.manifest("Echo.StreamServer.Controls.FacePile");Echo.Control.isDefined(c)||(c.init=function(){if(this.checkAppKey()){var a=this.config.get("liveUpdates.timeout");"undefined"!=typeof a&&this.config.set("liveUpdates.polling.timeout",a),b.isEmptyObject(this.get("data"))?this._request():(this.set("data.itemsPerPage",this.get("data.itemsPerPage",2)),this.config.set("liveUpdates.enabled",!1),this._initialResponseHandler(this.data))}},c.config={data:void 0,initialUsersCount:void 0,totalUsersCount:void 0,query:"",suffixText:"",item:{avatar:!0,text:!0},liveUpdates:{transport:"websockets",enabled:!0,polling:{timeout:10},websockets:{maxConnectRetries:3,serverPingInterval:30}},infoMessages:{layout:"compact"}},c.vars={users:[],uniqueUsers:{},isViewComplete:!1,moreRequestInProgress:!1,count:{total:0,visible:0}},c.labels={and:"and",more:"more"},c.templates.main='<span class="{class:container}"><span class="{class:actors}"></span><span class="{class:more}"></span><span class="{class:suffixText}"></span></span>',c.renderers.more=function(a){var b=this;if(!this._isMoreButtonVisible())return a.hide();a.empty().show();var c=this.get("count.total")-this.get("count.visible"),d=(c>0?c+" ":"")+this.labels.get("more"),e=!this._fromExternalData()||this.get("count.visible")<this.get("users").length;if(e){var f=Echo.Utils.hyperlink({caption:d});a.addClass("echo-linkColor").append(f)}else a.removeClass("echo-linkColor").append(d);return this.set("moreRequestInProgress",!1),e&&a.one("click",function(){b._getMoreUsers()}),a},c.renderers.actors=function(a){var c=this,d=[],e=this.get("cssPrefix"),f=this.config.get("item");if(!this.get("users").length||!f.avatar&&!f.text)return a.empty();var g=f.avatar&&!f.text?"addClass":"removeClass";a[g](e+"only-avatars");var h=function(a,b){return c.substitute({template:"<span {data:classAttr}>{data:text}</span>",data:{classAttr:b?'class="'+e+b+'"':"",text:a}})};b.map(this.get("users").slice(0,this.get("count.visible")),function(a){d.push(a.instance.render())});var i,j=this.config.get("item.text")?", ":"";return this._isMoreButtonVisible()||(i=d.pop()),d.length&&(d=j?this._intersperse(d,h(j,"delimiter")):d,d.push(h("&nbsp;"+this.labels.get("and")+" ","and"))),this._isMoreButtonVisible()||d.push(i),b.map(d,function(b){a.append(b)}),a},c.renderers.suffixText=function(a){return a.empty().append(this.config.get("suffixText",""))},c.methods.getVisibleUsersCount=function(){return this.count.visible},c.methods._isMoreButtonVisible=function(){return!this._fromExternalData()&&!this.isViewComplete||this.count.visible<this.count.total},c.methods._fromExternalData=function(){return!this.config.get("query")&&!!this.data},c.methods._request=function(){var a=this,c=this.get("request");c||(c=Echo.StreamServer.API.request({endpoint:"search",data:{q:this.config.get("query"),appkey:this.config.get("appkey")},liveUpdates:b.extend(this.config.get("liveUpdates"),{onData:function(b){a._secondaryResponseHandler(b)}}),secure:this.config.get("useSecureAPI"),apiBaseURL:this.config.get("apiBaseURL"),onError:function(b,c){var d="undefined"==typeof c.critical||c.critical&&"initial"===c.requestType;d&&a.showError(b,{critical:c.critical})},onData:function(b){a._initialResponseHandler(b)}}),this.set("request",c)),c.send()},c.methods._requestMoreItems=function(){var a=this,b=this.config.get("query"),c=this.get("nextPageAfter");"undefined"!=typeof c&&(b='pageAfter:"'+c+'" '+b);var d=Echo.StreamServer.API.request({endpoint:"search",secure:this.config.get("useSecureAPI"),apiBaseURL:this.config.get("apiBaseURL"),data:{q:b,appkey:this.config.get("appkey")},onError:function(b){a.showMessage({type:"error",data:b})},onData:function(b){a._initialResponseHandler(b)}});d.send()},c.methods._initialResponseHandler=function(a){return a.itemsPerPage&&a.itemsPerPage!==this.config.get("itemsPerPage")&&this.config.set("itemsPerPage",+a.itemsPerPage),this._fromExternalData()&&this.set("count.total",this.config.get("totalUsersCount",0)),this.set("nextPageAfter",a.nextPageAfter),a.entries.length?(this.get("count.visible")||this.set("count.visible",this._fromExternalData()?this.config.get("initialUsersCount",this.config.get("itemsPerPage")):this.config.get("itemsPerPage")),void this._processResponse(a)):void(this.get("isViewComplete")||(this.set("isViewComplete",!0),this.render(),this.ready()))},c.methods._secondaryResponseHandler=function(a){this._processResponse(a,!0)},c.methods._processResponse=function(a,c){var d=this,e=!0,f=b.map(a.entries,function(a){return function(b){if(d._isRemoveAction(a))d._maybeRemoveItem(a),b();else{d._isUniqueUser(a)&&(e=!1);var c=d.get("uniqueUsers."+a.actor.id);c?(c.itemsCount++,b()):d._initItem(a,function(){d._updateStructure(this),b()})}}});Echo.Utils.parallelCall(f,function(){d._output(c,e)})},c.methods._isRemoveAction=function(a){return a.verbs&&"http://activitystrea.ms/schema/1.0/delete"===a.verbs[0]},c.methods._output=function(a,b){this._fromExternalData()?this.set("count.total",Math.max(this.get("users").length,this.get("count.total"))):(this.set("count.total",this.get("users").length),this.set("count.visible",this.get("users").length)),this.set("count.visible",Math.min(this.get("count.visible"),this.get("users").length)),this.get("count.total")||this.set("isViewComplete",!1),!a&&b?this._getMoreUsers():(this.render(),this.ready())},c.methods._isUniqueUser=function(a){return!this.get("uniqueUsers."+a.actor.id)},c.methods._initItem=function(a,c){var d=b.extend({apiBaseURL:this.config.get("apiBaseURL"),submissionProxyURL:this.config.get("submissionProxyURL"),target:b("<div>"),appkey:this.config.get("appkey"),parent:this.config.getAsHash(),plugins:this.config.get("plugins"),context:this.config.get("context"),useSecureAPI:this.config.get("useSecureAPI"),data:a.actor,user:this.user,ready:c},this.config.get("item"));return new Echo.StreamServer.Controls.FacePile.Item(d)},c.methods._updateStructure=function(a){this.set("uniqueUsers."+a.get("data.id"),{itemsCount:1,instance:a});var b=this.get("uniqueUsers."+a.get("data.id"));this.get("users")[b.instance.isYou()?"unshift":"push"](b)},c.methods._maybeRemoveItem=function(a){var c=this.get("uniqueUsers."+a.actor.id);if(c&&!--c.itemsCount){var d;b.each(this.get("users"),function(b,c){return c.instance.data.id===a.actor.id?(d=b,!1):void 0}),this.get("users").splice(d,1),this.remove("uniqueUsers."+a.actor.id)}},c.methods._getMoreUsers=function(){if(this._fromExternalData()){var a=this.get("users").length,b=this.get("count.visible");this.set("count.visible",b+=this.config.get("itemsPerPage")),this.get("count.visible")>a&&this.set("count.visible",a),this.render()}else this.get("moreRequestInProgress")||(this.showMessage({type:"loading",target:this.view.get("more")}),this.set("moreRequestInProgress",!0)),this._requestMoreItems()},c.methods._intersperse=function(a,b){return Echo.Utils.foldl([],a,function(a,c){c.length&&c.push(b),c.push(a)})},c.css=".{class:container} { line-height: 20px; vertical-align: middle; }.{class:more} { white-space: nowrap; }.{class:more}.echo-linkColor a, .{class:more}.echo-linkColor a:hover { color: #476CB8; text-decoration: underline; }.{class:more} .echo-control-message-icon { display: inline; margin: 0px 5px; }",Echo.Control.create(c))}(Echo.jQuery),function(){"use strict";var a=Echo.Control.manifest("Echo.StreamServer.Controls.FacePile.Item");Echo.Control.isDefined(a)||(a.config={infoMessages:{enabled:!1}},a.labels={you:"You"},a.templates.main='<span class="{class:container}"><span class="{class:avatar}"></span><span class="{class:title}">{data:title}</span></span>',a.renderers.avatar=function(a){return this.config.get("avatar")?(this.placeImage({container:a,image:this.get("data.avatar"),defaultImage:this.config.get("defaultAvatar")}),this.config.get("text")||a.attr("title",this.get("data.title"))):a.hide(),a},a.renderers.title=function(a){return this.config.get("text")?a.empty().append(this.isYou()?this.labels.get("you"):this.get("data.title")):a.hide(),a},a.methods.isYou=function(){var a=this.get("data.id");return a&&a===this.user.get("identityUrl")},a.css=".{class:avatar} { display: inline-block; width: 16px; height: 16px; margin: 0px 3px 0px 0px; vertical-align: text-top; }.{class:only-avatars} .{class:avatar} { margin: 0px 2px; }.{class:container}, .{class:container} span { white-space: nowrap; display: inline-block; }.{class:only-avatars} .{class:container} { white-space: normal; }",Echo.Control.create(a))}(Echo.jQuery);
!function(a){"use strict";var b=a,c=Echo.Control.manifest("Echo.StreamServer.Controls.Stream");Echo.Control.isDefined(c)||(c.init=function(){var a=this;if(this.checkAppKey()){var c=this.config.get("liveUpdates.timeout");"undefined"!=typeof c&&this.config.set("liveUpdates.polling.timeout",c),this._recalcEffectsTimeouts(),this.request=this._getRequestObject({liveUpdates:b.extend(this.config.get("liveUpdates"),{onData:function(b){a._handleLiveUpdatesResponse(b)}}),onOpen:function(b,c){"initial"===c.requestType&&a.showError({},{retryIn:0,request:a.request})},onError:function(c,d){("undefined"==typeof d.critical||d.critical&&"initial"===d.requestType)&&a.showError(c,b.extend(d,{request:a.request}))},onData:function(b){a._handleInitialResponse(b)}});var d="full"===this.config.get("state.layout")?"paused":this.config.get("liveUpdates.enabled")?"live":"paused";this.activities.state=d;var e=this.config.get("data");e?(this._handleInitialResponse(e),this.request&&this.request.send({skipInitialRequest:!0,data:{q:this.config.get("query"),appkey:this.config.get("appkey"),since:e.nextSince}})):this.request.send()}},c.destroy=function(){b.map(this.items,function(a){a.destroy()})},c.config={query:"",children:{additionalItemsPerPage:5,displaySortOrder:"chronological",sortOrder:"reverseChronological",moreButtonSlideTimeout:600,itemsSlideTimeout:600,maxDepth:1},fadeTimeout:2800,flashColor:"#ffff99",item:{},itemsPerPage:15,itemsRefreshInterval:10,itemsComparator:void 0,liveUpdates:{transport:"websockets",enabled:!0,polling:{timeout:10},websockets:{maxConnectRetries:3,serverPingInterval:30}},openLinksInNewWindow:!1,slideTimeout:700,sortOrder:"reverseChronological",state:{label:{icon:!0,text:!0},toggleBy:"mouseover",layout:"compact"},asyncItemsRendering:!1},c.config.normalizer={showFlags:function(a){return"off"!==a},state:function(a){return a.toggleBy="mouseover"===a.toggleBy&&Echo.Utils.isMobileDevice()?"button":a.toggleBy,a.layout="button"===a.toggleBy?a.layout:c.config.state.layout,a}},c.vars={activities:{queue:[],state:void 0,lastState:"",animations:0},itemParentConfig:void 0,hasInitialData:!1,items:{},threads:[],lastRequest:null,request:null,moreRequest:null,itemsRenderingComplete:!0},c.labels={guest:"Guest",live:"Live",paused:"Paused",more:"More",emptyStream:"No items at this time...","new":"new",newItem:"new item",newItems:"new items"},c.events={"Echo.StreamServer.Controls.Stream.onItemsRenderingComplete":function(){this.view.render({name:"more"}),this._executeNextActivity()},"Echo.StreamServer.Controls.Stream.Item.onAdd":function(a,b){var c=this,d=this.items[b.item.data.unique];return d.config.get("target").hide(),this.queueActivity({action:"animation",item:d,priority:"highest",handler:function(){d.render(),d.set("added",!1),c._animateSpotUpdate("add",d,b.config)}}),{stop:["bubble"]}},"Echo.StreamServer.Controls.Stream.Item.onDelete":function(a,b){var c=this,d=this.items[b.item.data.unique];return this.queueActivity({action:"animation",item:d,priority:"highest",handler:function(){d.set("deleted",!1),c._animateSpotUpdate("remove",d,b.config)}}),{stop:["bubble"]}},"Echo.StreamServer.Controls.Stream.Item.onChildrenExpand":function(a,b){return this._requestChildrenItems(b.data.unique),{stop:["bubble"]}}},c.templates.main='<div class="{class:container} echo-primaryFont echo-primaryBackgroundColor"><div class="{class:header}"><div class="{class:state}"></div><div class="echo-clear"></div></div><div class="{class:content}"><div class="{class:body}"></div><div class="{class:more}"></div></div></div>',c.renderers.body=function(a){var b=this.lastRequest;return b?(b.data.length?(b.initial&&a.empty(),this._appendRootItems(b.data,a)):this.showMessage({type:"info",message:this.labels.get("emptyStream"),target:a}),a):a},c.renderers.content=function(a){var b=this,c=this.lastRequest;return c&&c.initial&&this.config.get("liveUpdates.enabled")&&"mouseover"===this.config.get("state.toggleBy")&&a.hover(function(){b.setState("paused")},function(){b.setState("live")}),a},c.renderers.state=function(a){var b=this,c=this.config.get("state.label"),d=this.config.get("state.layout");if(!c.icon&&!c.text||!this.config.get("liveUpdates.enabled"))return a;var e=this.getState(),f=0;"paused"===e&&(f=Echo.Utils.foldl(0,this.activities.queue,function(a,b){return a.affectCounter?++b:void 0}));var g=e+f;if(g===this.activities.lastState)return a;a.empty().show(),a.addClass(this.cssPrefix+d+"StateLayout"),"compact"===d&&a.addClass("echo-secondaryColor"),this.activities.lastState||"button"!==this.config.get("state.toggleBy")||("compact"===d&&a.addClass("echo-linkColor echo-clickable"),a.click(function(){b.setState("paused"===b.getState()?"live":"paused")}));var h={picture:'<span class="{class:state-picture} {class:state-picture}-'+e+'"></span>',message:"button"===this.config.get("state.toggleBy")?'<a href="javascript:void(0)" class="{class:state-message}">{label:'+e+"}</a>":'<span class="{class:state-message}">{label:'+e+"}</span>",count:' <span class="{class:state-count}">({data:count} {label:new})</span>',button:'<span class="{class:state-message}">{data:count} {data:label}</span>'};return"full"===d?f?a.append(this.substitute({template:h.button,data:{count:f,label:this.labels.get(1===f?"newItem":"newItems")}})):a.hide():(c.icon&&a.append(this.substitute({template:h.picture})),c.text&&(a.append(this.substitute({template:h.message})),f&&"paused"===e&&a.append(this.substitute({template:h.count,data:{count:f}})))),this.activities.lastState=g,a},c.renderers.more=function(a){var b=this;return this.isViewComplete||!this.threads.length?a.empty().hide():(this.itemsRenderingComplete?a.show():a.hide(),a.empty().append(this.labels.get("more")).off("click").one("click",function(){b.events.publish({topic:"onMoreButtonPress"}),a.html(b.labels.get("loading")),b._requestMoreItems(a)}))},c.methods.getState=function(){return this.activities.state},c.methods.setState=function(a){this.activities.state=a,"live"===a&&this._executeNextActivity(),this.view.render({name:"state"})},c.methods.queueActivity=function(a){if(a.item){var b=a.item.get("data.actor.id"),c=a.item.blocked||b&&this.user.has("identity",b),d=this._getActivityProjectedIndex(c,a),e={action:a.action,item:a.item,affectCounter:"add"===a.action&&!c,priority:a.priority,byCurrentUser:c,handler:a.handler};"undefined"!=typeof d?this.activities.queue.splice(d,0,e):this.activities.queue.push(e)}},c.methods._requestChildrenItems=function(a){var c=this,d=this.items[a],e=d.view.get("expandChildren"),f=this._getRequestObject({data:{q:this._constructChildrenSearchQuery(d)},onOpen:function(){c.showError({},{retryIn:0,target:e,request:f})},onError:function(a,d){c.showError(a,b.extend(d,{target:e,request:f}))},onData:function(a){d.set("data.nextPageAfter",a.nextPageAfter),d.set("data.hasMoreChildren",a.hasMoreChildren),a.entries=c._actualizeChildrenList(d,a.entries),c._onDataReceive(a,"children",function(e){var f=[];b.map(a.entries,function(a){var b=e[a.unique];c._applyStructureUpdates("add",b),a.parentUnique===d.get("data.unique")&&f.push(b)}),c._placeChildItems(d,f)})}});f.send()},c.methods._requestInitialItems=function(){var a=this;this.request||(this.request=Echo.StreamServer.API.request({endpoint:"search",apiBaseURL:this.config.get("apiBaseURL"),liveUpdates:b.extend(this.config.get("liveUpdates"),{onData:function(b){a._handleLiveUpdatesResponse(b)}}),data:{q:this.config.get("query"),appkey:this.config.get("appkey")},onOpen:function(b,c){"initial"===c.requestType&&a.showError({},{retryIn:0,request:a.request})},onError:function(c,d){("undefined"==typeof d.critical||d.critical&&"initial"===d.requestType)&&a.showError(c,b.extend(d,{request:a.request}))},onData:function(b){a._handleInitialResponse(b)}})),this.request.send()},c.methods._requestMoreItems=function(a){var c=this;this.lastRequest={initial:!1},this.moreRequest||(this.moreRequest=this._getRequestObject({onOpen:function(){c.showError({},{retryIn:0,target:a,request:c.moreRequest})},onError:function(d,e){c.showError(d,b.extend(e,{target:a,request:c.moreRequest}))},onData:function(b){c._handleInitialResponse(b,function(b){b.length?(c.lastRequest.data=b,c.view.render({name:"body"}),c.view.render({name:"more"})):a.html(c.labels.get("emptyStream")).delay(1e3).fadeOut(1e3)})}})),this.moreRequest.requestType="initial",this.moreRequest.send({data:{q:this.config.get("query")+' pageAfter:"'+this.get("nextPageAfter","0")+'"',appkey:this.config.get("appkey")}})},c.methods._onDataReceive=function(a,c,d){var e=this,f={};this.events.publish({topic:"onDataReceive",data:{entries:a.entries,type:c},propagation:!1});var g=b.map(a.entries,function(a){return function(b){e._initItem(a,!1,function(){f[this.get("data.unique")]=this,b()})}});Echo.Utils.parallelCall(g,function(){d(f)})},c.methods._prepareEventParams=function(a){return b.extend(a,{target:this.config.get("target").get(0),query:this.config.get("query")})},c.methods._applyLiveUpdates=function(a,c){var d=this,e={};e.entries=b.map(a||[],function(a){return d._normalizeEntry(a)}),this.events.publish({topic:"onDataReceive",data:{entries:e.entries,type:"live"},propagation:!1});var f=b.map(e.entries,function(a){return function(b){var c=d.items[a.unique],e=d._classifyAction(a);return c||"post"===e?"post"===e?c?(d._applySpotUpdates("replace",d._updateItem(a)),void b()):void d._initItem(a,!0,function(){c=this;var a=c.isRoot()?d._withinVisibleFrame(c):d._withinVisibleChildrenFrame(c);a||c.isRoot()||!d.user.has("identity",c.data.actor.id)||c.set("byCurrentUser",!0),a||c.get("byCurrentUser")?(d.events.publish({topic:"onItemReceive",data:{item:{data:c.data}},propagation:!1}),d._applySpotUpdates("add",c)):c.destroy(),b()}):void("delete"===e&&(d._applySpotUpdates("remove",c),b())):void b()}});Echo.Utils.sequentialCall(f,function(){d._recalcEffectsTimeouts(),c&&c.call(d)})},c.methods._actualizeChildrenList=function(a,c){var d=this;return b.map(c,function(c){c.targets=b.map(c.targets,function(b){return b.conversationID=a.get("data.target.conversationID"),b}),c=d._normalizeEntry(c);var e=d.items[c.unique];return e&&e.get("byCurrentUser")&&d._applyStructureUpdates("delete",e),c})},c.methods._createChildrenItemsDomWrapper=function(a,c){var d=this,e=b('<div class="'+this.get("cssPrefix")+'children-wrapper"></div>'),f=function(a){return d._getItemListIndex(a,c.get("children"))};return b.each(a,function(b,c){var d=b>0&&f(a[b-1])<f(c)?"append":"prepend";e[d](c.config.get("target")),c.render()}),e},c.methods._extractPresentationConfig=function(a){var b=["sortOrder","itemsPerPage","safeHTML","showFlags"];return Echo.Utils.foldl({},b,function(b,c){"undefined"!=typeof a[b]&&(c[b]=a[b])})},c.methods._extractTimeframeConfig=function(a){var b=function(a){var b=a.match(/^(<|>)(.*)$/),c=b[1];a=b[2].match(/^'([0-9]+) seconds ago'$/);var d=a?function(){return Math.floor((new Date).getTime()/1e3)-a[1]}:function(){return b[2]};return"<"===c?function(a){return a<d()}:">"===c?function(a){return a>d()}:void 0},c=Echo.Utils.foldl([],["before","after"],function(c,d){if(a[c]){var e=b(a[c]);e&&d.push(e)}});return{timeframe:c}},c.methods._getRespectiveAccumulator=function(a,b){var c={likesDescending:"likesCount",flagsDescending:"flagsCount",repliesDescending:"repliesCount"};return a.getAccumulator(c[b])},c.methods._appendRootItems=function(a,c){var d=this;a&&a.length&&(this.itemsRenderingComplete=!1,function e(f){f=f||0,c.append(a[f].config.get("target")),a[f].render(),a.length>++f?d.config.get("asyncItemsRendering")?setTimeout(b.proxy(e,d,f),0):e(f):(d.itemsRenderingComplete=!0,d.events.publish({topic:"onItemsRenderingComplete",global:!1,propagation:!1}))}())},c.methods._constructChildrenSearchQuery=function(a){var b=this.config.get("children.maxDepth")-a.get("depth")-1,c=+this.config.get("children.additionalItemsPerPage"),d=a.getNextPageAfter(),e=this.config.get("children.filter"),f=e&&"()"!==e?e+" ":"";return f+Echo.Utils.foldl("",{childrenof:a.get("data.object.id"),children:b,childrenItemsPerPage:b?+this.config.get("children.itemsPerPage"):0,itemsPerPage:c,sortOrder:this.config.get("children.sortOrder"),childrenSortOrder:this.config.get("children.sortOrder"),pageAfter:d?'"'+(d||0)+'"':void 0,safeHTML:this.config.get("safeHTML")},function(a,b,c){return b+="undefined"!=typeof a?c+":"+a+" ":""})+f},c.methods._handleInitialResponse=function(a,c){var d=this,e=[];this.config.get("target").show(),this.nextSince=a.nextSince||0,this.nextPageAfter=a.nextPageAfter;var f=this._extractPresentationConfig(a);f.itemsPerPage=+f.itemsPerPage,this.config.extend(f),a.entries=a.entries||[],a.children.itemsPerPage=+a.children.itemsPerPage,a.children.maxDepth=+a.children.maxDepth,this.config.set("children",b.extend(this.config.get("children"),a.children)),this.config.extend(this._extractTimeframeConfig(a));var g=this.config.get("sortOrder");a.entries=b.map(a.entries,function(a){return d._normalizeEntry(a)});var h=this.hasInitialData?"more":"initial";this._onDataReceive(a,h,function(f){b.map(a.entries,function(a){var b=f[a.unique];d._applyStructureUpdates("add",b),b.isRoot()&&d._addItemToList(e,b,g)}),d.hasInitialData=!0,d.isViewComplete=a.hasMoreChildren?"false"===a.hasMoreChildren:e.length!==d.config.get("itemsPerPage"),(c||function(a){d.lastRequest={initial:!0,data:a},d.render(),d.ready()})(e),d.itemsRefreshInterval&&clearInterval(d.itemsRefreshInterval),d.itemsRefreshInterval=setInterval(function(){d._refreshItemsDate(),d._checkTimeframeSatisfy()},1e3*d.config.get("itemsRefreshInterval"))})},c.methods._checkTimeframeSatisfy=function(){var a=this,c=this.config.get("timeframe");if(c&&c.length){var d=Echo.Utils.foldl([],this.threads,function(a,b){var d=Echo.Utils.foldl(!0,c,function(b,c){return c?b(a.get("timestamp")):!1});d||b.push(a)});b.map(d,function(b){a._applySpotUpdates("remove",b)})}},c.methods._handleLiveUpdatesResponse=function(a){var b=this;a=a||{},this._applyLiveUpdates(a.entries,function(){b.view.render({name:"state"}),b._executeNextActivity()})},c.methods._getRequestObject=function(a){var c=b.extend(!0,{endpoint:"search",secure:this.config.get("useSecureAPI"),apiBaseURL:this.config.get("apiBaseURL"),data:{q:this.config.get("query"),appkey:this.config.get("appkey")}},a);return Echo.StreamServer.API.request(c)},c.methods._recalcEffectsTimeouts=function(){var a=this,b={fade:a.config.get("fadeTimeout"),slide:a.config.get("slideTimeout")};if(a.timeouts=a.timeouts||{fade:b.fade,slide:b.slide},b.fade||b.slide){a.timeouts.coeff=a.timeouts.coeff||{fade:a.timeouts.fade/(b.fade+b.slide),slide:a.timeouts.slide/(b.fade+b.slide)};var c=function(c,d){return d=Math.round(d*a.timeouts.coeff[c]),100>d?0:d>b[c]?b[c]:d},d=1e3*a.config.get("liveUpdates.polling.timeout")*.8,e=a.activities.queue.length?d/a.activities.queue.length:d;a.timeouts.fade=c("fade",e),a.timeouts.slide=c("slide",e)}},c.methods._refreshItemsDate=function(){b.map(this.threads,function(a){a.view.render({name:"date"}),a.traverse(a.get("children"),function(a){a.view.render({name:"date"})})})},c.methods._executeNextActivity=function(){var a=this.activities;a.queue.length||"full"!==this.config.get("state.layout")||(a.state="paused"),a.animations>0||!this.itemsRenderingComplete||!a.queue.length||this.config.get("liveUpdates.enabled")&&"paused"===a.state&&"replace"!==a.queue[0].action&&!a.queue[0].byCurrentUser||a.queue.shift().handler()},c.methods._spotUpdates={animate:{}},c.methods._spotUpdates.add=function(a,b){var c=this.items[a.get("data.unique")];if(c&&c.view.rendered()&&"high"!==b.priority)return this._applySpotUpdates("replace",this._updateItem(a.get("data")),{priority:"highest"}),void a.destroy();if(this._applyStructureUpdates("add",a),a.set("added",!0),a.isRoot())this._placeRootItem(a);else{var d=this._getParentItem(a);d&&d.view.rendered()&&(d.view.render({name:"container"}),d.view.render({name:"children"}),d.view.render({name:"childrenByCurrentActorLive"}))}},c.methods._spotUpdates.replace=function(a){if(a.unblock(),this._maybeMoveItem(a)){var c=this._getParentItem(a),d=this.config.get(c?"children.sortOrder":"sortOrder"),e=c?c.get("children"):this.threads,f=this._getItemListIndex(a,e),g=b.extend([],e);g.splice(f,1);var h=this._getItemProjectedIndex(a,g,d);f!==h&&(this._applySpotUpdates("remove",a,{keepChildren:!0,priority:"high"}),this._applySpotUpdates("add",a,{priority:"high"}))}a&&a.view.rendered()&&(a.view.render({name:"container",recursive:!0}),a.events.publish({topic:"onRerender"}))},c.methods._spotUpdates.remove=function(a,b){if(a.set("deleted",!0),a.isRoot())a.events.publish({topic:"onDelete",data:{config:b},global:!1,propagation:!1});else{var c=this._getParentItem(a);c&&(c.view.render({name:"children",target:c.view.get("children"),extra:b}),c.view.render({name:"childrenByCurrentActorLive",target:c.view.get("childrenByCurrentActorLive"),extra:b}),c.view.render({name:"container"}))}},c.methods._spotUpdates.animate.fade=function(a){var b=this;if(this.timeouts.fade){var c=Math.round(this.timeouts.fade/2),d=a.view.get("container"),e=Echo.Utils.getVisibleColor(d),f="background-color "+c+"ms linear";d.css("background-color",this.config.get("flashColor")),setTimeout(function(){d.css({transition:f,"-o-transition":f,"-ms-transition":f,"-moz-transition":f,"-webkit-transition":f,"background-color":e}),d.css("background-color",""),b.activities.animations--,b._executeNextActivity()},c)}else this.activities.animations--,this._executeNextActivity()},c.methods._spotUpdates.animate.add=function(a){var b=this;if(this.activities.animations++,this.timeouts.slide){var c=a.config.get("target").show().css("height");a.config.get("target").css("overflow","hidden"),a.view.get("content").css("margin-top","-"+c).animate({"margin-top":"0px"},this.timeouts.slide,function(){a.config.get("target").css("overflow",""),a.view.get("content").css("margin-top",""),b._spotUpdates.animate.fade.call(b,a)})}else a.config.get("target").show(),b._spotUpdates.animate.fade.call(b,a)},c.methods._spotUpdates.animate.remove=function(a,c){var d=this;this.activities.animations++,c=c||{};var e=b.isFunction(c)?c:c.callback||function(){if(a.config.get("target").length){a.config.get("target")[c.keepChildren?"detach":"remove"]();var b=Echo.Utils.foldl(0,d.items,function(a,b){return b+1});b||d.showMessage({type:"info",message:d.labels.get("emptyStream"),target:d.view.get("body")}),d._applyStructureUpdates("delete",a,c),d.activities.animations--,d._executeNextActivity()}};this.timeouts.slide?a.config.get("target").slideUp(this.timeouts.slide,e):e()},c.methods._applySpotUpdates=function(a,b,c){var d=this;c=c||{},this.queueActivity({action:a,item:b,priority:c.priority,handler:function(){d._spotUpdates[a].call(d,b,c),d._executeNextActivity()}})},c.methods._animateSpotUpdate=function(a,b,c){this._spotUpdates.animate[a].call(this,b,c)},c.methods._getActivityProjectedIndex=function(a,c){var d={highest:0,high:10,medium:20,low:30,lowest:40};c.priority="highest"===c.priority&&"highest"||a&&"high"||"replace"===c.action&&"medium"||c.priority||"lowest";var e;return"replace"===c.action&&b.each(this.activities.queue,function(a,b){return"add"===b.action&&b.itemUnique===c.itemUnique?(c.priority=b.priority,!1):void 0}),b.each(this.activities.queue,function(a,b){return d[c.priority]<d[b.priority]?(e=a,!1):void 0}),e},c.methods._classifyAction=function(a){return"http://activitystrea.ms/schema/1.0/delete"===a.verbs[0]?"delete":"post"},c.methods._maybeMoveItem=function(a){return a.get("forceInject")},c.methods._withinVisibleFrame=function(a,b,c,d){return b=b||this.threads,c="undefined"==typeof c?this.isViewComplete:c,d=d||this.config.get("sortOrder"),c||!b.length?!0:1===this._itemsComparator(b[b.length-1],a,d)},c.methods._withinVisibleChildrenFrame=function(a){var b=this._getParentItem(a)||this._getParentItemFromActivityQueue(a);return b?this._withinVisibleFrame(a,b.get("children"),!b.hasMoreChildren(),this.config.get("children.sortOrder")):!1},c.methods._getParentItemFromActivityQueue=function(a){return a.isRoot()?void 0:Echo.Utils.safelyExecute(function(c){var d;return b.each(c,function(b,c){return"add"===c.action&&c.item.get("data.unique")===a.get("data.parentUnique")?(d=c.item,!1):void 0}),d},[this.activities.queue])},c.methods._getParentItem=function(a){return a.isRoot()?void 0:this.items[a.get("data.parentUnique")]},c.methods._itemsComparator=function(a,c,d){var e,f=this,g=this.config.get("itemsComparator");if(g&&b.isFunction(g))return g(a,c,d);switch(d){case"chronological":e=a.get("timestamp")>c.get("timestamp");break;case"reverseChronological":e=a.get("timestamp")<=c.get("timestamp");break;case"likesDescending":case"repliesDescending":case"flagsDescending":var h=function(a){return f._getRespectiveAccumulator(a,d)};e=h(a)<h(c)||h(a)===h(c)&&1===this._itemsComparator(a,c,"reverseChronological")}return e?1:"undefined"==typeof e?0:-1},c.methods._placeRootItem=function(a){var b=a.config.get("target");if(this.threads.length>1){var c=this._getItemListIndex(a,this.threads),d=this.threads[c+1],e=this.threads[c-1];d?d.config.get("target").before(b):e.config.get("target").after(b)}else this.view.get("body").empty().append(b);a.events.publish({topic:"onAdd",global:!1,propagation:!1})},c.methods._placeChildItems=function(a,c){var d=this,e=this._createChildrenItemsDomWrapper(c,a),f=-1;b.each(a.get("children"),function(a,b){return d._isItemInList(b,c)?(f=a-1,!1):void 0});var g=f>=0?a.get("children")[f].config.get("target"):a.view.get("children"),h=f>=0?"insertAfter":"chronological"!==this.config.get("children.sortOrder")?"prependTo":"appendTo";e[h](b(g)),a.view.render({name:"childrenByCurrentActorLive"}),e.css("height",e.show().css("height")).hide().animate({height:"show",marginTop:"show",marginBottom:"show",paddingTop:"show",paddingBottom:"show"},{duration:this.config.get("children.itemsSlideTimeout"),complete:function(){e.css("height",""),a.view.render({name:"expandChildren"}),a.view.render({name:"expandChildrenLabel"}),e.children().unwrap()}})},c.methods._getItemListIndex=function(a,c){var d=-1;return b.each(c||[],function(b,c){return c.get("data.unique")===a.get("data.unique")?(d=b,!1):void 0}),d},c.methods._isItemInList=function(a,b){return this._getItemListIndex(a,b)>=0},c.methods._initItem=function(a,c,d){this.itemParentConfig||(this.itemParentConfig=this.config.getAsHash());var e=b.extend({target:b("<div>"),appkey:this.config.get("appkey"),plugins:this.config.get("plugins"),context:this.config.get("context"),useSecureAPI:this.config.get("useSecureAPI"),apiBaseURL:this.config.get("apiBaseURL"),submissionProxyURL:this.config.get("submissionProxyURL"),user:this.user,live:c,ready:d},this.itemParentConfig.item);e.parent=this.itemParentConfig,e.data=this._normalizeEntry(a);var f=function(){new Echo.StreamServer.Controls.Stream.Item(e)};this.config.get("asyncItemsRendering")?setTimeout(f,0):f()},c.methods._updateItem=function(a){var c=this.items[a.unique],d=this.config.get(c.isRoot()?"sortOrder":"children.sortOrder"),e=d.match(/replies|likes|flags/),f=e&&this._getRespectiveAccumulator(c,d);return c.data.object.published!==a.object.published&&(c.set("timestamp",Echo.Utils.timestampFromW3CDTF(a.object.published)),c.set("forceInject",!0)),b.extend(c.data,a),e&&this._getRespectiveAccumulator(c,d)!==f&&c.set("forceInject",!0),c},c.methods._getItemProjectedIndex=function(a,c,d){var e,f=this;return(a.config.get("live")||a.get("forceInject"))&&b.each(c||[],function(b,c){return 1===f._itemsComparator(c,a,d)?(e=b,!1):void 0}),"undefined"!=typeof e?e:c.length},c.methods._addItemToList=function(a,b,c){this.config.get("itemsComparator")&&b.set("forceInject",!0),a.splice(this._getItemProjectedIndex(b,a,c),0,b),b.set("forceInject",!1),this.items[b.get("data.unique")]=b},c.methods._applyStructureUpdates=function(a,b,c){var d,e=this;switch(c=c||{},a){case"add":if(this.items[b.get("data.unique")]=b,b.isRoot())this._addItemToList(this.threads,b,this.config.get("sortOrder"));else{if(d=this._getParentItem(b),!d)return void delete this.items[b.get("data.unique")];b.set("depth",d.get("depth")+1),d.set("threading",!0),b.set("forceInject",!0),this._addItemToList(d.get("children"),b,this.config.get("children.displaySortOrder"))}break;case"delete":var f=b.isRoot()?this.threads:this.items[b.get("data.parentUnique")].get("children");if(b.isRoot()||1!==f.length||(d=this._getParentItem(b),d&&d.set("threading",!1)),f.splice(this._getItemListIndex(b,f),1),!c.keepChildren){var g=this._getItemListIndex(b,this.lastRequest.data);this.lastRequest.data.splice(g,1),b.traverse(b.get("children"),function(a){delete e.items[a.get("data.unique")],a.destroy()}),b.destroy(),b.set("children",[])}delete this.items[b.get("data.unique")]}},c.methods._normalizeEntry=function(a){if(a.normalized)return a;var c=this;return a.normalized=!0,b.each(a.targets||[],function(b,d){(d.id===d.conversationID||d.id===a.object.id||c.items[d.id+d.conversationID])&&(a.target=d)}),a.object.content_type=a.object.content_type||"text",a.object.accumulators=a.object.accumulators||{},b.each(["repliesCount","flagsCount","likesCount"],function(b,c){a.object.accumulators[c]=parseInt(a.object.accumulators[c]||"0")}),a.object.context=a.object.context||[],a.object.flags=a.object.flags||[],a.object.likes=a.object.likes||[],a.target=a.target||a.targets[0]||{},a.target.conversationID=a.target.conversationID||a.object.id,a.source=a.source||{},a.provider=a.provider||{},a.unique=a.object.id+a.target.conversationID,a.parentUnique=a.target.id+a.target.conversationID,a},c.css=".{class:message-wrapper} { padding: 15px 0px; text-align: center; -moz-border-radius: 0.5em; -webkit-border-radius: 0.5em; border: 1px solid #E4E4E4; }.{class:message-empty}, .{class:message-loading}, .{class:message-error} { display: inline-block; height: 16px; padding-left: 21px; background: no-repeat left center; }.{class:message-empty} { background-image: url({config:cdnBaseURL.sdk-assets}/images/information.png); }.{class:message-loading} { background-image: url({config:cdnBaseURL.sdk-assets}/images/loading.gif); }.{class:message-error} { background-image: url({config:cdnBaseURL.sdk-assets}/images/warning.gif); }.{class:header} { margin: 10px 0px 10px 0px; }.{class:compactStateLayout} { float: right; }.{class:fullStateLayout} { text-align: center; }.{class:state-picture} { display: inline-block; height: 9px; width: 8px; }.{class:state-picture-paused} { background: url({config:cdnBaseURL.sdk-assets}/images/control_pause.png) no-repeat center center; }.{class:state-picture-live} { background: url({config:cdnBaseURL.sdk-assets}/images/control_play.png) no-repeat center center; }.{class:state-message} { margin-left: 5px; text-decoration: none; }.echo-clickable a.{class:state-message}:hover { text-decoration: underline; }.{class:more}:hover, .{class:fullStateLayout}:hover { background-color: #E4E4E4; }.{class:more}, .{class:fullStateLayout} { text-align: center; border: solid 1px #E4E4E4; margin-top: 10px; padding: 10px; -moz-border-radius: 0.5em; -webkit-border-radius: 0.5em; cursor: pointer; font-weight: bold; }.{class:more} .echo-app-message { padding: 0; border: none; border-radius: 0; }",Echo.Control.create(c))}(Echo.jQuery),function(a){"use strict";var b=a,c=Echo.Control.manifest("Echo.StreamServer.Controls.Stream.Item");if(!Echo.Control.isDefined(c)){c.init=function(){this.timestamp=Echo.Utils.timestampFromW3CDTF(this.get("data.object.published")),this.ready()},c.config={aggressiveSanitization:!1,buttonsOrder:void 0,contentTransformations:{text:["smileys","urls","newlines"],html:["smileys","urls","newlines"],xhtml:["smileys","urls"]},infoMessages:{enabled:!1},limits:{maxBodyCharacters:void 0,maxBodyLines:void 0,maxBodyLinkLength:50,maxMarkerLength:16,maxReLinkLength:30,maxReTitleLength:143,maxTagLength:16},optimizedContext:!0,providerIcon:Echo.Loader.getURL("images/favicons/comments.png",!1),reTag:!0,viaLabel:{icon:!1,text:!1}},c.config.normalizer={contentTransformations:function(a){return b.each(a,function(b,c){a[b]=Echo.Utils.foldl({},c||[],function(a,b){b[a]=!0})}),a}},c.vars={children:[],depth:0,threading:!1,textExpanded:!1,timestamp:void 0,blocked:!1,buttonsOrder:[],buttonSpecs:{},buttons:{}},c.labels={defaultModeSwitchTitle:"Switch to metadata view",guest:"Guest",metadataModeSwitchTitle:"Return to default view",sharedThisOn:"I shared this on {service}...",userID:"User ID:",userIP:"User IP:",textToggleTruncatedMore:"more",textToggleTruncatedLess:"less",fromLabel:"from",viaLabel:"via",childrenMoreItems:"View more items",re:"Re"},c.templates.metadata={userID:'<div class="{class:metadata-userID}"><span class="{class:metadata-title} {class:metadata-icon}">{label:userID}</span><span class="{class:metadata-value}">{data:actor.id}</span></div>',userIP:'<div class="{class:metadata-userIP}"><span class="{class:metadata-title} {class:metadata-icon}">{label:userIP}</span><span class="{class:metadata-value}">{data:ip}</span></div>'},c.templates.mainHeader='<div class="{class:content}"><div class="{class:container}"><div class="{class:avatar-wrapper}"><div class="{class:avatar}"></div></div><div class="{class:wrapper}"><div class="{class:subwrapper}"><div class="{class:subcontainer}"><div class="{class:frame}"><div class="{class:modeSwitch} echo-clickable"></div><div class="{class:authorName} echo-linkColor"></div><div class="echo-clear"></div><div class="{class:data}"><div class="{class:re}"></div><div class="{class:body} echo-primaryColor"> <span class="{class:text}"></span><span class="{class:textEllipses}">...</span><span class="{class:textToggleTruncated} echo-linkColor echo-clickable"></span></div><div class="{class:markers} echo-secondaryFont echo-secondaryColor"></div><div class="{class:tags} echo-secondaryFont echo-secondaryColor"></div></div><div class="{class:metadata}"></div><div class="{class:footer} echo-secondaryColor echo-secondaryFont"><img class="{class:sourceIcon} echo-clickable"><div class="{class:date}"></div><div class="{class:from}"></div><div class="{class:via}"></div><div class="{class:buttons}"></div><div class="echo-clear"></div></div></div></div><div class="echo-clear"></div></div></div><div class="echo-clear"></div><div class="{class:childrenMarker}"></div></div>',c.templates.mainFooter='<div class="{class:childrenByCurrentActorLive}"></div></div>',c.templates.childrenTop='<div class="{class:children}"></div><div class="{class:expandChildren} {class:container-child} echo-trinaryBackgroundColor echo-clickable"><span class="{class:expandChildrenLabel} echo-message-icon"></span></div>',c.templates.childrenBottom='<div class="{class:expandChildren} {class:container-child} echo-trinaryBackgroundColor echo-clickable"><span class="{class:expandChildrenLabel} echo-message-icon"></span></div><div class="{class:children}"></div>',c.methods.template=function(){return this.templates.mainHeader+("chronological"===this.config.get("parent.children.sortOrder")?this.templates.childrenTop:this.templates.childrenBottom)+this.templates.mainFooter},c.renderers.authorName=function(a){var b=this.get("data.actor.title")||this.labels.get("guest");return Echo.Utils.safelyExecute(a.html,b,a)||a},c.renderers.markers=function(a){return this.view.render({name:"_extraField",target:a,extra:{type:"markers"}})},c.renderers.tags=function(a){return this.view.render({name:"_extraField",target:a,extra:{type:"tags"}})},c.renderers.container=function(a){var c=this;a.removeClass(b.map(["child","root","child-thread","root-thread"],function(a){return c.cssPrefix+"container-"+a}).join(" "));var d=this.threading?"-thread":"",e=this.depth?"container-child"+d+" echo-trinaryBackgroundColor":"container-root"+d;a.addClass(this.cssPrefix+"depth-"+this.depth+" "+this.cssPrefix+e);var f=function(a){b.map(c.buttonsOrder,function(b){var d=c.get("buttons."+b+".clickableElements");c.get("buttons."+b+".element")&&d&&d[a+"Class"]("echo-linkColor")})};return Echo.Utils.isMobileDevice()||a.off(["mouseleave","mouseenter"]).hover(function(){c.user.is("admin")&&c.view.get("modeSwitch").show(),f("add")},function(){c.user.is("admin")&&c.view.get("modeSwitch").hide(),f("remove")}),a},c.renderers.metadata=function(a){if(a.empty(),this.user.is("admin")){var b=this.view.fork(),d=function(d){a.append(b.render({template:c.templates.metadata[d]}))
};d("userID"),this.get("data.ip")&&d("userIP")}return a.hide()},c.renderers.modeSwitch=function(a){var b=this;if(a.hide(),!this.user.is("admin"))return a;var c="default",d=function(){a.attr("title",b.labels.get(c+"ModeSwitchTitle"))};return d(),a.click(function(){c="default"===c?"metadata":"default",d(),b.view.get("data").toggle(),b.view.get("metadata").toggle()}),Echo.Utils.isMobileDevice()&&a.show(),a},c.renderers.wrapper=function(a){return a.addClass(this.cssPrefix+"wrapper"+(this.depth?"-child":"-root"))},c.renderers.avatar=function(a){return this.placeImage({container:a,image:this.get("data.actor.avatar"),defaultImage:this.config.get("defaultAvatar")}),a},c.renderers.children=function(a,b){return this.view.render({name:"_childrenContainer",target:a,extra:{filter:function(a){return!a.byCurrentUser},keepChildren:b&&b.keepChildren}})},c.renderers.childrenByCurrentActorLive=function(a,b){return this.view.render({name:"_childrenContainer",target:a,extra:{filter:function(a){return a.byCurrentUser},keepChildren:b&&b.keepChildren}})},c.renderers.buttons=function(a){var c=this;return this._assembleButtons(),this._sortButtons(),a.empty(),b.map(this.buttonsOrder,function(b){var d=c.get("buttons."+b);d&&d.name&&d.visible()&&(c.view.render({name:"_buttonsDelimiter",target:a}),c.view.render({name:"_button",target:a,extra:d}))}),a},c.renderers.re=function(a){var c=this;if(!this.config.get("reTag")||this.depth)return a.hide();var d=document.location.href,e=this.get("data.object.context"),f=this.get("data.object.permalink");if(f===d||!e||!e.length)return a.hide();var g=!1;if(b.map(e,function(a){return a.uri===d?(g=!0,!1):void 0}),g)return a.hide();var h,i={limits:this.config.get("limits"),openLinksInNewWindow:this.config.get("parent.openLinksInNewWindow")},j=this._getDomain(d);if(this.config.get("optimizedContext")){var k;b.map(e,function(a){return c._getDomain(a.uri)===j?(k=a,!1):void 0}),h=this._reOfContext(k||e[0],i)}else h=b.map(e,function(a){return c._reOfContext(a,i)});return a.empty().append(h).show()},c.renderers.sourceIcon=function(a){if(!this.config.get("viaLabel.icon")||"jskit"===this.get("data.source.name")||"echo"===this.get("data.source.name"))return a.hide();var b=this.get("data.source.icon",this.config.get("providerIcon")),c={href:this.get("data.source.uri",this.get("data.object.permalink"))},d={openInNewWindow:this.config.get("parent.openLinksInNewWindow")};return a.hide().attr("src",Echo.Utils.htmlize(b)).one("error",function(){a.hide()}).one("load",function(){a.show().wrap(Echo.Utils.hyperlink(c,d))}),a},c.renderers.via=function(a){var b=this,c=function(a){return(b.data[a].name||"").toLowerCase()};return c("source")===c("provider")?a:this.view.render({name:"_viaText",target:a,extra:{label:"via",field:"provider"}})},c.renderers.from=function(a){return this.view.render({name:"_viaText",target:a,extra:{label:"from",field:"source"}})},c.renderers.textToggleTruncated=function(a){var b=this;return a.off("click").click(function(){b.textExpanded=!b.textExpanded,b.view.render({name:"body"}),b.view.render({name:"textToggleTruncated"})}),a.empty().append(this.labels.get("textToggleTruncated"+(this.textExpanded?"Less":"More")))},c.renderers.body=function(a){var c=this,d=[this.get("data.object.content"),{source:this.get("data.source.name"),limits:this.config.get("limits"),contentTransformations:this.config.get("contentTransformations."+this.get("data.object.content_type"),{}),openLinksInNewWindow:this.config.get("parent.openLinksInNewWindow")}];b.each(this._getBodyTransformations(),function(a,b){return d=b.apply(c,d),/\S/.test(d[0])?void 0:(d[0]=c.labels.get("sharedThisOn",{service:d[1].source}),!1)});var e=d[0],f=d[1].truncated,g=this.view.get("text").empty();return Echo.Utils.safelyExecute(g.append,e,g),this.view.get("textEllipses")[!f||this.textExpanded?"hide":"show"](),this.view.get("textToggleTruncated")[f||this.textExpanded?"show":"hide"](),a},c.renderers.date=function(a){return this.age=this.getRelativeTime(this.timestamp),a.html(this.age)},c.renderers.expandChildrenLabel=function(a,b){if(!this.children.length||!this.hasMoreChildren())return a;b=b||{},b.state=b.state||"regular";var c={loading:{css:this.cssPrefix+"message-loading",label:"loading"},regular:{css:"echo-linkColor echo-message-icon",label:"childrenMoreItems"}};return a.removeClass(c["loading"===b.state?"regular":"loading"].css).addClass(c[b.state].css).html(this.labels.get(c[b.state].label))},c.renderers.expandChildren=function(a,b){var c=this;return this.children.length?this.hasMoreChildren()?(b=b||{},a.addClass(this.cssPrefix+"depth-"+(this.depth+1)).show().off("click").one("click",function(){c.view.render({name:"expandChildrenLabel",target:c.view.get("expandChildrenLabel"),extra:{state:"loading"}}),c.events.publish({topic:"onChildrenExpand",data:{data:c.data},global:!1,propagation:!1})})):(a.slideUp(this.config.get("children.moreButtonSlideTimeout")),a):a},c.renderers._childrenContainer=function(a,c){return b.each(a.children(),function(a,c){b(c).detach()}),b.map(this.children,function(b){c&&c.filter&&!c.filter(b)||(a.append(b.config.get("target")),b.view.rendered()||b.added||b.render(),(b.deleted||b.added)&&b.events.publish({topic:b.deleted?"onDelete":"onAdd",data:{config:c},global:!1,propagation:!1}))}),a},c.renderers._extraField=function(a,b){var c=this,d=(b||{}).type;if(!this.data.object[d]||!this.user.is("admin"))return a.hide();var e="markers"===d?"maxMarkerLength":"maxTagLength",f=this.config.get("limits."+e),g=Echo.Utils.foldl([],this.data.object[d],function(a,b){var d=a.length>f?'<span title="{data:item}">{data:truncatedItem}</span>':"<span>{data:item}</span>",e=Echo.Utils.htmlTextTruncate(a,f,"...");b.push(c.substitute({template:d,data:{item:a,truncatedItem:e}}))});return(Echo.Utils.safelyExecute(a.prepend,g.sort().join(", "),a)||a).show()},c.renderers._button=function(a,c){var d=c.template||'<a class="{class:button} {class:button}-{data:name}">{data:label}</a>',e=b(this.substitute({template:d,data:{label:c.label||"",name:c.name}}));if(!c.clickable)return a.append(e);var f=b(".echo-clickable",e);f.length||(f=e,e.addClass("echo-clickable")),f[c.once?"one":"on"]({click:function(a){a.stopPropagation(),c.callback&&c.callback()}});var g=this.get("buttons."+c.plugin+"."+c.name);return g.element=e,g.clickableElements=f,Echo.Utils.isMobileDevice()&&f.addClass("echo-linkColor"),a.append(e)},c.renderers._buttonsDelimiter=function(a){return a.append('<span class="'+this.cssPrefix+'button-delim"> &middot; </span>')},c.renderers._viaText=function(a,b){b=b||{};var c=this.data[b.field];if(!this.config.get("viaLabel.text")||!c.name||"jskit"===c.name||"echo"===c.name)return a;var d=Echo.Utils.hyperlink({"class":"echo-secondaryColor",href:c.uri||this.get("data.object.permalink"),caption:c.name},{openInNewWindow:this.config.get("parent.openLinksInNewWindow")});return a.html("&nbsp;"+this.labels.get(b.label+"Label")+"&nbsp;").append(d)},c.methods.hasMoreChildren=function(){return"true"===this.get("data.hasMoreChildren")},c.methods.getNextPageAfter=function(){var a=b.grep(this.children,function(a){return!a.config.get("live")}),c="chronological"===this.config.get("parent.children.sortOrder")?a.length-1:0;return a.length?a[c].data.pageAfter:void 0},c.methods.traverse=function(a,c,d){var e=this;return b.each(a||[],function(a,b){d=e.traverse(b.children,c,c(b,d))}),d},c.methods.block=function(a){if(!this.blocked){this.blocked=!0;var c=this.view.get("container"),d=c.width(),e=c.outerHeight();this.blockers={backdrop:b('<div class="'+this.cssPrefix+'blocker-backdrop"></div>').css({width:d,height:e}),message:b(this.substitute({template:'<div class="{class:blocker-message}">{data:label}</div>',data:{label:a}})).css({left:(parseInt(d)-200)/2+"px",top:(parseInt(e)-20)/2+"px"})},c.addClass("echo-relative").prepend(this.blockers.backdrop).prepend(this.blockers.message)}},c.methods.unblock=function(){this.blocked&&(this.blocked=!1,this.blockers.backdrop.remove(),this.blockers.message.remove(),this.view.get("container").removeClass("echo-relative"))},c.methods.getAccumulator=function(a){return this.data.object.accumulators[a]},c.methods.isRoot=function(){return!this.config.get("parent.children.maxDepth")||this.get("data.object.id")===this.get("data.target.conversationID")},c.methods.addButtonSpec=function(a,b){this.buttonSpecs[a]||(this.buttonSpecs[a]=[]),this.buttonSpecs[a].push(b)},c.methods._getDomain=function(a){var b=Echo.Utils.parseURL(a);return b&&b.domain?b.domain:a},c.methods._reOfContext=function(a,c){var d=a.title||a.uri.replace(/^https?:\/\/(.*)/gi,"$1"),e=c.limits[d?"maxReTitleLength":"maxReLinkLength"];d.length>e&&(d=d.substring(0,e)+"...");var f=Echo.Utils.hyperlink({"class":"echo-primaryColor",href:a.uri,caption:this.labels.get("re")+": "+Echo.Utils.stripTags(d)},{openInNewWindow:c.openLinksInNewWindow});return b(this.substitute({template:'<div class="{class:re-container}">{data:hyperlink}</div>',data:{hyperlink:f}}))},c.methods._prepareEventParams=function(a){return b.extend(a,{target:this.config.get("parent.target").get(0),query:this.config.get("parent.query"),item:{data:this.data,target:this.config.get("target").get(0)}})};var d={codes:[],regexps:[],hash:{":)":{file:"smile.png",title:"Smile"},":-)":{file:"smile.png",title:"Smile"},";)":{file:"wink.png",title:"Wink"},";-)":{file:"wink.png",title:"Wink"},":(":{file:"unhappy.png",title:"Frown"},":-(":{file:"unhappy.png",title:"Frown"},"=-O":{file:"surprised.png",title:"Surprised"},":-D":{file:"grin.png",title:"Laughing"},":-P":{file:"tongue.png",title:"Tongue out"},"=)":{file:"happy.png",title:"Happy"},"B-)":{file:"evilgrin.png",title:"Evil grin"}}};c.methods._initSmileysConfig=function(){var a=this;if(d.codes.length)return d;var c=function(a){return a.replace(/([\W])/g,"\\$1")},e=[];return b.each(d.hash,function(b,f){var g=c(b);e.push(g),d.codes.push(b),d.regexps[b]=new RegExp(g,"g"),f.tag=a.substitute({template:'<img class="{class:smiley-icon}" src="{config:cdnBaseURL.sdk-assets}/images/smileys/emoticon_'+f.file+'" title="'+f.title+'" alt="'+f.title+'">'})}),d.regexps.test=new RegExp(e.join("|")),d},c.methods._assembleButtons=function(){var a=this,c=[];b.each(this.buttonSpecs,function(d,e){b.map(e,function(e){var f=b.isFunction(e)?e.call(a):b.extend({},e);if(f.name){var g=f.callback||function(){};f.callback=function(){g.call(a),a.events.publish({topic:"onButtonClick",data:{name:f.name,plugin:d,item:{data:a.data,target:a.config.get("target")}}})},f.label=f.label||f.name,f.plugin=d,"undefined"==typeof f.clickable&&(f.clickable=!0),"undefined"==typeof f.visible&&(f.visible=!0);var h=f.visible;f.visible=b.isFunction(h)?h:function(){return h};var i=d+"."+f.name;a.set("buttons."+i,f),b.inArray(i,a.buttonsOrder)<0&&c.push(i)}})}),this.buttonsOrder=c.concat(this.buttonsOrder)},c.methods._sortButtons=function(){var a=this,c=this.buttonsOrder,d=this.config.get("buttonsOrder");if(d)if(d!==c){var e=function(d,e,f){a.get("buttons."+d)&&(e.push(d),f=f||b.inArray(d,c),f>=0&&delete c[f])},f=Echo.Utils.foldl([],d,function(a,d){if(/^(.*)\./.test(a))e(a,d);else{var f=new RegExp("^"+a+"\\.");b.map(c,function(a,b){a&&a.match(f)&&e(a,d,b)})}});this.buttonsOrder=f,this.config.set("buttonsOrder",f)}else d.length||(this.buttonsOrder=[]);else this.config.set("buttonsOrder",c)},function(){c.methods._getBodyTransformations=function(){return[e,f,h,g,k,l,m,i,j,n]};var a="((?:http|ftp|https):\\/\\/(?:[a-z0-9#:\\/\\;\\?\\-\\.\\+,@&=%!\\*\\'(){}\\[\\]$_|^~`](?!gt;|lt;))+)",d=function(a,b){var c=a.length>b.maxTagLength?'<span class="{class:tag}" title="{data:tag}">{data:truncatedTag}</span>':'<span class="{class:tag}">{data:tag}</span>',d=a.substring(0,b.maxTagLength)+"...";return this.substitute({template:c,data:{tag:a,truncatedTag:d}})},e=function(a,b){return b.source&&"Twitter"===b.source&&this.config.get("aggressiveSanitization")&&(a=""),[a,b]},f=function(a,b){var c=this;return b.contentTransformations.hashtags&&(a=a.replace(/(?:#|\uff03)(<a[^>]*>[^<]*<\/a>)/gi,function(a,e){return d.call(c,e,b.limits)})),[a,b]},g=function(a,b){var c=this;return b.contentTransformations.hashtags&&(a=a.replace(/(^|[^\w&\/])(?:#|\uff03)([^\s\.,;:'"#@\$%<>!\?\(\)\[\]]+)/gi,function(a,e,f){return e+d.call(c,f,b.limits)})),[a,b]},h=function(a,b){var c=this,d=[];return a=a.replace(/((<a\s+[^>]*>)(.*?)(<\/a>))|<.*?>/gi,function(a,e,f,j,k){if(e){var l=h.call(c,j,b);l=g.apply(c,l),l=i.apply(c,l),a=f+l[0]+k}return d.push(a)," %%HTML_TAG%% "}),b.tags=d,[a,b]},i=function(a,c){return b.each(c.tags,function(b,c){a=a.replace(" %%HTML_TAG%% ",c)}),[a,c]},j=function(b,c){return b=b.replace(/(<a\s+[^>]*>)(.*?)(<\/a>)/gi,function(b,d,e,f){return new RegExp("^"+a+"$","i").test(e)&&(e=e.length>c.limits.maxBodyLinkLength?e.substring(0,c.limits.maxBodyLinkLength)+"...":e),c.openLinksInNewWindow&&!/\s+target=("[^<>"]*"|'[^<>']*'|\w+)/.test(d)&&(d=d.replace(/(^<a\s+[^>]*)(>$)/,'$1 target="_blank"$2')),d+e+f}),[b,c]},k=function(b,c){c.textBeforeAutoLinking=b;var d;return c.source&&"jskit"!==c.source&&"echo"!==c.source&&(d=this.depth?this.get("data.target.id"):this.config.get("reTag")?this.get("data.object.permalink")||this.get("data.target.id"):void 0),b=b.replace(new RegExp(a,"ig"),function(a,b){return d===b?"":c.contentTransformations.urls?Echo.Utils.hyperlink({href:b,caption:b},{skipEscaping:!0,openInNewWindow:c.openLinksInNewWindow}):a}),[b,c]},l=function(a,c){if(c.contentTransformations.smileys){if(a!==c.textBeforeAutoLinking){var d=i.call(this,a,c);d=h.apply(this,d),a=d[0],c=d[1]}var e=this._initSmileysConfig();a.match(e.regexps.test)&&b.each(e.codes,function(b,c){a=a.replace(e.regexps[c],e.hash[c].tag)})}return[a,c]},m=function(a,b){return b.contentTransformations.newlines&&(a=a.replace(/\n\n+/g,"\n\n"),a=a.replace(/\n/g,"&nbsp;<br>")),[a,b]},n=function(a,b){var c=!1;if((b.limits.maxBodyCharacters||b.limits.maxBodyLines)&&!this.textExpanded){if(b.limits.maxBodyLines){var d=b.contentTransformations.newlines?"<br>":"\n",e=a.split(d);e.length>b.limits.maxBodyLines&&(a=e.splice(0,b.limits.maxBodyLines).join(d),c=!0)}var f=b.limits.maxBodyCharacters&&a.length>b.limits.maxBodyCharacters?b.limits.maxBodyCharacters:c?a.length:void 0,g=Echo.Utils.htmlTextTruncate(a,f,"",!0);g.length!==a.length&&(c=!0),a=g}return b.truncated=c,[a,b]}}();for(var e=[],f=0;20>=f;f++)e.push(".{class:depth}-"+f+" { margin-left: "+(f?68+44*(f-1):0)+"px; }");c.css='.{class:content} { word-wrap: break-word; }.{class:container-root} { padding: 10px 0px 10px 10px; }.{class:container-root-thread} { padding: 10px 0px 0px 10px; }.{class:container-child} { padding: 10px; margin: 0px 20px 2px 0px; }.{class:container-child-thread} { padding: 10px; margin: 0px 20px 2px 0px; }.{class:avatar-wrapper} { margin-right: -58px; float: left; position: relative; }.{class:children} .{class:avatar-wrapper}, .{class:childrenByCurrentActorLive} .{class:avatar-wrapper} { margin-right: -34px; }.{class:children} .{class:subwrapper}, .{class:childrenByCurrentActorLive} .{class:subwrapper} { margin-left: 34px; }.{class:wrapper} { float: left; width: 100%; }.{class:subwrapper} { margin-left: 58px; }.{class:subcontainer} { float: left; width: 100%; }.{class:markers} { line-height: 16px; background: url("{config:cdnBaseURL.sdk-assets}/images/curation/metadata/marker.png") no-repeat; padding: 0px 0px 4px 21px; margin-top: 7px; }.{class:tags} { line-height: 16px; background: url("{config:cdnBaseURL.sdk-assets}/images/tag_blue.png") no-repeat; padding: 0px 0px 4px 21px; }.{class:metadata-title} { font-weight: bold; line-height: 25px; height: 25px; margin-right: 5px; }.{class:metadata-icon} { display: inline-block; padding-left: 26px; }.{class:metadata-userID} { border-bottom: 1px solid #e1e1e1; border-top: 1px solid #e1e1e1;}.{class:metadata-userID} .{class:metadata-icon} { background: url("{config:cdnBaseURL.sdk-assets}/images/curation/metadata/user.png") no-repeat left center; }.{class:metadata-userIP} { border-bottom: 1px solid #e1e1e1; }.{class:metadata-userIP} .{class:metadata-icon} { background: url("{config:cdnBaseURL.sdk-assets}/images/curation/metadata/computer.png") no-repeat left center; }.{class:modeSwitch} { float: right; width: 16px; height: 16px; background:url("{config:cdnBaseURL.sdk-assets}/images/curation/metadata/flip.png") no-repeat 0px 3px; }.{class:childrenMarker} { border-color: transparent transparent #ECEFF5; border-width: 0px 11px 11px; border-style: solid; margin: 3px 0px 0px 77px; height: 1px; width: 0px; display: none; }.{class:container-root-thread} .{class:childrenMarker} { display: block; }.{class:avatar} { width: 48px; height: 48px; }.{class:children} .{class:avatar}, .{class:childrenByCurrentActorLive} .{class:avatar} { width: 24px; height: 24px; }.{class:authorName} { float: left; font-size: 15px; font-weight: bold; }.{class:re} { font-weight: bold; }.{class:re} a:link, .{class:re} a:visited, .{class:re} a:active { text-decoration: none; }.{class:re} a:hover { text-decoration: underline; }.{class:body} { padding-top: 4px; }.{class:buttons} { float: left; margin-left: 3px; }.{class:buttons} a.{class:button} { color: #C6C6C6; }.{class:buttons} a.{class:button}.echo-linkColor, .{class:buttons} a.{class:button}:hover { color: #476CB8; text-decoration: none; }.{class:sourceIcon} { float: left; height: 16px; width: 16px; margin-right: 5px; border: 0px; }.{class:date}, .{class:from}, .{class:via} { float: left; }.{class:from} a, .{class:via} a { text-decoration: none; color: #C6C6C6; }.{class:from} a:hover, .{class:via} a:hover { color: #476CB8; }.{class:tag} { display: inline-block; height: 16px; background: url("{config:cdnBaseURL.sdk-assets}/images/tag_blue.png") no-repeat; padding-left: 18px; }.{class:smiley-icon} { border: 0px; }.{class:textToggleTruncated} { margin-left: 5px; }.{class:blocker-backdrop} { position: absolute; left: 0px; top: 0px; background: #FFFFFF; opacity: 0.7; z-index: 100; }.{class:blocker-message} { position: absolute; z-index: 200; width: 200px; height: 20px; line-height: 20px; text-align: center; background-color: #FFFF99; border: 1px solid #C6C677; opacity: 0.7; -moz-border-radius: 0.5em 0.5em 0.5em 0.5em; }.{class:expandChildren} { display:none; text-align: center; padding:4px; }.{class:expandChildren} .{class:expandChildrenLabel} { display: inline-block; padding-left: 22px; }.{class:expandChildren} .echo-message-icon { background: url("{config:cdnBaseURL.sdk-assets}/images/whirlpool.png") no-repeat 5px 4px; }.{class:expandChildren} .{class:message-loading} { background: no-repeat left top url("{config:cdnBaseURL.sdk-assets}/images/loading.gif"); }.{class:expandChildren} .echo-app-message { padding: 0; border:none; border-radius: 0; }'+e.join("\n"),Echo.Control.create(c)}}(Echo.jQuery);
!function(a){"use strict";var b=a,c=Echo.Control.manifest("Echo.StreamServer.Controls.Submit");Echo.Control.isDefined(c)||(c.init=function(){if(this.checkAppKey()){var a=this;this.addPostValidator(function(){var c=!0;return b.each(["name","text"],function(b,d){return c=!a.highlightMandatory(a.view.get(d))}),c},"low"),this.render(),this.ready()}},c.destroy=function(){var a=this;b.each(this.posting.subscriptions,function(b){a.events.unsubscribe({handlerId:b})})},c.config={targetURL:document.location.href,markers:[],source:{},tags:[],requestMethod:"GET",itemURIPattern:void 0,actionString:"Type your comment here...",postingTimeout:30,type:void 0,errorPopup:{minHeight:70,maxHeight:150,width:390},targetQuery:void 0},c.vars={validators:[]},c.dependencies=[{loaded:function(){return!!Echo.GUI},url:"{config:cdnBaseURL.sdk}/gui.pack.js"},{url:"{config:cdnBaseURL.sdk}/gui.pack.css"}],c.labels={markers:"Markers:",markersHint:"Marker1, marker2, marker3, ...",post:"Post",posting:"Posting...",postingFailed:'There was a server error while trying to submit your item. Please try again in a few minutes. <b>Error: "{error}"</b>.',postingTimeout:"There was a network issue while trying to submit your item. Please try again in a few minutes.",tagsHint:"Tag1, tag2, tag3, ...",tags:"Tags:",yourName:"Your Name (required)",yourWebsiteOptional:"Your website (optional)"},c.templates.main='<div class="{class:container}"><div class="{class:header}"><div class="{class:userInfoWrapper}"><div class="{class:avatar}"></div><div class="{class:fields}"><div class="{class:fieldsWrapper}"><div class="{class:nameContainer} {class:border}"><input type="text" class="{class:name} echo-primaryFont echo-primaryColor" /></div><div class="{class:urlContainer} {class:border}"><input type="text" class="{class:url} echo-primaryFont echo-primaryColor" /></div></div></div><div class="echo-clear"></div></div></div><div class="{class:body}"><div class="{class:content} {class:border}"><textarea class="{class:text} {class:textArea} echo-primaryFont echo-primaryColor"></textarea></div><div class="{class:markersContainer} {class:metadataContainer} echo-primaryFont echo-primaryColor"><div class="{class:metadataLabel}">{label:markers}</div><div class="{class:metadataWrapper}"><div class="{class:metadataSubwrapper} {class:border} "><input type="text" class="{class:markers} echo-primaryFont" /></div></div><div class="echo-clear"></div></div><div class="{class:tagsContainer} {class:metadataContainer} echo-primaryFont echo-primaryColor"><div class="{class:metadataLabel}">{label:tags}</div><div class="{class:metadataWrapper}"><div class="{class:metadataSubwrapper} {class:border} "><input type="text" class="{class:tags} {class:border} echo-primaryFont" /></div></div><div class="echo-clear"></div></div></div><div class="{class:controls}"><div class="{class:postContainer}"><div class="btn echo-primaryFont {class:postButton}"></div></div><div class="echo-clear"></div></div></div>',c.renderers.tagsContainer=function(a){return this.user.is("admin")?a.show():a.hide()},c.renderers.markersContainer=c.renderers.tagsContainer,c.renderers.markers=function(a){return this.view.render({name:"_metaFields",target:a,extra:{type:"markers"}})},c.renderers.tags=function(a){return this.view.render({name:"_metaFields",target:a,extra:{type:"tags"}})},c.renderers.text=function(a){var b=this.get("data.object.content");return b&&a.val(b),a.iHint({text:this.config.get("actionString"),className:"echo-secondaryColor"})},c.renderers.avatar=function(a){return this.placeImage({container:a,image:this.user.get("avatar"),defaultImage:this.config.get("defaultAvatar")}),a},c.renderers.name=function(a){return a.val(this.user.get("name","")).iHint({text:this.labels.get("yourName"),className:"echo-secondaryColor"})},c.renderers.url=function(a){return a.val(this.user.get("domain","")).iHint({text:this.labels.get("yourWebsiteOptional"),className:"echo-secondaryColor"})},c.renderers.postButton=function(a){var b=this,d={normal:{target:a,icon:!1,disabled:!1,label:this.labels.get("post")},posting:{target:a,icon:this.config.get("cdnBaseURL.sdk-assets")+"/images/loading.gif",disabled:!0,label:this.labels.get("posting")}},e=new Echo.GUI.Button(d.normal);this.posting=this.posting||{},this.posting.subscriptions=this.posting.subscriptions||[];var f=function(a,d,f){var g=c.name+".onPost"+a,h=b.posting.subscriptions;h[g]&&b.events.unsubscribe({topic:g,handlerId:h[g]}),h[g]=b.events.subscribe({topic:g,handler:function(a,b){e.setState(d),f&&f(b)}})};return f("Init",d.posting),f("Complete",d.normal,function(){b.view.get("text").val("").trigger("blur"),b.view.render({name:"tags"}),b.view.render({name:"markers"})}),f("Error",d.normal,function(a){var c=a.request||{};c.state&&c.state.critical&&b._showError(a)}),this.posting.action=this.posting.action||function(){b._isPostValid()&&b.post()},a.off("click",this.posting.action).on("click",this.posting.action),a},c.renderers._metaFields=function(a,c){var d=c.type,e=this.get("data.object."+d,this.config.get(d)),f=b.trim(Echo.Utils.stripTags(e.join(", ")));return this.view.get(d).iHint({text:this.labels.get(d+"Hint"),className:"echo-secondaryColor"}).val(f).blur()},c.methods.post=function(){var a=this,b=function(b,c,d,e){var f={topic:"onPost"+b,data:{postData:c}};(e||d)&&(f.data.request={state:e,response:d}),a.events.publish(f)},c=this.config.get("type",this._getASURL("comment")),d=[].concat(a._getActivity("post",c,a.view.get("text").val()),a._getActivity("tag",this._getASURL("marker"),a.view.get("markers").val()),a._getActivity("tag",this._getASURL("tag"),a.view.get("tags").val())),e={content:d,appkey:this.config.get("appkey"),sessionID:this.user.get("sessionID","")};this.config.get("targetQuery")&&(e["target-query"]=this.config.get("targetQuery"));var f={onData:function(a,c){b("Complete",e,a,c),Echo.Events.publish({topic:"Echo.Control.onDataInvalidate",context:"global",data:{}})},onError:function(a,c){b("Error",e,a,c)}};b("Init",e),Echo.StreamServer.API.request({endpoint:"submit",method:this.config.get("requestMethod"),itemURIPattern:this.config.get("itemURIPattern"),submissionProxyURL:this.config.get("submissionProxyURL"),timeout:this.config.get("postingTimeout"),secure:this.config.get("useSecureAPI"),data:e,onData:f.onData,onError:f.onError}).send()},c.methods.highlightMandatory=function(a){if(a&&!b.trim(a.val())){var c=this.cssPrefix+"mandatory";return a.parent().addClass(c),a.focus(function(){b(this).parent().removeClass(c)}),!0}return!1},c.methods.addPostValidator=function(a,b){this.validators["low"===b?"push":"unshift"](a)},c.methods.refresh=function(){var a=this;this.config.set("data.object.content",this.view.get("text").val()),b.map(["tags","markers"],function(b){var c=a.view.get(b).val().split(", ");a.config.set("data.object."+b,c||[])});var c=Echo.Utils.getComponent("Echo.StreamServer.Controls.Submit");c.parent.refresh.call(this)},c.methods._getActivity=function(a,b,c){return c?{actor:{objectTypes:[this._getASURL("person")],name:this.user.get("name",this.user.is("logged")?"":this.view.get("name").val()),avatar:this.user.get("avatar","")},object:{objectTypes:[b],content:c},source:this.config.get("source"),verbs:[this._getASURL(a)],targets:[{id:this.config.get("targetURL")}]}:[]},c.methods._getASURL=function(a){return"http://activitystrea.ms/schema/1.0/"+a},c.methods._showError=function(a){a=a||{};var c=a.request&&a.request.response||{},d=b.inArray(c.errorCode,["network_timeout","connection_failure"])>=0?this.labels.get("postingTimeout"):this.labels.get("postingFailed",{error:c.errorMessage||c.errorCode}),e=this._assembleErrorPopup(d);new Echo.GUI.Modal({data:{body:e.content},width:e.width,footer:!1,fade:!0,show:!0})},c.methods._assembleErrorPopup=function(a){var c=this.config.get("errorPopup"),d=this.substitute({template:'<div class="{data:css}">{data:message}</div>',data:{message:a,css:this.cssPrefix+"error"}}),e={content:b(d).css({"min-height":c.minHeight,"max-height":c.maxHeight}),width:c.width};return e},c.methods._isPostValid=function(){var a=!0;return b.each(this.validators,function(b,c){return a=c()}),a},c.methods._prepareEventParams=function(a){return b.extend(a,{data:this.get("data"),target:this.config.get("target").get(0),targetURL:this.config.get("targetURL")})},c.css='.{class:header} { margin-bottom: 3px; }.{class:avatar} { float: left; margin-right: -48px; width: 48px; height: 48px; }.{class:fields} { width: 100%; float: left; }.{class:fields} input { width: 100%; }.{class:fieldsWrapper} { margin-left: 53px; }.{class:nameContainer} { margin: 1px 0px 4px 0px; padding: 0px 2px 1px 3px; background-color: #fff; }.{class:nameContainer} input.{class:name} { font-size: 14px; font-weight: bold; border: none; width: 100%;}.{class:fieldsWrapper} input.{class:name}[type="text"] { width: 100%; margin-bottom: 0px; border: none; padding: 0px; outline: 0; box-shadow: none; }.{class:fieldsWrapper} input.{class:name}[type="text"]:focus { outline: 0; box-shadow: none;  }.{class:urlContainer} { padding: 0px 2px 1px 3px; background-color: #fff; }.{class:urlContainer} input.{class:url} { height: 19px; border: none; width: 100%; margin-bottom: 0px;}.{class:fieldsWrapper} input.{class:url}[type="text"] { width: 100%; margin-bottom: 0px; border: none; padding: 0px; outline: 0; box-shadow: none;  }.{class:fieldsWrapper} input.{class:url}[type="text"]:focus { outline: 0; box-shadow: none; }.{class:fieldsWrapper} input.{class:url}[type="text"].echo-secondaryColor,.{class:fieldsWrapper} input.{class:name}[type="text"].echo-secondaryColor,.{class:content} textarea.{class:textArea}.echo-secondaryColor,.{class:container} .{class:metadataSubwrapper} input.echo-secondaryColor[type="text"] { color: #C6C6C6 }.{class:author} { font-weight: bold; }.{class:content} { padding: 5px 5px 5px 6px; background-color: #fff; }.{class:content} textarea.{class:textArea} { width: 100%; height: 102px; padding: 0px; margin: 0px; border: none; resize:none; box-shadow: none; outline: 0; }.{class:content} textarea.{class:textArea}:focus { outline: 0; box-shadow: none; }.{class:text} input { width: 100%; border: none; }.{class:metadataContainer} { margin-top: 6px; }.{class:metadataLabel} { float: left; width: 50px; margin-right: -50px; text-align: right; line-height: 22px; }.{class:metadataWrapper} { float: left; width: 100%; }.{class:metadataSubwrapper} { margin-left: 55px; padding: 2px 2px 2px 3px; background-color: #fff; }.{class:container} .{class:metadataSubwrapper} input[type="text"] { width: 100%; border: 0; padding: 0px; outline: 0; box-shadow: none; margin-bottom: 0px; }.{class:container} .{class:metadataSubwrapper} input[type="text"]:focus { outline: 0; box-shadow: none; }.{class:controls} { margin-top: 5px; }.{class:postContainer} { float: right; }.{class:border} { border: 1px solid #d2d2d2; }.{class:mandatory} { border: 1px solid red; }.{class:queriesViewOption} { padding-right: 5px; }.{class:error} { color: #444444; font: 14px Arial; line-height: 150%; padding-left: 85px; background: no-repeat url({config:cdnBaseURL.sdk-assets}/images/info70.png); }',Echo.Control.create(c))}(Echo.jQuery);
!function(a){"use strict";var b=a,c=Echo.Plugin.manifest("CommunityFlag","Echo.StreamServer.Controls.Stream.Item");Echo.Plugin.isDefined(c)||(c.init=function(){this.extendTemplate("insertAsLastChild","data",c.templates.main),this.component.addButtonSpec("CommunityFlag",this._assembleButton("Flag")),this.component.addButtonSpec("CommunityFlag",this._assembleButton("Unflag"))},c.config={showUserList:!0},c.labels={flagged:"Flagged",flaggedThis:" flagged this.",flagControl:"Flag",unflagControl:"Unflag",flagProcessing:"Flagging...",unflagProcessing:"Unflagging..."},c.dependencies=[{control:"Echo.StreamServer.Controls.FacePile",url:"{config:cdnBaseURL.sdk}/streamserver.pack.js"}],c.templates.main='<div class="{plugin.class:flaggedBy}"></div>',c.renderers.flaggedBy=function(a){var b=this,c=this.component,d=c.get("data.object.flags",[]);if(!d.length||!c.user.is("admin")||!b.config.get("showUserList"))return a.hide();var e=5,f=b.get("facepile")?b.get("facepile").getVisibleUsersCount():e,g=b.config.assemble({target:a,data:{entries:d,itemsPerPage:e},initialUsersCount:f,suffixText:b.labels.get("flaggedThis")});return b.set("facepile",new Echo.StreamServer.Controls.FacePile(g)),a.show()},c.methods._assembleButton=function(a){var b=this,c=function(){var c=this;c.get("buttons."+b.name+"."+a+".element").empty().append(b.labels.get(a.toLowerCase()+"Processing"));var d={verbs:["http://activitystrea.ms/schema/1.0/"+a.toLowerCase()],targets:[{id:c.get("data.object.id")}]},e=Echo.StreamServer.API.request({endpoint:"submit",secure:b.config.get("useSecureAPI",!1,!0),submissionProxyURL:b.config.get("submissionProxyURL","",!0),data:{content:d,appkey:c.config.get("appkey"),sessionID:c.user.get("sessionID"),"target-query":c.config.get("parent.query")},onData:function(d){b._publishEventComplete({name:a,state:"Complete",response:d}),"Flag"!==a||c.config.get("parent.showFlags")||(b.set("flagged",!0),c.view.render({name:"buttons"})),b.requestDataRefresh()},onError:function(d){b._publishEventComplete({name:a,state:"Error",response:d}),c.render()}});e.send()};return function(){var d=this,e=d.get("data.object.flags"),f=b.labels.get(a.toLowerCase()+"Control"),g=b._myFlags(e).length>0?"Unflag":"Flag",h="Flag"===a&&!d.config.get("parent.showFlags")&&b.get("flagged"),i={name:a,label:h?b.labels.get("flagged"):'<span class="echo-clickable">'+f+"</span>"+(d.user.is("admin")&&e.length?" ("+e.length+")":""),visible:d.user.is("logged")&&g===a,clickable:!h,once:!0,callback:c};return h&&(i.template="<span>{data:label}</span>"),i}},c.methods._publishEventComplete=function(a){var b=this.component;this.events.publish({topic:"on"+a.name+a.state,data:{item:{data:b.get("data"),target:b.config.get("target")},response:a.response}})},c.methods._myFlags=function(a){var c=this.component;return b.map(a,function(a){return c.user.has("identity",a.actor.id)?a:void 0})},c.css=".{plugin.class:flaggedBy} { background: url({config:cdnBaseURL.sdk-assets}/images/curation/status/communityflagged.png) no-repeat 0px 4px; padding: 0px 0px 4px 21px; }",Echo.Plugin.create(c))}(Echo.jQuery);
!function(a){"use strict";var b=a,c=Echo.Plugin.manifest("Edit","Echo.StreamServer.Controls.Stream.Item");Echo.Plugin.isDefined(c)||(c.init=function(){this.component.addButtonSpec("Edit",this._assembleButton())},b.map(["Complete","Error"],function(a){c.events["Echo.StreamServer.Controls.Submit.Plugins.Edit.onEdit"+a]=function(){this.component.render()}}),c.labels={editButton:"Edit"},c.dependencies=[{control:"Echo.StreamServer.Controls.Submit",url:"{config:cdnBaseURL.sdk}/streamserver.pack.js"}],c.methods._submitConfig=function(a,b){return this.config.assemble({target:b,data:a.get("data"),targetURL:a.get("data.object.id")})},c.methods._assembleButton=function(){var a=this;return function(){var b=this;return{name:"Edit",label:a.labels.get("editButton"),visible:b.user.is("admin")||b.user.has("identity",b.get("data.actor.id")),callback:function(){var c=a._submitConfig(b,b.view.get("subcontainer"));c.parent=a.component.config.getAsHash(),c.targetQuery=a.config.get("query",""),c.plugins.push({name:"Edit"}),new Echo.StreamServer.Controls.Submit(c),b.config.get("target").get(0).scrollIntoView(!0)}}}},Echo.Plugin.create(c))}(Echo.jQuery),function(a){"use strict";var b=a,c=Echo.Plugin.manifest("Edit","Echo.StreamServer.Controls.Submit");Echo.Plugin.isDefined(c)||(c.init=function(){this.extendTemplate("insertAfter","postContainer",c.templates.cancel),this.extendTemplate("replace","header",c.templates.header),this.component.labels.set({post:this.labels.get("post"),posting:this.labels.get("posting")})},c.labels={createdBy:"Created by",edit:"Edit",on:"on",post:"Update",posting:"Updating...",cancel:"cancel"},b.map(["Init","Complete","Error"],function(a){c.events["Echo.StreamServer.Controls.Submit.onPost"+a]=function(b,c){"Init"===a&&(c.postData.content=this._prepareContent()),this.events.publish({data:c,topic:"onEdit"+a})}}),c.templates.header='<div class="{plugin.class:header} echo-primaryFont echo-primaryFont echo-primaryColor">{plugin.label:createdBy} <span class="{plugin.class:author}"></span> {plugin.label:on} <span class="{plugin.class:editedDate}"></span></div>',c.templates.cancel='<div class="{plugin.class:cancelButtonContainer}"><a href="javascript:void(0);" class="{plugin.class:cancelButton} echo-primaryFont echo-clickable echo-linkColor">{plugin.label:cancel}</a></div>',c.renderers.author=function(a){var b=this.component;return a.text(b.get("data.actor.title")||b.labels.get("guest"))},c.renderers.editedDate=function(a){var b=this.component.get("data.object.published");if(!b)return a.empty();var c=new Date(1e3*Echo.Utils.timestampFromW3CDTF(b));return a.text(c.toLocaleDateString()+", "+c.toLocaleTimeString())},c.renderers.cancelButton=function(a){var b=this;return a.click(function(){b.events.publish({topic:"onEditError"})})},c.methods._prepareContent=function(){var a=this.component,b=function(b){return a.view.get(b).val()};return[].concat(this._getMetaDataUpdates("tag","tag",b("tags")),this._getMetaDataUpdates("mark","marker",b("markers")),this._prepareActivity("update","comment",b("text")))},c.methods._prepareActivity=function(a,b,c){return c?{object:{objectTypes:["http://activitystrea.ms/schema/1.0/"+b],content:c},source:this.component.config.get("source"),verbs:["http://activitystrea.ms/schema/1.0/"+a],targets:[{id:this.component.get("data.object.id")}]}:[]},c.methods._getMetaDataUpdates=function(a,c,d){var e=this,f=this.component,g=function(a){return b.map(a||[],function(a){return b.trim(a)})},h={modified:g(d.split(",")),current:g(f.get("data.object."+c+"s"))},i=[],j=function(a,d,f){b.map(a,function(a){a&&!~b.inArray(a,d)&&i.push(e._prepareActivity(f,c,a))})};return j(h.current,h.modified,"un"+a),j(h.modified,h.current,a),i},c.css=".{plugin.class:cancelButtonContainer} { float: right; margin: 6px 15px 0px 0px; }",Echo.Plugin.create(c))}(Echo.jQuery);
!function(a){"use strict";var b=a,c=Echo.Plugin.manifest("FormAuth","Echo.StreamServer.Controls.Submit");Echo.Plugin.isDefined(c)||(c.init=function(){"forcedLogin"===this._userStatus()&&this.extendTemplate("replace","header",c.templates.forcedLogin),this.extendTemplate("insertBefore","header",c.templates.auth),this.component.addPostValidator(this._validator())},c.config={identityManager:{},submitPermissions:"allowGuest"},c.enabled=function(){return this.component.user&&this.component.user.get("sessionID")&&this.config.get("identityManager.login")&&this.config.get("identityManager.signup")},c.labels={youMustBeLoggedIn:"You must be logged in to comment"},c.dependencies=[{control:"Echo.IdentityServer.Controls.Auth",url:"{config:cdnBaseURL.sdk}/identityserver.pack.js"}],c.templates.auth='<div class="{plugin.class:auth}"></div>',c.templates.forcedLogin='<div class="{class:header} echo-primaryFont"><span class="{plugin.class:forcedLoginMessage} echo-secondaryColor">{plugin.label:youMustBeLoggedIn}</span></div>',c.component.renderers.header=function(a){var b=this;return"logged"===b._userStatus()?a.empty():b.parentRenderer("header",arguments)},c.component.renderers.container=function(a){var c=this;c.parentRenderer("container",arguments);var d=function(a){return c.cssPrefix+a};return a.removeClass(b.map(["logged","anonymous","forcedLogin"],d).join(" ")).addClass(d(c._userStatus()))},c.renderers.auth=function(a){var b=this;return new Echo.IdentityServer.Controls.Auth(b.config.assemble({target:a,identityManager:b.config.get("identityManager")})),a},c.methods._validator=function(){var a=this,b=this.component;return function(){return b.user.is("logged")||"forceLogin"!==a._permissions()?!0:(a.view.get("forcedLoginMessage").addClass(a.cssPrefix+"error"),!1)}},c.methods._permissions=function(){return this.config.get("submitPermissions")},c.methods._userStatus=function(){return this.component.user.is("logged")?"logged":"forceLogin"===this._permissions()?"forcedLogin":"anonymous"},c.css=".{plugin.class:forcedLoginMessage} { font-size: 14px; font-weight: bold; }.{plugin.class:error} { color: red; }",Echo.Plugin.create(c))}(Echo.jQuery);
!function(a){"use strict";var b=a,c=Echo.Plugin.manifest("InfiniteScroll","Echo.StreamServer.Controls.Stream");Echo.Plugin.isDefined(c)||(c.init=function(){var a=this,c=function(){var c=a.component.view.get("more");c&&!a.get("renderInProgress")&&!a.get("requestInProgress")&&b.inviewport(c,{threshold:0})&&c.click()};a.set("scrollHandler",c),b(window).on("scroll",c)},c.events={"Echo.StreamServer.Controls.Stream.onDataReceive":function(){this.set("requestInProgress",!1)},"Echo.StreamServer.Controls.Stream.onMoreButtonPress":function(){this.set("requestInProgress",!0),this.set("renderInProgress",!0)}},c.component.renderers.more=function(a){return this.parentRenderer("more",arguments),this.set("renderInProgress",!1),a},c.methods.destroy=function(){b(window).off("scroll",this.get("scrollHandler"))},Echo.Plugin.create(c))}(Echo.jQuery);
!function(){"use strict";var a=Echo.Plugin.manifest("ItemAccumulatorDisplay","Echo.StreamServer.Controls.Stream.Item");Echo.Plugin.isDefined(a)||(a.init=function(){this.extendTemplate("insertBefore","modeSwitch",a.templates.main)},a.config={countTickTimeout:1,accumulator:"repliesCount"},a.templates.main='<div class="{plugin.class:accumulatorContainer}"></div>',a.renderers.accumulatorContainer=function(a){var b=this.component,c=this.config.get("accumulator"),d=b.get("data.object.accumulators")[c],e=this.get("count")||{};if("undefined"==typeof e.current)return this.set("count",{actual:d,current:d}),a.append(d);this._stopTimer();var f=b.view.get("container");if(f.stop(!0,!0),e.actual!==d&&(e.actual=d,this.set("count",e)),a.append(e.current),e.current!==e.actual){var g=this.get("originalBGColor");"undefined"==typeof g&&(g=Echo.Utils.getVisibleColor(f),this.set("originalBGColor",g)),f.css({backgroundColor:b.config.get("parent.flashColor")}),this._animateCounter(g)}return a},a.methods._stopTimer=function(){var a=this.get("timer");a&&clearTimeout(a),this.set("timer",void 0)},a.methods._animateCounter=function(a){this._stopTimer();var b=this,c=this.get("count"),d=this.component;if("undefined"!=typeof c.current&&c.current===c.actual&&!this.get("animationInProgress")){var e=d.view.get("container");return this.set("animationInProgress",!0),void e.animate({backgroundColor:a},d.config.get("parent.fadeTimeout"),"linear",function(){e.css("backgroundColor",""),b.set("animationInProgress",!1)})}this.set("timer",setTimeout(function(){var c=b.get("count");c.current!==c.actual&&(c.current<c.actual?c.current++:c.current--,b.set("count.current",c.current),b.view.get("accumulatorContainer").html(c.current),b._animateCounter(a))},1e3*this.config.get("countTickTimeout")))},a.css=".{plugin.class:accumulatorContainer} { float: right; margin-right: 7px; }",Echo.Plugin.create(a))}(Echo.jQuery);
!function(a){"use strict";var b=a,c=Echo.Plugin.manifest("JanrainAuth","Echo.StreamServer.Controls.Submit");Echo.Plugin.isDefined(c)||(c.init=function(){"forcedLogin"===this._userStatus()&&this.extendTemplate("replace","header",c.templates.forcedLogin),this.extendTemplate("insertBefore","header",c.templates.auth),this.component.addPostValidator(this._validator())},c.config={appId:"",buttons:["login"],title:"",height:260,width:420,signinWidgetConfig:{},submitPermissions:"allowGuest"},c.enabled=function(){return this.component.user&&this.component.user.get("sessionID")&&this.config.get("appId")&&this.config.get("buttons").length},c.labels={youMustBeLoggedIn:"You must be logged in to comment"},c.dependencies=[{control:"Echo.IdentityServer.Controls.Auth",url:"{config:cdnBaseURL.sdk}/identityserver.pack.js"}],c.templates.auth='<div class="{plugin.class:auth}"></div>',c.templates.forcedLogin='<div class="echo-primaryFont {class:header}"><span class="echo-secondaryColor {plugin.class:forcedLoginMessage}">{plugin.label:youMustBeLoggedIn}</span></div>',c.component.renderers.header=function(a){var b=this;return"logged"===b._userStatus()?a.empty():b.parentRenderer("header",arguments)},c.component.renderers.container=function(a){var c=this;c.parentRenderer("container",arguments);var d=function(a){return c.cssPrefix+a};return a.removeClass(b.map(["logged","anonymous","forcedLogin"],d).join(" ")).addClass(d(c._userStatus()))},c.renderers.auth=function(a){var b=this,c=["appId","title","width","height","buttons","signinWidgetConfig"],d=Echo.Utils.foldl({name:"JanrainConnector"},c,function(a,c){return b.config.get(a)&&(c[a]=b.config.get(a)),c});return new Echo.IdentityServer.Controls.Auth(b.config.assemble({target:a,plugins:[d]})),a},c.methods._validator=function(){var a=this,b=this.component;return function(){return b.user.is("logged")||"forceLogin"!==a._permissions()?!0:(a.view.get("forcedLoginMessage").addClass(a.cssPrefix+"error"),!1)}},c.methods._permissions=function(){return this.config.get("submitPermissions")},c.methods._userStatus=function(){return this.component.user.is("logged")?"logged":"forceLogin"===this._permissions()?"forcedLogin":"anonymous"},c.css=".{plugin.class:forcedLoginMessage} { font-size: 14px; font-weight: bold; }.{plugin.class:error} { color: red; }",Echo.Plugin.create(c))}(Echo.jQuery);
!function(a){"use strict";var b=a,c=Echo.Plugin.manifest("JanrainSharing","Echo.StreamServer.Controls.Submit");Echo.Plugin.isDefined(c)||(c.init=function(){this._isLegacy()||this.config.get("alwaysShare")||this.extendTemplate("insertBefore","postButton",c.templates.share)},c.config={appId:"",alwaysShare:!1,sharingWidgetConfig:{},maxLength:120,reducedLength:30,maxImagesCount:5},c.enabled=function(){return this.config.get("appId")},c.dependencies=[{loaded:function(){return!!Echo.GUI},url:"{config:cdnBaseURL.sdk}/gui.pack.js"},{url:"{config:cdnBaseURL.sdk}/gui.pack.css"}],c.events={"Echo.StreamServer.Controls.Submit.onPostInit":function(){this._isLegacy()||this.set("needShare",this.config.get("alwaysShare")||this.view.get("shareCheckbox").prop("checked"))},"Echo.StreamServer.Controls.Submit.onPostComplete":function(a,b){var c=this;return c._isLegacy()?void this._shareLegacy(b):void(this.get("needShare")&&this._share(this._prepareData(b)))}},c.labels={share:"Share this comment",sharePrompt:"Share your comment:"},c.templates.share='<div class="echo-secondaryFont {plugin.class:shareContainer}"><input type="checkbox" class="{plugin.class:shareCheckbox}"><span class="{plugin.class:shareLabel}">{plugin.label:share}</span></div>',c.methods._share=function(a){var c,d=this,e=function(){d.set("foreignConfig",b.extend(!0,{},janrain.engage.share.getState())),d._showPopup(a)};if(window.janrain&&janrain.engage&&janrain.engage.share||d.get("janrainInitialized"))return void e();d.set("janrainInitialized",!0),"object"!=typeof window.janrain&&(window.janrain={}),"object"!=typeof janrain.settings&&(janrain.settings={}),"object"!=typeof janrain.settings.share&&(janrain.settings.share={}),"object"!=typeof janrain.settings.packages&&(janrain.settings.packages=[]),janrain.settings.packages.push("share"),janrain.ready=!0;var f=window.janrainShareOnload;window.janrainShareOnload=function(){f&&(f(),window.janrainShareOnload=f),e()},c="https:"===document.location.protocol?"https://rpxnow.com/js/lib/"+d.config.get("appId")+"/widget.js":"http://widget-cdn.rpxnow.com/js/lib/"+d.config.get("appId")+"/widget.js",Echo.Loader.download([{url:c}])},c.methods._showPopup=function(a){var c,d=this,e=janrain.engage.share,f=janrain.events.onModalClose.addHandler(function(){janrain.events.onModalClose.removeHandler(f),e.reset(),e.setState(d.get("foreignConfig")),d.remove("foreignConfig")}),g=d.config.get("sharingWidgetConfig");e.reset(),e.setState(g),e.setTitle(g.title||b('meta[property="og:title"]').attr("content")||document.title),e.setDescription(g.description||b('meta[property="og:description"]').attr("content")||""),e.setMessage(g.message||Echo.Utils.stripTags(a.object.content)),e.setUrl(g.url||b('meta[property="og:url"]').attr("content")||location.href.replace(/([#\?][^#\?]*)+$/,"")),c=g.image||b('meta[property="og:image"]').attr("content")||"",c&&e.setImage(c),e.show()},c.methods._prepareData=function(a){var b=a.postData.content[0];return{origin:"submit",actor:{id:this.component.user.get("identityUrl"),name:b.actor.name,avatar:b.actor.avatar},object:{id:a.request.response.objectID,content:b.object.content},source:b.source,target:a.targetURL}},c.methods._isLegacy=function(){return this.config.get("xdReceiver")},c.methods._shareLegacy=function(a){var b=this;Echo.Loader.download([{loaded:function(){return!!window.RPXNOW},url:("https:"===document.location.protocol?"https://":"http://static.")+"rpxnow.com/js/lib/rpx.js"}],function(){RPXNOW.init({appId:b.config.get("appId"),xdReceiver:b.config.get("xdReceiver")}),RPXNOW.loadAndRun(["Social"],function(){var c=new RPXNOW.Social.Activity(b.config.get("activity.sharePrompt",b.labels.get("sharePrompt")),b._prepareContentLegacy(a),b.config.get("activity.itemURL",a.targetURL));RPXNOW.Social.publishActivity(b._prepareActivityLegacy(c))})})},c.methods._prepareActivityLegacy=function(a){var c=this,d=a,e={"activity.pageDescription":function(a){d.setDescription(a)},"activity.pageTitle":function(a){d.setTitle(a)},"activity.pageImages":function(a){var e=0,f=c.config.get("maxImagesCount"),g=new RPXNOW.Social.ImageMediaCollection;b.each(a,function(a,b){return e===f?!1:void(b.src&&b.href&&(g.addImage(b.src,b.href),e++))}),d.setMediaItem(g)}};return b.each(e,function(a,b){c.config.get(a)&&b(c.config.get(a))}),d},c.methods._prepareContentLegacy=function(a){var b=this,c=Echo.Utils.stripTags(a.postData.content[0].object.content),d=b.config.get("activity.shareContent");if(d)return b.labels.get(d,{domain:window.location.host,content:b._truncate(c,b.config.get("reducedLength"))});var e=a.inReplyTo,f=b.config.get("maxLength");if(b._isReplyToTweet(e)){var g=b._getTweetAuthor(e);return b.labels.get("@{author} {content}",{author:g,content:b._truncate(c,f-g.length-2)})}return b._truncate(c,f)},c.methods._truncate=function(a,b){return b>0&&a.length>b?a.substring(0,b)+"...":a},c.methods._isReplyToTweet=function(a){return!(!a||!a.source||"Twitter"!==a.source.name)},c.methods._getTweetAuthor=function(a){return a.actor.id.replace(/https?\:\/\/twitter\.com\//,"")},c.css=".{plugin.class:shareContainer} { display: inline-block; margin: 0px 15px 0px 0px; }.echo-sdk-ui .{plugin.class:shareContainer} input.{plugin.class:shareCheckbox} { margin: 0px; margin-right: 3px; padding: 0px; }",Echo.Plugin.create(c))}(Echo.jQuery),function(){"use strict";var a=Echo.Plugin.manifest("JanrainSharing","Echo.StreamServer.Controls.Stream.Item");Echo.Plugin.isDefined(a)||(a.init=function(){this.component.addButtonSpec("Share",this._assembleButton())},a.config={appId:"",sharingWidgetConfig:{}},a.enabled=function(){return this.config.get("appId")},a.dependencies=[{loaded:function(){return!!Echo.GUI},url:"{config:cdnBaseURL.sdk}/gui.pack.js"},{url:"{config:cdnBaseURL.sdk}/gui.pack.css"}],a.labels={shareButton:"Share"},a.methods._share=Echo.StreamServer.Controls.Submit.Plugins.JanrainSharing.prototype._share,a.methods._showPopup=Echo.StreamServer.Controls.Submit.Plugins.JanrainSharing.prototype._showPopup,a.methods._prepareData=function(a){return{origin:"item",actor:{id:a.actor.id,name:a.actor.title,avatar:a.actor.avatar},object:{id:a.object.id,content:a.object.content},source:a.source,target:a.target.id}},a.methods._assembleButton=function(){var a=this,b=this.component,c=function(){a._share(a._prepareData(b.get("data")))};return function(){return{name:"Share",label:a.labels.get("shareButton"),callback:c}}},Echo.Plugin.create(a))}(Echo.jQuery);
!function(a){"use strict";var b=a,c=Echo.Plugin.manifest("Like","Echo.StreamServer.Controls.Stream.Item");Echo.Plugin.isDefined(c)||(c.init=function(){this.extendTemplate("insertAsLastChild","data",c.templates.main),this.component.addButtonSpec("Like",this._assembleButton("Like")),this.component.addButtonSpec("Like",this._assembleButton("Unlike"))},c.config={asyncFacePileRendering:!1},c.labels={likeThis:" like this.",likesThis:" likes this.",likeControl:"Like",unlikeControl:"Unlike",likeProcessing:"Liking...",unlikeProcessing:"Unliking..."},c.dependencies=[{control:"Echo.StreamServer.Controls.FacePile",url:"{config:cdnBaseURL.sdk}/streamserver.pack.js"}],c.events={"Echo.StreamServer.Controls.FacePile.Item.Plugins.Like.onUnlike":function(a,b){return this._sendActivity("Unlike",this.component,b.actor),{stop:["bubble"]}}},c.templates.main='<div class="{plugin.class:likedBy}"></div>',c.renderers.likedBy=function(a){var c=this,d=this.component;if(!d.get("data.object.likes").length)return a.hide();var e=5,f=c.get("facePile")?c.get("facePile").getVisibleUsersCount():e,g=!1,h=d.user.get("identityUrl"),i=d.get("data.object.likes");b.each(i,function(a,b){return b.actor.id===h?(g=!0,!1):void 0});var j=c.config.assemble({target:a.get(0),data:{itemsPerPage:e,entries:i},initialUsersCount:f,totalUsersCount:d.get("data.object.accumulators.likesCount"),suffixText:c.labels.get(i.length>1||g?"likeThis":"likesThis")});return j.plugins.push({name:"Like"}),d.user.is("admin")&&a.addClass(c.cssPrefix+"highlight"),this.config.get("asyncFacePileRendering")?setTimeout(b.proxy(this._initFacePile,this,j),0):this._initFacePile(j),a.show()},c.methods._initFacePile=function(a){this.set("facePile",new Echo.StreamServer.Controls.FacePile(a))},c.methods._sendRequest=function(a,b,c){Echo.StreamServer.API.request({endpoint:"submit",secure:this.config.get("useSecureAPI",!1,!0),submissionProxyURL:this.component.config.get("submissionProxyURL"),onData:b,onError:c,data:a}).send()},c.methods._sendActivity=function(a,b,c){var d=this,e={verbs:["http://activitystrea.ms/schema/1.0/"+a.toLowerCase()],targets:[{id:b.get("data.object.id")}]};c&&c.id&&(e.author=c.id),this._sendRequest({content:e,appkey:b.config.get("appkey"),sessionID:b.user.get("sessionID"),"target-query":b.config.get("parent.query")},function(b){d._publishEventComplete({name:a,state:"Complete",response:b}),d.requestDataRefresh()},function(b){d._publishEventComplete({name:a,state:"Error",response:b})})},c.methods._publishEventComplete=function(a){var b=this.component;this.events.publish({topic:"on"+a.name+a.state,data:{item:{data:b.get("data"),target:b.config.get("target")},response:a.response}})},c.methods._assembleButton=function(a){var c=this,d=function(){var b=this;b.get("buttons."+c.name+"."+a+".element").empty().append(c.labels.get(a.toLowerCase()+"Processing")),c._sendActivity(a,b)};return function(){var e=this,f=b.map(e.get("data.object.likes"),function(a){return e.user.has("identity",a.actor.id)?a:void 0}).length>0?"Unlike":"Like";return{name:a,label:c.labels.get(a.toLowerCase()+"Control"),visible:e.user.is("logged")&&f===a,once:!0,callback:d}}},c.css=".{plugin.class:likedBy} { background: url({config:cdnBaseURL.sdk-assets}/images/likes.png) no-repeat 0px 4px; padding: 0px 0px 4px 21px; }.{plugin.class:highlight} { line-height: 23px; }",Echo.Plugin.create(c))}(Echo.jQuery),function(){"use strict";var a=Echo.Plugin.manifest("Like","Echo.StreamServer.Controls.FacePile.Item");Echo.Plugin.isDefined(a)||(a.init=function(){this.extendTemplate("insertAsLastChild","container",a.templates.main)},a.labels={unlikeOnBehalf:"Unlike on behalf of this user"},a.templates.main='<img class="{plugin.class:adminUnlike}" src="{config:cdnBaseURL.sdk-assets}/images/container/closeWindow.png"" title="{plugin.label:unlikeOnBehalf}" width="10" height="9">',a.component.renderers.container=function(a){this.parentRenderer("container",arguments),this.component.user.is("admin")&&a.addClass(this.cssPrefix+"highlight")},a.renderers.adminUnlike=function(a){var b=this,c=this.component;return c.user.is("admin")?a.one("click",function(){c.view.get("container").css("opacity",.3),b.events.publish({topic:"onUnlike",data:{actor:c.get("data"),target:c.config.get("parent.target").get(0)},global:!1,propagation:!1})}):a.remove()},a.css=".{plugin.class:adminUnlike} { cursor: pointer; margin-left: 3px; }.{plugin.class:highlight} { display: inline-block; line-height: 16px; background-color: #EEEEEE; padding: 1px 3px; border: 1px solid #D2D2D2; border-radius: 5px; -moz-border-radius: 5px; -webkit-border-radius: 5px; margin: 0px 2px; }",Echo.Plugin.create(a))}(Echo.jQuery);
!function(a){"use strict";var b=a,c=Echo.Plugin.manifest("MetadataManager","Echo.StreamServer.Controls.Stream.Item");Echo.Plugin.isDefined(c)||(c.init=function(){var a=this,c=this.component;b.each(this.config.get("controls"),function(b,d){c.addButtonSpec("MetadataManager",a._assembleButton("Mark",d)),c.addButtonSpec("MetadataManager",a._assembleButton("Unmark",d))})},c.labels={markProcessing:"Adding {type} {marker}...",unmarkProcessing:"Removing {type} {marker}..."},c.methods._assembleButton=function(a,b){var d=this,e=b.marker?"marker":"tag",f=b.marker||b.tag,g=a+"As"+Echo.Utils.capitalize(f.replace(/[^a-z0-9_-]/gi,"")),h=function(){var b=this,h=a.toLowerCase();b.get("buttons."+c.name+"."+g+".element").empty().append(d.labels.get(h+"Processing",{type:e,marker:f}));var i="tag"===e?h.replace(/mark/g,"tag"):h,j={verbs:["http://activitystrea.ms/schema/1.0/"+i],targets:[{id:b.get("data.object.id")}],object:{objectTypes:["http://activitystrea.ms/schema/1.0/"+e],content:f}},k=d._prepareCompleteEventPublish({name:g,type:e,action:a});Echo.StreamServer.API.request({endpoint:"submit",secure:this.config.get("useSecureAPI",!1,!0),submissionProxyURL:b.config.get("submissionProxyURL"),onData:function(a){k("Complete",a),d.requestDataRefresh()},onError:function(a){k("Error",a)},data:{appkey:b.config.get("appkey"),content:j,"target-query":b.config.get("parent.query",""),sessionID:b.user.get("sessionID","")}}).send()};return function(){return{name:g,label:b["label"+a],visible:d._isButtonVisible(b,f,a,e),once:!0,callback:h}}},c.methods._prepareCompleteEventPublish=function(a){var c=this,d=this.component,e={data:{item:{data:d.get("data"),target:d.get("view.content")},type:a.type,name:a.name}};return function(d,f){c.events.publish(b.extend(!0,e,{topic:"on"+a.action+d,data:{response:f}}))}},c.methods._isButtonVisible=function(a,c,d,e){var f=this.component,g=!~b.inArray(c,f.get("data.object."+e+"s")||[])^"Unmark"===d;if(!g||!f.user.is("logged"))return!1;if(f.user.is("admin"))return!0;var h=f.config.get("submissionProxyURL");if("marker"===e&&!h)return!1;if(a.visible=f.invoke(a.visible),b.isEmptyObject(a.visible))return!1;var i=!0;return b.each(["state","roles","markers"],function(b,c){var d=a.visible["user."+c];return d&&(d="string"==typeof d?[d]:d,!f.user.any(c,d))?(i=!1,!1):void 0}),!!i},Echo.Plugin.create(c))}(Echo.jQuery);
!function(a){"use strict";var b=a,c=Echo.Plugin.manifest("Moderation","Echo.StreamServer.Controls.Stream.Item");Echo.Plugin.isDefined(c)||(c.init=function(){var a=this,d=this.component,e=this.config.get("itemActions").concat(this.config.get("userActions"));this.extendTemplate("insertAfter","avatar",c.templates.status),b.each(e,function(e,f){var g=c.actionButtons[f];g&&b.isArray(g)?b.each(g,function(b,c){d.addButtonSpec("Moderation",a["_assemble"+Echo.Utils.capitalize(f)+"Button"](c))}):d.addButtonSpec("Moderation",a._assembleButton(Echo.Utils.capitalize(f)))})},c.config={removePersonalItemsAllowed:!1,userActions:["ban","permissions"],itemActions:["approve","spam","delete"]},c.events={"Echo.StreamServer.Controls.Stream.Plugins.Moderation.onUserUpdate":function(a,b){var c=this.component,d=b.item;return c.get("data.actor.id")===d.data.actor.id?(c.set("data.actor."+("state"===b.field?"status":b.field),b.value),c.render(),{stop:["bubble"]}):void 0}},c.labels={approveButton:"Approve",deleteButton:"Delete",spamButton:"Spam",untouchButton:"Untouch",changingStatusToCommunityFlagged:"Flagging...",changingStatusToModeratorApproved:"Approving...",changingStatusToModeratorDeleted:"Deleting...",changingStatusToUserDeleted:"Deleting...",changingStatusToUntouched:"Untouching...",changingStatusToModeratorFlagged:"Marking as spam...",statusCommunityFlagged:"Flagged by Community",statusModeratorApproved:"Approved by Moderator",statusModeratorDeleted:"Deleted by Moderator",statusUserDeleted:"Deleted by User",statusModeratorFlagged:"Flagged by Moderator",statusSystemFlagged:"Flagged by System",banUser:"Ban User",unbanUser:"Unban",userBanned:"Banned User",processingAction:"Setting up '{state}' user state...",moderatorRole:"Moderator",administratorRole:"Administrator",userButton:"Demote to User",moderatorButton:"Promote to Moderator",administratorButton:"Promote to Admin",setRoleAction:"Setting up '{role}' role...",unsetRoleAction:"Removing '{role}' role...",statusUntouched:"New"},c.templates.buttonLabels={banned:'<span class="{plugin.class:button-state} {plugin.class:button-state-banned}">{plugin.label:userBanned}</span>(<span class="echo-clickable">{plugin.label:unbanUser}</span>)',unbanned:'<span class="echo-clickable">{plugin.label:banUser}</span>'},c.templates.status='<div class="{plugin.class:status}"><div class="{plugin.class:statusIcon}"></div><div class="echo-clear"></div></div>',c.renderers.status=function(a){var b=this.component;if(!b.user.is("admin"))return a.hide(),a;b.get("depth")&&a.addClass(this.cssPrefix+"status-child");var c=b.get("data.object.status")||"Untouched";return a.addClass(this.cssPrefix+"status-"+c)},c.renderers.statusIcon=function(a){var b=this.component;if(!b.user.is("admin"))return a;var c=b.get("data.object.status")||"Untouched",d=this.labels.get("status"+c);return a.addClass(this.cssPrefix+"status-icon-"+c).attr("title",d)},c.statuses=["Untouched","ModeratorApproved","ModeratorDeleted","UserDeleted","CommunityFlagged","ModeratorFlagged","SystemFlagged"],c.button2status={Spam:"ModeratorFlagged",Delete:"ModeratorDeleted",Approve:"ModeratorApproved",Untouch:"Untouched"},c.actionButtons={ban:["Ban","UnBan"],permissions:["UserPermissions"]},c.roles=["","moderator","administrator"],c.methods._changeItemStatus=function(a){var b=this.component;this.set("selected",!1),b.set("data.object.status",a),b.view.render({name:"buttons"}),this.view.render({name:"status",recursive:!0})},c.methods._sendRequest=function(a,b,c){Echo.StreamServer.API.request({endpoint:"submit",secure:this.config.get("useSecureAPI",!1,!0),submissionProxyURL:this.component.config.get("submissionProxyURL"),onData:b,onError:c,data:a}).send()},c.methods._publishCompleteActionEvent=function(a){this.events.publish({topic:"on"+a.name+a.state,data:{item:{data:this.component.get("data"),target:this.component.get("view.content")},response:a.response}})},c.methods._assembleButton=function(a){var b=this,d=function(d){var e=c.button2status[a];return!d.user.is("admin")&&"Delete"===a&&b.config.get("removePersonalItemsAllowed")&&d.user.has("identity",d.data.actor.id)&&(e="UserDeleted"),e},e=function(){var c=this,e=d(c);c.block(b.labels.get("changingStatusTo"+e));var f={verbs:["http://activitystrea.ms/schema/1.0/update"],targets:[{id:c.get("data.object.id")}],actor:{title:c.get("data.actor.id")},object:{state:e}};b._sendRequest({content:f,appkey:c.config.get("appkey"),sessionID:c.user.get("sessionID"),"target-query":c.config.get("parent.query")},function(c){b._publishCompleteActionEvent({name:a,state:"Complete",response:c}),b._changeItemStatus(e),b.requestDataRefresh()},function(d){b._publishCompleteActionEvent({name:a,state:"Error",response:d}),c.unblock()})};return function(){var c=this,f=d(c);return{name:a,label:b.labels.get(a.toLowerCase()+"Button"),visible:c.get("data.object.status")!==f&&(c.user.is("admin")||"UserDeleted"===f),callback:e}}},c.methods._sendUserUpdate=function(a){var b=this.component;Echo.IdentityServer.API.request({endpoint:"update",submissionProxyURL:this.component.config.get("submissionProxyURL"),secure:this.config.get("useSecureAPI",!1,!0),data:{content:{field:a.field,value:a.value,identityURL:b.get("data.actor.id"),username:b.get("data.actor.title")},appkey:b.config.get("appkey"),sessionID:b.user.get("sessionID",""),"target-query":b.config.get("parent.query","")},onData:a.onData,onError:function(){b.render()}}).send()},c.methods._assembleBanButton=function(a){var b=this,d=function(){var d=this,e="Ban"===a?"ModeratorBanned":"Untouched";d.get("buttons."+c.name+"."+a+".element").empty().append(b.labels.get("processingAction",{state:e})),b._sendUserUpdate({field:"state",value:e,onData:function(c){b._publishCompleteActionEvent({name:a,state:"Complete",response:c}),b._publishUserUpdateEvent({item:d,field:"state",value:e})},onError:function(c){b._publishCompleteActionEvent({name:a,state:"Error",response:c})}})};return function(){var e=this,f=b._isUserBanned(),g=e.get("data.actor.id")!==e.user.config.get("fakeIdentityURL")&&f^"Ban"===a;return{name:a,label:b.substitute({template:c.templates.buttonLabels[f?"banned":"unbanned"]}),visible:g&&e.user.is("admin"),callback:d,once:!0}}},c.methods._assemblePermissionsButton=function(a){var d=this,e=function(){var e=this,f=d._getRole(),g=d._getNextRole(f),h=""!==g?(e.get("data.actor.roles")||[]).concat(g):Echo.Utils.foldl([],e.get("data.actor.roles")||[],function(a,d){b.inArray(a,c.roles)<0&&d.push(a)}),i=""===g?"unset":"set";e.get("buttons."+c.name+"."+a+".element").empty().append(d.labels.get(i+"RoleAction",{role:g||f})),d._sendUserUpdate({field:"roles",value:h.length?h.join(","):"-",onData:function(b){d._publishCompleteActionEvent({name:a,state:"Complete",response:b}),d._publishUserUpdateEvent({item:e,field:"roles",value:h})},onError:function(b){d._publishCompleteActionEvent({name:a,state:"Error",response:b})}})};return function(){var b=this,c=d._getRole(),f=c?'<span class="{plugin.class:button-role} {plugin.class:button-role}-{data:role}">{data:label}</span>(<span class="echo-clickable">{data:button}</span>)':'<span class="echo-clickable">{data:button}</span>',g=d.substitute({template:f,data:{role:c,label:c?d.labels.get(c+"Role"):"",button:d.labels.get((d._getNextRole(c)||"user")+"Button")}});return{name:a,label:g,visible:b.get("data.actor.id")!==b.user.config.get("fakeIdentityURL")&&b.user.any("roles",["administrator"]),callback:e,once:!0}}},c.methods._publishUserUpdateEvent=function(a){this.events.publish({topic:"onUserUpdate",data:{item:a.item,field:a.field,value:a.value},global:!1,propagation:!1}),this.requestDataRefresh()},c.methods._isUserBanned=function(){return"ModeratorBanned"===this.component.get("data.actor.status")},c.methods._getRole=function(){var a="";return b.each(this.component.get("data.actor.roles")||[],function(d,e){return b.inArray(e,c.roles)>0&&(a=e,"administrator"===e)?!1:void 0}),a},c.methods._getNextRole=function(a){return c.roles[(b.inArray(a,c.roles)+1)%c.roles.length]},c.css=function(){return".{plugin.class:status} { width: 48px; height: 24px; }.{plugin.class:status-child} { width: 24px; height: 24px; }.{plugin.class:statusIcon} { float: right; margin: 4px; width: 16px; height: 16px; }.{plugin.class:status-Untouched} { background: #00aaff; }.{plugin.class:status-ModeratorApproved} { background: #bdfb6d; }.{plugin.class:status-ModeratorDeleted} { background: #f20202; }.{plugin.class:status-UserDeleted} { background: #ff8e8e; }.{plugin.class:status-SystemFlagged}, .{plugin.class:status-CommunityFlagged}, .{plugin.class:status-ModeratorFlagged} { background: #ff9e00; }.{plugin.class:button-state} { margin-right: 3px; }.{plugin.class:button-state-banned} { color: #FF0000; }.{plugin.class:button-role} { margin-right: 3px; }.{plugin.class:button-role-moderator} { color: #0000FF; }.{plugin.class:button-role-administrator} { color: #008000; }"+b.map(c.statuses,function(a){return".{plugin.class:status-icon-"+a+"} { background: url({config:cdnBaseURL.sdk-assets}/images/curation/status/"+a.toLowerCase()+".png) no-repeat; }"}).join("")}(),Echo.Plugin.create(c))}(Echo.jQuery),function(){"use strict";var a=Echo.Plugin.manifest("Moderation","Echo.StreamServer.Controls.Stream");a.events={"Echo.StreamServer.Controls.Stream.Item.Plugins.Moderation.onUserUpdate":function(a,b){return this.events.publish({topic:"onUserUpdate",data:b,global:!1}),{stop:["bubble"]}}},Echo.Plugin.create(a)}(Echo.jQuery);
!function(a){"use strict";var b=a,c=Echo.Plugin.manifest("Reply","Echo.StreamServer.Controls.Stream.Item");Echo.Plugin.isDefined(c)||(c.init=function(){var a=this,d=this.component;this.extendTemplate("insertAsLastChild","content",c.templates.form);var e=Echo.Utils.get(Echo.Variables,this._getSubmitKey());b.each(e||{},function(b,c){a.set(b,c)}),d.addButtonSpec("Reply",this._assembleButton()),this.set("documentClickHandler",this._getClickHandler()),b(document).on("click",this.get("documentClickHandler"))},c.config={actionString:"Write a reply..."},c.labels={replyControl:"Reply"},c.dependencies=[{control:"Echo.StreamServer.Controls.Submit",url:"{config:cdnBaseURL.sdk}/streamserver.pack.js"}],c.events={"Echo.StreamServer.Controls.Stream.Plugins.Reply.onFormExpand":function(a,b){var c=this.component,d=c.config.get("context");this.get("expanded")&&d&&d!==b.context&&this._hideSubmit()},"Echo.StreamServer.Controls.Submit.onPostComplete":function(){this._hideSubmit()},"Echo.StreamServer.Controls.Stream.Item.onRender":function(){this.get("expanded")&&this._showSubmit()}},c.templates.form='<div class="{plugin.class:replyForm}"><div class="{plugin.class:submitForm}"></div><div class="{plugin.class:compactForm}"><div class="{plugin.class:compactContent} {plugin.class:compactBorder}"><input type="text" class="{plugin.class:compactField} echo-primaryFont echo-secondaryColor"></div></div></div>',c.component.renderers.container=function(a){var b=this.component,c=b.threading;return this.get("expanded")&&(b.threading=!0),b.parentRenderer("container",arguments),b.threading=c,a},c.component.renderers.children=function(){var a=this.component;if(1===a.get("children").length){var b=a.get("children")[0];(b.get("added")||b.get("deleted"))&&(this._itemCSS("remove",a,this.view.get("compactForm")),this.view.render({name:"compactForm"}))}return a.parentRenderer("children",arguments)},c.renderers.submitForm=function(a){return a.click(function(a){a.stopPropagation()}),this.get("expanded")?a.show():a.empty().hide()},c.renderers.compactForm=function(a){var b=this.component,c=!!b.children.length;return b.get("depth")||!c||this.get("expanded")||b.get("children")[0].get("deleted")?(this._itemCSS("remove",b,this.view.get("compactForm")),a.hide()):(this._itemCSS("add",b,a),a.show())},c.renderers.compactField=function(a){var b=this;return a.focus(function(){b._showSubmit()}).val(this.config.get("actionString"))},c.methods.destroy=function(){this.get("submit")&&Echo.Utils.set(Echo.Variables,this._getSubmitKey(),{expanded:this.get("expanded"),data:{object:this._getSubmitData()}}),b(document).off("click",this.get("documentClickHandler"))},c.methods._submitConfig=function(a){var b=this,c=this.component;return b.config.assemble({target:a,targetURL:c.get("data.object.id"),parent:c.config.getAsHash(),data:b.get("data")||{},targetQuery:c.config.get("query",""),ready:function(){b.set("submit",this),b._expand()}})},c.methods._showSubmit=function(){var a=this.component,b=this.view.get("submitForm");this._itemCSS("add",a,this.view.get("submitForm"));var c=this.get("submit");if(c)return c.config.set("target",b),c.render(),this._expand(),b;var d=this._submitConfig(b);return d.plugins.push({name:"Reply",inReplyTo:a.get("data")}),new Echo.StreamServer.Controls.Submit(d),b},c.methods._hideSubmit=function(){var a=this.component,b=this.get("submit");b&&b.set("data",void 0),this.set("expanded",!1),this._itemCSS("remove",a,this.view.get("submitForm")),this.view.get("submitForm").empty(),this.view.render({name:"compactForm"}),a.view.render({name:"container"}),this.events.publish({topic:"onCollapse"})},c.methods._expand=function(){var a=this.component;this.set("expanded",!0),this.view.render({name:"submitForm"}),this.view.render({name:"compactForm"}),this.events.publish({topic:"onExpand",data:{context:a.config.get("context")}}),a.view.render({name:"container"})},c.methods._getClickHandler=function(){var a=this;return function(){var b=a.get("submit");a.get("expanded")&&b&&!b.view.get("text").val()&&a._hideSubmit()}},c.methods._assembleButton=function(){var a=this,b=function(){a._showSubmit()};return function(){var c=this;return{name:"Reply",label:a.labels.get("replyControl"),visible:c.get("depth")<c.config.get("parent.children.maxDepth"),callback:b}}},c.methods._itemCSS=function(a,c,d){b.each(["container","container-child","depth-"+(c.get("depth")+1)],function(b,e){d[a+"Class"](c.get("cssPrefix")+e)}),d[a+"Class"]("echo-trinaryBackgroundColor")},c.methods._getSubmitKey=function(){var a=this.component,b=a.config.get("context").split("/")[0];return"forms."+a.data.unique+"-"+b},c.methods._getSubmitData=function(){var a={},c=this.get("submit");return a.content=c.view.get("text").val(),b.map(["tags","markers"],function(b){var d=c.view.get(b).val().split(", ");a[b]=d||[]}),a},c.css=".{plugin.class:compactContent} { padding: 5px 5px 5px 6px; background-color: #fff; }.{plugin.class:compactBorder} { border: 1px solid #d2d2d2; }.{plugin.class:compactContent} input.{plugin.class:compactField}[type='text'].echo-secondaryColor { color: #C6C6C6 }.{plugin.class:compactContent} input.{plugin.class:compactField}[type='text'].echo-primaryFont { font-size: 12px; line-height: 16px; }.{plugin.class:compactContent} input.{plugin.class:compactField}[type='text'] { width: 100%; height: 16px; border: none; margin: 0px; padding: 0px; box-shadow: none; vertical-align: middle; }.{plugin.class:compactContent} input.{plugin.class:compactField}[type='text']:focus { outline: 0; box-shadow: none; }",Echo.Plugin.create(c))}(Echo.jQuery),function(){"use strict";var a=Echo.Plugin.manifest("Reply","Echo.StreamServer.Controls.Stream");Echo.Plugin.isDefined(a)||(a.events={"Echo.StreamServer.Controls.Stream.Item.Plugins.Reply.onExpand":function(a,b){this.events.publish({topic:"onFormExpand",data:{context:b.context}})}},Echo.Plugin.create(a))}(Echo.jQuery),function(a){"use strict";var b=a,c=Echo.Plugin.manifest("Reply","Echo.StreamServer.Controls.Submit");Echo.Plugin.isDefined(c)||(c.init=function(){var a=this,b=a.component,c=b._prepareEventParams;b._prepareEventParams=function(d){var e=c.call(b,d);return e.inReplyTo=a.config.get("inReplyTo"),e}},b.map(["onRender","onRerender"],function(a){c.events["Echo.StreamServer.Controls.Submit."+a]=function(){var a=this.component;a.config.get("target").show(),a.view.get("text").focus()}}),Echo.Plugin.create(c))}(Echo.jQuery);
!function(){"use strict";var a=Echo.Plugin.manifest("TextCounter","Echo.StreamServer.Controls.Submit");Echo.Plugin.isDefined(a)||(a.init=function(){this.extendTemplate("insertAfter","content",a.templates.counter)},a.events={"Echo.StreamServer.Controls.Submit.onPostComplete":function(){this.view.render({name:"counterLabel"})}},a.labels={limited:"{typed}/{left} characters",unlimited:"{typed} characters"},a.templates.counter='<div class="{plugin.class:counterLabel} echo-primaryFont echo-primaryColor"></div>',a.component.renderers.text=function(a){var b=this;b.parentRenderer("text",arguments);var c=b.config.get("limit",0),d=function(){if(c){var d=a.val();if(d.length<=c)b.set("text",d);else if(d.length>c)return void a.val(b.get("text"))}b.view.render({name:"counterLabel"})};return a.on("blur focus keyup keypress",d)},a.renderers.counterLabel=function(a){var b=this,c=this.component,d=b.config.get("limit",0),e=c.view.get("text").val().length,f=b.labels.get(b.config.get("label",d?"limited":"unlimited"),{typed:e,left:Math.max(d-e,0),limit:d});return a.text(f)},Echo.Plugin.create(a))}(Echo.jQuery);
!function(a){"use strict";var b=a,c=Echo.Plugin.manifest("TweetDisplay","Echo.StreamServer.Controls.Stream.Item");Echo.Plugin.isDefined(c)||(c.init=function(){var a=this.component,d=a.config.get("contentTransformations");b.map(["text","html","xhtml"],function(a){d[a].hashtags=!1}),a.config.set("contentTransformations",d),a.config.set("plugins.Like.enabled",!1),a.config.set("plugins.Reply.enabled",!1),a.config.set("viaLabel.icon",!0),this.extendTemplate("insertBefore","authorName",c.templates.date),this.extendTemplate("insertAfter","authorName",c.templates.username),a.addButtonSpec(this.name,this._assembleButton("tweet")),a.addButtonSpec(this.name,this._assembleButton("retweet")),a.addButtonSpec(this.name,this._assembleButton("favorite"))},c.labels={tweet:"Reply",retweet:"Retweet",favorite:"Favorite",comment:"Comment",secondsAgo:"{seconds}s",minutesAgo:"{minutes}m",hoursAgo:"{hours}h",monthsAgo:"{day} {month}",yearsAgo:"{day} {month} {year}",fullDate:"{time} - {date}",month1:"Jan",month2:"Feb",month3:"Mar",month4:"Apr",month5:"May",month6:"Jun",month7:"Jul",month8:"Aug",month9:"Sep",month10:"Oct",month11:"Nov",month12:"Dec"},c.dependencies=[{loaded:function(){return!!window.twttr},url:"//platform.twitter.com/widgets.js"}],c.enabled=function(){return this._isTweet()},c.events={"Echo.StreamServer.Controls.Stream.Item.onRender":function(){var a=this.cssPrefix+"activeButton",c=this.component;b.map(c.buttons[this.name],function(b){b.element.unbind("click").unbind("mouseover mouseout").hover(function(){b.element.addClass(a)},function(){b.element.removeClass(a)})}),window.twttr&&window.twttr.widgets&&window.twttr.widgets.load()}},c.templates={username:'<div class="{plugin.class:tweetUserName}"></div>',date:'<div class="{plugin.class:tweetDate} echo-secondaryFont"></div>'},c.component.renderers.authorName=function(){var a=this.component;return a.parentRenderer("authorName",arguments).removeClass("echo-linkColor").addClass(this.cssPrefix+"tweetScreenName").wrapInner(Echo.Utils.hyperlink({href:a.get("data.actor.id")},{openInNewWindow:a.config.get("openLinksInNewWindow"),skipEscaping:!0}))},c.component.renderers.avatar=function(){var a=this.component;return a.parentRenderer("avatar",arguments).wrap(Echo.Utils.hyperlink({href:a.get("data.actor.id")},{openInNewWindow:a.config.get("openLinksInNewWindow"),skipEscaping:!0}))},c.component.renderers.date=function(){var a=this.component;return this.view.render({name:"tweetDate"}),a.parentRenderer("date",arguments)},c.component.renderers._buttonsDelimiter=function(){var a=this.component,b=a.buttonSpecs[this.name].length;return a.parentRenderer("_buttonsDelimiter",arguments).find("span[class*='button-delim']").eq(b).text(" | ")},c.renderers.tweetUserName=function(a){var b=this.component;return a.html(Echo.Utils.hyperlink({href:b.get("data.actor.id"),caption:"@"+this._extractTwitterID(),"class":"echo-secondaryFont echo-secondaryColor"},{openInNewWindow:b.config.get("openLinksInNewWindow"),skipEscaping:!0}))},c.renderers.tweetDate=function(a){var b=this.component;return a.html(Echo.Utils.hyperlink({caption:this._getTweetTime(),href:b.get("data.object.id"),"class":"echo-secondaryFont echo-secondaryColor",title:this._getTweetTime(!0)},{openInNewWindow:b.config.get("openLinksInNewWindow"),skipEscaping:!0}))},c.methods._assembleButton=function(a){var b=this,c=this.component,d=c.get("data.object.id").match(/\/(\d+)$/),e=d&&d[1];return function(){return{name:a,label:b.labels.get(a),template:Echo.Utils.hyperlink({href:"https://twitter.com/intent/"+a+"?in_reply_to="+e+"&tweet_id="+e,"class":"echo-clickable "+b.cssPrefix+"intentControl echo-secondaryColor",caption:'<span class="'+b.cssPrefix+"icon "+b.cssPrefix+'icon-{data:name}">&nbsp;</span><span>{data:label}</span>'},{openInNewWindow:c.config.get("openLinksInNewWindow"),skipEscaping:!0}),visible:e&&b._isTweet()}}},c.methods._isTweet=function(){var a=this.component;return"Twitter"===a.get("data.source.name")},c.methods._getTweetTime=function(a){var b,c=this.component,d=new Date(1e3*c.timestamp),e=(new Date).getTime(),f=Math.floor((e-d.getTime())/1e3);return b=a?this.labels.get("fullDate",{time:d.toLocaleTimeString(),date:d.toLocaleDateString()}):60>f?this.labels.get("secondsAgo",{seconds:f}):3600>f?this.labels.get("minutesAgo",{minutes:Math.floor(f/60)}):86400>f?this.labels.get("hoursAgo",{hours:Math.floor(f/3600)}):31536e3>f?this.labels.get("monthsAgo",{day:d.getDate(),month:this.labels.get("month"+(d.getMonth()+1))}):this.labels.get("yearsAgo",{day:d.getDate(),month:this.labels.get("month"+(d.getMonth()+1)),year:d.getFullYear()})},c.methods._extractTwitterID=function(){var a=this.component,b=a.get("data.actor.id").match(/twitter.com\/(.*)/);return b?b[1]:a.get("data.actor.id")},c.css=".{plugin.class} .{class:avatar} a img { border: 0px; }.{plugin.class} .{class:date} { display: none; }.{plugin.class} .{class:buttons} .{class:button-delim}:first-child { display: none; }.{plugin.class} .{class:data} a { text-decoration: none; }.{plugin.class} .{class:data} a:hover { text-decoration: underline; }.{plugin.class} .{class:footer} { padding-top: 5px; }.{plugin.class} .{class:modeSwitch} { margin-left: 6px; }.{plugin.class:userName} { float: left; font-size: 15px; font-weight: bold; }.{plugin.css:screenName} { margin-left: 4px; font-size: 11px; font-weight: normal; padding-top: 1px; }.{plugin.class:userName} a, .{plugin.class:tweetUserName} a, .{plugin.class:intentControl} { text-decoration: none; }.{plugin.class:icon} { width: 15px; height: 15px; display: inline-block; margin-right: 3px; background: url(https://si0.twimg.com/images/dev/cms/intents/icons/sprites/everything-spritev2.png) no-repeat; }.{plugin.class:icon-tweet} { background-position: 0px -2px; }.{plugin.class:icon-retweet} { background-position: -80px -2px; }.{plugin.class:icon-favorite} { background-position: -32px -2px; }.{plugin.class:activeButton} .{plugin.class:icon-tweet} { background-position: -16px -2px; }.{plugin.class:activeButton} .{plugin.class:icon-retweet} { background-position: -96px -2px; }.{plugin.class:activeButton} .{plugin.class:icon-favorite} { background-position: -48px -2px; }.{plugin.class:tweetUserName} { margin-left: 4px; font-size: 15px; float: left; }.{plugin.class:twitterIcon} { float: left; margin-right: 3px; }.{plugin.class:date} { text-decoration: none; color: #C6C6C6; }.{plugin.class:tweetScreenName} a { text-decoration: none; color: #333333; }.{plugin.class:tweetDate} a { text-decoration: none; }.{plugin.class:tweetDate} a:hover { text-decoration: underline;  }.{plugin.class:tweetDate} { float: right; }",Echo.Plugin.create(c))}(Echo.jQuery);