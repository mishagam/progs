/**
 * almond 0.1.2 Copyright (c) 2011, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 *
 * Modified October 11, 2012 by Lloyd Smith II <lloyd.smith@wapolabs.com>
 *  - got rid of the asynchronous loading so that all require is always synchronous
 *  - see the comment prefixed with "LES:" below
 */

/**
 * David Chamber's btoa / atob polyfill:
 *  https://github.com/davidchambers/Base64.js
 * (released under a very permissive license) and linked to
 * on the Modenizr collection of HTML5 polyfills: https://github.com/Modernizr/Modernizr/wiki/HTML5-Cross-Browser-Polyfills
 *
 * Slightly modified for MonetaJS / AMD.
 */

var JSON;JSON||(JSON={}),function(){function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(){var e=(new Date).getTime(),t,n,r;(function(e){function c(e,t){var n=t&&t.split("/"),r=o.map,i=r&&r["*"]||{},s,u,a,f,l,c,h,p,d,v;if(e&&e.charAt(0)==="."&&t){n=n.slice(0,n.length-1),e=n.concat(e.split("/"));for(p=0;v=e[p];p++)if(v===".")e.splice(p,1),p-=1;else if(v===".."){if(p===1&&(e[2]===".."||e[0]===".."))return!0;p>0&&(e.splice(p-1,2),p-=2)}e=e.join("/")}if((n||i)&&r){s=e.split("/");for(p=s.length;p>0;p-=1){u=s.slice(0,p).join("/");if(n)for(d=n.length;d>0;d-=1){a=r[n.slice(0,d).join("/")];if(a){a=a[u];if(a){f=a,l=p;break}}}if(f)break;!c&&i&&i[u]&&(c=i[u],h=p)}!f&&c&&(f=c,l=h),f&&(s.splice(0,l,f),e=s.join("/"))}return e}function h(t,n){return function(){return l.apply(e,a.call(arguments,0).concat([t,n]))}}function p(e){return function(t){return c(t,e)}}function d(e){return function(t){i[e]=t}}function v(t){if(s.hasOwnProperty(t)){var n=s[t];delete s[t],u[t]=!0,f.apply(e,n)}if(!i.hasOwnProperty(t))throw new Error("No "+t);return i[t]}function m(e,t){var n,r,i=e.indexOf("!");return i!==-1?(n=c(e.slice(0,i),t),e=e.slice(i+1),r=v(n),r&&r.normalize?e=r.normalize(e,p(t)):e=c(e,t)):e=c(e,t),{f:n?n+"!"+e:e,n:e,p:r}}function g(e){return function(){return o&&o.config&&o.config[e]||{}}}var i={},s={},o={},u={},a=[].slice,f,l;f=function(t,n,r,o){var a=[],f,l,c,p,y,b;o=o||t;if(typeof r=="function"){n=!n.length&&r.length?["require","exports","module"]:n;for(b=0;b<n.length;b++){y=m(n[b],o),c=y.f;if(c==="require")a[b]=h(t);else if(c==="exports")a[b]=i[t]={},f=!0;else if(c==="module")l=a[b]={id:t,uri:"",exports:i[t],config:g(t)};else if(i.hasOwnProperty(c)||s.hasOwnProperty(c))a[b]=v(c);else if(y.p)y.p.load(y.n,h(o,!0),d(c),{}),a[b]=i[c];else if(!u[c])throw new Error(t+" missing "+c)}p=r.apply(i[t],a);if(t)if(l&&l.exports!==e&&l.exports!==i[t])i[t]=l.exports;else if(p!==e||!f)i[t]=p}else t&&(i[t]=r)},t=n=l=function(t,n,r,i){return typeof t=="string"?v(m(t,n).f):(t.splice||(o=t,n.splice?(t=n,n=r,r=null):t=e),n=n||function(){},f(e,t,n,r),l)},l.config=function(e){return o=e,l},r=function(e,t,n){t.splice||(n=t,t=[]),s[e]=[e,t,n]},r.amd={jQuery:!0}})(),r("almond",function(){}),r("lib/jquery",[],function(){return window.$wpjQ||window.jQuery}),r("wapo/wapo-jquery",["lib/jquery"],function(e){window.$wpjQ||(window.$wpjQ=e),window.jQuery||(window.jQuery=e),window.$||(window.$=e)}),r("wapo/wapo",[],function(){var e,t=function(){};return t.prototype.Get_Cookie=function(e){var t,n,r,i,s,o,u;t=document.cookie.split(";"),s=!1,o=/^(.*?)(=)(.*?)$/,u=t.length;while(u--){n=t[u].match(o);if(typeof n!="undefined"&&n!==null){r=n[1].replace(/^\s+|\s+$/g,"");if(r===e)return s=!0,n[2]==="="&&(i=unescape(n[3].replace(/^\s+|\s+$/g,""))),i}n=null,r=""}if(!s)return null},t.prototype.Delete_Cookie=function(e,t,n){this.Get_Cookie(e)&&(document.cookie=e+"="+(t?";path="+t:"")+(n?";domain="+n:"")+";expires=Thu, 01-Jan-1970 00:00:01 GMT")},t.prototype.Set_Cookie=function(e,t,n,r,i,s){var o,u;o=new Date,o.setTime(o.getTime()),n&&(n=n*1e3*60*60*24),u=new Date(o.getTime()+n),document.cookie=e+"="+escape(t)+(n?";expires="+u.toGMTString():"")+(r?";path="+r:"")+(i?";domain="+i:"")+(s?";secure":"")},t.prototype.Get_Request_Parameter=function(e,t){var n,r;t+="=";if(e.length>0)return n=e.indexOf(t),n!==-1?(n+=t.length,r=e.indexOf("&",n),r===-1&&(r=e.length),unescape(e.substring(n,r))):"null"},t.prototype.getParameter=function(e){var t,n,r;t=window.top.location.search.substring(1),e+="=";if(t.length>0)return n=t.indexOf(e),n!==-1?(n+=e.length,r=t.indexOf("&",n),r===-1&&(r=t.length),unescape(t.substring(n,r))):"null"},t.prototype.getBaseDomainName=function(e){var t,n,r;return t=e,n=e.lastIndexOf("."),n>-1&&(r=e.lastIndexOf(".",n-1),r>-1&&(t=e.substring(r+1))),t},e=new t,e}),r("wapo/moneta/util/CallbackQueue",[],function(){var e=function(){this.callbacks={},this.counter=0};return e.prototype.add=function(e,t){var n=this.callbacks,r=this.counter=this.counter+1,i,s;typeof t=="undefined"?(s=e,i=window):(s=t,i=e);if(s){var o="callback_"+r;return n[o]=[i,s],n[o].iscallback=!0,o}return null},e.prototype.remove=function(e){e&&delete this.callbacks[e]},e.prototype.run=function(){var e=this.callbacks,t,n,r,i,s=arguments;for(i in e){t=e[i];if(t&&t.iscallback){r=t[0],n=t[1];try{n.apply(r,s)}catch(o){}}}},e}),r("wapo/moneta/util/EventLoop",["lib/jquery","./CallbackQueue"],function(e,t){var n=function(){},r=function(n){var i={interval:500};n&&e.extend(i,n),this.state=r.UNINITIALIZED,this.interval=i.interval,this.loop=null,this.callbacks=new t,this.shutdownCallbacks=new t};return r.UNINITIALIZED=0,r.STARTED=1,r.SHUTDOWN=2,r.prototype.isStarted=function(){return this.state===r.STARTED},r.prototype.isShutdown=function(){return this.state===r.SHUTDOWN},r.prototype.addCallback=function(e,t){return this.callbacks.add(e,t)},r.prototype.removeCallback=function(e){this.callbacks.remove(e)},r.prototype.removeShutdownCallback=function(e){this.shutdownCallbacks.remove(e)},r.prototype.addShutdownCallback=function(e,t){return this.shutdownCallbacks.add(e,t)},r.prototype.startup=function(){var t=this;t.startup=n,t.state=r.STARTED,t.loop=window.setInterval(function(){if(!t.isStarted())return;try{t.callbacks.run()}catch(e){}},t.interval);var i=this.unloadHandler=function(){t.shutdown()};e(window).bind("unload",i)},r.prototype.shutdown=function(){var t=this,i=t.loop,s=t.shutdownCallbacks,o=t.unloadHandler;t.shutdown=n,t.startup=n,t.removeShutdownCallback=n,t.addShutdownCallback=n,t.removeCallback=n,t.addCallback=n,t.state=r.SHUTDOWN,t.shutdownCallbacks=null,t.loop=null,t.callbacks=null,e(window).unbind("unload",o),window.clearInterval(i),s&&s.run()},r}),r("wapo/moneta/util/listPromise",["lib/jquery"],function(e){function t(t){function i(){function a(){var t=[].slice.call(arguments);u+=1,s.push(t),u===e&&n.resolve(s,o)}function f(){var t=[].slice.call(arguments);o.push(t),u+=1,u===e&&n.resolve(s,o)}var e=t.length,r=0,i,s=[],o=[],u=0;e===0&&n.resolve(s,o);for(r=0;r<e;r++)i=t[r],i.done(a),i.fail(f)}var n=new e.Deferred,r=n.promise();return i(),r}return t}),r("wapo/moneta/util/isvisible",["lib/jquery"],function(e){function n(e,n){n=n?n:0;var r=t.scrollTop(),i=r+t.height(),s=e.offset().top,o=s+e.height();return o<=i+n&&s>=r-n}var t=e(window);return n}),r("wapo/moneta/widget/AmazonBehavior",["lib/jquery"],function(e){var t=function(){};return t.prototype.addBehavior=function(t){if(t.adType!=="amazon")return;var n=this,r=t.container,i="_SL75_",s="_SL82_";r.find(".rev-widget ."+t.divClass+" > div:first").wrap('<div class="main"></div>').find("img").attr("src",function(){return e(this).attr("src").replace(i,s)}),r.find(".rev-widget ."+t.divClass+" > div.basic-link").wrapAll('<div class="other"></div>'),r.find(".rev-widget ."+t.divClass+" > div.other").prepend('<div class="separator"></div>'),n.updateContainerClass(t),r.delegate(".rev-widget ."+t.divClass+" .other .basic-link img","click",function(){var o=e(this),u=o.parents(".basic-link").html().replace(i,s),a=r.find(".rev-widget ."+t.divClass+" .main .basic-link").html().replace(s,i);r.find(".rev-widget ."+t.divClass+" .main .basic-link").html(u),o.parents(".basic-link").html(a),n.updateContainerClass(t)})},t.prototype.updateContainerClass=function(t){var n=t.container,r=/(link-type-.+?)([\s'"]|$)/igm,i=n.find(".rev-widget"),s=i.attr("class").replace(r,""),o=n.find(".rev-widget ."+t.divClass+" .main .basic-link").attr("class"),u=typeof o!="undefined"&&o.match(r),a="";u!==null&&typeof u[0]!="undefined"&&(a=" "+u[0]),n.find(".rev-widget").addClass(e.trim(s+a))},t}),r("wapo/moneta/widget/WeatherWidgetBehavior",[],function(){var e=function(){};return e.prototype.addBehavior=function(e){e.container.find(".revplat-weather-widget #zipCode").focus(function(){this.value==="enter zip code"&&(this.value="")}).blur(function(){this.value===""&&(this.value="enter zip code")})},e}),r("wapo/moneta/widget/RevDataFormBehavior",["lib/jquery","../../wapo"],function(e,t){var n=function(){};return n.prototype.addBehavior=function(e){var t=this,n=e.container,r=n.find(".revDataForm");r.bind("submit",function(){return t._saveDataInCookie(this,e),e.refresh(),!1})},n.prototype._saveDataInCookie=function(n,r){var i=r.moneta.DATA_ATTRIBUTES,s=e(n).serializeArray(),o,u,a;for(o in s)u=s[o],u.value.length>0?i[u.name]=u.value:typeof i[u.name]!="undefined"&&delete i[u.name];a=JSON.stringify(i),t.Set_Cookie("rev_da",a,"1825","/",null,!1)},n}),r("wapo/moneta/widget/WashPostSearchBehavior",[],function(){var e=function(){};return e.prototype.addBehavior=function(e){function u(e){return!e||e===""||e===s}var t=e.container,n=t.find('input[class="moneta-text"]'),r=t.find("form"),i=r.attr("data-moneta-search-form-disable-events")==="true";if(n.length===0||r.length===0||i)return;var s=n.val(),o=r.attr("data-moneta-default-search-term")||"20502";r.attr("onsubmit",null),r.bind("submit.WashPostSearchBehavior",function(){var e=n.val();u(e)&&n.val(o)}),n.bind("focus.WashPostSearchBehavior",function(){this.value===s&&(this.value="")}),n.bind("blur.WashPostSearchBehavior",function(){this.value===""&&(this.value=s)})},e}),r("wapo/moneta/widget/behavior",["./AmazonBehavior","./WeatherWidgetBehavior","./RevDataFormBehavior","./WashPostSearchBehavior"],function(e,t,n,r){var i=[new e,new t,new n,new r];return{addBehavior:function(e){var t;for(t=0;t<i.length;t++)i[t].addBehavior(e)}}}),r("wapo/moneta/util/OptionsParser",[],function(){var e=/^\s*<!--\s*MONETAJS_OPTIONS\s*\[\s*(.*?)\s*\]\s*-->\s*$/m,t=function(){this.pattern=e};return t.prototype.parse=function(e){var t=this.pattern.exec(e);return t?t[1]:null},new t}),r("wapo/moneta/util/MessageChannel",["lib/jquery","./CallbackQueue"],function(e,t){var n=function(e){return typeof e=="string"&&e!==""},r=function(e){return typeof e=="undefined"},i=function(e){return!r(e)},s=function(t,n,r,i,o){var u=this;this.messagePrefix=t+":",this.messagePrefixRe=new RegExp("^"+this.messagePrefix),this.postMessageEventName="message."+t+"_"+s._instanceCount,s._instanceCount++,this.sourceWin=n,this.$sourceWin=e(n),this.sourceListenerId=r,this.destWin=i,this.$destWin=e(i),this.destListenerId=o,this.topics={},this.handler=function(e){return u.handleMessage(e)},this._askerCount=0,this._askers={},this._responders={}};return s._instanceCount=0,s.prototype._sendMessage=function(e){if(!!this.destWin.postMessage)return this.destWin.postMessage(this.messagePrefix+JSON.stringify(e),"*")},s.prototype._parseMessage=function(e){var t=e.data;if(this.messagePrefixRe.test(t))try{return JSON.parse(t.substring(this.messagePrefix.length))}catch(n){return null}return null},s.prototype.listen=function(){this.$sourceWin.bind(this.postMessageEventName,this.handler)},s.prototype.stopListening=function(){this.$sourceWin.unbind(this.postMessageEventName,this.handler)},s.prototype.handleMessage=function(e){var t=this._parseMessage(e.originalEvent),n,r,s;t&&this.sourceListenerId===t.targetListenerId&&(r=t.args||[],i(t.topic)?(n=t.topic,s=this.topics["topic-"+n],s&&s.run.apply(s,r)):t.answer?this._acceptAnswer(t.askerId,r):t.ask&&this._respondTo(t.question,t.askerId,r))},s.prototype.setDestinationListenerId=function(e){this.destListenerId=e},s.prototype.setSourceListenerId=function(e){this.sourceListenerId=e},s.prototype.publish=function(e,t){var n={targetListenerId:this.destListenerId,topic:e,args:t||[]};return this._sendMessage(n)},s.prototype._acceptAnswer=function(t,n){if(e.isNumeric(t)){var r=this._askers[t];e.isFunction(r)&&(delete this._askers[t],r.apply({},n))}},s.prototype._respondTo=function(t,r,i){if(n(t)){var s=this._responders[t];e.isFunction(s)&&s.apply({},[this._makeAnswerFunction(r)].concat(i))}},s.prototype._makeAnswerFunction=function(e){var t=this;return function(n){return t._sendMessage({targetListenerId:t.destListenerId,askerId:e,args:n,answer:!0})}},s.prototype.ask=function(t,i,s){if(n(t)){r(s)&&e.isFunction(i)&&(s=i,i=[]);if(e.isFunction(s)){r(i)?i=[]:e.isArray(i)||(i=[i]);var o=this._askerCount++,u={targetListenerId:this.destListenerId,question:t,args:i||[],askerId:o,ask:!0};return this._askers[o]=s,this._sendMessage(u)}}},s.prototype.answer=function(t,r){if(e.isFunction(r)&&n(t)){var i=this._responders[t];return this._responders[t]=r,i}},s.prototype.stopAnswering=function(e){var t=this._responders[e];return delete this._responders[e],t},s.prototype.subscribe=function(e,n){var r,i,s;r=this.topics["topic-"+e],r||(r=this.topics["topic-"+e]=new t),i=r.add(n),s="_monetaMessageChannelSubscriptionId-"+e,n[s]=i},s.prototype.unsubscribe=function(e,t){var n,r,i;n=this.topics["topic-"+e],n&&(t?(i="_monetaMessageChannelSubscriptionId-"+e,r=t[i],n.remove(r),t[i]=null):this.topics["topic-"+e]=null)},s}),r("wapo/moneta/util/Sandbox",["lib/jquery","./CallbackQueue","./MessageChannel"],function(e,t,n){var r=function(e,t,n){return t=Math.max(0,t||0),n=Math.max(0,Math.min(n||Number.MAX_VALUE,Number.MAX_VALUE)),Math.max(t,Math.min(n,e))},i=function(t,n,r){this._el=t,this._text=n,this._options=e.extend({},{width:"100",height:"100",frameborder:"0",marginheight:"0",marginwidth:"0",scrolling:"no",src:"javascript:void(0)",style:"border:0;overflow:hidden;padding:0;margin:0;",allowtransparency:"true"},r),this._maxTries=Math.max(this._options.maxInitTries||-1,-1),this._initInterval=Math.max(10,this._options.initPollInterval||100)};return i.prototype._incarcerate=function(){var e=this,t=e._iframe=document.createElement("IFRAME"),n=e._supportsSrcDoc="srcdoc"in t,r=e._text,i=e._el,s;e._setPrisonAttributes(),i.appendChild(t),s=e._doc=t.contentDocument?t.contentDocument:t.contentWindow.document||t.document,e._win=t.contentWindow,n?t.setAttribute("srcdoc",r):(s.open(),s.write(r),s.close())},i.prototype.load=function(){return this._incarcerate()},i.prototype._setPrisonAttributes=function(){var e=this._iframe,t=this._options;t.width!=="auto"&&e.setAttribute("width",t.width),t.height!=="auto"&&e.setAttribute("height",t.height),e.setAttribute("frameborder",t.frameborder),e.setAttribute("marginheight",t.marginheight),e.setAttribute("marginwidth",t.marginwidth),e.setAttribute("scrolling",t.scrolling),e.setAttribute("src",t.src),e.setAttribute("style",t.style),e.setAttribute("allowtransparency",t.allowtransparency)},i.prototype.publish=function(e,t){var n=this;n.ready(function(){n.isListening()&&n._listener.publish(e,t)})},i.prototype.ask=function(e,t,n){var r=this;r.ready(function(){r.isListening()&&r._listener.ask(e,t,n)})},i.prototype.subscribe=function(e,t){this.isListening()&&this._listener.subscribe(e,t)},i.prototype.unsubscribe=function(e,t){this.isListening()&&this._listener.unsubscribe(e,t)},i.prototype._shouldSendInit=function(){var e=this;return!e._stopPublishingInit&&(e._infiniteAttemps||e._attemptsLeft>0)},i.prototype.listen=function(t,r){if(this.isListening())return;var i=this,s=i._listener,o=i._options,u=this._initInterval,a=this._maxTries,f=function(){i._shouldSendInit()&&(i._infiniteAttempts||i._attemptsLeft--,i._listener.publish("init",[r]),i._shouldSendInit()&&setTimeout(f,u))};i._canceled=!1,a<0?i._infiniteAttemps=!0:i._attemptsLeft=a,s=i._listener=new n("monetajs",t,r,i._win,null),s.listen(),i._readyQueue=e.Deferred(),i._canceledQueue=e.Deferred(),s.subscribe("ready",function(){i._stopPublishingInit=!0,i._readyQueue.resolve()}),s.subscribe("cancel",function(t){i._stopPublishingInit=!0,i._canceled=!0,i._readyQueue.reject(),i._readyQueue=e.Deferred(),i._readyQueue.reject(),i._canceledQueue.resolve(t)}),o.resizeOptions&&i._resize(o.resizeOptions),i._stopPublishingInit=!1,i._shouldSendInit()&&setTimeout(f,u)},i.prototype._resize=function(e){var t=this;(e.allowWidth||e.allowHeight)&&t.ask("size",function(n){if(t._canceled)return;n&&n.height&&e.allowHeight&&(t._iframe.height=r(n.height,e.minHeight,e.maxHeight)),n&&n.width&&e.allowWidth&&(t._iframe.width=r(n.width,e.minWidth,e.maxWidth))})},i.prototype.ready=function(e){this.isListening()&&this._readyQueue.then(e)},i.prototype.isListening=function(){return!!this._listener},i.prototype.canceled=function(e){this.isListening()&&this._canceledQueue.then(e)},i.prototype.stopListening=function(){var e=this;e.isListening()&&(e._listener.stopListening(),e._listener=null,e._readyQueue=null,e._canceledQueue=null,e._stopPublishingInit=!0)},i.prototype.destroy=function(){this.stopListening()},i}),r("wapo/moneta/util/Params",[],function(){var e="_param_",t=function(e){e=e||"",e.length>0&&e[0]==="?"&&(e=e.substring(1)),this.qs=e,this._parse()};return t.prototype._parse=function(){var t=this.qs,n,r,i,s,o,u;n=this.values={};if(t!==""){r=t.split("&");for(s=0;s<r.length;s++)i=r[s].split("="),o=e+decodeURIComponent(i[0]),i.length>1?u=decodeURIComponent(i[1]):u="",n[o]?n[o].push(u):n[o]=[u]}},t.prototype.getValue=function(t){var n=this.values[e+(t||"")];if(n&&n.length>0)return n[0]},t.prototype.getValues=function(t){return this.values[e+t||""]},t.current=function(){return new t(window.location.search)},t}),r("wapo/base64",[],function(){var e=function(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n=function(){try{document.createElement("$")}catch(e){return e}}();window.btoa?e.encode=function(e){return window.btoa(e)}:e.encode=function(e){for(var r,i,s=0,o=t,u="";e.charAt(s|0)||(o="=",s%1);u+=o.charAt(63&r>>8-s%1*8)){i=e.charCodeAt(s+=.75);if(i>255)throw n;r=r<<8|i}return u},window.atob?e.decode=function(e){return window.atob(e)}:e.decode=function(e){e=e.replace(/=+$/,"");if(e.length%4==1)throw n;for(var r=0,i,s,o=0,u="";s=e.charAt(o++);~s&&(i=r%4?i*64+s:s,r++%4)?u+=String.fromCharCode(255&i>>(-2*r&6)):0)s=t.indexOf(s);return u}},t={};return e(t),t.encodeUTF8=function(e){return t.encode(unescape(encodeURIComponent(e)))},t.decodeUTF8=function(e){return decodeURIComponent(escape(t.decode(e)))},t.uriEncodeUTF8=function(e){return t.encodeUTF8(e).replace(/\+/g,".").replace(/\//g,"_").replace(/=/g,"-")},t.uriDecodeUTF8=function(e){return t.decodeUTF8(e.replace(/\./g,"+").replace(/_/g,"/").replace(/-/g,"="))},t}),r("wapo/urlUtils",["./moneta/util/Params","./base64"],function(e,t){var n,r={__dependencies:{Params:e},params:function(e){return new n.Params(r.parseUrl(e).query)},isJavaScriptUrl:function(e){return e&&e.match(/^javascript:/)},isFragment:function(e){return e&&e.match(/^#/)},exceedsMaxUrlLength:function(e){return e?e.length>2083:!1},parseUrl:function(e){e=e||"";var t=e.indexOf("?"),n=e.indexOf("#"),r,i,s;return s=n>=0?e.substring(n):"",i=t>=0?e.substring(t+1,n>=0?n:e.length):"",r=e.substring(0,t>=0?t:n>=0?n:e.length),{base:r,query:i,hash:s}},addParamToUrl:function(e,t,n){var i=r.parseUrl(e),s=i.query,o=encodeURIComponent(t)+"="+encodeURIComponent(n),u="";return s.length>0?s="?"+s+"&"+o:s="?"+o,u+=i.base+s+i.hash,u},tryAddingBase64EncodedUrlParam:function(e,n,i){var s,o;if(r.isJavaScriptUrl(e)||r.isFragment(e))return;o=t.uriEncodeUTF8(JSON.stringify(i)),s=r.addParamToUrl(e,n,o);if(r.exceedsMaxUrlLength(s))return;return s}};return n=r.__dependencies,r}),r("wapo/UUID",[],function(){return{generate:function(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e==="x"?t:t&3|8;return n.toString(16)});return e}}}),r("wapo/moneta/util/EventEmitterMixin",["lib/jquery"],function(e){var t="__eventEmitterMixinJqObject",n={on:"bind",off:"unbind",once:"one",trigger:"trigger"},r=Array.prototype.slice,i=e.fn,s,o=function(n){return function(){return this[t]=this[t]||e({}),i[n].apply(this[t],r.apply(arguments))}},u=function(){};for(s in n)n.hasOwnProperty(s)&&(u.prototype[s]=o(n[s]));return u.mixin=function(e){for(var t in n)n.hasOwnProperty(t)&&(e[t]=u.prototype[t])},u}),r("wapo/moneta/MonetaWidget",["lib/jquery","./util/isvisible","./widget/behavior","./util/OptionsParser","./util/Sandbox","../urlUtils","../UUID","./util/EventEmitterMixin"],function(e,t,n,r,i,s,o,u){function l(e,t){try{return JSON.parse(e)||t}catch(n){return t}}function c(e){return typeof e=="string"?e:""}var a={Sandbox:i},f="data-widget-last-click-id",h=function(e){this.moneta=e.moneta,this.containerId=e.containerId,this.container=e.container,this.setOptions(e.widgetOptions),this.adId=null,this.treatmentId=null,this.widgetInstanceId=null,this.html=null,this.adType=null,this.links=null,this.cssUrl=null,this.numLinks=null,this.error=null,this.assocId=null,this.pxWidth=null,this.pxHeight=null,this.divClass=null,this.viewWidgetCallbackId=null,this._refreshedBefore=!1};return h.__dependencies=a,u.mixin(h.prototype),h.prototype.setOptions=function(e){var t=this;t.widgetOptions=e||{},t.widgetOptions.container=t.containerId,delete t.widgetOptions.containerId,t.widgetOptions._renderOptions?(t._renderOptions=t.widgetOptions._renderOptions,delete t.widgetOptions._renderOptions):t._renderOptions={},t.widgetOptions.renderData?(t.renderData=t.widgetOptions.renderData,delete t.widgetOptions.renderData):t.renderData=null},h.prototype.isRefreshed=function(){return this._refreshedBefore},h.prototype._signalRefreshStart=function(){this._refreshedBefore=!0},h.prototype._detectContainer=function(){var t=this.container,n=this.containerId;return!n||n.length===0?!1:t&&t.length>0?!0:(this.container=t=e("#"+n),t&&t.length>0)},h.prototype.hasContainer=function(){var e=this,t=e.container,n=e.containerId;return n&&t&&n.length>0&&t.length>0},h.prototype.refresh=function(){return this.moneta.refresh(this.containerId)},h.prototype.render=function(e){var t=this,n=t.container;t._setData(e),typeof t.error=="undefined"&&n&&t.html&&(t.tearDown(!0),n.attr("data-moneta-container-id",t.containerId),n.addClass("monetaWidgetMainContainer"),n.data("monetaWidget",t),t.renderOptions.sandbox?t._renderInSandbox():t.renderOptions.keepContents?t._keepContentsRender():t._renderInContainer(),t._logRenderAndBindEvents())},h.prototype.renderFallback=function(){var e=this;e._fireCancelWidgetInstanceEvent();if(e._fallbackData&&e._fallbackData.data){if(e._fallbackData.data._rendered)throw new Error("_fallbackData recursion!");e.render(e._fallbackData)}else e.destroy()},h.prototype._renderInContainer=function(){var e=this,t=e.container;t.append(e._getPreparedHtml()),e._finishRenderInContainer()},h.prototype._finishRenderInContainer=function(){var e=this;n.addBehavior(e),e.moneta.appendCss(e.cssUrl)},h.prototype._keepContentsRender=function(){var e=this,t=e.container,n=t.find(".monetaWidgetContentDiv"),r=n.find(".monetaWidgetInnerContentDiv"),i=e.renderOptions.keepContentsOptions||{},s;n.length>0&&r.length>0?(this.widgetInstanceId?n.attr("id",this.widgetInstanceId):n.removeAttr("id"),i.resetDimensions&&n.css({width:e.pxWidth,height:e.pxHeight}),i.resetDivClass&&r.attr("class","monetaWidgetInnerContentDiv "+this.divClass),i.targetSelector?(s=r.find(i.targetSelector),s.length===0&&(s=r)):s=r,s.append(c(e.html)),e._finishRenderInContainer()):e._renderInContainer()},h.prototype._renderInSandbox=function(){var t=this,n=e('<div class="monetaSandbox '+t.divClass+'"></div>'),r=t.container,i;t.cssUrl&&n.css("display","none"),r.append(n),i=t.sandbox=new a.Sandbox(n[0],t.html,t.renderOptions.sandboxOptions),i.load(),i.listen(window,t.widgetInstanceId),t.moneta.appendCss(t.cssUrl),i.canceled(function(){t.renderFallback()})},h.prototype._logRenderAndBindEvents=function(){this._fireRenderEvent(),this._registerViewWidgetCallback(),this._bindEvents(),this._crossDomainDivHack()},h.prototype.destroy=function(){var e=this;if(e.destroyed)return;e.destroyed=!0,e.tearDown(!1),e.trigger("destroy"),e.off()},h.prototype.tearDown=function(e){var t=this;t.hasContainer()&&(t._unbindEvents(),!e||t.sandbox?(t.sandbox&&(t.sandbox.destroy(),t.sandbox=null),t.container.empty()):(!t.renderOptions||!t.renderOptions.keepContents)&&t.container.empty())},h.prototype.isScrolledIntoView=t,h.prototype.logEvent=function(){return this.moneta.logEvent.apply(this.moneta,Array.prototype.slice.apply(arguments))},h.prototype.getMonetaService=function(){return this.moneta},h.prototype.getEventLoop=function(){return this.moneta.eventLoop},h.prototype._registerViewWidgetCallback=function(){var e=this,t=e.moneta,n=t.eventLoop,r=e.viewWidgetCallbackId=n.addCallback(t,function(){e.isScrolledIntoView(e.container)&&(e.logEvent("view_widget",{widget_instance_id:e.widgetInstanceId,ad_id:e.adId,ad_treatment_id:e.treatmentId,container_id:e.containerId,page_url:window.location.href+"",version:t.EVENTS_VERSION}),n.removeCallback(r),r===e.viewWidgetCallbackId&&(e.viewWidgetCallbackId=null))})},h.prototype._unbindEvents=function(){var e=this;e.container.undelegate(),e.viewWidgetCallbackId&&(e.getEventLoop().removeCallback(e.viewWidgetCallbackId),e.viewWidgetCallbackId=null)},h.prototype._bindEvents=function(){var t=this;t.container.delegate("a","click.MonetaWidget_assign_click_id",function(){e(this).attr(f,o.generate())}),t.container.delegate("a","click.MonetaWidget_visitor_id",function(){var n=e(this),r=n.attr("data-vis-id-param"),i=n.attr("href"),o;r&&(n.removeAttr("data-vis-id-param"),o={p:t.getMonetaService().getEventParam("pubid"),v:t.getMonetaService().getVisId()},i=s.tryAddingBase64EncodedUrlParam(i,r,o),i&&n.attr("href",i))}),t.container.delegate(".rev-widget .rev-contentlink, .rev-widget a, a:has(> .rev-buylink)","click.MonetaWidget_adClick",function(){t._adClick(this)}),t.sandbox&&(t.sandbox.subscribe("adClick",function(e,n,r){t._sendClickEvent(n["data-link-id"]||n.href,n["data-position"],r.eventExtra,o.generate())}),t.sandbox.publish("jQuery.delegate",["body",".rev-contentlink, a, a:has(> .rev-buylink)","click.MonetaWidget_adClick","adClick",["href","data-link-id","data-position"],["eventExtra"]])),t.container.delegate("a","click.MonetaWidget_clickReverb",function(){var n=e(this),r="data-widget-reverb-url-original",i=n.attr("data-widget-click"),o,u,a,l;i==="reverb-url"&&(u=n.attr(r)||n.attr("href"),l=n.attr(f),o=t._makeClickReverbData(n.attr("data-link-id"),n.attr("data-position"),n.data("eventExtra"),l),a=s.tryAddingBase64EncodedUrlParam(u,t.getMonetaService().clickReverbUrlParam,o),a&&(n.attr(r,u),n.attr("href",a)))})},h.prototype._fireRenderEvent=function(){var t=this,n=(new Date).getTime(),r=t.moneta,i=t.container,s=e(document),o=e(window),u=i.position(),a=[];i.find("a[data-position]").each(function(t,n){var r=e(n);a.push({link_id:r.attr("data-link-id"),link_position:r.attr("data-position")})}),t.logEvent("render_widget",{widget_instance_id:t.widgetInstanceId,container_id:t.containerId,page_url:window.location.href+"",viewable_page_size_xy:o.width()+","+o.height(),page_size_xy:s.width()+","+s.height(),position_xy:u.left+","+u.top,load_time:n-t.fetchStartTime,size_x:i.width(),size_y:i.height(),ad_id:t.adId,ad_treatment_id:t.treatmentId,version:r.EVENTS_VERSION,browser_time:n,link_info:a})},h.prototype._crossDomainDivHack=function(){var e=this.moneta;e.useCrossDomainDivHack&&(document.getElementById(e.crossDomainDivHackId)===null||typeof document.getElementById(e.crossDomainDivHackId)=="undefined")&&this.container.append('<div id="'+e.crossDomainDivHackId+'"></div>')},h.prototype._adClick=function(t){var n=e(t);this._sendClickEvent(n.attr("data-link-id"),n.attr("data-position"),n.data("eventExtra"),n.attr(f))},h.prototype._makeClickReverbData=function(e,t,n,r){var i=this._makeClickEventData(e,t,n,r),s=this.getMonetaService()._makeEventData("interact_element",i,!0);try{delete s.version,delete s.interaction_name}catch(o){}return s},h.prototype._makeClickEventData=function(e,t,n,r){var i=this.getMonetaService();return{widget_instance_id:this.widgetInstanceId,container_id:this.containerId,interaction_name:"Click",element_position:t,link_id:e,version:i.EVENTS_VERSION,ad_id:this.adId,event_extra:n,click_id:r}},h.prototype._sendClickEvent=function(e,t,n,r){this.logEvent("interact_element",this._makeClickEventData(e,t,n,r))},h.prototype._valueOrDefaultIfNull=function(e,t){return typeof e!="undefined"?e:t},h.prototype._fireCancelWidgetInstanceEvent=function(){var e=this,t=(new Date).getTime(),n=e.moneta,r=null;e._fallbackData&&e._fallbackData.data&&(r=e._fallbackData.data.widgetInstanceId),e.logEvent("cancel_widget_instance",{widget_instance_id:e.widgetInstanceId,replacement_widget_instance_id:r,ad_id:e.adId,ad_treatment_id:e.treatmentId,version:n.EVENTS_VERSION,browser_time:t})},h.prototype._getPreparedHtml=function(){var e='<div class="monetaWidgetContentDiv rev-widget" style="width:'+this.pxWidth+";height:"+this.pxHeight+(this.cssUrl?";display:none":"")+'"';return this.widgetInstanceId&&(e+=' id="'+this.widgetInstanceId+'"'),e+='><div class=" monetaWidgetInnerContentDiv '+this.divClass+'">'+c(this.html)+"</div></div>",e},h.prototype._setData=function(e){var t=e.data||{},n=this;n.adId=t.adId,n.treatmentId=t.treatmentId,n.widgetInstanceId=t.widgetInstanceId,n.html=t.html,n.renderOptions=t.renderOptions||l(r.parse(n.html))||n._renderOptions,n.adType=t.adType,n.links=t.links,n.cssUrl=t.cssUrl,n.numLinks=4,n.error=t.error,n.assocId=n._valueOrDefaultIfNull(t.data.assocId,"wapo-20"),n.pxWidth=n._valueOrDefaultIfNull(t.data.widthInPixels,"auto"),n.pxHeight=n._valueOrDefaultIfNull(t.data.heightInPixels,"auto"),n.divClass=n._valueOrDefaultIfNull(t.data.divClass,"washpost-bigbox"),n.fetchStartTime=e.fetchStartTime,n.fallbackCount=e.fallbackCount||0,t._rendered=!0,t.fallback?n._fallbackData={data:t.fallback,fetchStartTime:n.fetchStartTime,fallbackCount:n.fallbackCount+1}:n._fallbackData=null,n.viewWidgetCallbackId&&(n.moneta.eventLoop.removeCallback(n.viewWidgetCallbackId),n.viewWidgetCallbackId=null)},h}),r("wapo/moneta/util/MultiArray",["lib/jquery"],function(e){var t=function(){this._array=[]};return t.prototype={appendToNext:function(e){this.append(e,this.size())},appendAllToNext:function(e){this.appendAll(e,this.size())},appendAll:function(e,t){var n,r=typeof t=="undefined"?Math.max(this.size()-1,0):t;for(n=0;n<e.length;n++)this.append(e[n],r)},append:function(e,t){var n=this._array,r;r=typeof t=="undefined"?Math.max(n.length-1,0):t,r===n.length&&n.push([]),n[r].push(e)},size:function(){return this._array.length},get:function(e){return this._array[e]},isEmpty:function(){return this._array.length===0},containsValue:function(e){var t,n,r=this._array,i;for(t=0;t<r.length;t++){i=r[t];for(n=0;n<i.length;n++)if(i[n]===e)return!0}return!1},removeValue:function(e){var t,n,r=this._array,i;for(t=0;t<r.length;t++){i=r[t];for(n=0;n<i.length;n++)if(i[n]===e){i.splice(n,1),i.length===0&&this.removeIndex(t);break}}},removeIndex:function(e){this._array.splice(e,1)},each:function(t){var n=this,r=n._array;e.each(r,function(e,n){t.call(window,n,e)})},eachValue:function(t,n){var r=this,i=r._array;typeof n=="undefined"?e.each(i,function(e){r.eachValue(t,e)}):e.each(i[n],function(e,r){t.call(window,r,n,e)})},mapValues:function(t,n){var r=this._array,i,s=[];if(typeof n=="undefined"){for(i=0;i<r.length;i++)s.push(this.mapValues(t,i));return s}return e.map(r[n],function(e,r){return t.call(window,e,n,r)})}},t}),r("wapo/pageUtils",[],function(){var e={win:window};return{__dependencies:e,getBestProtocol:function(){var t=e.win.location.protocol;return t==="file:"||t==="http:"?"http:":"https:"},getLocation:function(){return e.win.location}}}),r("wapo/moneta/EventService",["lib/jquery","../pageUtils"],function(e,t){var n=function(e){this.EVENTS_URL=e||t.getBestProtocol()+"//event.wapolabs.com/log.php"};return n.prototype._makeEventData=function(e,t){return t||{}},n.prototype.logEvent=function(t,n){return e.ajax({dataType:"jsonp",url:this.EVENTS_URL,cache:!1,data:this._makeEventData(t,n)})},n}),r("wapo/moneta/VisitorInfo",["../wapo"],function(e){var t=function(e,t){this._data={},this._cookies=e||["wapo_vis_id","wapo_login_id","wapo_sess_id","s_vi"],this.alwaysReload=!!t,this._init()};return t.prototype._init=function(){var t,n=this._cookies,r=n.length;for(t=0;t<r;t++)this._data[n[t]]=e.Get_Cookie(n[t])},t.prototype.get=function(t,n){if(n||this.alwaysReload)this._data[t]=e.Get_Cookie(t);return this._data[t]},t}),r("wapo/moneta/pageExecTime",[],function(){function e(){var e=typeof MONETAJS_PAGE_EXEC_TS=="undefined"?-1:MONETAJS_PAGE_EXEC_TS;try{e=parseInt(e,10)}catch(t){e=-1}return Math.max(-1,e)}function t(){var e=typeof TWP_Debug=="undefined"?null:TWP_Debug;return e&&e.initialTime&&e.initialTime instanceof Date?e.initialTime.getTime():-1}var n=-1,r=[t,e],i=r.length,s;for(s=0;s<i;s++){n=Math.max(-1,r[s]());if(n>=0)break}return n}),r("wapo/moneta/appExecTime",[],function(){return typeof e!="undefined"?e:-1}),r("wapo/moneta/LoadTime",["./pageExecTime","./appExecTime","../UUID"],function(e,t,n){var r=n.generate();return{scriptUUID:function(){return r},appExecTime:function(){return t},pageExecTime:function(){return e},pageRelativeTimeSince:function(t){return e>=0?t-e:-1},appRelativeTimeSince:function(e){return t>=0?e-t:-1}}}),r("lib/docCookies",[],function(){var e={getItem:function(e){return!e||!this.hasItem(e)?null:unescape(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1"))},setItem:function(e,t,n,r,i,s){if(!e||/^(?:expires|max\-age|path|domain|secure)$/i.test(e))return;var o="";if(n)switch(n.constructor){case Number:o=n===Infinity?"; expires=Tue, 19 Jan 2038 03:14:07 GMT":"; max-age="+n;break;case String:o="; expires="+n;break;case Date:o="; expires="+n.toGMTString()}document.cookie=escape(e)+"="+escape(t)+o+(i?"; domain="+i:"")+(r?"; path="+r:"")+(s?"; secure":"")},removeItem:function(e,t){if(!e||!this.hasItem(e))return;document.cookie=escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(t?"; path="+t:"")},hasItem:function(e){return(new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=")).test(document.cookie)},keys:function(){var e=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/);for(var t=0;t<e.length;t++)e[t]=unescape(e[t]);return e}};return e}),r("wapo/moneta/Roadblock",["./util/Params","../../lib/docCookies","lib/jquery"],function(e,t,n){function i(e,t,n,r){var i,s,o;return e&&(i={ccuid:e,r:{}},t&&(o=1*t,isNaN(o)||(i.r.ttl=t)),n&&(s=new Date(n),isNaN(s.getTime())||(i.r.exp=n)),r&&(i.r.id=r)),i}var r=function(){this._check()};return r.prototype._check=function(){var e=this._parseQuery(),t=this._parseCookies();this._rb=null,e?t?e.ccuid===t.ccuid&&e.r.id===t.r.id?this._rb=t:(this._rb=e,this._deleteCookies(),this._setCookies()):(this._rb=e,this._deleteCookies(),this._setCookies()):t&&(this._rb=t)},r.prototype._parseQuery=function(){var t=e.current(),n=t.getValue("_moneta[ccuid]"),r=t.getValue("_moneta[r][ttl]"),s=t.getValue("_moneta[r][exp]"),o=t.getValue("_moneta[r][id]");return i(n,r,s,o)},r.prototype._parseCookies=function(){var n=t.getItem("_moneta[ccuid]"),r=t.getItem("_moneta[r]"),s=new e(r),o=s.getValue("ttl"),u=s.getValue("exp"),a=s.getValue("id");return i(n,o,u,a)},r.prototype._setCookies=function(){var e=this._rb,r,i;e&&(e.r.exp?r=new Date(1*e.r.exp):e.r.ttl&&(r=1*e.r.ttl),t.setItem("_moneta[ccuid]",e.ccuid,r,"/"),i=n.param(e.r),i!==""&&t.setItem("_moneta[r]",i,r,"/"))},r.prototype._deleteCookies=function(){t.removeItem("_moneta[ccuid]","/"),t.removeItem("_moneta[r]","/")},r.prototype.getParams=function(e){e||this._check();if(this.isActive())return{_moneta:this._rb}},r.prototype.isActive=function(){return!!this._rb},r}),r("wapo/identity/WapoSite",["lib/jquery"],function(e){function r(e,t){return e&&e.visitors&&e.visitors.wapoVisitor&&e.visitors.wapoVisitor.id||t}var t="-1",n={read:"/public/visitor.json",create:"/public/visitor/create"},i=function(e){this.name=e.name,this.idVisitorUrl=e.idVisitorUrl,this.identityUrl=e.identityUrl,this.visId=e.visId,this.timeout=typeof e.timeout=="undefined"?5e3:e.timeout,this.jsonpParam=e.jsonpParam||"callback",this.protocol=e.protocol||"https:",this.visitorCookie=e.visitorCookie,this.reconcileCookie=e.reconcileCookie,this.apiPaths={read:this.idVisitorUrl&&this.protocol+this.idVisitorUrl+n.read,create:this.identityUrl&&this.protocol+this.identityUrl+n.create}};return i.isValidVisId=function(e){return!!e&&e!==t},i.prototype.hasVisId=function(){return i.isValidVisId(this.visId)},i.prototype.readVisId=function(){var n=this,i=e.Deferred();return e.ajax({url:n.apiPaths.read,data:{lang:"en-us",tags:"sunset"},dataType:"jsonp",jsonp:n.jsonpParam,timeout:n.timeout,success:function(e){n.visId=r(e,t),i.resolve(n)},error:function(){n.visId=t,i.resolve(n)}}),i.promise()},i.prototype.createVisId=function(){var t=this,n=e.Deferred();return e.ajax({url:t.apiPaths.create,dataType:"jsonp",data:{format:"json"},jsonp:t.jsonpParam,success:function(e){var i=r(e);t.visId=i,n.resolve(t)},error:function(){t.visId=null,n.resolve(t)}}),n.promise()},i}),r("wapo/moneta/MonetaService",["lib/jquery","../wapo","./util/EventLoop","./util/listPromise","./MonetaWidget","./util/MultiArray","./EventService","./VisitorInfo","./LoadTime","./Roadblock","../pageUtils","../urlUtils","../base64","../identity/WapoSite"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p){function v(e){return typeof e=="string"&&e!==""}var d={doc:document,win:window},m=function(t){var n=l.getBestProtocol(),r={BASE_URL:n+"//staging_oscar.wapolabs.com/RevenuePlatform",EVENTS_URL:n+"//event.wapolabs.com/log.php",EVENTS_APP_NAME:"moneta",useCrossDomainDivHack:!1,crossDomainDivHackId:"wapo_338542",renderBeforeDomReady:!1,skipMissingContainers:!1,noClickReverb:!1,removeFromDOMOnReplace:!0},i=e.extend({},r,t),a=this;e(d.doc).ready(function(){a.domReady=!0}),this.BASE_URL=i.BASE_URL,this.useCrossDomainDivHack=!!i.useCrossDomainDivHack,this.crossDomainDivHackId=i.crossDomainDivHackId,this.renderBeforeDomReady=!!i.renderBeforeDomReady,this.skipMissingContainers=!!i.skipMissingContainers,this._widgets={},this.DATA_ATTRIBUTES={},this.LOADED_CSS=[],this._visitorInfo=i.visitorInfo||new u,this.EVENTS_VERSION="1",this.EVENTS_APP_NAME=i.EVENTS_APP_NAME,this.clickReverbUrlParam=i.clickReverbUrlParam||"_monetaClick",this.reconcileVisitorReverbEnabled=!!i.reconcileVisitorReverbEnabled,this.reconcileVisitorReverbUrlParam=i.reconcileVisitorReverbUrlParam||"_monetaVisitor",this.clickReverbEnabled=!i.noClickReverb,this.eventService=i.eventService||new o(i.EVENTS_URL),this.roadblock=i.roadblock||new f,this.eventLoop=i.eventLoop,this.batches=new s,this._initPageUrl(i.getPageUrl),this._init(i.widgetOptions),this._customAddStyleSheet=e.isFunction(i.addStyleSheet)?i.addStyleSheet:null,this.replaceWidgetsOnAdd=!!i.replaceWidgetsOnAdd,this.removeFromDOMOnReplace=!!i.removeFromDOMOnReplace,this.postProcessPongData=e.isFunction(i.postProcessPongData)?i.postProcessPongData:null};m.__dependencies=d,m.prototype.getWidget=function(e){return this._widgets[e]},m.prototype.removeWidget=function(e,t){var n=this.getWidget(e);n&&(delete this._widgets[e],this.batches.removeValue(e),n.destroy(),t&&n.container&&n.container.remove())},m.prototype._getPongOptionsForContainerIds=function(t){var n=this;return e.map(t,function(e){return n.getWidget(e).widgetOptions})},m.prototype.addWidget=function(e,t,n){var r=this._addWidget(e,n);return r&&this.batches.append(r.containerId,t),r},m.prototype.addWidgetOptions=function(t,n,r){var i=this._normalizeWidgetOptions(t),s=this,o=i.defaultWidgetOptions,u;n?u=this.batches.size():u=Math.max(this.batches.size()-1,0),e.each(i.batches,function(e,t){s._addBatchConfigWidgets(e+u,t,o,r)})},m.prototype._addWidget=function(e,t){var n=this,r=n._fixMonetaWidgetConfig(e),s=n._widgets,o=r.containerId,u;return v(o)&&(n.replaceWidgetsOnAdd&&n.removeWidget(o,n.removeFromDOMOnReplace),s[o]||(u=new i(r),!t||u.hasContainer()||u._detectContainer()?s[o]=u:u=null)),u},m.prototype._fixMonetaWidgetConfig=function(t){var n,r=t.containerId;return r?(n=t.container,n?n=n instanceof e?n:e(n):n=e("#"+r),t.container=r,delete t.containerId):(r=t.container,n=e("#"+r)),{moneta:this,containerId:r,container:n,widgetOptions:t}},m.prototype._convertToMultiArray=function(t){var n;return t?(n=new s,e.isArray(t)?n.appendAll(t):n.append(t)):n=this.batches,n},m.prototype.refresh=function(e){var t=this._convertToMultiArray(e);return this._handleRefresh(t)},m.prototype.refreshNewWidgets=function(){var e=this,t=new s;return e.batches.each(function(n,r){var i,s;for(i=0;i<n.length;i++)s=e.getWidget(n[i]),s.isRefreshed()||t.append(s.containerId,r)}),e._handleRefresh(t)},m.prototype._handleRefresh=function(e){var t=this,i=[],s=[];return t.eventLoop||(t.eventLoop=new n,t.eventLoop.startup()),e.isEmpty()?null:(e.each(function(e){var n=t._makePongRequest(e),r=n.deferred.promise();n.doPong(),i.push(r),s.push(n.jqXHR)}),{promise:r(i),jqXHR:r(s),promises:i,jqXHRs:s})},m.prototype._makePongRequest=function(e){return new g(this,e)},m.prototype._initPageUrl=function(t){var n;e.isFunction(t)?n=function(){return t.call(null)}:typeof t=="string"?n=function(){return t}:n=function(){return d.win.location.toString()},this.getPageUrl=n},m.prototype._init=function(e){this.DATA_ATTRIBUTES=this._getDataAttributes(),this.addWidgetOptions(e,!1,this.skipMissingContainers)},m.prototype._normalizeWidgetOptions=function(t){var n;return t||(t={batches:[]}),e.isArray(t)?n={batches:[{widgets:t}]}:(n=t,t.widgets&&(t.batches?t.batches.push({widgets:t.widgets}):t.batches=[{widgets:t.widgets}],delete t.widgets)),n.defaultWidgetOptions||(n.defaultWidgetOptions={}),n},m.prototype._addBatchConfigWidgets=function(t,n,r,i){var s=this;e.each(n.widgets,function(o,u){var a={};e.extend(!0,a,r,n.defaultWidgetOptions,u),s.addWidget(a,t,i)})},m.prototype.appendCss=function(t){if(this._customAddStyleSheet)try{this._customAddStyleSheet(t)}catch(n){}else{var r=this.LOADED_CSS,i;t&&e("link[href='"+t+"']").length===0&&e.inArray(t,r)===-1&&(i='<link rel="stylesheet" href="'+t+'"></link>',e("head").append(i),r.push(t))}},m.prototype.logError=function(t){var n=this.BASE_URL+"/ad/adError";e.getJSON(n+"?&callback=?&format=json",t)},m.prototype.logEvent=function(e,t){return t=this._makeEventData(e,t),this.eventService.logEvent(e,t)},m.prototype._setOverrideVisId=function(e){this._overrideVisId=e},m.prototype.getVisId=function(){return this._overrideVisId||this._visitorInfo.get("wapo_vis_id")},m.prototype.logStartupEvents=function(){var e=this;e.logStartupEvents=function(){},e._logLoad(),e._logClickReverb(),e._logReconcileVisitorReverb()},m.prototype._logLoad=function(){this.logEvent("script_loaded",{app_exec_time:a.appExecTime(),page_exec_time:a.pageExecTime(),page_url:d.win.location.toString()})},m.prototype._logReconcileVisitorReverb=function(){this.reconcileVisitorReverbEnabled&&this._doIfUrlHasParam(this.reconcileVisitorReverbUrlParam,function(e){this.sendReconcileVisitorEvent(e.p,e.v,this.getVisId())})},m.prototype.sendReconcileVisitorEvent=function(e,t,n){n!==t&&p.isValidVisId(n)&&p.isValidVisId(t)&&e&&this.logEvent("reconcile_visitor",{publisher_id:e,publisher_vis_id:t,master_vis_id:n})},m.prototype._logClickReverb=function(){this.clickReverbEnabled&&this._doIfUrlHasParam(this.clickReverbUrlParam,function(t){var n=this._makeEventData("interact_element");t=e.extend(n,t,{real_wapo_vis_id:n.wapo_vis_id,real_wapo_sess_id:n.wapo_sess_id,real_wapo_login_id:n.wapo_login_id,event_name:"interact_element",interaction_name:"ClickReverb",version:this.EVENTS_VERSION}),this.eventService.logEvent(t.event_name,t)})},m.prototype.setPublisherService=function(e){this._publisherService=e},m.prototype.getPublisherService=function(){return this._publisherService},m.prototype._doIfUrlHasParam=function(t,n){var r=d.win.location.toString(),i=c.params(r).getValue(t),s;if(i)try{s=JSON.parse(h.uriDecodeUTF8(i))}catch(o){s=null}e.isPlainObject(s)&&n.call(this,s)},m.prototype._makeEventData=function(t,n,r){var i=this._visitorInfo,s;return n=n||{},n.wapo_vis_id=n.wapo_vis_id||this.getVisId(),n.wapo_sess_id=n.wapo_sess_id||i.get("wapo_sess_id"),n.wapo_login_id=n.wapo_login_id||i.get("wapo_login_id"),r||(n.browser_time=s=n.browser_time||(new Date).getTime(),n.useragent=navigator.userAgent,n.event_name=t,n.product_name=this.EVENTS_APP_NAME,n.script_id=n.script_id||a.scriptUUID(),n.page_elapsed_time_ms=n.page_elapsed_time_ms||a.pageRelativeTimeSince(s),n.app_elapsed_time_ms=n.app_elapsed_time_ms||a.appRelativeTimeSince(s)),e.extend(n,this._eventParams)},m.prototype.addEventParams=function(t){if(!t)return;var n=this._eventParams=this._eventParams||{};e.extend(!0,n,t)},m.prototype.getEventParam=function(e){if(!e)return this._eventParams;var t=this._eventParams;if(!t)return;return t[e]},m.prototype._getDataAttributesFromCookie=function(e){try{return JSON.parse(t.Get_Cookie(e))||{}}catch(n){return{}}},m.prototype._getDataAttributes=function(){var e=this._getDataAttributesFromCookie("trove_da"),t=this._getDataAttributesFromCookie("rev_da"),n;if(e==={})return t;for(n in e)t[n]=e[n];return t},m.prototype.addPongParams=function(t){var n=this._pongParams=this._pongParams||{};e.extend(!0,n,t)},m.prototype._postProcessPongData=function(e){this.postProcessPongData&&this.postProcessPongData(e)},m.prototype._createPostData=function(t){var n=this._visitorInfo,r=this.DATA_ATTRIBUTES,i=e.extend(!0,{},this._pongParams,{url:this.getPageUrl(),ads:{},da:{},wapo_vis_id:this.getVisId(),wapo_login_id:n.get("wapo_login_id"),s_vi:n.get("s_vi")}),s,o,u,a,f;e.extend(i,this.roadblock.getParams());for(s in t){a=e.extend(!0,{},t[s]),f=this.getWidget(a.container);if(f){typeof a.container!="undefined"&&(i.ads[a.container]=a);if(typeof a.finderOptions!="undefined")for(o in a.finderOptions)i.ads[a.container].finder=o}}for(u in r)i.da[u]=r[u];return this._postProcessPongData(i),i};var g=function(t,n){this.deferred=e.Deferred(),this.parentService=t,this.PONG_URL=t.BASE_URL+"/ad/pong?&callback=?&format=json";var r=[],i=[];e.each(n,function(e,n){var s=t.getWidget(n);s.renderData?r.push(s):i.push(n)}),this.widgetsWithData=r,this.postData=t._createPostData(t._getPongOptionsForContainerIds(i)),this.containerIds=i,this.processedWidgets=[],this.deferredWidgets=[]};return g.prototype.doPong=function(){var t=this,n=t.containerIds,r=n.length,i,s;for(s=0;s<r;s++)i=t.parentService.getWidget(n[s]),i&&i._signalRefreshStart();t.fetchStartTime=(new Date).getTime();if(r>0)t.jqXHR=e.ajax({type:"GET",url:t.PONG_URL,data:t.postData,dataType:"json",success:function(e){t.response=e;if(typeof e.error=="undefined")try{t._processResponse()}catch(n){t.error=n,t.deferred.reject("bug",n,t.postData,e)}else t._rejectDeferred()},error:function(e){t.error=e,t.deferred.reject("ajax",e,t.postData),t.parentService.logError(t.postData)}});else{var o=e.Deferred();t.jqXHR=o.promise(),o.resolve()}e.each(t.widgetsWithData,function(e,n){var r=n.renderData;n.renderData=null,n._signalRefreshStart(),t._handleWidgetResponseData(n.containerId,r)}),r===0&&this._scheduleResolution()},g.prototype._scheduleResolution=function(){this.deferredWidgets.length===0?this._resolveDeferred():this._processDeferredWidgetsWhenDomIsReady()},g.prototype._handleWidgetResponseData=function(e,t){var n=this.parentService,r=this.deferredWidgets,i,s=n.renderBeforeDomReady;i=n.getWidget(e),i&&(s||n.domReady?this._tryProcessWidget(i,t)||(n.domReady?n.removeWidget(e):r.push([i.containerId,t])):r.push([i.containerId,t]))},g.prototype._processResponse=function(){var e=this.response,t;for(t in e)this._handleWidgetResponseData(t,e[t]);this._scheduleResolution()},g.prototype._rejectDeferred=function(){this.deferred.reject("server",this.postData,this.response),this.parentService.logError(this.postData)},g.prototype._resolveDeferred=function(){this.deferred.resolve(this.postData,this.response,this.processedWidgets)},g.prototype._processDeferredWidgetsWhenDomIsReady=function(){var t=this;e(d.doc).ready(function(){var e=t.parentService,n=t.deferredWidgets,r,i,s,o,u;e.domReady=!0;for(r=0;r<n.length;r++)o=n[r],i=o[0],s=o[1],u=e.getWidget(i),t._tryProcessWidget(u,s)||e.removeWidget(i);t._resolveDeferred()})},g.prototype._tryProcessWidget=function(e,t){return e.hasContainer()||e._detectContainer()?(this.processedWidgets.push(e),e.render({data:t,fetchStartTime:this.fetchStartTime}),!0):!1},m}),r("wapo/moneta/MonetaWidgetParser",["lib/jquery"],function(e){var t=function(e,t){var n,r=e.length,i,s=[];for(n=0;n<r;n++)i=t(e[n],n,e),i&&s.push(i);return s},n=function(e,t){var n=e.attr("data-moneta-processed"),r=t||n!=="true";return r&&e.attr("data-moneta-widget")},r=function(r){return t(r,function(t){var r=e(t);return r.attr("type")==="moneta/widget"&&n(r)?r:null})},i=function(t,n){n.attr("data-moneta-processed","true");try{var r=n.data(),i=e.extend({},r.monetaWidget),s=r.monetaWidgetDivId,o,u=!1,a;return s?(o=e("#"+s),o.length===0&&(o=e("<div></div>"),o.attr("id",s),u=!0)):(o=e("<div></div>"),u=!0),n.attr("class")&&(o.attr("class",n.attr("class")),n.attr("class","")),n.attr("style")&&(o.attr("style",n.attr("style")),n.attr("style","")),u&&n.before(o),i.containerId=i.container,i.container=o,a=t.addWidget(i),a&&r.monetaWidgetImmediate&&a.refresh(),a}catch(f){return null}},s=function(e){this.service=e};return s.prototype._parseWidget=function(t,r){var s=t instanceof e?t:e(t);return n(s,r)?i(this.service,s):null},s.prototype.parseWidgets=function(t,n){var s=r(t||document.getElementsByTagName("script")),o=this,u=o.service;e.each(s,function(e,t){i(u,t)}),n!==!0&&u.refreshNewWidgets()},s}),r("wapo/moneta/legacy/LegacyOptions",[],function(){var e=function(e){this.global=e,this.widgetOptions=null,this.mainConfig=null};return e.prototype.found=function(){return this.widgetOptions||this.mainConfig},e.prototype.load=function(){if(this.found())return;var e=this.global,t,n;e.adOptions&&(t=e.adOptions,e.adOptions=null),t&&t.mainConfig===!0?(n=t,this.widgetOptions=n.widgetOptions,this.mainConfig=n,delete n.widgetOptions):(this.widgetOptions=t,this.mainConfig=null)},e}),r("wapo/moneta/MainScriptParser",["lib/jquery"],function(e){function u(e,n){if(e===null||e===undefined)return!1;if(!t.$.isArray(e))return n(e,0,[e]);var r=e.length,i,s;for(s=0;s<r;s++){i=e[s];if(n(i,s,e))return!0}return!1}function a(e,t){return!e||!t?!1:u(t,function(t){return!!e[t]})}function f(e,t){return!e||!t?!1:u(t,function(t){return e.match(t)})}var t={$:e},n="data-moneta-config-processed",r="data-moneta-processed",i="true",s="unknown",o=["monetaConfig","monetaWidget","monetaWidgetDivId","monetaVersion","monetaPublisher"],l=function(e,t,n){n=n||"moneta";var r="(?:\\.full\\.|\\.min\\.|\\.jq\\.full\\.|\\.jq.min\\.|\\.)js$";this.VERSION_PATTERN=new RegExp("^.*\\/([a-z0-9\\.\\-\\_]*)\\/js\\/"+n+r,"i"),this.MONETA_SCRIPT_PATTERNS=[new RegExp("^.*\\/js\\/"+n+r,"i")],this.sourceVersion={version:t||"2.x"},this.sourceVersion.major=this._parseMajorVersion(this.sourceVersion.version),this.doc=e};return l.__dependencies=t,l.prototype._isProcessedScript=function(e){return e.getAttribute(n)===i||e.getAttribute(r)===i},l.prototype._setMainScriptProcessed=function(e){e.setAttribute(n,i)},l.prototype._findMainMonetaScripts=function(e){var t=e.length,n,r,i=[];for(n=0;n<t;n++)r=e[n],r.getAttribute("src")&&!this._isProcessedScript(r)&&i.push(r);return i},l.prototype.findMainScript=function(){var e,t,n,r,i;e=this._allScripts=this.doc.getElementsByTagName("script"),r=this._findMainMonetaScripts(e),n=r.length;for(t=0;t<n;t++){i=this._getMonetaScriptInfo(r[t]);if(i){if(i.version.major===this.sourceVersion.major)break;i=null}else i=null}return this._mainScriptInfo=i,i&&this._setMainScriptProcessed(i.$script[0]),i},l.prototype._getMonetaScriptInfo=function(e){var n=t.$(e),r=n.data(),i=n.attr("src"),s=a(r,o),u;return this._isProcessedScript(e)||!(s||i&&f(i,this.MONETA_SCRIPT_PATTERNS))?null:(u={$script:n,data:r,src:i},s&&(u.useDataAttrs=!0),u.version=this._guessVersion(u),u)},l.prototype._makeVersion=function(e){return{major:this._parseMajorVersion(e),version:e}},l.prototype._parseMajorVersion=function(e){var t=e.indexOf(".");return t>=0?e.substring(0,t):s},l.prototype._guessVersion=function(e){var t=e.src,n=e.$script.attr("data-moneta-version"),r;return n?r=this._makeVersion(n):(n=t&&this.VERSION_PATTERN.exec(t),n?(r={version:n[1],major:this._parseMajorVersion(n[1])},r.major===s&&e.useDataAttrs&&(r={version:this.sourceVersion.version,major:this.sourceVersion.major})):e.useDataAttrs?r={version:this.sourceVersion.version,major:this.sourceVersion.major}:r={version:s,major:s}),r},l}),r("wapo/Cookie",["./wapo","./pageUtils"],function(e,t){var n=function(e){this._options=e};return n.prototype.get=function(){return e.Get_Cookie(this._options.name)},n.prototype.set=function(t){var n=this._options;e.Set_Cookie(n.name,t,n.expiry,n.path,n.domain,!!n.secure)},n.prototype.options=function(e){if(typeof e=="undefined")return this._options;this._options=e},n.newInstance=function(r,i){i=i||r;var s={name:r.name||i.name,expiry:r.expiry||i.expiry||18250,domain:r.domain||i.domain||e.getBaseDomainName(t.getLocation().hostname),path:r.path||i.path||"/"};return typeof r.secure=="undefined"?s.secure=!!i.secure:s.secure=!!r.secure,new n(s)},n}),r("wapo/identity/WapoVisitor",["lib/jquery","./WapoSite","../pageUtils","../UUID","../Cookie"],function(e,t,n,r,i){var s={WapoSite:t,pageUtils:n},o="read",u="set",a="shared",f="1",l=function(t){var n=t.wapoSites,r=t.masterSiteName,f=t.wapoSiteName,l=t.protocol||s.pageUtils.getBestProtocol(),c,h,p;typeof t.identityMode!="undefined"?p=t.identityMode:typeof t.noidentity!="undefined"&&(p=t.noidentity===!0?o:u),p===a?this._sharedCookieMode=!0:p===u?this._setCookieMode=!0:p===o?this._readCookieMode=!0:this._setCookieMode=!0,this.visitorSites=e.map(n,function(t){var n=new s.WapoSite(e.extend({protocol:l},t));n.name===r&&(c=n);if(f===n.name){h=n;return}return n}),this.masterSite=c,this.wapoSite=h,this.visitorCookie=i.newInstance(t.visitorCookie,e.extend({name:"wapo_vis_id",domain:t.baseDomain,expiry:18250,path:"/"},h&&h.visitorCookie)),this.reconcileCookie=i.newInstance(t.reconcileCookie,e.extend({name:"wapo_moneta_visidrec",domain:t.baseDomain,expiry:1,path:"/"},h&&h.reconcileCookie)),this._visId=null,this._deferred=null};return l.__dependencies=s,l.prototype.getVisId=function(){var t=this,n=t.visitorSites,i=t.masterSite,s,o;return this._deferred?this._deferred.promise():(s=this._deferred=e.Deferred(),t._readCookie()?s.resolve(t._visId):t._readCookieMode?e(document).on("wapo_visitor_create",function(){t._readCookie()?s.resolve(t._visId):s.reject("Could not get visitor id")}):t._setCookieMode?(this._setCookie(r.generate()),s.resolve(t._visId)):t._sharedCookieMode?(o=e.map(n,function(e){return e.readVisId()}),e.when.apply(e,o).then(function(){i.hasVisId()?(t._setCookie(i.visId),s.resolve(t._visId)):(e.each(n,function(e,n){if(n.hasVisId())return t._setCookie(n.visId),!1}),t.hasVisId()?s.resolve(t._visId):i.createVisId().then(function(){i.hasVisId()?(t._setCookie(i.visId),s.resolve(t._visId)):s.reject("Could not get visitor id")}))})):s.reject("Could not get visitor id"),s.promise())},l.prototype.reconcile=function(e){this.reconcileCookie.get()!==f&&this._doReconcile(e)},l.prototype._doReconcile=function(e){var t=this,n=t.masterSite;t.getVisId().then(function(r){n.hasVisId()?t._invokeReconcileCallback(e,r,n.visId):n.readVisId().then(function(){t._invokeReconcileCallback(e,r,n.visId)})})},l.prototype._invokeReconcileCallback=function(e,t,n){this.reconcileCookie.set(f),t!==n&&e(t,n)},l.prototype.hasVisId=function(){return s.WapoSite.isValidVisId(this._visId)},l.prototype._setCookie=function(e){s.WapoSite.isValidVisId(e)&&(this._visId=e,this.visitorCookie.set(this._visId))},l.prototype._readCookie=function(){var e=this.visitorCookie.get();if(s.WapoSite.isValidVisId(e))return this._visId=e,!0},l}),r("wapo/moneta/publisher/PublisherService",["../../identity/WapoVisitor","lib/jquery","../../Cookie"],function(e,t,n){function u(e){return e===i||e===s}var r={win:window,WapoVisitor:e},i="off",s="on",o=function(e,i){var s,o,u,a,f;s=e.identityConfig,o=e.publisherConfig,u={name:o.cookieName,domain:o.cookieDomain,expiry:o.cookieExpiry,path:o.cookiePath},a={name:o.reconcileCookieName,domain:o.reconcileCookieDomain,expiry:o.reconcileCookieExpiry,path:o.reconcileCookiePath},this._optOutCookie=n.newInstance({name:o.optOutCookieName,domain:o.optOutCookieDomain,expiry:o.optOutCookieExpiry,path:o.optOutCookiePath},{name:"wapo_moneta_pub_optout"}),f=t.extend(!0,{},s,{visitorCookie:u,wapoSiteName:o.wapoSite,noidentity:o.noidentity,identityMode:o.identityMode,reconcileCookie:a}),this.publisherId=o.id,this.fireReadAutomatically=!o.noread,this.computePageData=t.isFunction(o.computePageData)?o.computePageData:null,this.extra=o.extra,this.monetaService=i,this.wapoVisitor=new r.WapoVisitor(f),this._initialized=!1};return o.__dependencies=r,o.prototype.init=function(){var e=this;e._initialized||(e._initialized=!0,e.monetaService.addPongParams({pubid:e.publisherId,pubOptStat:e.getOptOutStatus()}),e.monetaService.addEventParams({pubid:e.publisherId}),e.monetaService.setPublisherService(e),e.wapoVisitor.reconcile(function(t,n){e.monetaService.sendReconcileVisitorEvent(e.publisherId,t,n)}),e.fireReadAutomatically&&e.sendViewPageEvent())},o.prototype.sendViewPageEvent=function(e){var n=this;return n.wapoVisitor.getVisId().then(function(s){var o=n.monetaService;o._setOverrideVisId(s);if(e||n.extra)e=t.extend(!0,{},n.extra,e);if(n.getOptOutStatus()!==i){var u={page_url:r.win.location.href+"",publisher_id:n.publisherId,wapo_vis_id:s,extra:e};if(n.computePageData){var a=n.computePageData();for(var f in a)u[f]=a[f]}o.logEvent("view_page",u)}})},o.prototype.getOptOutStatus=function(){var e=this._optOutCookie.get();return u(e)?e:""},o.prototype.setOptOutStatus=function(e){u(e)&&(this._optOutCookie.set(e),this.monetaService.logEvent("set_widget_preference",{preference_key:"pubwidget_personalization",preference_value:e}))},o}),r("wapo/moneta/MonetaLoader",["./MonetaService","./MonetaWidgetParser","lib/jquery","./LoadTime","./legacy/LegacyOptions","./MainScriptParser","./publisher/PublisherService"],function(e,t,n,r,i,s,o){var u={MonetaService:e,MonetaWidgetParser:t,$:n,LoadTime:r,doc:document,win:window,LegacyOptions:i,MainScriptParser:s,PublisherService:o},a=function(e){this.defaultMonetaConfig=e.defaultMonetaConfig,this.sourceVersion=e.sourceVersion,this.scriptName=e.scriptName,this.identityConfig=e.identityConfig,this.monetaService=null,this.widgetParser=null,this.loadDeferred=null,this.legacyOptions=null,this._mainScriptInfo=null,this.publisherService=null};return a.__dependencies=u,a.prototype.load=function(e){e=e||{};var t=this,n=e.monetaConfig,r=!!e.noparse,i=!r,s=!!e.ignoreLegacyOptions,o=!s,a=t.loadDeferred;return a?a.promise():(a=t.loadDeferred=new u.$.Deferred,n||(t._mainScriptInfo=(new u.MainScriptParser(u.doc,t.sourceVersion,t.scriptName)).findMainScript()),o&&(t.legacyOptions=new u.LegacyOptions(u.win),t.legacyOptions.load()),t._makeConfig(n),t.monetaService=new u.MonetaService(t._config),t.widgetParser=new u.MonetaWidgetParser(t.monetaService),t._makePublisherService(e.publisherConfig),t.publisherService&&t.publisherService.init(),t.monetaService.logStartupEvents(),t._finishLoading(i,o),a.promise())},a.prototype._logLoad=function(){var e=this.monetaService;e.logEvent("script_loaded",{app_exec_time:u.LoadTime.appExecTime(),page_exec_time:u.LoadTime.pageExecTime(),page_url:u.win.location.href+""})},a.prototype._makeConfig=function(e){var t=this,n=t.defaultMonetaConfig,r,i;t._mainScriptInfo&&(i=t._mainScriptInfo.data.monetaConfig||{}),t.legacyOptions&&(r=t.legacyOptions.mainConfig||{}),t._config=u.$.extend({},n,r,i,e)},a.prototype._makePublisherService=function(e){var t=this;!e&&t._mainScriptInfo&&t._mainScriptInfo.data.monetaPublisher&&(e=t._mainScriptInfo.data.monetaPublisher),e&&(t.publisherService=new u.PublisherService({identityConfig:t.identityConfig,publisherConfig:e},t.monetaService))},a.prototype._finishLoading=function(e,t){var n=this,r=n.loadDeferred,i=n._mainScriptInfo;e||t?(e&&i&&n.widgetParser._parseWidget(i.$script),n._loadWidgets(n._allScripts,e,t),u.$(u.doc).ready(function(){n._loadWidgets(u.doc.getElementsByTagName("script"),e,t),r.resolve()})):r.resolve()},a.prototype._loadWidgets=function(e,t,n){if(!t&&!n)return;t&&this.widgetParser.parseWidgets(e,!0);if(n){this.legacyOptions.load();var r=this.legacyOptions.widgetOptions;r&&this.monetaService.addWidgetOptions(r,null,!0)}this.monetaService.refreshNewWidgets()},a}),r("wapo/moneta/MonetaTagApi",["lib/jquery"],function(e){var t=function(){},n=function(n,r,i){var s={parseWidgets:function(e,t){if(e===!0||e===!1)t=e,e=null;r.parseWidgets(e,t)},reload:function(e){n.refresh(e)},refresh:function(){n.refreshNewWidgets()},addWidget:function(t){!e.isArray(t)&&t&&(t=[t]),t&&e.each(t,function(e,t){var r=t.div,i=t.immediate,s=t.options||{},o;s.containerId=s.container,s.container=r,o=n.addWidget(s),i===!0&&o&&o.refresh()})},fireViewPageEvent:i?function(e){i.sendViewPageEvent(e)}:t,publisherServiceEnabled:function(){return!!i}};return s};return{makeApi:n}}),r("wapo/moneta/MonetaTagApiLoader",["./MonetaTagApi"],function(e){var t=function(e,t){this.global=e,this.loader=t};return t.prototype.load=function(){var t=this.loader,n=this.global,r=n.getApiObject(),i;return i={monetaConfig:r.config,noparse:r._noparse,ignoreLegacyOptions:r._ignoreLegacyOptions,publisherConfig:r.publisher},t.load(i).then(function(){var i=e.makeApi(t.monetaService,t.widgetParser,t.publisherService);r.moneta=function(){return i},n.apiReady()})},t}),r("wapo/moneta/config/config",["../../pageUtils"],function(e){function n(){var e={BASE_URL:t+"//moneta.trove.com/RevenuePlatform",EVENTS_URL:t+"//event.trove.com/log.php",useCrossDomainDivHack:!0,renderBeforeDomReady:!1};return e}var t=e.getBestProtocol();return n()}),r("wapo/identity/config/config",[],function(){var e=[{name:"Socialreader",idVisitorUrl:"//idvisitor.socialreader.com/identity",identityUrl:"//id.socialreader.com/identity",jsonpParam:"jsonp_callback",visitorCookie:{name:"wapo_vis_id",domain:"socialreader.com",expiry:18250,path:"/"}},{name:"TheRoot",idVisitorUrl:"//idvisitor.theroot.com/identity",identityUrl:"//id.theroot.com/identity",jsonpParam:"jsonp_callback",visitorCookie:{name:"wapo_vis_id",domain:"theroot.com",expiry:18250,path:"/"}},{name:"Slate",idVisitorUrl:"//idvisitor.slate.com/identity",identityUrl:"//id.slate.com/identity",jsonpParam:"jsonp_callback",visitorCookie:{name:"wapo_vis_id",domain:"slate.com",expiry:18250,path:"/"}},{name:"Washington Post",idVisitorUrl:"//idvisitor.washingtonpost.com/identity",identityUrl:"//id.washingtonpost.com/identity",jsonpParam:"jsonp_callback",visitorCookie:{name:"wapo_vis_id",domain:"washingtonpost.com",expiry:18250,path:"/"}},{name:"Trove",idVisitorUrl:"//idvisitor.trove.com/identity",identityUrl:"//id.trove.com/identity",jsonpParam:"jsonp_callback",visitorCookie:{name:"wapo_vis_id",domain:"trove.com",expiry:18250,path:"/"}},{name:"Foreign Policy",idVisitorUrl:"//idvisitor.foreignpolicy.com/identity",identityUrl:"//id.foreignpolicy.com/identity",jsonpParam:"jsonp_callback",visitorCookie:{name:"wapo_vis_id",domain:"foreignpolicy.com",expiry:18250,path:"/"}}],t={wapoSites:e,masterSiteName:"Socialreader"};return t}),r("wapo/moneta/util/AsyncApiGlobal",["lib/jquery"],function(e){var t=function(e,t,n,r,i){this._global=e,this._apiObjectName=t,this._queueName=n||"cmd",this._optIn=!!r,this._processedFlagName=i};return t.prototype._takeOwnershipOfApiObjectIfNecessary=function(e){var t=this._processedFlagName;if(t){if(e[t]===!0)return e=null,!1;e[t]=!0}return!0},t.prototype.init=function(){var t=this._optIn,n=this._global,r=this._apiObjectName,i=this._queueName,s=!1,o,u,a,f,l,c,h;typeof n[r]=="undefined"?t?s=!0:(u=n[r]={},this._takeOwnershipOfApiObjectIfNecessary(u)):(u=n[r],this._takeOwnershipOfApiObjectIfNecessary(u)||(u=null,s=!0));if(!s){o=this._deferred=e.Deferred(),this._apiObject=u,u[i]=a=u[i]||[],h=function(e){typeof e=="function"&&o.then(function(){try{e()}catch(t){}})},f=Array.prototype.splice.call(a,0,a.length),c=f.length;for(l=0;l<c;l++)h(f[l]);f=null,a.push=h,u[i]={push:h}}return!s},t.prototype.getApiObject=function(){return this._apiObject},t.prototype.apiReady=function(){this._deferred&&this._deferred.resolve()},t}),r("wapo/moneta/main/revplat",["../MonetaLoader","../MonetaTagApiLoader","../config/config","../../identity/config/config","../util/AsyncApiGlobal"],function(e,t,n,r,i){var s=new i(window,"monetatag","q",!0,"__processed"),o,u;return u=new e({defaultMonetaConfig:n,identityConfig:r,scriptVersion:"2.4.4",scriptName:"moneta"}),s.init()?(o=new t(s,u),o.load()):u.load(),u}),n(["wapo/wapo-jquery","wapo/moneta/main/revplat"])}()