/* ---------------------------------------------------------------------------------
   file-start: js/scheme/schemius.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/lib/jquery.selectric.min.js 
*/

/*! Selectric ÏŸ v1.8.6 (2014-10-14) - git.io/tjl9sQ - Copyright (c) 2014 Leonardo Santos - Dual licensed: MIT/GPL */
!function(e){"use strict";var t="selectric",s="Input Items Open Disabled TempShow HideSelect Wrapper Hover Responsive Above Scroll",o=".sl",i={onChange:function(t){e(t).change()},maxHeight:300,keySearchTimeout:500,arrowButtonMarkup:'<b class="button">&#x25be;</b>',disableOnMobile:!0,openOnHover:!1,expandToItemText:!1,responsive:!1,preventWindowScroll:!0,inheritOriginalWidth:!1,customClass:{prefix:t,postfixes:s,camelCase:!0,overwrite:!0},optionsItemBuilder:"{text}"},n={add:function(e,t,s){this[e]||(this[e]={}),this[e][t]=s},remove:function(e,t){delete this[e][t]}},a={replaceDiacritics:function(e){for(var t="40-46 50-53 54-57 62-70 71-74 61 47 77".replace(/\d+/g,"\\3$&").split(" "),s=t.length;s--;)e=e.toLowerCase().replace(RegExp("["+t[s]+"]","g"),"aeiouncy".charAt(s));return e},format:function(e){var t=arguments;return(""+e).replace(/{(\d+|(\w+))}/g,function(e,s,o){return o&&t[1]?t[1][o]:t[s]})},nextEnabledItem:function(e,t){for(;e[t=(t+1)%e.length].disabled;);return t},previousEnabledItem:function(e,t){for(;e[t=(t>0?t:e.length)-1].disabled;);return t},toDash:function(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()},triggerCallback:function(s,o){var i=o.element,l=o.options["on"+s];e.isFunction(l)&&l.call(i,i,o),n[s]&&e.each(n[s],function(){this.call(i,i,o)}),e(i).trigger(t+"-"+a.toDash(s),o)}},l=e(document),r=e(window),c=function(n,c){function d(t){if($.options=e.extend(!0,{},i,$.options,t),$.classes={},$.element=n,a.triggerCallback("BeforeInit",$),$.options.disableOnMobile&&L)return void($.disableOnMobile=!0);C(!0);var o=$.options.customClass,l=o.postfixes.split(" "),r=R.width();e.each(s.split(" "),function(e,t){var s=o.prefix+l[e];$.classes[t.toLowerCase()]=o.camelCase?s:a.toDash(s)}),x=e("<input/>",{"class":$.classes.input,readonly:L}),k=e("<div/>",{"class":$.classes.items,tabindex:-1}),T=e("<div/>",{"class":$.classes.scroll}),D=e("<div/>",{"class":o.prefix,html:$.options.arrowButtonMarkup}),y=e('<p class="label"/>'),I=R.wrap("<div>").parent().append(D.prepend(y),k,x),A={open:v,close:g,destroy:C,refresh:u,init:d},R.on(A).wrap('<div class="'+$.classes.hideselect+'">'),e.extend($,A),$.options.inheritOriginalWidth&&r>0&&I.width(r),p()}function p(){$.items=[];var t=R.children(),s="<ul>",i=t.filter(":selected").index();H=S=~i?i:0,(E=t.length)&&(t.each(function(t){var o=e(this),i=o.html(),n=o.prop("disabled"),l=$.options.optionsItemBuilder;$.items[t]={value:o.val(),text:i,slug:a.replaceDiacritics(i),disabled:n},s+=a.format('<li class="{1}">{2}</li>',e.trim([t==H?"selected":"",t==E-1?"last":"",n?"disabled":""].join(" ")),e.isFunction(l)?l($.items[t],o,t):a.format(l,$.items[t]))}),k.append(T.html(s+"</ul>")),y.html($.items[H].text)),D.add(R).add(I).add(x).off(o),I.prop("class",[$.classes.wrapper,$.options.customClass.overwrite?R.prop("class").replace(/\S+/g,$.options.customClass.prefix+"-$&"):R.prop("class"),$.options.responsive?$.classes.responsive:""].join(" ")),R.prop("disabled")?(I.addClass($.classes.disabled),x.prop("disabled",!0)):(j=!0,I.removeClass($.classes.disabled).on("mouseenter"+o+" mouseleave"+o,function(t){e(this).toggleClass($.classes.hover),$.options.openOnHover&&(clearTimeout($.closeTimer),"mouseleave"==t.type?$.closeTimer=setTimeout(g,500):v())}),D.on("click"+o,function(e){Y?g():v(e)}),x.prop({tabindex:q,disabled:!1}).on("keypress"+o,h).on("keydown"+o,function(e){h(e),clearTimeout($.resetStr),$.resetStr=setTimeout(function(){x.val("")},$.options.keySearchTimeout);var t=e.keyCode||e.which;t>36&&41>t&&b(a[(39>t?"previous":"next")+"EnabledItem"]($.items,S))}).on("focusin"+o,function(e){x.one("blur",function(){x.blur()}),Y||v(e)}).on("oninput"in x[0]?"input":"keyup",function(){x.val().length&&e.each($.items,function(e,t){return RegExp("^"+x.val(),"i").test(t.slug)&&!t.disabled?(b(e),!1):void 0})}),R.prop("tabindex",!1),O=e("li",k.removeAttr("style")).click(function(){return b(e(this).index(),!0),!1})),a.triggerCallback("Init",$)}function u(){a.triggerCallback("Refresh",$),p()}function h(e){var t=e.keyCode||e.which;13==t&&e.preventDefault(),/^(9|13|27)$/.test(t)&&(e.stopPropagation(),b(S,!0))}function f(){var e=k.closest(":visible").children(":hidden"),t=$.options.maxHeight;e.addClass($.classes.tempshow);var s=k.outerWidth(),o=D.outerWidth()-(s-k.width());!$.options.expandToItemText||o>s?W=o:(k.css("overflow","scroll"),I.width(9e4),W=k.width(),k.css("overflow",""),I.width("")),k.width(W).height()>t&&k.height(t),e.removeClass($.classes.tempshow)}function v(s){a.triggerCallback("BeforeOpen",$),s&&(s.preventDefault(),s.stopPropagation()),j&&(f(),e("."+$.classes.hideselect,"."+$.classes.open).children()[t]("close"),Y=!0,B=k.outerHeight(),M=k.height(),x.val("").is(":focus")||x.focus(),l.on("click"+o,g).on("scroll"+o,m),m(),$.options.preventWindowScroll&&l.on("mousewheel"+o+" DOMMouseScroll"+o,"."+$.classes.scroll,function(t){var s=t.originalEvent,o=e(this).scrollTop(),i=0;"detail"in s&&(i=-1*s.detail),"wheelDelta"in s&&(i=s.wheelDelta),"wheelDeltaY"in s&&(i=s.wheelDeltaY),"deltaY"in s&&(i=-1*s.deltaY),(o==this.scrollHeight-M&&0>i||0==o&&i>0)&&t.preventDefault()}),I.addClass($.classes.open),w(S),a.triggerCallback("Open",$))}function m(){f(),I.toggleClass($.classes.above,I.offset().top+I.outerHeight()+B>r.scrollTop()+r.height())}function g(){if(a.triggerCallback("BeforeClose",$),H!=S){a.triggerCallback("BeforeChange",$);var e=$.items[S].text;R.prop("selectedIndex",H=S).data("value",e),y.html(e),a.triggerCallback("Change",$)}l.off(o),I.removeClass($.classes.open),Y=!1,a.triggerCallback("Close",$)}function b(e,t){$.items[e].disabled||(O.removeClass("selected").eq(S=e).addClass("selected"),w(e),t&&g())}function w(e){var t=O.eq(e).outerHeight(),s=O[e].offsetTop,o=T.scrollTop(),i=s+2*t;T.scrollTop(i>o+B?i-B:o>s-t?s-t:o)}function C(e){j&&(k.add(D).add(x).remove(),!e&&R.removeData(t).removeData("value"),R.prop("tabindex",q).off(o).off(A).unwrap().unwrap(),j=!1)}var x,k,T,D,y,I,O,S,H,B,M,W,E,A,$=this,R=e(n),Y=!1,j=!1,L=/android|ip(hone|od|ad)/i.test(navigator.userAgent),q=R.prop("tabindex");d(c)};e.fn[t]=function(s){return this.each(function(){var o=e.data(this,t);o&&!o.disableOnMobile?""+s===s&&o[s]?o[s]():o.init(s):e.data(this,t,new c(this,s))})},e.fn[t].hooks=n}(jQuery);
;

/* file-end: js/lib/jquery.selectric.min.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/captcha.js 
*/

!function(a){"use strict";function b(){return"undefined"!=typeof k}function c(){var b=a.Deferred();return"keycaptcha"===LJ.Captcha.current?(b.resolve(),b.promise()):(j?b.resolve(j):LJ.Api.call("captcha.get_public_key",{},function(a){j=a.captcha_public,b.resolve(j)}),b.promise())}function d(){return"solve_media_captcha"===LJ.Captcha.current?"https:"===location.protocol?"https://api-secure.solvemedia.com/papi/challenge.ajax":"http://api.solvemedia.com/papi/challenge.ajax":location.protocol+"//www.google.com/recaptcha/api/js/recaptcha_ajax.js"}function e(d,e){var f=a.Deferred();return e=a.extend(l,e||{}),LJ.Captcha.current?a.when(c(),m()).then(function(){b()?k.create(j,d,e):console.error("Something went wrong. Captcha object is not defined.")}):(f.resolve(),f.promise())}function f(){b()&&k.destroy()}function g(){b()&&k.reload.apply(null,arguments)}function h(){return b()?"keycaptcha"===LJ.Captcha.current?null:k.get_challenge():void 0}function i(){return b()?"keycaptcha"===LJ.Captcha.current?a("#"+window.s_s_c_captcha_field_id).val():k.get_response():void 0}LJ.define("LJ.Captcha"),LJ.Captcha={create:e,reload:g,destroy:f,getChallenge:h,getResponse:i,isDefined:b,responseFieldName:LJ.Flags.isEnabled("solve_media_captcha")?"adcopy_response":"recaptcha_response_field",current:["keycaptcha","solve_media_captcha","recaptcha"].filter(LJ.Flags.isEnabled).shift()};var j,k,l={lang:"ru"},m=LJ.Function.once(function(){var b=a.Deferred();return window.ACPuzzleOptions={onload:function(){k=ACPuzzle,b.resolve()}},"keycaptcha"===LJ.Captcha.current?LJ.Api.call("captcha.get_public_key",{},function(c){var d=LJ.get("page.captcha_field_id")||"capcode";window.s_s_c_user_id=c.user_id,window.s_s_c_session_id=c.session_id,window.s_s_c_captcha_field_id=LJ.get("page.captcha_field_id")||"capcode",window.s_s_c_submit_button_id=LJ.get("page.submitbtn_id")||"createpage_create",window.s_s_c_web_server_sign=c.server_sign,window.s_s_c_web_server_sign2=c.server_sign2,a("#"+d).before('<input type="hidden" name="captcha_type" value='+LJ.Captcha.current+">"),LJ.injectScript(location.protocol+"//backs.keycaptcha.com/swfs/cap.js").then(function(){k={create:function(){},destroy:function(){},reload:function(a){a&&window.s_s_c_onload&&window.s_s_c_onload(a,window.s_s_c_captcha_field_id,window.s_s_c_submit_button_id)}},b.resolve()})}):LJ.injectScript(d()).then(function(){"solve_media_captcha"!==LJ.Captcha.current&&(k=Recaptcha,b.resolve())}),b.promise()})}(jQuery);;

/* file-end: js/captcha.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/scheme/schemius/feedback.js 
*/

!function(a){"use strict";a(function(){function b(){g.addClass("p-feedback"),f=!0,LJ.get("remote")||LJ.Captcha.create("b-captcha",{tabindex:50}),d.bubble("hide")}var c=this,d=a(".s-welcometo"),e=a(".s-do-item-feedback"),f=!1,g=a("body"),h=a(".s-feedback"),i=h.find(".s-feedback-error"),j=h.find(".b-bubble-success-inner"),k={inprogress:"s-feedback-creating",done:"s-feedback-successfully",error:"s-feedback-erroneously"};a(".js-feedback").on("click",function(a){a.preventDefault(),b()}),this.setState=function(a){h.toggleClass(k.inprogress,"inprogress"===a),h.toggleClass(k.done,"done"===a),h.toggleClass(k.error,"error"===a)},h.on("click",".s-feedback-submit",function(b){var d={};b.preventDefault(),c.setState("inprogress"),h.find("input, textarea, select").each(function(){d[this.name]=a(this).val()}),LJ.Api.call("support.create_request",d,function(b){return b.error?(i.html(b.error.message),c.setState("error")):(j.html(a("<a>").attr("href",b.request.url).html(b.request.url)),void c.setState("done"))})}).on("click",".s-feedback-another",function(b){b.preventDefault(),h.find("input, textarea").each(function(){a(this).val("")}),LJ.Captcha.reload(),c.setState(null)}),d.bubble({target:e,showOn:"click",alwaysShowUnderTarget:!0,arrowWidth:"auto"}).on("click",".s-welcometo-action .b-flatbutton",function(a){a.preventDefault(),b()}).on("click",".s-welcometo-switcher",function(a){return a.preventDefault(),LJ.get("remote")?void LJ.Api.call("settings.set_old_design",{value:1},function(){location.reload()}):(LJ.Cookie.setGlobal("ljold",1,{expires:7}),void location.reload())}),g.on("click",function(b){var d=a(b.target);f&&(d.hasClass("b-fader")||d.hasClass("s-feedback-close"))&&(g.removeClass("p-feedback"),f=!1,c.setState(null),LJ.get("remote")||LJ.Captcha.destroy())})})}(jQuery);;

/* file-end: js/scheme/schemius/feedback.js 
----------------------------------------------------------------------------------*/

!function(a){"use strict";function b(){function b(a){return!!(a.ctrlKey||a.metaKey&&LJ.Support.isMac)}function c(a){a&&LJ.Api.call("lang.set",{lang:a},function(){location.reload()})}var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t=a(document.body),u=a(".s-header"),v=a(".s-inline-search-input"),w=a(".s-do-item-search-btn"),x="p-show-search",y=!1,z=a(".s-nav-item-lang"),A="s-nav-item-lang-open",B=function(a){b(a)||(u.toggleClass(x),u.hasClass(x)&&(y=!0,setTimeout(function(){v.focus()},500)))};w.on("click",B),v.on("click",function(){y=!0}),t.on("click",function(){y||(u.removeClass(x),z.removeClass(A)),y=!1}),t.on("gesturestart",function(b){(a("html").hasClass("p-nav-common-menu-open")||a("html").hasClass("p-nav-user-menu-open"))&&b.preventDefault()}),~navigator.userAgent.indexOf("Android")&&a("html").addClass("html-android html-mobile"),(~navigator.userAgent.indexOf("iPhone")||~navigator.userAgent.indexOf("iPad"))&&a("html").addClass("html-ios html-mobile"),~navigator.userAgent.indexOf("Windows Phone")&&a("html").addClass("html-wphone html-mobile"),a("[data-lang]").on("click",function(){c(a(this).data("lang"))}),z.on("click",function(a){b(a)||(a.preventDefault(),z.toggleClass(A),y=z.hasClass(A))}),a(".s-lang-select").selectric({customClass:{prefix:"b-selectus",postfixes:"Input Items Open Disabled TempShow HideSelect Wrapper Hover Responsive Above Scroll",camelCase:!1,overwrite:!1}}).on("change",function(){c(a(this).val())}),a(".b-message-mobile-close").one("click",function(){a(".b-message-mobile").hide()}),p=a(".s-drop-master"),q="s-drop-open",r=LJ.Support.isMobile(),s=!1,r||(o=a(":lj-bubble"),p.on("mouseenter",function(){var b=a(this),c=300;s&&(clearTimeout(n),c=0),n=setTimeout(function(){p.removeClass(q),b.addClass(q),s=!0,o.bubble("hide")},c)}).on("mouseleave",function(){var b=a(this);return s?void(n=setTimeout(function(){b.removeClass(q),s=!1},500)):(clearTimeout(n),void b.removeClass(q))})),r&&(p.on("click",function(b){var c=a(this),d=0!==c.find("li").length,e=a(b.target).closest("span").is(".s-header-journal-menu-item-link-icon");"input"!==b.target.tagName.toLowerCase()&&(c.hasClass(q)||!d||e||b.preventDefault(),c.hasClass(q)||e||(s=!0,p.removeClass(q),b.stopPropagation(),a(":lj-bubble").bubble("hide")),c.toggleClass(q))}),t.on("click",function(b){var c=0===a(b.target).closest(p).length,d=a(b.target).is(".b-popup");d&&(b.stopPropagation(),a(":lj-bubble").bubble("hide")),s&&c&&(s=!1,p.removeClass(q),b.preventDefault())}),LJ.Support.isMobile&&LJ.Support.browser.safari&&t.addClass("iphone"),a(".l-flatslide-menu-active, .l-flatslide-menu-expander").click(function(b){b.preventDefault(),a(this).closest(".l-flatslide-menu").toggleClass("l-flatslide-menu-expanded")}),a(".s-header-search, .s-header-item-search__form").removeAttr("target")),h=a("html"),i=a(".s-body"),j=a(".s-nav-control-common"),k=a(".s-nav-control-user, .s-nav-control-login"),l="p-nav-common-menu-open",m="p-nav-user-menu-open",j.on("click",function(){h.toggleClass(l)}),k.on("click",function(){h.toggleClass(m)}),g=function(){h.removeClass(l),h.removeClass(m)},i.on("click",function(){g()}),a(".s-nav-item-login, .b-loginform-close").on("click",function(b){r||(g(),b.preventDefault(),t.toggleClass("p-loginform"),a("#user").focus())}),a(".b-fader").on("click",function(){t.hasClass("p-loginform")&&t.removeClass("p-loginform")}),a(".lj-openid-auth-button").on("click",function(b){b.preventDefault(),a(".b-loginform").toggleClass("openid-auth-state"),a(".b-loginform").hasClass("openid-auth-state")?a("#openid").focus():a("#user").focus()}),LJ.Event.on("userpic.changed",function(b){a(".s-userpic").css("backgroundImage","url("+b+")")}),!LJ.Flags.isEnabled("ljwelcomevideo")||r||LJ.get("remote")||LJ.Cookie.get("welcome_ljvideo")||0!==LJ.get("remote_is_sup")||a(".appwidget-login").length||LJ.injectScript("http://www.youtube.com/player_api").then(function(){function b(a){(0===a.data||2===a.data)&&d.addClass("s-ljvideo-end"),1===a.data&&d.removeClass("s-ljvideo-end")}var c,d=a(".s-ljvideo");t.addClass("p-ljvideo"),window.onYouTubePlayerAPIReady=function(){c=new window.YT.Player("s-ljvideo-player",{width:"640",height:"360",videoId:"wq0YmQ4xIeU",playerVars:{rel:0},events:{onStateChange:b}})},a(".b-fader, .s-ljvideo-close").on("click",function(){t.hasClass("p-ljvideo")&&(t.removeClass("p-ljvideo"),c.destroy(),LJ.Cookie.setGlobal("welcome_ljvideo",1,{expires:14}))})}),f=a(".s-header .i-supus-new, .s-header-messages-count"),LJ.Event.on("message:count:change",function(a){a>0?(f.html(a),f.removeClass("s-header-messages-count-empty")):f.addClass("s-header-messages-count-empty")}),e=a(".flatquestion-nojs-friendsgroups"),d=a(".flatquestion-popup-field-showanswer"),a(".flatquestion-popup-select").on("change",function(){"custom"===a(this).val()?e.show():e.hide(),"public"===a(this).val()?d.show():d.hide()})}a(function(){0===a(".s-header").length?a("html").on("controlstrip-initialized",b):b()})}(jQuery);;

/* file-end: js/scheme/schemius.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.lj.repostbutton.js 
*/

LJ.UI.registerTemplate('templates-CleanHtml-PaidRepost', "<span class=\" b-flatrepost repost-button {{if $data.reposted}} b-flatrepost-reposted {{/if}} {{if $data.count}} b-flatrepost-counted {{/if}} {{if $data.budget || $data.cost}} b-flatrepost-gained {{/if}} {{if $data.owner}} b-flatrepost-disabled {{/if}} {{if $data.login}} b-flatrepost-disabled {{/if}} \" ><a href=\"javascript:void(0);\" data-href=\"{{html $data.url}}\" class=\"b-flatrepost-name\" title=\"{{if $data.reposted}}{{html LJ.mltext(\'entry.reference.label.title\')}}{{else}}{{if $data.login}}{{html LJ.mltext(\'repost.button.title.login\')}}{{else}}{{if $data.owner}}{{html LJ.mltext(\'repost.button.title.myown\')}}{{else}}{{html LJ.mltext(\'repost.button.title\')}}{{/if}}{{/if}}{{/if}}\" ><span class=\"b-flatrepost-gain\" title=\"{{html $data.budget}}{{html LJ.mltext(\'paidrepost.button.title.curr\')}}\" >{{if !$data.owner}}+{{html $data.cost}}{{else $data.budget}}{{html $data.budget}}{{/if}}</span></a><span class=\"b-flatrepost-counter\" title=\"{{html LJ.mltext(\'repost.button.counter\')}}\" >{{html $data.count}}</span></span> ", 'JQuery.stat');
LJ.UI.registerTemplate('templates-CleanHtml-Repost', "<span class=\" b-flatrepost repost-button {{if $data.reposted}} b-flatrepost-reposted {{/if}} {{if $data.count}} b-flatrepost-counted {{/if}} {{if $data.budget}} b-flatrepost-gained {{/if}} {{if $data.owner}} b-flatrepost-disabled {{/if}} {{if $data.login}} b-flatrepost-disabled {{/if}} \" ><a href=\"javascript:void(0);\" data-href=\"{{html $data.url}}\" class=\"b-flatrepost-name\" title=\"{{if $data.reposted}}{{html LJ.mltext(\'entry.reference.label.title\')}}{{else}}{{if $data.login}}{{html LJ.mltext(\'repost.button.title.login\')}}{{else}}{{if $data.owner}}{{html LJ.mltext(\'repost.button.title.myown\')}}{{else}}{{html LJ.mltext(\'repost.button.title\')}}{{/if}}{{/if}}{{/if}}\" ><span class=\"b-flatrepost-gain\" title=\"{{html $data.budget}}{{html LJ.mltext(\'paidrepost.button.title.curr\')}}\" >{{if !$data.owner}}+{{html $data.cost}}{{else $data.budget}}{{html $data.budget}}{{/if}}</span></a><span class=\"b-flatrepost-counter\" title=\"{{html LJ.mltext(\'repost.button.counter\')}}\" >{{html $data.count}}</span></span> ", 'JQuery.stat');
LJ.UI.registerTemplate('templates-CleanHtml-reposted', "{{if $data.content}} {{each ($value.users || $data.users)}}{{if !((!$index) && !($value.dropComma || $data.dropComma))}}, {{/if}}<a href=\"{{html ($value.url || $data.url)}}\">{{html ($value.user || $data.user)}}</a>{{/each}} {{else}} <div class=\"b-reposted-popup\"> <div class=\"b-reposted-popup-header\">{{html LJ.mltext(\'repost.popup.head\')}}</div> <div class=\"b-reposted-popup-content b-reposted-popup-load\"></div> <div class=\"b-reposted-popup-footer\"><a href=\"javascript:void(0);\">{{html LJ.mltext(\'repost.popup.footer\')}}</a></div> </div> {{/if}} ", 'JQuery.stat');
!function(a){"use strict";a.widget("lj.repostbutton",a.lj.basicWidget,{options:{classNames:{active:"repost-button-active",inactive:"repost-button-inactive",popupLoad:"b-reposted-popup-load",popupNomore:"b-reposted-popup-footer-hide",repostError:"repost-error"},selectors:{counterParent:".lj-button-c",button:".lj-button-b",counter:".lj-like-item-count",buttonLink:".lj-button-link",popupContent:".b-reposted-popup-content",popupFooter:".b-reposted-popup-footer",popupMore:".b-reposted-popup-footer > a"},templates:{popup:"templates-CleanHtml-reposted"},url:"",reposted:!1,cost:0,budget:0,paid:!1},_create:function(){this.options.classNames={active:"b-flatrepost-reposted",inactive:"b-flatrepost-disabled",popupLoad:"b-reposted-popup-load",popupNomore:"b-reposted-popup-footer-hide",repostError:"repost-error"},this.options.selectors={counterParent:".b-flatrepost-counter",button:".b-flatrepost-name",counter:".b-flatrepost-counter",buttonLink:".b-flatrepost-name",popupContent:".b-reposted-popup-content",popupFooter:".b-reposted-popup-footer",popupMore:".b-reposted-popup-footer > a"},a.lj.basicWidget.prototype._create.apply(this),this.options.url||console.warn(this.widgetName,": no url in options, initialization won't continue"),this._journal=LJ.get("currentJournal"),this._count=null,this._remote=LJ.get("remoteUser"),this._reposted=this.options.reposted,this._el("buttonLink"),this._href=this.element.find(this._s("button")).data("href"),this._href=LJ.Util.Journal.parseLink(this._href)||{},this._canRepost()||(this.element.addClass(this._cl("inactive")),this._buttonLink.removeAttr("title"),this._lock()),this._popup=null,this._popupContent=null,this._popupLocked=!1,this._lastUser=null,this._el("counterParent"),this._el("counter"),Number(this._counter.html())||this._hideCounter(),this._bindControls()},_hideCounter:function(){this._counterParent.addClass("empty")},_showCounter:function(){this._counterParent.removeClass("empty")},_bindControls:function(){var b=this;this.element.on("click",this._s("button"),this._onUpdateButton.bind(this)),this._counterParent.one("click",function(){Number(b._counter.html())&&(b._popup=b._tmpl("popup"),b._el("popupFooter",b._popup),b._popupContent=b._popup.find(b._s("popupContent")),b._popup.bubble({showOn:"click",align:"side",alwaysShowUnderTarget:!0,target:b._counterParent}).on("bubblehide",function(){b._lastUser=null,b._popupContent.empty(),b._popupFooter.removeClass(b._cl("popupNomore"))}).on("bubbleshow",function(){b._loadRepostedList()}).on("click",b._s("popupMore"),b._loadRepostedList.bind(b)),Function.defer(function(){b._popup.bubble("show")}))}),a.lj.basicWidget.prototype._bindControls.apply(b)},_loadRepostedList:function(a){var b=this;a&&a.preventDefault(),this._popupLocked||(this._popupLocked=!0,this._popupContent.addClass(this._cl("popupLoad")),LJ.Api.call("repost.get_list",{url:this.options.url,last:this._lastUser},function(a){b._popupContent.removeClass(b._cl("popupLoad")),b._popupLocked=!1,a.error?b._handleAnswer(a):(b._render(a.users,a.nomore,a.count),b._lastUser=a.last)}))},_render:function(a,b,c){var d=this;a.length>0&&d._tmpl("popup",{content:!0,dropComma:!!d._lastUser,users:a}).appendTo(d._popupContent),this._updateCounter(c),b&&d._popupFooter.addClass(d._cl("popupNomore"))},_onUpdateButton:function(a){this.locked()||this.toggleRepost(),a.preventDefault()},_handleAnswer:function(a){if(a.hasOwnProperty("delete")&&(a.message&&this._showMessage(a.message),this.paid!==Boolean(a.paid)||this.paid&&this.cost!==a.cost))return void this.element.replaceWith(LJ.Social.renderRepostButton(this.options.url,a));if(a.error){if(a.error.message&&this._showMessage(a.error.message),a.error.data)return void this.element.replaceWith(LJ.Social.renderRepostButton(this.options.url,a.error.data))}else this._updateButton(!this._reposted);!a.hasOwnProperty("count")&&a.hasOwnProperty("delete")&&(a.count=this._count-1),this._updateCounter(a.count),this._unlock()},_showMessage:function(b){var c=a("<div />",{"class":this._cl("repostError"),text:b}).bubble({target:this.element,align:"center",hide:function(){c.remove()}}).bubble("show")},_updateButton:function(a){this._reposted=a,this.element.toggleClass(this._cl("active"),this._reposted)},_updateCounter:function(a){"undefined"!=typeof a&&(this._count=Number(a),this._counter.html(this._count)),Number(this._counter.html())?this._showCounter():this._hideCounter()},_canRepost:function(){return LJ.get("preview")?!1:this._remote?LJ.get("remote_is_identity")?!1:this._remote===this._href.journal?!1:!0:!1},toggleRepost:function(){var a=this,b={url:this.options.url};this._canRepost()&&(null===this._count&&(this._count=parseInt(this._el("counter").html(),10)||0),this._lock(),this._reposted?LJ.Api.call("repost.delete",b,function(b){b.error||b.reposted||a._journal!==a._remote||location.href.match(/\/(friends|times|feed)\b/)?a._handleAnswer(b):location.reload()}):(b.timezone=LJ.Util.Date.timezone(),this.options.paid&&(b.cost=this.options.cost),LJ.Api.call("repost.create",b,this._handleAnswer.bind(this))))}})}(jQuery);;

/* file-end: js/jquery/jquery.lj.repostbutton.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/threeposts.js 
*/

!function(a){"use strict";a(function(){function b(){var a=3,b={7:4,8:4,9:3};return a=b[s]>0?b[s]:s}function c(){var a=1;if(y>E)return a=1;if(s>=2){a=Math.floor(E/y),a>s&&(a=s);var b=s%a;if(b>0)if(s%(a-1)===0)a--;else if(s%(a+1)===0)a++;else if(1===b){var c=E/(a+1);c>=z&&a++}}return a}function d(){E=l.width(),B=A>E?c():b(),e(E/B)}function e(a){var b=[150,300,330,400,500,600,800],c=["xxs","xs","s","m","l","xl","xxl"];b.forEach(function(d){a>d&&(D=c[b.indexOf(d)])})}function f(){l.find("."+u).removeClass(u),"xs"===D&&w.each(function(){var b=a(this).find("."+t),c=b.get(0).getClientRects().length;2>c&&a(this).addClass(u)})}function g(a){return q.get(a).scrollHeight}function h(){if(0===x&&r.height()>0){q.height("auto");var a=q.map(g),b=Math.max.apply(Math,a);q.height(b)}}function i(){E=l.width();var a=[400,600,800,1e3,1200,1400],b=["xs","s","m","l","xl","xxl"];a.forEach(function(c){E>c&&(C=b[a.indexOf(c)])}),d(),j()}function j(){var a=k+"--size-"+C,b=k+"--items-in-row-"+B,c=k+"--item-size-"+D,d=m+"\n"+a+"\n"+b+"\n"+c;l.attr("class",d),l.attr("data-item-layout",D),n.hide(),o.show(),h(),f()}var k="threeposts",l=a("."+k),m=l.attr("class"),n=a(".placeholder-threeposts"),o=a(".threeposts__items"),p="threeposts__item",q=a("."+p),r=a(q.get(0)),s=q.length,t="threeposts__title-inner",u="threeposts__item--short-title",v="threeposts__item--pic",w=a("."+v),x=w.length,y=235,z=200,A=1200,B=3,C="xxs",D="xxs",E=l.width();i(),a(window).resize(LJ.Function.debounce(i,50))})}(jQuery);;

/* file-end: js/threeposts.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.lj.ljcut.js 
*/

!function(a){"use strict";var b=[];a.widget("lj.ljcut",a.lj.basicWidget,{options:{journalid:null,ditemid:null,cutid:null,placeholders:0,sticky:!1,selectors:{expand:".ljcut-link-expand",collapse:".ljcut-link-collapse",collapseLink:".ljcut-pseudolink-collapse",stickyLink:".b-sticky-cut-link"},classNames:{preloader:"ljcut-link-expanding",expanded:"ljcut-expanded","sticky-cut-visible":"b-sticky-cut-visible",cut:".b-sticky-cut"}},_create:function(){a.lj.basicWidget.prototype._create.apply(this),this._window=a(window),this.cut=a(this._cl("cut")),this._stickyCollapseHandler=this._collapse.bind(this),this.content=null,this._isMac=/Mac/.test(navigator.userAgent),this._isOpera=/Opera/.test(navigator.userAgent),this._collapseNode=a('<span class="ljcut-pseudolink"><span class="ljcut-decor"><span class="ljcut-pseudolink-collapse">{close}</span></span></span>'.supplant({close:this._ml("collapse")})),this._bindControls(),this._id=b.length,b[this._id]=!1},_bindControls:function(){var b=!1,c=[this._s("expand"),this._s("collapse")].join(", ");a.lj.basicWidget.prototype._bindControls.apply(this),this.element.on("click",this._s("expand"),this._expand.bind(this)),this.element.on("click",this._s("collapse"),this._collapse.bind(this)),this.element.on("touchstart",c,function(){b=!0}),this.element.on("touchmove",c,function(){b=!1}),this.element.on("touchend",c,function(c){b&&(a(c.target).trigger("click"),c.preventDefault())}),a(document).on("keydown",this._shortcuts.bind(this)),this._window.on("scroll",this._scrolling.bind(this))},_shortcuts:function(a){var b=this._isMac&&this._isOpera?a.metaKey:a.ctrlKey,c=a.altKey;if(b&&c){switch(a.which){case 61:case 187:this.expand();break;case 173:case 31:case 109:case 189:this.collapse()}a.preventDefault()}},_togglePreloader:function(a){this.element.toggleClass(this._cl("preloader"),a)},_toggleContent:function(b,c){var d,e=this;!this.locked()&&this.content&&(this._lock(),"function"!=typeof c&&(c=a.noop),this.element.toggleClass(e._cl("expanded"),b),b?this._showContent(c):(d=this.element.offset().top-30,this.element.is(":screenable")?this._hideContent(c):a("body,html").animate({scrollTop:d},300,function(){setTimeout(e._hideContent.bind(e,c),50)})))},_showContent:function(a){var b=this;this.content.show(50,function(){b._trigger("show",null,b),a(),b._unlock()})},_hideContent:function(a){var b=this;this.content.slideUp(50,function(){b._trigger("hide",null,b),a(),b._unlock()})},_requestContent:function(b){var c=this;this._lock(),this._togglePreloader(!0),LJ.Api.call("event.get_lj_cut",b,function(b){c.content=a("<div />",{html:b.text}).hide(),c.element.after(c.content),c._unlock(),c._togglePreloader(!1),c._toggleContent(!0,c._addHandlers.bind(c)),b.counter_image_url&&LJ.Stat.addCounter(b.counter_image_url)})},_addHandlers:function(){this.content.ljLikes(),LJ.Event.trigger("social:widgets:parse")},expand:function(){this.locked()||(this.content?this._toggleContent(!0):this._requestContent({journalid:this.options.journalid,ditemid:this.options.ditemid,cutid:this.options.cutid,placeholders:this.options.placeholders}))},collapse:function(){this.locked()||(this._toggleContent(!1),this._toggleStickyClass(!1))},_expand:function(a){return a.metaKey||a.ctrlKey?!0:(a.preventDefault(),void this.expand())},_collapse:function(a){return a.metaKey||a.ctrlKey?!0:(a.preventDefault(),b[this._id]=!1,void this.collapse())},_scrolling:function(){this._updateStickyCutState()},_updateStickyCutState:function(){var c,d,e,f,g,h,i;this._isExpanded()&&this.options.sticky&&this.content&&(c=this._window.height(),d=a(document).scrollTop(),e=this.content.height(),f=this.content.offset().top,g=f+e,i=this.element.find(this._s("collapse")),h=d>f&&g-c>d,b[this._id]=h,this._toggleStickyClass(h))},_toggleStickyClass:function(c){this.cut.toggleClass(this._cl("sticky-cut-visible"),b.indexOf(!0)>-1),c?a(document).on("click",this._s("stickyLink"),this._stickyCollapseHandler):a(document).off("click",this._s("stickyLink"),this._stickyCollapseHandler)},_addBottomCollapser:function(){return!this._bottomCloser&&this.options.sticky&&(this._bottomCloser=this._collapseNode.appendTo(this.content),this._bottomCloser.find(this._s("collapseLink")).on("click",this._bottomCloserClickHandler.bind(this))),this._bottomCloser},_bottomCloserClickHandler:function(){event.preventDefault(),this.collapse()},_isExpanded:function(){return this.element.hasClass(this._cl("expanded"))},_isCollapsed:function(){return!this._isExpanded()}})}(jQuery);;

/* file-end: js/jquery/jquery.lj.ljcut.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/entry/main.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/string.js 
*/

!function(){"use strict";LJ.define("LJ.String"),LJ.String.pad=function(a,b,c){if(a=a.toString(),"undefined"==typeof b)throw new Error("You should provide padding string length");if("undefined"==typeof c)throw new Error("You should provide padding symbol");if(a.length>=b)return a;for(;a.length<b;)a=c+a;return a.length===b?a:a.slice(-b)},LJ.String.capitalize=function(a){var b;if("string"!=typeof a)throw new Error("You should provide string as argument");return b=a.length,0===b?a:1===b?a.toUpperCase():a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()},LJ.String.linkify=function(a){var b=new RegExp("^(?:([a-zA-Z]+):)?//"),c=/^[a-zA-Z]+:/,d=/^:\/\//,e=c.test(a)?"":"http://";return b.test(a)?a:e+(d.test(a)?a.replace("://",""):a)},LJ.String.smartSplit=function(a,b){return"undefined"==typeof b&&(b=","),a.split(b).map(function(a){return a.trim()}).filter(Boolean)},LJ.String.encodeHTML=function(a){var b={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"};return a.replace(/([<>&\"\'])/g,function(a,c){return b[c]?b[c]:c})}}();;

/* file-end: js/core/string.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/editor/basicToolbar.js 
*/


/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/api.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/messages.js 
*/

Site.page.template['angular/ljMessages.ng.tmpl'] = '<div\n    class=\"b-msgsystem-wrapper b-msgsystem-wrapper-fixed\"\n    ng-class=\"{\'b-msgsystem-wrapper-ontop\': directive.top }\"\n    ng-hide=\"directive.messages.length === 0\"\n    >\n    <div\n        ng-repeat=\"message in directive.messages\"\n        class=\"b-msgsystem b-msgsystem-type-{{message.type}}\"\n        ng-animate=\"\'b-msgsystem\'\"\n        >\n        <header\n            class=\"b-msgsystem-head\"\n            lj-html=\"message.title\"\n            ng-if=\"message.title\"\n            ></header>\n        <div class=\"b-msgsystem-wrap\">\n            <div class=\"b-msgsystem-body\" lj-html=\"message.body\"></div>\n        </div>\n        <span class=\"b-msgsystem-close\" ng-click=\"directive.close(message)\">\n            <span class=\"b-msgsystem-close-text\" lj-ml=\"component.messages.close\"></span>\n            <span class=\"b-msgsystem-close-ctrl\" lj-ml=\"component.messages.close\" lj-ml-attr=\"title\">&times;</span>\n        </span>\n    </div>\n</div>\n';
LJ.injectStyle('/* System Message\n----------------------------------- */\n.b-msgsystem-wrapper {\n    width: 100%;\n    height: auto;\n    }\n    .b-msgsystem-wrapper.b-msgsystem-wrapper-fixed {\n        position: fixed;\n        top: 0;\n        left: 0;\n        z-index: 5000;\n        overflow: hidden;\n        padding: 0 0 10px;\n        }\n\n    .g-sensor .b-msgsystem-wrapper.b-msgsystem-wrapper-fixed,\n    .mobile-msg .b-msgsystem-wrapper.b-msgsystem-wrapper-fixed {\n        position: static;\n        padding: 0;\n        background-image: none;\n        }\n\n    /* open popup */\n    .flatpopup-open .b-msgsystem-wrapper.b-msgsystem-wrapper-fixed {\n        z-index: 5001;\n        }\n\n    /* on top */\n    .b-msgsystem-wrapper-ontop.b-msgsystem-wrapper.b-msgsystem-wrapper-fixed {\n        position: absolute;\n        top: 60px;\n        z-index: 4998;\n        }\n    .flatpopup-open .b-msgsystem-wrapper-ontop.b-msgsystem-wrapper.b-msgsystem-wrapper-fixed {\n        z-index: 5001;\n        }\n\n.b-msgsystem {\n    position: relative;\n    min-height: 50px;\n    padding: 10px 140px 10px 120px;\n    font: 14px/1.357 Arial, Helvetica, sans-serif;\n    }\n    .b-msgsystem DD,\n    .b-msgsystem DT,\n    .b-msgsystem TH,\n    .b-msgsystem TD,\n    .b-msgsystem P,\n    .b-msgsystem DIV,\n    .b-msgsystem LI,\n    .b-msgsystem PRE,\n    .b-msgsystem CODE,\n    .b-msgsystem KBD {\n        font-size: 100%;\n        }\n    .b-msgsystem .i-ljuser-userhead {\n        vertical-align: top !important;\n        margin: 3px 0 0 0;\n        }\n.b-msgsystem:after {\n    position: absolute;\n    bottom: -10px;\n    left: 0;\n    display: block;\n    content: \'\';\n    width: 100%;\n    height: 10px;\n    background-image: -webkit-linear-gradient(top, rgba(53, 99, 161, 0.3), rgba(53, 99, 161, 0));\n    background-image:    -moz-linear-gradient(top, rgba(53, 99, 161, 0.3), rgba(53, 99, 161, 0));\n    background-image:      -o-linear-gradient(top, rgba(53, 99, 161, 0.3), rgba(53, 99, 161, 0));\n    background-image:   linear-gradient(to bottom, rgba(53, 99, 161, 0.3), rgba(53, 99, 161, 0));\n    -webkit-background-size: 10px 10px;\n         -o-background-size: 10px 10px;\n            background-size: 10px 10px;\n    background-position: 0 100%;\n    background-repeat: repeat-x;\n    }\n    .b-msgsystem-head {\n        margin: 0 0 0.357em;\n        padding: 0;\n        font-size: 1.142em;\n        font-weight: bold;\n        }\n    .b-msgsystem-wrap {\n        line-height: 50px;\n        min-height: 50px;\n        }\n\n    .b-msgsystem-head ~ .b-msgsystem-wrap {\n        line-height: inherit;\n        min-height: 0;\n        }\n\n    .b-msgsystem-body {\n        display: inline-block;\n        vertical-align: middle;\n        line-height: 1.571;\n        font-size: 1em;\n        color: #787878;\n        }\n    .b-msgsystem-intext {\n        margin-bottom: 2em;\n        }\n\n.b-msgsystem .i-ljuser-username,\n.b-msgsystem .i-ljuser-username:link,\n.b-msgsystem .i-ljuser-username:visited {\n    color: #0051B7 !important;\n    }\n.b-msgsystem .i-ljuser-username:hover,\n.b-msgsystem .i-ljuser-username:active {\n    color: #C00 !important;\n    }\n\n.b-msgsystem-type-error {\n    background: #FFEFEF no-repeat 2.7em 50% url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA7CAYAAADFJfKzAAAKeElEQVRo3tVbCVBURxp2ACMBRWaiOICCIMQDLFDjuaWGxERDUmYVIpaKEl1dN0aN1xrRoBDBAwwi4m0irhpjJB4rri7GI2q5luJ9gMageAAKiJwCwr/9U/9QPc17MwOZgbGrvpqZ9/r//++b7v67X7/3mjUzXVEQLARYchDPaWxei8KLs2JozvAGQwsGaw5vCr9bUL3mZMeLN3uB1jP9PlReXRjpn/HtqsjHUXFJWcvjr+asWJv1dMXaF89WJgB+4m88juexHtZHO/oDzEq4guuWSKwFI/rW7bBlkx5FrT6as3zNy6cr4qG+QDu0Rz/oj1q9OdftFY0tUiO0RmRswBine0uil2VHxeXmLFsDxgL6Q7/onxPdaGNbwXXXNzo7qFumLYqambU0Nj87cjWYCsz/c4yD8WhsW5m6lfnWtE6eOsvnQXhM6pOlsdBYwHgYlxvTJhGs4MamTercsAmPwmMKH0esAl14unE7FBw9AaU30qDiSQ68KiyCqrKXgAU/8Tcex/NYD+vr84lxMT7y4MaywthCsfvYXp8fvuThkuhqBpBD/sEjUJHzDBpS0A7tdfnH+MgD+RAvowjWEnprfvjazLAVIAckWfWyHIxR0E/+waOgKx7jE28swVpCL81eFHF/0TKQwpO1W6H8cRaYoqBf9C8XG3n9WcF8MrI9M23epIzQyGoGEJHFxhlUVYNJC/OPcaTiI6/T0+Z+ToLrnbR4oTY7Rof0+X1+eOm9+REgIu/wMWjMgvGkeDB+hVsDx73DJS2DBStoHrN2smutvDX7m0t35y0BEbnJKdAUBeNK8WE8L3u2cVDRtGRliFhNq2L/b3V6yqy56bPDQERm/BZoyoLxpXid+fvsUORN/PW2bm33ndx7QMebM0Of3/5qIfDIWJUAUF3dpGKhqgr+WBkPIjfGtwB5C91ZZ/bFNajdyYnTo25OXwAiyh49AXMoZZmPQIof8kb+pEM2Oys0rern5uF09Yt5eden/RN4PN6VBOZUHv+YBCJH5I38udZVyHXhmlbdP/rzyVenzgERr0rLzEos8pHiyfhP4VrXQi4D4w6C6mzIlymXJ88CHpmJuw1bBBQVw7nl38HeT0bBLyPHwpVN26CqolL/MGR1sC7aoC36QF96k1XiTyByZfyPoQ7SUyczaxJTy37OLh0uTpzxMnXiDOBRcv+h3sCVpaWwa7A/rGnrroWDY/+mO6mxc1hHtENfFSUlOmOWPHgIIlfkP8jFzQX1SCUqC5qfWm/xHznqQsg04HFj4VKDWvXKxh/qENbg/q+nZO3wnJwd+tRXbiyMBJEz6kA9pMtCsgsfCgiOPR88FXg82LHHILEp0+fJkr4Yt17W7sLqdbJ26FNfQX4iZ9Qh1ZU1WRjXlm1TPptw5NyYycAj73yqQWL/tyJWlnT63gOydnhOzu7cslX6l5GMn8gZdaAebs2saMavmBjUxwNDbp8JmgQ8ijMyDRJb9CQbNr3dsw7hf/UfApVl8pkcz2Ed0Q59oU99pfh+JoicmY401COsqGqnHOzfTicDJuT+FhgCPMoLXhi+dr2dDvsCx0O82hMS2neFwxOnQXF2jn7CrM7hSV/W2KAt+kBfBs0Aefkgcj4RMD4H9ZCuFrxYHMT2DM4nRgRXnBwRDDwMmTqadL4tKQWR8/G/jitGPaSrNklZ0g/cnO5wfPgYEPE6FCneqId01RGLmcsl5eOgimMfBwGPqooKsxZayVpW5JziP6qYxGou+yw1Yt/UiD08NCDv6LBA4FGeX2DWYl/m5oHIOXnoyKeoh5t+LOu07IH3h6f954MRwOPF73+YtdjCexkgcmY60uVatnbM7h44LCX5veHAI+vU2T+3nZJ2F65uSYRfZ4fC/s8mwJ6hI2uA3/EYnsM6DS3IT+SMOqTGrFY23tTHL+Hfgz8BHjfiN9d/V5BtgF9evxW2931PdsEgIrGPH1xatwXKXxTWKxbyEzmjDqlsrDXPLujWM+TAwI+Ax/HxUw2PzBb117ftgs2de2kJWd/RG3YOHAb7Ro6DQ8FTaoDf8RieExcT6KOa7UgYlIkZP5Ez6pCbZ2tXUK42rbyTBnxQ/suAD4HH83T93ayUTe4HgkJqCG/o5AP//WIOpP28DwoyHui96sE6WBdt0BZ97B8VUuNTV0FeIlfk36mlXXepFZTW2pjBfVuvQaf29n0feKRG6l6jFrHN7MTe78KeYQFwZ98heFXe8DsDaHtn/yH42T+wxmeRjq0g5CVyRf6oQ2ptrHXVgxl5cWffOXveYcQFVMpcW5Y+y63plpknTxt/J5H5RN8Yo+78WgJSPJG/MO1oXcDXXs/ioG5vbeOz03fg8909BgGPC99GSxLKTr0CVZWvTLeZyHznXL5W99JwaQyIHJE38qfkVOd6VmungsGBoVNMl54bd/n8BUTkp90xi7k172YaSPFD3sifdEjuVGi6so2mK/dopeyf6NX3xQ7vfsDjMEsaTV0wSycHBIPIjfEtRN5cF7aRuztQu7vI4Mjgubhjt6jtXfuAiCNjJzepWIwvxSvCzSsaeRN/2d1FrbsBDPiUimsLC4vu6z19b25jc6aIizFrmkQoxpXis8HT95atpSVON67E31bXXQGtOwI0R3kMV6lHbPXoUfa9Rw8QcWFlXKMKxXhSPLZ4+Bb7K9t9Sq2qNuSOgNi6Klpbdp3l6B661d2nmgFEHGJjuPpVlWnHKPOPcaTiI69ZavevkSe38Nd7r6fOXTzKaG4M3mFOHhs3s2WdFJI+CoBn126aRCj6Rf9ysb9x6oRrYG/i6VCfu3ha92dpnlJTKveJcPTYubFDN5DDb18vYbv4RUYRWcHuBpxeEA664jE+O5AX8VNz86pVfW5G891ZSRM0jgffUIeOCRucu1QzgBxOzl0E+ekNu2RDO7TX5R/jIw8S6kkLfmVD7rzXeaaCxkGt4H8onUPXOnqWrHN8G3Rhz5BP4UxYJNw9kAxPr92A4qzs2ss3/MTfeBzPn10cVVNfn0+Mi/E5oc7Er0HPVEg+LUPpXCPYx8/GPjDGwf12QjsPaCxgPIwrI9S4jweRYycaI97NFYo+M+wdo+Mc3ArjHdzBVGD+izAOxqNk1Il4GE2onGAlJQM3Sve+7s2th8y3d/4htk3HgjVt3MBYQH/M7zZP5p/F6UHx3Ci+0thCJZ9dpKzXluY1DwYvhp5tLK0GT2nlELHUvv351SrX8jiVK9QXzK4C7dEP+kO/5N+D4rWl+CZ5dlHyqVSaz1T0L7vSGPKiFujdxsLq3SAb1cy5durvF7d2Or7cvv2daPsOud8pXUpWK10AP/E3HsfzWG+0jeortEN78uNFfl0pjorimvSpVMnnjenftaPk5UhXGzieutDY8mXoReT7MvRj6M+hHx3vTfV8ya4L+XEhv29RHJvGet5Y9klyGjt29M+3oyzpQlsjnkS+G7UUiulOn150vAvVcyc7Z/KjIr+2TfEkuc53BOifb0ljSkXjS02Z05nGXAcSpPnuTOfVVF9F9q3IX5O+I2DQ2x+092NLpFvT/q2SxGigpOMacbbcazBm/dqLwkTv9bwWLzWZ3Rtb/weCZK6FTFk50QAAAABJRU5ErkJggg==\');\n    color: #CB1427;\n    }\n    .b-msgsystem-type-error + .b-msgsystem-type-error {\n        border-top: 1px solid #FFDFDF;\n        }\n.b-msgsystem-type-warning {\n    background: #FCF8E3 no-repeat 2.7em 50% url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA7CAYAAADFJfKzAAAJyUlEQVRo3tVbDVRUxxVmWUAEREHFBSpEhUarFrXRiCdHkxxzmkSt1arxaKMSlJrE+IPWvwRUBEzCUWKAClYDFhNrqoBRTBQDgpQ2AWUNsqIYDQqKAiIEEBC5nUvvcmaH93YXw8I653wH9u3ce79vZ+bOvHnzLCxMVxQESwFKDuJ3WpunovDirBisGWwYejHYcugtfO5F9azJjhdv9gJtVwZMcVJnbnj9+oUtYaUFIUdva0Ivll8Ou3O3KKzm3pVwwL/4Ga/j91gP66Md/QBmJVzBdUsk1mtVwJT+mpxN/qUF206VX97eeLcoFDoLtEN79IP+qNWtuW6v6G6RWqFtIiNDZ7ldy/1gx53CkMpyzXboKqA/9Iv+OdHdNrYVXHe1edbLxUGTs3FV2aWt928XbgNTgfmvxjgYj8a2lalbmW9N29QvlvqU5AedLyvYAt0FjIdxuTFtEsEKbmza5aWtXnxLHVRbejEI9OHulWh4UHYSGqoLoLnhNrQ018DjloeABf/iZ7yO32M9rG/IJ8bF+MiDG8uKrhaK3cf+h7OBW2/mv9/KAHKoupkMzQ/L4UkK2qG9Pv8YH3kgH+LVJYJ1hBZmBUaXnN8EcqgqSWYt1ghdUdAP+tMXj/GJ6irBOkIvpL0XciN3PUihrDASmupLwRQF/aJ/udjI65cK5pORfdaxAP8fv1vXygAiyjQxAK2PwaSF+cc4UvGRV2bKMj8S3OmkxQu1S4yaM6H434EN13ICQURlyQnozoLxpHgwfrX7ds56jktaRgtW0Dxm6zaoj1NhxooLV7NXgYiKn76CnigYV4oP45nvPaS/M01LVsaI1bYq9v8+WUl+64qyVoCIEnUk9GTB+FK8ziX7bUbexN9g67Z332ULxj1zKf3tak3GO8Djet6HOIh6VCyO4eu5YSByY3wfIG+hO+vNvrgGdcz48s3wS2f+AiIe1t4EcygNtSUgxQ95I3/SIZudFdpWfdHX0039jX/VD6eXAo9SzT/AnEqpJhFEjupT/lXIn2tdhVwXbmvV5L2zl6m/9gMRLY8azEos8pHiyfgHcK1rKZeBcQfBOfvIgrQLJxYBj5KL+8EcC/ISuTL+Z1AH6emQmbWJyWHiWNfBuSkLG/OOLQQe9Q9uGBW8/EYuJEW8AjHL+0DsigFwer8fG18VRozBe2110QZt0Qf6MlSQl8gV+U8e7+6BeqQSlSXNT33/vmPqvO+T5wOPgjPrjBJ6/3YRxL47AKID7HVwKOR51uWa9HTHprY6ol3sioFtPg2Vgm//CiJn1IF6SJelZBc+vnd65H+PzAUeP6kTjBKbnvguRAXYSeLHfPlFSPH5JFk79GmoID+RM+qQ6sraLIxry4Gn42d8k3N4NvCovPUfo8Qe+2QmRC2zk4T6TLSsnTotStYOfRpcRjJ+ImfUgXq4NbPCgl8xMajSD8y4nP3FTOBRd/+6UWJzkoIZwd6SKC3KlLW7VXRW1g59Gip11TdA5Mx0FKEeYUXVPuVg/3bLODCtMjNxOvBoelht5ERfAQkbnoVPl9rqIPVvbxi0TY2Z18EOfRmT3BrrK0HknJ4w7S7qIV29eLE4iPsxuKfHv9qckfAq8Hjc0tyJlU0FnDu8Hg6HvgBHP57a1n1bH7cYvll//KitLtqgLfowRiiWR831IHJOj/99HeohXe1JSkkfcHN68Lf7XwERT0OR4o16SFcHsZi5PE7Hvdyctvdl4NGZlu2J8qipHkTOp+NeqiOx2ts+pVZsb63YkzGTq07tmQI8mhrum7XYxroKEDmnRk++h3q46UfZoWVTIicVnYx+AXjUVFw1a7G1FcUgcmY6rsi1bPuYPRT+XNqJ3ROBx53idLMWi/xEzqhDaszqZOO4zb+N+WrXeOBx6ewusxaL/ETOqEMqG+vMs5sWD12SEjEOeKTHzzUY8Fpeikmhd5nK+ImcUYfcPNu+gvJ0tR119EOfpqSPfIBHdfllvQF3LVKYFHIFeYlckf8w996jpVZQOmtjhqEJQSMyj4SPAh7nU7foFbvzTQuTQq4gL5Er8kcdUmtjnbsezMhb3vJce3j7CBDxqKnOzObXOpDiifyFaUfnBr79fhYH9a9cbHwOBntXH9r6a+Dx/fEgsxKbezwYRI7IG/lTcupwP6uzU8HgwjAs4m2PuM+DhoGI+3c0ZiG0qqwApPghb+RPOiR3KrRd2U7blcd62/kmbPKsSXz/GeCRGjOjx4W2sn3jE1GvgciN8a1F3lwXtpN7OtC+u8jgyuAdvEgVfmCjB4j4OvZPPSoW40vx2rZEFYG8ib/s7qLO0wAGPKXi2ctaMXrParfChPXuICLvZFiPCMW4UnxiV7tp7G0tcbrxJP72+p4K6DwRoDnK6w++DrP2B6oefrZWBSJyT4R2b0Ji8aR47AtU1b0+wX4mtarKmCcCYus609pyxJrZ/TbvW+PSygAijn86w6ib81/2aKelLY5UfOS1ela/jciTW/gbfNbT4SkeZbQhDKOCF/SN27uyP0jh6EeToeKm2jSPKJlf9C8X+4P5fXENPIp4unTmKZ7O81map1SUyn1CFjp+HrfCCeSQdWgN26+q7RKRzY0/w7l/BoK+eIzPQeRF/FTcvGrVmYfRfHd2ogkax8OYTXPtY/a849jKAHI4e/A9qLr9ZPMx2qG9Pv8YH3mQUG9a8Ds9yZP3DmcqaBy0C17+mu3mqACH+pjlDqAPh0MnQfaXG6A49wjcK8lnW55lbNej5v8HQ9hf/IzX8fvsf21sq2/IJ8bF+JxQd+L3RGcqJE/LUDrXCvZ5abTVnIglvS9Hs1377gLGw7gyQrv2eBA5dqMxMsraymLCymk2Ebvfsq2NYvu8pgLz/zPGwXiUjIYRjy4TKifYiZLBEEr3Y4YOUkxd/0fr+F1+Ng92+9tAVwH9Mb8JXq6WU1mcsRRvCMV36mqhkmcXKesNpHnNi2Ekw7gBjoopAVOVIdvnW30XucSq6RM/K+gsmF0z2qMf9Id+yb8XxRtI8U1ydlHyVCrNZ870K3vSGBpJLTB+QB+LF+f5Wq5aO93ys+A5yvQdC5RXI/6srNy5SFkfuVgJ+Bc/43X8Huu9MclyNdqhPfkZSX49KY4zxTXpqVTJ88b06zpS8nKluw0cT8NpbI1h+B2Rf55hIoMvh4l0fTzVG0N2w8mPB/ntT3Hsuuu8sexJcho7jvTLD6Is6UFbI95E/jfUUihmNP0dSdeHU72hZOdOfpzJr31PnCTX+44A/fIONKacaXypKHO605gbTIK0/7vT9yqq70z2fchfj74jYNTbH7T3Y0+k+9L+rROJ0cKJrmvF2XOvwZj1ay8KE73X81S81GR2b2z9DzRDXz0l+Xs9AAAAAElFTkSuQmCC\');\n    color: #C09853;\n    }\n    .b-msgsystem-type-warning + .b-msgsystem-type-warning {\n        border-top: 1px solid #F9F1C7;\n        }\n.b-msgsystem-type-success {\n    background: #DFF0D8 no-repeat 2.7em 50% url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA7CAYAAADFJfKzAAAKXElEQVRo3tVbCVRV1xX1MwsIgkoRFBwgscikBkTSRq2miRpjnIixDkkVMdYposUhMgq2tQaM4JCotUZNamNjTDROC61jspyXAxqJKAoEBRFkRjh9m5zPujze+/9j+YCXtdfnv3vPOXv/e++5901t2hivaBgmMpgKkNdpbZ6LIoozk2AuwUKCpQQrAW1l3y25nTnbieJbvUCrQfMGOSy+vHh4dEZ0fFxW3O74nPjLCbkJOQkPEgpXPlxJ+MR3HEc92qE97PgHaFXCNcKwBDFLiWiHZWnLpsXdjzsYnxtfLgmixgJ2sIcf+ONeNxeGvaa5RWqF1oocnTjGZXl65Mq4nBV5K36Op6YC/MEv/Auim21ua4ThauH0opPtkrRl82Ky4x7F5qwgY0HyX4A4iMdz28zYvSz2ptWMfTP8Iu9GnY/JjqXmAuIhrjCnjSJYI8xN6wXnw6dG3Y8uisqKIV1Y92ADfff4AF0pvUrZldlU+LSIyqrLCAWf+I7jqEc7tNfnE3ERHzyEuaxpaqEYPjbhVyKiP7wXXSOB1PDVo730c2UuPUuBHex1+Ud88AAf5tUkgusLvR6RvDQzktQAkuXV5dQUBX72SP50xZP4rG0qwfWEzruwIHbxnQ9JCWuyk+l+RRYZo8Av/KvFBq//V7CYjGzCTsyetuj2shoJJEdK9idULf0Zs8A/4ijFB68Zx2e/x4IbnbREodbjt08MDE9fUhr+0xKS49v8A9ScBfGUeEj8isZsDnlJSFoGC9bwOmbVzsXOYc71hRfm34ogOb7J208tURBXiY/E82IHz46OvCyZGSJW26sY/+2mnXh/4dybi0iOpMwUasmC+Eq8pp2ctRS8mb/e3q0bvn1D+3ebdS284E9pC0nEXzOSqEb6a8mCOZxw+yOSc5P4PgZv2XDWmX2xB7WbciwsYea1BSTHvbL71BrK3bJ7pMQPvMGfdahmZ422V90H93CZfnlefuiV+STis6x/UWsqn2XtIjlH8AZ/oXc1akO4tlfH7pkc+sfLc0mO0qelrUos+CjxlPjPEHrXRC0D4wqC4x9OhR2eenE2idicuYNaY9mSuZPkXCX+R6CD9TTIzNrEZNs5qGvXSedmlU86P4tEZJRkGhS8qKKYYs6k0OB/v0uv7Q6l5Es7qLK6Sq8d2qAtbGALH/Clr9yReMm5gn+XV7q5QY9SojLh9cl+6KZRIe+cDSMRi67GGCS0pKqMXtoxnizX+NXD6L1zdGZw1KGN3A6+iiv1T50/S/zknKEDeliXieIQHvntxMSQH0JJxNa7hiWmtRe3NyCsxaE7p1TtUKdmB5/6CvjJOUOH0lDWZmHsLTu9eWjygbGnp5GIM3nnDBIbejhSlfTfzm5WtUOdmt30Q8v1xgU/OWfogB5hz6xpI+6YJDiPTJ2S9tbJ90jE7eK7BomN+369KunPb6hvL1GnZhd9Ollv3IziTJJzlnTcgB7ZjqpuycH4dhlxbEreG8enkoiCikKDxGY9yaXOG19pQNhn2ygqrVI/z0Ud2sjt4As+9ZW8ikck5zzi6JRc6GFdlqJYTOL2ElyHHZ1cOezYZBJhSDbVlqt5t2j4V2Fk/XEfsk8OpIn7F1JO8UO9dmiDtrCBLXzAl0GJUVpv5ZxfT51UDD2sqy5JmfIXXJzu+vvUiSTH81CUeEMP62ogFpnLbcihCZVDDk8gEZXVla1aaElVKck5/+7Q28UsVnvaZ6oV21YrduD+8fmDDoaQiEcVj1u12Ifl+STnPHDfuAfQIyw/pg16Nvjr0Td+8904EvFjYUarFnurKIPknCUdN9V6tm7OBnzxxuEB+8aQiKM5Z1q1WPCTc4YOpTlbLxv7bnw1JXDvWyTio6ubdQZLzfye8suMN9TzSgtqY6gV8JNzhg6lbFxvne25JODdfntGkoiQ1Nk6yZQ9La/d2yZd2KZzPW30KZzkCz7hGzHUCvjJOUOH2jpbt4Nq627n7b97eIX/f0aQiLSCdJ3EsGHHGYvLJwNrdz3pBZnPLBK28AFf8KnrZAC85FzB37qnvY/SDqre3lhCD6+tQ//r8+UwEhF1Psmg07SIE6vrdkCBO0No6clE+jo9le4UZlFV9dMGNjiGOrRBW9ho7eFL34YGvORcwR86lPbG9c56kJHdowLCvXa9RnIUVxl2peJM9iUK+nxCg+0fdkZunw4hzy2v1wL/45i8HWxPZ1/UGwd8lHiCv2zZqXcCX3c+i0lt2cXW74UdQwte/OJVErH8bKLBQxHnqEfunqEJ+8LJIaW/6kZfC7RBW9gYevUy8mwSyTmCN/hzcmpwPlvvSoUEJwk93f4etNFj5xCS4/qj9EbPQSSXE/fPUcqlnbVDc+aRmFrgfxxDna4EpFSu5N8kJX7gDf6sQ/FKhXYoW2uHsnWfDgO6/XNQYfftg0nEyP1hLb6uVtfU0PB900nOTeJbBN7CELZWuztQd3VRQmcJns5RfRLctg0kOcYemN2iYhFfiZdzbN9V4M38Va8u1rsbIAFPqbhrLE19XNYHX3Pd+luSI/7chhYRirhKfFw2BF83sTHDcuPO/G103RWod0eA1ygP2ze7jnbe/HKZ85aXSY4VZ9c1q1DEU+LhvCm42GZ4l1Hcq86G3BGQ964j7y1/3f4Dr6VOm4JrJJAcI7+ZSU9rjHt/Fv4RRyk+eLWf77UYPIWNv957PQ3u4nFG6y7B2z7Sd2OHT4NICa/snkyXHqYZRSj8wr9abPvlPtgDezNPp8bcxat3f5bXKWdO5X52sb47HDYGkho+OL7SoAvbhpQnlSW04MRfSFc8ic928GJ+zsK6ataYm9HicHbgBRrzwd92iVeK/fqAGgmkhjnHVlBa/k/PJBJ2sNflH/HBg4V68obf4VnuvDd4poLnQZ1gq/c9ltom9y2xXdePdCF41zsUcXI1fXnrIF18kEZZxblUWPGkVhQ+8R3HUb/41Ora9vp8Ii7iC0Jdmd8zPVOh+LQMp3OtYD+zwU7j2q7yS7NO7kvNBcRDXBWhTft4EDt24Tni3cbcJNBirscqqzV+RVZr/cloWOP3BHEQj5NRT+bRZELVBDtwMujO6d5f08NmqHnEC/+wSPR9bPGxHzUZJH+S360mnrZDpTh9OF53ju/Q1EIVn13krNeJ1zUPCb0l9NV0tBhoNqNbrHmc1w/mib4V5km+1Ggk+lbCHn7gD37ZvwfH68TxjfLsouJTqbyeOfKv7M5zqDf3QECbjhaDTEJc55mEe2wxjeyVarqy94+mq7zzTFd7l5gm+lDtJ77juFSPdiZvu86HXa39L356s193juPIcY36VKri88b869px8urMZxuYT714bvlL6Mfk+0sIkjBAQBAfD+B2/mzXi/24sd8OHMe6uZ43Vn2SnOeOHf/yv+Is6caXRjyZvBf3FMT48GdvPt6L2/VgO1f248h+bVriSXKd7wjwL2/Lc8qR55czZ05XnnNdWZD2f1eud+b2jmzfjv216DsCBr39wdd+bJi0PV+/dWAxWjjwca04G+E1mFb92ovGSO/1PBcvNbW6N7b+B2yJlhtD2EeEAAAAAElFTkSuQmCC\');\n    color: #468847;\n    }\n    .b-msgsystem-type-success + .b-msgsystem-type-success {\n        border-top: 1px solid #BFE1B1;\n        }\n.b-msgsystem-type-info {\n    background: #D9EDF7 no-repeat 2.7em 50% url(\'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADsAAAA7CAYAAADFJfKzAAAK6UlEQVR42tVbCVBUVxYdQEVpINIsQRgQUeLKgNEYnZpKdEonVpwJbnEdt3JEGQ0uDGNEBhQ3iEbcUFBBUVR0BEFBURBQxJEgMSibK6Ls0Cwt0NAsd96lXpvfrz/dSNE0OVWnoLv/u/ec/9677/3fv3+nRmhRajPU4ZD5jLb5LYAx14ewL2E/Ql3C/hwOYF7r0uP6YjvGfK832H/ywvVGHuGZX/tcy9+1K64oYs+tkkzfhLIS34TyWr/bFYB/8TW+j5/jcXg8tsP2/MY1b1KHCtMlQo09I3JX7owrvLk7vqxxT0I5fCixHbbHOBgP49L4Oj1rmp2L1OQcN38L7+iXe3bdKq0kYqG7iPEwLsaXme7Jua3FGa79zAYP1996OW/9jriSqp03S0FdJPGrMQ/mw7yYX629zPRmf+eDsQ7eMQUZPnHF0FPEfJhXNqe7zTAAmBKuIAwhfNDW1pbR0tISVltbu9b3araL9/VC8bYbRaCMx+6VQ1xuDWQVN0BxrRTEkhaQSFsBgX/xNb6Pn+NxeLyqmJh3U1jGMiJRjzOXtbpqchBhGChBDREZk1UNXrFveRn9uArKxFLoArAdtmdjsmxzD3+yjcgV4LDukmEAWEpYAQTNLa1w7eFLWHfyNkzb/l+Y4nURXILiIe5RPsiQXlAHntfevGdUZhU0NrdCNwDjoGkam5/uF3MOd8kwAAQBRVTac/jDplAwWnqElyuP3mw/GYjQtDI4nFwMhTVNoA5gXIzvcfU1LzeE/ezDGlZldA4QtLS2wfqQRDSkktsv3QdEYXUTkGZqBcYPTCmB76Py+djmcjxlBTWsumgBwAEg8DiXImfIZHkA/HV3JKwhw9d+o3xPm688BrUNTdCTiM0SgXvkS0VGvBDP8Qwej0VLpWEAcAaC0KTs92am74iAF6XVIAMaG+8eJmf41i+voacR86QS3C4/V+CG8JxHxlZ2Qros9VFmdiRhMxAE3HgEc/dehabmFkC8KG+AjAIxIPyvZciZPXc3FzSBQ4lvYMOlpwpcFXTPg9gxwPmrqncnAIO0V9VNruG5cD6tGBBhd3PkzN5+XACaAM5hv7hXgNq4/O5Cds14p1U2zHDmhVZDQ8NEiUTiLZVKE+4/LU1eez4bkElPRYDAosQ1K3onAU2hQCRBbQpccTR5N/FiSKirrDpr0bOhZ/PpFIvVZzJFa8KeAPJNlQQQk70uvjeK666mcS6tCPXJcfXZTBHq5/Qur1ltejYM5/lGrXIOzQSkZ2QuIN5UiOV6FeevptHQ1IIaFUj0O3N6V5uvV/vQOwjCpYGp8StPPQJkSEoBILAYcc3mvBVBR3iUXw6eF+7BuhO32wteTX0jqML9vCLYEpbSvmM7Hv8Y6iRS6AxOp75BnXIk+hPQB/pRqMycqxl9i9ETrZaffNi4PDgDkHFPygCB4mVGjZcFtG9A+BB4KxOEy+Q3ICNdT9FljB97ItMUNi24zJVU14EqvK6sR51yRP1WDl9Yox++QqVN16ePvtp8ct6SE+kgY1JeBSBwZ8XdbOB2kUVBhRg/491xzfSLBj78kl/e4S7tH2Rb2hlsuZyFWuWIPtAP9aXNO4Rn+sb4LwpMAxkvpxcCwu/KT3JC0p6VAAt2aWJ3Y208g+FgTEaHbezWBkNncCa1ALXKEX2wQ5lbhQWEprN/jI+bf/R/IKNPdDYg7mS/VXnWo3960aFwK+cg4EPw7ScdtnF0OwOdwYOXItQqR/SBftAXtypr0x2HAaH5LP+k3LlHUkHGBcfuAwJ75QvP8HYR49zPwglSRFhgURn+XQiv8M1n7wIfymvqwXr1cd42OJo6g/yKOtQqR+IjD/3I76jokkPHt8VM/+TKWQfvApeya9S8QhE8eFaMxpVWYodNoQqjoFHaAh3hXm4RjHD99SRhgdt4KokWQdUQvWsCVvNM/6Qy9IO+ZEsQtzgNJLT8Zn+S9Bv/ZOBS2tLK9iAuRTgEeSsmHo9LSWzGK3hZWtPJi/UWuJtTCNd/ftW+pn8I6sl6y2r+2/7EOvSDvrhFSoe+MCK0mrEvEViyRrlXP8PWnoS3lWLQNPh0ox/0xWdWSGg93S9eOv2HBOCS27N4W4adW7hOag7Ys83Aav7KL76OmhVSfzoyswNkZqfuviGa5nsLuKyqa5Kbk6zZH6LSQZOoEDcCq3nqruvl6Iez/Ogo9OzkbdF5f951A7h8XloLXHiFp8p2SXgzjpwMCWgSL8rEwGomPp6yPaswZ/+4JTz+yx2xwOWd3BJgUVZTj8UHK7PGgfpYzeiDmbOK1Xi86/GAP227BlweisuC3gzUx2pGH0w1Vlxnh8/bsnySVzRwufhIouotW3K2WqkMqI/VjD7YdVZhB6VnZjNmwtbIpgmeV4DLvGKl6yXOX7WyI6AuVivqFwwaas/uoBT2xoS2DhtC74zbEgFc7ojM6JVmURerFfWjD3ZvrHDVQ2g9bKG3m+PmS8CyrrEZehNQD59O1I8+2KsehetZQsv+Jr93GON2rtrePRy43H45HXoTfCLSgdWIulE/+mCuZxXvVBCaEQ4dumJf0Ci388Ayt6gKegOy3oqATx/qRv3og71TwV7A68mGsr7t2EmfrA+tHb4xDLic/eN10DRayeLutDcWWG1Erxh1c4awHjOEFe8uEg4itLOa573bzvUMsFxwIA40CczPp8t6gc9e1E31895dZIeyHqEx4WCtvrr2Ns6B2bbrQoGlX3QGaAKYl0+PjXNQjrauwB51U/0CdgizQ1mH07vmhMMGjneaZeMSIrH55ylg6Rv1EHoQmI/mZugSXPfR2K+daK+a830joKp3hXRvOdJ0xkYPqzXBbYTAcva+GHpHQX3A+JiHLz/qIvq+R51Ur1Dldz0UWsyOyoxwCOEYs7leQZarTwAfp+2IgMyCClAHMC7G7yi32Zz/BKA+qtOsU9/isZWZs+6a01LuYDLP55z5qiDoiO7kpppY0gTdgXcSKfw7LAWU5SN6wlAX1WeOetnvZ1WaZYazEaElnQ+OQiePALOVgW2E0BE3nk6GvC6ux9gO2yuLj/lRBxqluixQp+pv3lUbFhAKuYYNp7p4mCw7Um+y4igo42TvS7D1/D24kvYcMl+XQ3FV3ftHE/Avvsb38XPPC6ntx6uKiXkxP8eoJdUn6IpRtjr3o4GMOYYd+o+aMtdo0b5c4fIA6CliPszLGlX+tEzXDWNgCzpHxmjp9J2g/xfXvQOXHBQPXHoY1EUS/x3mwXyYl+a3UGa0uwwb0WIwhJZ7Rx0z26mCGZtPGS72rzFccgi6ixiPxD3d52O7qSTPWJpvCM1v1L1GWcO0aNGqZ0rXtWGEowk/1TYw+XLAFGcf/bk70wwWH2gy+PtB+FCSdlJsj3EwHsal8YfRfKaYn312Ua1PpdL1TEjP8mA6h0bTHviMCJ2sO2H++gHT/xWi5+SdqPet7zPB/L2VgoX76wWLDgD+xdf4Pn6Ox+l+vmADtsP2GIfGs6PxzWk+A/ap1B553pieXUNavAYRWtP5NILOLUfCcVT854QTCSdxOJG+/xk9zpG2G0HjWNO4xjSPHvu8cY8/SU7njiE98x8TWlKhttgzVPwo7Clqxp7+HU3fH0GPs6XtLGkcIY0r4HuSXKO/EaBnXh/nFBVqSoefBTVgRWnN+d+Sfm5OjxfS9gYYj+83Ar3u1x/03o8ARVPxA2kFFXJohO9zzAloO03/+kO1aXX8rkdDJn/7v9j6P5SDt02QcYOYAAAAAElFTkSuQmCC\');\n    color: #3A87AD;\n    }\n    .b-msgsystem-type-info + .b-msgsystem-type-info {\n        border-top: 1px solid #B3DBEF;\n        }\n\n.b-msgsystem-close {\n    position: absolute;\n    right: 0;\n    top: 50%;\n    width: 100px;\n    margin: -0.714em 0 0;\n    padding: 0 2em 0 0;\n    text-align: right;\n    cursor: pointer;\n    -webkit-user-select: none;\n       -moz-user-select: none;\n        -ms-user-select: none;\n            user-select: none;\n    color: #000;\n    }\n.b-msgsystem-close:hover {\n    color: #C00;\n    }\n    .b-msgsystem-close-text {\n        border-bottom: 1px dotted;\n        }\n    .b-msgsystem-close-ctrl {\n        margin: 0 0 0 0.1em;\n        vertical-align: middle;\n        font-size: 1.3em;\n        }\n\n\n/* xs-size screen (45em) ~ 630px */\n@media all and (max-width: 45em) {\n    .b-msgsystem {\n        padding: 10px 50px 10px 44px;\n        background-position: 10px 10px;\n        -webkit-background-size: 24px;\n             -o-background-size: 24px;\n                background-size: 24px;\n        }\n\n    .b-msgsystem-close {\n        position: absolute;\n        top: 0;\n        right: 0;\n        bottom: 0;\n        margin: 0;\n        width: 50px;\n        }\n        .b-msgsystem-close-text {\n            display: none;\n            }\n        .b-msgsystem-close-ctrl {\n            position: absolute;\n            top: 50%;\n            left: 50%;\n            margin: -0.6em 0 0 -0.2em;\n            text-shadow: 0 -1px 0 rgba(255, 255, 255, 0.5);\n            font-size: 1.7em;\n            color: rgba(0, 0, 0, 0.5);\n            }\n}\n\n/* Toggle */\n.b-msgsystem {\n    top: 0;\n    opacity: 1;\n    -webkit-transition: 0.3s top, 0.3s opacity;\n       -moz-transition: 0.3s top, 0.3s opacity;\n        -ms-transition: 0.3s top, 0.3s opacity;\n         -o-transition: 0.3s top, 0.3s opacity;\n            transition: 0.3s top, 0.3s opacity;\n    }\n.b-msgsystem-enter,\n.b-msgsystem-leave {\n    top: -100px;\n    opacity: 0;\n    }\n\n@media print {\n    .b-msgsystem-wrapper {\n        display: none;\n        }\n}\n');
//= require_ml component.messages.close
!function(){"use strict";angular.module("LJ.Messages",["LJ.Templates","LJ.Directives"]).run(["$compile","$rootScope",function(a,b){angular.element("div[lj-messages]").length<1&&a("<div lj-messages></div>")(b).appendTo("body")}]).factory("Messages",[function(){function a(a){return-1===g.indexOf(a.type)||h[a.body]?void 0:(h[a.body]=!0,f.push(a),e)}function b(){return f.length=0,h={},e}function c(a){return f=f.filter(function(b){return b!==a}),delete h[a.body],e}function d(){return f}var e,f=[],g=["error","info","success","warning"],h={};return e={get:d,add:a,remove:c,clear:b},LJ.get("messages")&&LJ.get("messages").forEach(a),g.forEach(function(b){e[b]=function(c){"string"==typeof c&&(c={body:c}),c.type=b,a(c)}}),e}]).directive("ljMessages",["$timeout","Messages",function(a,b){return{templateUrl:"ljMessages.ng.tmpl",scope:!0,controllerAs:"directive",controller:["$scope","$document",function(c,d){function e(){a(function(){f.top=d.scrollTop()<=62})}var f=this;d.on("scroll",e),this.messages=b.get(),this.close=b.remove,c.$watchCollection(b.get,function(a){f.messages=a}),c.$on("$destroy",function(){d.off("scroll",e)}),e()}]}}])}();;

/* file-end: js/core/angular/messages.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/activity.js 
*/

!function(){"use strict";function a(a,b){function c(){return f}function d(a){f=a}function e(){b.cancel(g),d(!0),g=b(d.bind(this,!1),9e5)}var f,g;return e(),a.on("click touchstart touchend keydown mousemove mousewheel",LJ.Function.debounce(e,100,!0)),{isActive:c}}angular.module("LJ.Activity",[]),angular.module("LJ.Activity").factory("Activity",a),a.$inject=["$document","$timeout"]}();;

/* file-end: js/core/angular/activity.js 
----------------------------------------------------------------------------------*/

angular.module("LJ.Api",["LJ.Messages","LJ.Activity"]).factory("Api",["$timeout","$cacheFactory","$rootScope","$q","Messages","Activity",function(a,b,c,d,e,f){"use strict";function g(a,b){return"undefined"==typeof b?a:a+JSON.stringify(h(b))}function h(a){if(!angular.isObject(a))return a;var b={};return Object.keys(a).sort().forEach(function(c){b[c]=h(a[c])}),b}function i(a,b){l.remove(g(a,b))}function j(b,h,i,j){var k,m,n=d.defer(),o={cache:!1,silent:!1,meta:!1},p=!1;return f.isActive()?(("object"!=typeof h||null===h)&&(h={}),"object"==typeof i&&(j=i,i=null),j=angular.extend(o,j||{}),m=g(b,h),j.cache&&(k=l.get(m),k&&(p=!0)),p||(k=n.promise,LJ.Api.call(b,h,function(b){a(function(){b.error?n.reject(b.error):n.resolve(b),c.$apply()},0)}),j.cache&&l.put(m,k)),LJ.Event.trigger("api:request:change",b,!0),k.then(function(){LJ.Event.trigger("api:request:change",b,!1)}),j.silent||k.then(function(a){var b=a.message;"undefined"!=typeof b&&(b.body=b.content,e.add(b))},function(a){"undefined"!=typeof a.message&&1!==a.code&&e.error({body:a.message})}),j.meta&&(k=k.then(function(a){return{response:a,fromCache:p}})),"function"==typeof i&&k.then(i),k):(n.reject(),n.promise)}var k={call:j,invalidate:i},l=b("LJApiPromises");return k}]);;

/* file-end: js/core/angular/api.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/autocomplete.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/lib/jquery-ui/jquery.ui.position.min.js 
*/

/*! jQuery UI - v1.8.24 - 2012-09-28
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.position.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.ui=a.ui||{};var c=/left|center|right/,d=/top|center|bottom/,e="center",f={},g=a.fn.position,h=a.fn.offset;a.fn.position=function(b){if(!b||!b.of)return g.apply(this,arguments);b=a.extend({},b);var h=a(b.of),i=h[0],j=(b.collision||"flip").split(" "),k=b.offset?b.offset.split(" "):[0,0],l,m,n;return i.nodeType===9?(l=h.width(),m=h.height(),n={top:0,left:0}):i.setTimeout?(l=h.width(),m=h.height(),n={top:h.scrollTop(),left:h.scrollLeft()}):i.preventDefault?(b.at="left top",l=m=0,n={top:b.of.pageY,left:b.of.pageX}):(l=h.outerWidth(),m=h.outerHeight(),n=h.offset()),a.each(["my","at"],function(){var a=(b[this]||"").split(" ");a.length===1&&(a=c.test(a[0])?a.concat([e]):d.test(a[0])?[e].concat(a):[e,e]),a[0]=c.test(a[0])?a[0]:e,a[1]=d.test(a[1])?a[1]:e,b[this]=a}),j.length===1&&(j[1]=j[0]),k[0]=parseInt(k[0],10)||0,k.length===1&&(k[1]=k[0]),k[1]=parseInt(k[1],10)||0,b.at[0]==="right"?n.left+=l:b.at[0]===e&&(n.left+=l/2),b.at[1]==="bottom"?n.top+=m:b.at[1]===e&&(n.top+=m/2),n.left+=k[0],n.top+=k[1],this.each(function(){var c=a(this),d=c.outerWidth(),g=c.outerHeight(),h=parseInt(a.curCSS(this,"marginLeft",!0))||0,i=parseInt(a.curCSS(this,"marginTop",!0))||0,o=d+h+(parseInt(a.curCSS(this,"marginRight",!0))||0),p=g+i+(parseInt(a.curCSS(this,"marginBottom",!0))||0),q=a.extend({},n),r;b.my[0]==="right"?q.left-=d:b.my[0]===e&&(q.left-=d/2),b.my[1]==="bottom"?q.top-=g:b.my[1]===e&&(q.top-=g/2),f.fractions||(q.left=Math.round(q.left),q.top=Math.round(q.top)),r={left:q.left-h,top:q.top-i},a.each(["left","top"],function(c,e){a.ui.position[j[c]]&&a.ui.position[j[c]][e](q,{targetWidth:l,targetHeight:m,elemWidth:d,elemHeight:g,collisionPosition:r,collisionWidth:o,collisionHeight:p,offset:k,my:b.my,at:b.at})}),a.fn.bgiframe&&c.bgiframe(),c.offset(a.extend(q,{using:b.using}))})},a.ui.position={fit:{left:function(b,c){var d=a(window),e=c.collisionPosition.left+c.collisionWidth-d.width()-d.scrollLeft();b.left=e>0?b.left-e:Math.max(b.left-c.collisionPosition.left,b.left)},top:function(b,c){var d=a(window),e=c.collisionPosition.top+c.collisionHeight-d.height()-d.scrollTop();b.top=e>0?b.top-e:Math.max(b.top-c.collisionPosition.top,b.top)}},flip:{left:function(b,c){if(c.at[0]===e)return;var d=a(window),f=c.collisionPosition.left+c.collisionWidth-d.width()-d.scrollLeft(),g=c.my[0]==="left"?-c.elemWidth:c.my[0]==="right"?c.elemWidth:0,h=c.at[0]==="left"?c.targetWidth:-c.targetWidth,i=-2*c.offset[0];b.left+=c.collisionPosition.left<0?g+h+i:f>0?g+h+i:0},top:function(b,c){if(c.at[1]===e)return;var d=a(window),f=c.collisionPosition.top+c.collisionHeight-d.height()-d.scrollTop(),g=c.my[1]==="top"?-c.elemHeight:c.my[1]==="bottom"?c.elemHeight:0,h=c.at[1]==="top"?c.targetHeight:-c.targetHeight,i=-2*c.offset[1];b.top+=c.collisionPosition.top<0?g+h+i:f>0?g+h+i:0}}},a.offset.setOffset||(a.offset.setOffset=function(b,c){/static/.test(a.curCSS(b,"position"))&&(b.style.position="relative");var d=a(b),e=d.offset(),f=parseInt(a.curCSS(b,"top",!0),10)||0,g=parseInt(a.curCSS(b,"left",!0),10)||0,h={top:c.top-e.top+f,left:c.left-e.left+g};"using"in c?c.using.call(b,h):d.css(h)},a.fn.offset=function(b){var c=this[0];return!c||!c.ownerDocument?null:b?a.isFunction(b)?this.each(function(c){a(this).offset(b.call(this,c,a(this).offset()))}):this.each(function(){a.offset.setOffset(this,b)}):h.call(this)}),a.curCSS||(a.curCSS=a.css),function(){var b=document.getElementsByTagName("body")[0],c=document.createElement("div"),d,e,g,h,i;d=document.createElement(b?"div":"body"),g={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},b&&a.extend(g,{position:"absolute",left:"-1000px",top:"-1000px"});for(var j in g)d.style[j]=g[j];d.appendChild(c),e=b||document.documentElement,e.insertBefore(d,e.firstChild),c.style.cssText="position: absolute; left: 10.7432222px; top: 10.432325px; height: 30px; width: 201px;",h=a(c).offset(function(a,b){return b}).offset(),d.innerHTML="",e.removeChild(d),i=h.top+h.left+(b?2e3:0),f.fractions=i>21&&i<22}()})(jQuery);;

/* file-end: js/lib/jquery-ui/jquery.ui.position.min.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/lib/jquery-ui/jquery.ui.autocomplete.min.js 
*/

/*! jQuery UI - v1.8.24 - 2012-09-28
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.autocomplete.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){var c=0;a.widget("ui.autocomplete",{options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null},pending:0,_create:function(){var b=this,c=this.element[0].ownerDocument,d;this.isMultiLine=this.element.is("textarea"),this.element.addClass("ui-autocomplete-input").attr("autocomplete","off").attr({role:"textbox","aria-autocomplete":"list","aria-haspopup":"true"}).bind("keydown.autocomplete",function(c){if(b.options.disabled||b.element.propAttr("readOnly"))return;d=!1;var e=a.ui.keyCode;switch(c.keyCode){case e.PAGE_UP:b._move("previousPage",c);break;case e.PAGE_DOWN:b._move("nextPage",c);break;case e.UP:b._keyEvent("previous",c);break;case e.DOWN:b._keyEvent("next",c);break;case e.ENTER:case e.NUMPAD_ENTER:b.menu.active&&(d=!0,c.preventDefault());case e.TAB:if(!b.menu.active)return;b.menu.select(c);break;case e.ESCAPE:b.element.val(b.term),b.close(c);break;default:clearTimeout(b.searching),b.searching=setTimeout(function(){b.term!=b.element.val()&&(b.selectedItem=null,b.search(null,c))},b.options.delay)}}).bind("keypress.autocomplete",function(a){d&&(d=!1,a.preventDefault())}).bind("focus.autocomplete",function(){if(b.options.disabled)return;b.selectedItem=null,b.previous=b.element.val()}).bind("blur.autocomplete",function(a){if(b.options.disabled)return;clearTimeout(b.searching),b.closing=setTimeout(function(){b.close(a),b._change(a)},150)}),this._initSource(),this.menu=a("<ul></ul>").addClass("ui-autocomplete").appendTo(a(this.options.appendTo||"body",c)[0]).mousedown(function(c){var d=b.menu.element[0];a(c.target).closest(".ui-menu-item").length||setTimeout(function(){a(document).one("mousedown",function(c){c.target!==b.element[0]&&c.target!==d&&!a.ui.contains(d,c.target)&&b.close()})},1),setTimeout(function(){clearTimeout(b.closing)},13)}).menu({focus:function(a,c){var d=c.item.data("item.autocomplete");!1!==b._trigger("focus",a,{item:d})&&/^key/.test(a.originalEvent.type)&&b.element.val(d.value)},selected:function(a,d){var e=d.item.data("item.autocomplete"),f=b.previous;b.element[0]!==c.activeElement&&(b.element.focus(),b.previous=f,setTimeout(function(){b.previous=f,b.selectedItem=e},1)),!1!==b._trigger("select",a,{item:e})&&b.element.val(e.value),b.term=b.element.val(),b.close(a),b.selectedItem=e},blur:function(a,c){b.menu.element.is(":visible")&&b.element.val()!==b.term&&b.element.val(b.term)}}).zIndex(this.element.zIndex()+1).css({top:0,left:0}).hide().data("menu"),a.fn.bgiframe&&this.menu.element.bgiframe(),b.beforeunloadHandler=function(){b.element.removeAttr("autocomplete")},a(window).bind("beforeunload",b.beforeunloadHandler)},destroy:function(){this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete").removeAttr("role").removeAttr("aria-autocomplete").removeAttr("aria-haspopup"),this.menu.element.remove(),a(window).unbind("beforeunload",this.beforeunloadHandler),a.Widget.prototype.destroy.call(this)},_setOption:function(b,c){a.Widget.prototype._setOption.apply(this,arguments),b==="source"&&this._initSource(),b==="appendTo"&&this.menu.element.appendTo(a(c||"body",this.element[0].ownerDocument)[0]),b==="disabled"&&c&&this.xhr&&this.xhr.abort()},_initSource:function(){var b=this,c,d;a.isArray(this.options.source)?(c=this.options.source,this.source=function(b,d){d(a.ui.autocomplete.filter(c,b.term))}):typeof this.options.source=="string"?(d=this.options.source,this.source=function(c,e){b.xhr&&b.xhr.abort(),b.xhr=a.ajax({url:d,data:c,dataType:"json",success:function(a,b){e(a)},error:function(){e([])}})}):this.source=this.options.source},search:function(a,b){a=a!=null?a:this.element.val(),this.term=this.element.val();if(a.length<this.options.minLength)return this.close(b);clearTimeout(this.closing);if(this._trigger("search",b)===!1)return;return this._search(a)},_search:function(a){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.source({term:a},this._response())},_response:function(){var a=this,b=++c;return function(d){b===c&&a.__response(d),a.pending--,a.pending||a.element.removeClass("ui-autocomplete-loading")}},__response:function(a){!this.options.disabled&&a&&a.length?(a=this._normalize(a),this._suggest(a),this._trigger("open")):this.close()},close:function(a){clearTimeout(this.closing),this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.deactivate(),this._trigger("close",a))},_change:function(a){this.previous!==this.element.val()&&this._trigger("change",a,{item:this.selectedItem})},_normalize:function(b){return b.length&&b[0].label&&b[0].value?b:a.map(b,function(b){return typeof b=="string"?{label:b,value:b}:a.extend({label:b.label||b.value,value:b.value||b.label},b)})},_suggest:function(b){var c=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(c,b),this.menu.deactivate(),this.menu.refresh(),c.show(),this._resizeMenu(),c.position(a.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next(new a.Event("mouseover"))},_resizeMenu:function(){var a=this.menu.element;a.outerWidth(Math.max(a.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(b,c){var d=this;a.each(c,function(a,c){d._renderItem(b,c)})},_renderItem:function(b,c){return a("<li></li>").data("item.autocomplete",c).append(a("<a></a>").text(c.label)).appendTo(b)},_move:function(a,b){if(!this.menu.element.is(":visible")){this.search(null,b);return}if(this.menu.first()&&/^previous/.test(a)||this.menu.last()&&/^next/.test(a)){this.element.val(this.term),this.menu.deactivate();return}this.menu[a](b)},widget:function(){return this.menu.element},_keyEvent:function(a,b){if(!this.isMultiLine||this.menu.element.is(":visible"))this._move(a,b),b.preventDefault()}}),a.extend(a.ui.autocomplete,{escapeRegex:function(a){return a.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},filter:function(b,c){var d=new RegExp(a.ui.autocomplete.escapeRegex(c),"i");return a.grep(b,function(a){return d.test(a.label||a.value||a)})}})})(jQuery),function(a){a.widget("ui.menu",{_create:function(){var b=this;this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({role:"listbox","aria-activedescendant":"ui-active-menuitem"}).click(function(c){if(!a(c.target).closest(".ui-menu-item a").length)return;c.preventDefault(),b.select(c)}),this.refresh()},refresh:function(){var b=this,c=this.element.children("li:not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","menuitem");c.children("a").addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(c){b.activate(c,a(this).parent())}).mouseleave(function(){b.deactivate()})},activate:function(a,b){this.deactivate();if(this.hasScroll()){var c=b.offset().top-this.element.offset().top,d=this.element.scrollTop(),e=this.element.height();c<0?this.element.scrollTop(d+c):c>=e&&this.element.scrollTop(d+c-e+b.height())}this.active=b.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end(),this._trigger("focus",a,{item:b})},deactivate:function(){if(!this.active)return;this.active.children("a").removeClass("ui-state-hover").removeAttr("id"),this._trigger("blur"),this.active=null},next:function(a){this.move("next",".ui-menu-item:first",a)},previous:function(a){this.move("prev",".ui-menu-item:last",a)},first:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},last:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},move:function(a,b,c){if(!this.active){this.activate(c,this.element.children(b));return}var d=this.active[a+"All"](".ui-menu-item").eq(0);d.length?this.activate(c,d):this.activate(c,this.element.children(b))},nextPage:function(b){if(this.hasScroll()){if(!this.active||this.last()){this.activate(b,this.element.children(".ui-menu-item:first"));return}var c=this.active.offset().top,d=this.element.height(),e=this.element.children(".ui-menu-item").filter(function(){var b=a(this).offset().top-c-d+a(this).height();return b<10&&b>-10});e.length||(e=this.element.children(".ui-menu-item:last")),this.activate(b,e)}else this.activate(b,this.element.children(".ui-menu-item").filter(!this.active||this.last()?":first":":last"))},previousPage:function(b){if(this.hasScroll()){if(!this.active||this.first()){this.activate(b,this.element.children(".ui-menu-item:last"));return}var c=this.active.offset().top,d=this.element.height(),e=this.element.children(".ui-menu-item").filter(function(){var b=a(this).offset().top-c+d-a(this).height();return b<10&&b>-10});e.length||(e=this.element.children(".ui-menu-item:first")),this.activate(b,e)}else this.activate(b,this.element.children(".ui-menu-item").filter(!this.active||this.first()?":last":":first"))},hasScroll:function(){return this.element.height()<this.element[a.fn.prop?"prop":"attr"]("scrollHeight")},select:function(a){this._trigger("selected",a,{item:this.active})}})}(jQuery);;

/* file-end: js/lib/jquery-ui/jquery.ui.autocomplete.min.js 
----------------------------------------------------------------------------------*/

angular.module("LJ.Autocomplete",[]).directive("ljAutocomplete",["$parse",function(a){return{restrict:"A",link:function(b,c,d){function e(a,b){var d,e,f,g,h,m=a.term,n=LJ.DOM.getSelection(c).start,o=m.slice(0,n),p=m.slice(n);return p.length&&","!==p.charAt(0)?void b():(o=o.trim(),f=o.lastIndexOf(","),-1===f?(h=o,j=[]):(h=o.slice(f+1).trim(),j=o.slice(0,f).split(/\,\s*/)),p.length?(p=p.slice(1).trim(),k=p.split(/\,\s*/),""===k[k.length-1]&&k.pop()):k=[],d=j.concat(k),h.length<l.minLength?void b():(h=h.toLowerCase(),g=i.filter(function(a){return-1!==a.toLowerCase().indexOf(h)}),e=d.map(function(a){return a.toLowerCase()}),g=g.filter(function(a){return-1===e.indexOf(a.toLowerCase())}),void b(r?g.slice(0,r-1):g)))}function f(){return!1}function g(a,d){a.preventDefault(),n?(j.push(d.item.value),c.val(j.concat(k).join(", ")+", "),c.trigger("input"),0===k.length?LJ.DOM.setCursor(c,"end"):LJ.DOM.setCursor(c,j.join(", ").length)):(c.val(d.item.value),c.trigger("input")),b.$emit("select",d.item.value)}var h,i,j,k,l,m,n,o,p,q,r=null;if(b.$on("$destroy",function(){c.autocomplete("destroy")}),h={delay:50,minLength:1,focus:f,select:g,source:e},d.ljAutocompleteOptions&&(l=b.$eval(d.ljAutocompleteOptions)),d.ljAutocompleteLimit&&(r=b.$eval(d.ljAutocompleteLimit)),l=angular.extend(h,l||{}),n=d.hasOwnProperty("ljAutocompleteMultiple"),c.autocomplete(l),n||(o=function(a){44===a.which&&a.preventDefault()},c.on("keypress",o)),d.ljAutocompleteSubmit&&(q=a(d.ljAutocompleteSubmit),p=function(a){13!==a.which||a.isDefaultPrevented()||(a.preventDefault(),b.$apply(function(){q(b,{$value:c.val()})}))},c.on("keydown",p),b.$on("$destroy",function(){c.off("keydown",p),c.off("keypress",o)})),d.ljAutocompleteDisabled&&b.$watch(function(){return b.$eval(d.ljAutocompleteDisabled)},function(a){m=Boolean(a),c.autocomplete("option","disabled",m),m&&c.autocomplete("close")}),d.ljAutocompleteSelect&&!n){var s=a(d.ljAutocompleteSelect);b.$on("select",function(){b.$apply(function(){s(b,{$value:c.val()})})})}b.$watch(function(){return m?void 0:b.$eval(d.ljAutocomplete)},function(a){!m&&a&&(i=d.ljAutocompleteProp?a.map(LJ.Function.get(d.ljAutocompleteProp)):a)},!0)}}}]);;

/* file-end: js/core/angular/autocomplete.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/bubble.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/ref.js 
*/

!function(){"use strict";angular.module("LJ.Ref",[]).factory("Ref",function(){function a(a,b){return f[a]?void console.error("Ref element with id `%s` has been registered before.",a):void(f[a]=b)}function b(a){f[a]&&delete f[a]}function c(a){var b=f[a];return b||console.error("Ref `%s` not found.",a),b}function d(a,b){"undefined"==typeof b&&(b={});var d=c(a),f=angular.element("html, body");if(!d)return void console.error("Could not scroll to the ref `%s` that has not been already defined.",a);var g=d.offset().top;b.onlyUp&&angular.element(window).scrollTop()<=g||(!b.onlyOutOfScreen||e(d))&&(b.toParent&&(f=d.parent(),g=0),f.animate({scrollTop:g}))}function e(a){var b=angular.element(window),c=b.scrollTop(),d=c+b.height(),e=a.offset().top;return e>d-100||c>e}var f={};return{add:a,remove:b,get:c,scrollTo:d}}).directive("ljRef",["Ref",function(a){return{restrict:"A",scope:!0,link:function(b,c,d){var e=d.ljRef;a.add(e,c),b.$on("$destroy",function(){a.remove(e)})}}}])}();;

/* file-end: js/core/angular/ref.js 
----------------------------------------------------------------------------------*/

Site.page.template['Widgets/ljBubble.tmpl'] = '<div\n    class=\"\n        b-popup\n        bubble-node\n        b-popup-withclosecontrol\n        b-bubble-{{bubble.name}}\n        \"\n    ng-show=\"show\"\n    lj-switch-off=\"show\"\n    lj-switch-off-action=\"bubble.close()\"\n    ng-style=\"{ left: position.x, top: position.y, visibility: visibility }\"\n    ng-class=\"{\n        \'b-popup-noclosecontrol\': !bubble.options.closeControl\n    }\"\n    lj-switch-off-skip>\n    <div class=\"b-popup-outer\">\n        <div class=\"b-popup-inner\">\n            <i class=\"i-popup-arr\" ng-class=\"arrowClass()\">\n                <i class=\"i-popup-arr-brdr-outer\">\n                    <i class=\"i-popup-arr-brdr-inner\">\n                        <i class=\"i-popup-arr-bg\"></i>\n                    </i>\n                </i>\n            </i>\n            <div ng-include src=\"template\"></div>\n            <i class=\"i-popup-close\" ng-click=\"bubble.close()\"></i>\n        </div>\n    </div>\n</div>\n';
!function(a){"use strict";angular.module("LJ.Bubble",["LJ.Templates","LJ.Directives","LJ.Ref"]).factory("Bubble",["$rootScope","$compile","Ref",function(b,c,d){var e={},f={},g="p-openpopup";return e.current=null,e.node=null,e.register=function(){function d(d,g){if(!d||!d.name||!d.template)throw new Error("Incorrect bubble options. You should provide name and template.",d);var h=d.name;if(d.disableClick=!0,f[h])return f[h].count+=1,e.bind(null,h);var i=a("<div />").attr("lj-bubble",JSON.stringify(d)),j="undefined"==typeof g;return j&&(g=b.$new(!0)),i.appendTo("body"),c(i)(g),f[h]={count:1,node:i,scope:g,isScopeCreated:j},e.bind(null,h)}function e(a){var b=f[a];b&&(b.count-=1,0===b.count&&(b.isScopeCreated||b.scope.$destroy(),b.node.remove(),delete f[a]))}var f={};return d}(),e._register=function(a,b){if(f.hasOwnProperty(a))return console.warn("Warning: bubble with name `%s` has been registered before!",a),!1;var c=angular.isDefined(b)?angular.copy(b):{};c=angular.extend({closeControl:!0},c),f[a]=Object.create(c)},e._unregister=function(a){delete f[a],e.current===a&&(e.current=null)},e.open=function(a,c,h){if(!f.hasOwnProperty(a))throw new Error("Bubble `"+a+"` can't be opened, it has not been registered yet.");c instanceof jQuery&&(h=c,c={}),"string"==typeof c&&(h=d.get(c),c={}),"object"==typeof c&&e.options(a,c),h instanceof jQuery&&(e.node=h),"string"==typeof h&&(e.node=d.get(h)),e.current=a,b.$broadcast("bubble:open",a,c,h),b.$broadcast("bubble:open:"+a,a,c,h),angular.element("body").addClass(g)},e.close=function(){var a,c=e.current,d=f[c];b.$broadcast("bubble:close",c,d,e.node),b.$broadcast("bubble:close:"+c,c,d,e.node);for(a in d)d.hasOwnProperty(a)&&delete d[a];e.current=null,e.node=null,angular.element("body").removeClass(g)},e.options=function(a,b){return"undefined"==typeof b||b===f[a]?f[a]:void angular.copy(b,f[a])},e}]).directive("ljBubble",["Bubble","$parse","$compile","$timeout","$templateCache",function(b,c,d,e,f){return{scope:!0,link:function(g,h,i){function j(){var a=g.arrow.vertical,b=g.arrow.horizontal;g.visibility="hidden",m(),o()&&(g.arrow.vertical="b"===a?l("alwaysBottom")?"t":"b":l("alwaysTop")?"b":"t"),p()&&(g.arrow.horizontal="l"===b?l("alwaysLeft")?"l":"r":l("alwaysRight")?"r":"l"),g.arrow.horizontal!==b||g.arrow.vertical!==a?e(k):g.visibility="visible"}function k(){return m(),p()&&!l("aside")&&g.arrow.horizontal?(g.arrow.horizontal="",void k()):void(g.visibility="visible")}function l(a){return g.bubble.options[a]||w[a]}function m(){var a=b.node||h,c=a.offset().left+Math.floor(a.outerWidth()/2),d=g.bubble.options.forceX||0,e=g.bubble.options.forceY||0;l("aside")?(g.position.x="r"===g.arrow.horizontal?a.offset().left-y.outerWidth()-z.outerWidth()+d:a.offset().left+a.outerWidth()+z.outerWidth()+d,g.position.y=a.offset().top-z.position().top+(a.outerHeight()-z.outerHeight())/2+e):(g.position.x=g.arrow.horizontal?c-z.position().left-Math.floor(z.outerWidth()/2)-2+d:c-y.outerWidth()/2-Math.floor(z.outerWidth()/4)-2+d,g.position.y="t"===g.arrow.vertical?a.offset().top+a.outerHeight()+z.outerHeight()+e:a.offset().top-z.outerHeight()-y.outerHeight()+e)}function n(){g.position.x=-9999}function o(){var a=A.scrollTop();return g.position.y<a||g.bubble.options.aside?!0:g.position.y+y.outerHeight()>a+A.outerHeight()}function p(){var a=A.scrollLeft();return g.position.x<a||g.bubble.options.aside?!0:g.position.x+y.outerWidth()>a+A.outerWidth()}function q(a){a.preventDefault(),b.current!==w.name&&e(function(){b.open(w.name)})}function r(){s(),C&&(v=e(b.close,C))}function s(){e.cancel(v)}function t(){s(),b.close()}function u(){g.show&&e(j)}var v,w=c(i.ljBubble)(g),x=w.name,y=d(f.get("ljBubble.tmpl"))(g),z=y.find(".i-popup-arr"),A=angular.element(window),B=w.eventType||"click",C=Number(w.autoClose||0);g.show=!1,b._register(x,w),g.template=w.template||x+".html",g.bubble={name:x,close:b.close,options:b.options(x)},g.clear=function(){g.arrow={vertical:"t",horizontal:"l"}},g.position={x:-9999,y:-9999},g.visibility="hidden",g.arrowClass=function(){var a=g.bubble.options,b=g.arrow.vertical,c=g.arrow.horizontal;return a.aside||w.aside?"i-popup-arr"+c+b:"i-popup-arr"+b+c},g.$watch(function(){return b.current},function(a){n(),e(function(){g.show=a===x,a&&g.show&&(g.clear(),e(j))})},!0),w.disableClick||h.on(B,q),A.on("resize",u),w.recalculateOnScroll&&A.on("scroll",u),w.closeOnScroll&&A.on("scroll",t),a("body").append(y),h.on("mouseleave",r),y.on("mouseenter",s),y.on("mouseleave",r),g.clear(),g.$on("$destroy",function(){h.off(B,q),A.off("resize",u),A.off("scroll",u),A.off("scroll",b.close),h.off("mouseleave",r),y.off("mouseenter",s),y.off("mouseleave",r),b._unregister(x),y.remove()})}}}])}(jQuery);;

/* file-end: js/core/angular/bubble.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/users.js 
*/


/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/options.js 
*/

angular.module("LJ.Options",[]).factory("Options",[function(){return{create:function(a){function b(b,c){"undefined"==typeof c?angular.extend(a,b):a[b]=c}function c(b){return a[b]}function d(){return a}if("undefined"==typeof a&&(a={}),"object"!=typeof a)throw new TypeError("Options should be an object.");return{set:b,get:c,raw:d}}}}]);;

/* file-end: js/core/angular/options.js 
----------------------------------------------------------------------------------*/

!function(){"use strict";angular.module("Users",["LJ.Api","LJ.Options"]).factory("Relations",["$q","$timeout","UsersCache",function(a,b,c){function d(d,e,f){var g=a.defer(),h={addFriend:{is_invite_sent:!0},removeFriend:{is_friend:!1},subscribe:{is_subscribedon:!0},unsubscribe:{is_subscribedon:!1},join:{is_invite_sent:!0},leave:{is_member:!1},setBan:{is_banned:!0},setUnban:{is_banned:!1}},i={addFriend:{is_invite_sent:!1},removeFriend:{is_friend:!0},subscribe:{is_subscribedon:!1},unsubscribe:{is_subscribedon:!0},join:{is_invite_sent:!1},leave:{is_member:!0},setBan:{is_banned:!1},setUnban:{is_banned:!0}},j=angular.copy(c.get(d)||{});return"undefined"==typeof f&&(f={}),f.wait||c.update(d,h[e]||{}),LJ.Event.trigger("relations.change",{username:d,action:e,callback:function(a){b(function(){if(a.error)return f.wait||c.update(d,angular.extend(i[e],j)),void g.reject(a.error.message);var b=LJ.Object.pick(a,"is_banned","is_friend","is_member","is_subscriber","is_subscribedon","is_friend_of","is_invite_sent");c.update(d,b),g.resolve(a)})}}),g.promise}function e(a,b,e){var f=d(a,b?"subscribe":"unsubscribe",e);return b||f.then(function(){c.update(a,{filtermask:0})}),f}function f(a,b,c){return d(a,b?"addFriend":"removeFriend",c)}function g(a,b,c){return d(a,b?"join":"leave",c)}function h(a,b,c){return d(a,b?"setBan":"setUnban",c)}function i(a,b,c){return d(a,b?"banEverywhere":"unbanEverywhere",c)}return{toggleFriend:f,toggleSubscription:e,toggleMember:g,toggleBan:h,toggleBanEverywhere:i}}]).factory("Mask",function(){function a(a){return a>>>0}var b={};return b.change=function(b,c){var d=c.add,e=c.remove;return"undefined"!=typeof d&&(Array.isArray(d)||(d=[d]),b=d.reduce(function(b,c){return a(b|Math.pow(2,c))},b)),"undefined"!=typeof e&&(Array.isArray(e)||(e=[e]),b=e.reduce(function(b,c){var d=Math.pow(2,32)-1-Math.pow(2,c);return a(b&d)},b)),b},b.check=function(a,b){var c=Math.pow(2,b);return Boolean(a&c)},b}).factory("UsersCache",["$q","$cacheFactory","Options",function(a,b,c){function d(a){if("undefined"!=typeof a){var b=j.get(k.get("journal"))||{},c=a;return Array.isArray(a)||(a=[a]),a.forEach(function(a){if(a&&"object"==typeof a&&"undefined"!=typeof a.username){var c=b[a.username];b[a.username]=c?angular.extend(c,a):a}}),j.put(k.get("journal"),b),c}}function e(a){var b=j.get(k.get("journal"));return Boolean(b[a])}function f(a){var b,c=typeof a;if("string"===c)return b=j.get(k.get("journal")),b&&b[a]?b[a]:null;if("function"===c)return g(a);if("undefined"===c)return g();throw new TypeError("Incorrect argument passed.")}function g(a){var b,c=j.get(k.get("journal")),d=[];for(b in c)if(c.hasOwnProperty(b)){if(a&&!a(c[b]))continue;d.push(c[b])}return d}function h(a,b){var c=f(a)||{username:a};return angular.extend(c,b),d(c),c}var i,j=b("users"),k=c.create({journal:LJ.get("remoteUser")});return i={add:d,update:h,set:k.set,get:f,exists:e}}]).factory("Users",["$q","$timeout","Api","Mask","UsersCache","Options",function(a,b,c,d,e,f){function g(a){return B[C.get("type")][a]}function h(a){return"subscriptions"===C.get("type")?Boolean(a.is_subscribedon):!0}function i(a,b){return"undefined"==typeof b?a[j()]||1:void(a[j()]=b)}function j(){return"subscriptions"===C.get("type")?"filtermask":"groupmask"}function k(a,b,d){return c.call("user.get",{target:a,fields:b},d).then(function(a){var b=a.user;return e.add(b),b})}function l(a,b){return c.call("relations.list_friends",{journal:C.get("journal"),fields:a},b).then(p("is_friend"))}function m(a){return c.call("groups.list_users",{journal:C.get("journal"),fields:a}).then(function(a){return e.add(a.users),a})}function n(a){return c.call("relations.list_subscriptions",{journal:C.get("journal"),fields:a}).then(p("is_subscribedon"))}function o(a){return c.call("relations.list_banned",{journal:C.get("journal"),fields:a}).then(p("is_banned"))}function p(a){return function(b){var c=b.users;return c.forEach(LJ.Function.set(a,!0)),e.add(c),c}}function q(a){return c.call("relations."+a+"_count").then(function(a){return a.count})}function r(b){return angular.isArray(b)||(b=[b]),0===b.length?a.reject("You should provide users to sync."):c.call(g("update"),{users:b,journal:C.get("journal")}).then(function(a){return e.add(a.users),a})}function s(a,b){var c=e.get(a);return c?d.check(i(c),b):!1}function t(a){return a.filter(e.exists).map(e.get).filter(h)}function u(a){var b=(a.filter||"").toLowerCase(),c=e.get(function(c){return h(c)&&d.check(i(c),a.id)?b&&-1===c.display_username.toLowerCase().indexOf(b)?!1:!0:!1});return a.limit&&(c=c.slice(0,a.limit)),c}function v(a){var b=(a.filter||"").toLowerCase(),c=e.get(function(c){return h(c)?d.check(i(c),a.id)?!1:b&&-1===c.display_username.toLowerCase().indexOf(b)?!1:!0:!1});return a.limit&&(c=c.slice(0,a.limit)),c}function w(a,b){Array.isArray(b)||(b=[b]);var c;return c="subscriptions"===C.get("type")?t(b):b.map(function(a){return e.get(a)||{username:a}}),c.forEach(function(b){i(b,d.change(i(b),{add:a}))}),r(c)}function x(a,b,c){Array.isArray(b)||(b=[b]);var e=t(b);return e.forEach(function(b){i(b,d.change(i(b),{remove:a}))}),c&&c.silent?void 0:r(e)}function y(a,b){return e.update(a,{alias:b}),c.call("user.alias_set",{target:a,alias:b})}function z(a){return function(b,c){return b[a].toLowerCase().localeCompare(c[a].toLowerCase())}}function A(){var a,b=C.get("journal");C.set.apply(null,arguments),a=C.get("journal"),a!==b&&e.set("journal",a)}var B={friends:{read:"relations.list_friends",readOne:"relations.get_friend",update:"groups.update_users"},subscriptions:{read:"relations.list_subscriptions",readOne:"relations.get_subscription",update:"filters.update_users"}},C=f.create({type:"friends",journal:LJ.get("remoteUser")});return{USERHEAD_FIELDS:{alias:1,journal_url:1,profile_url:1,userhead_url:1,is_invisible:1,journaltype:1},set:A,get:C.get,Cache:e,fetchUser:k,fetchBanned:o,fetchFriends:l,fetchGroupUsers:m,fetchSubscriptions:n,fetchCount:q,sync:r,alias:y,isUserInGroup:s,getExisting:t,fromGroup:u,outOfGroup:v,addToGroup:w,removeFromGroup:x,comparator:z}}])}();;

/* file-end: js/core/angular/users.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/editor/editor.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/lib/textinputs_jquery.js 
*/

/**
 * @license Rangy Inputs, a jQuery plug-in for selection and caret manipulation within textareas and text inputs.
 *
 * https://github.com/timdown/rangyinputs
 *
 * For range and selection features for contenteditable, see Rangy.

 * http://code.google.com/p/rangy/
 *
 * Depends on jQuery 1.0 or later.
 *
 * Copyright 2013, Tim Down
 * Licensed under the MIT license.
 * Version: 1.1
 * Build date: 31 March 2013
 */
(function(a){function l(a,b){var c=typeof a[b];return"function"===c||!("object"!=c||!a[b])||"unknown"==c}function m(a,c){return typeof a[c]!=b}function n(a,b){return!("object"!=typeof a[b]||!a[b])}function o(a){window.console&&window.console.log&&window.console.log("RangyInputs not supported in your browser. Reason: "+a)}function p(a,c,d){return 0>c&&(c+=a.value.length),typeof d==b&&(d=c),0>d&&(d+=a.value.length),{start:c,end:d}}function q(a,b,c){return{start:b,end:c,length:c-b,text:a.value.slice(b,c)}}function r(){return n(document,"body")?document.body:document.getElementsByTagName("body")[0]}var c,d,e,f,g,h,i,j,k,b="undefined";a(document).ready(function(){function v(a,b){return function(){var c=this.jquery?this[0]:this,d=c.nodeName.toLowerCase();if(1==c.nodeType&&("textarea"==d||"input"==d&&"text"==c.type)){var e=[c].concat(Array.prototype.slice.call(arguments)),f=a.apply(this,e);if(!b)return f}return b?this:void 0}}var s=document.createElement("textarea");if(r().appendChild(s),m(s,"selectionStart")&&m(s,"selectionEnd"))c=function(a){var b=a.selectionStart,c=a.selectionEnd;return q(a,b,c)},d=function(a,b,c){var d=p(a,b,c);a.selectionStart=d.start,a.selectionEnd=d.end},k=function(a,b){b?a.selectionEnd=a.selectionStart:a.selectionStart=a.selectionEnd};else{if(!(l(s,"createTextRange")&&n(document,"selection")&&l(document.selection,"createRange")))return r().removeChild(s),o("No means of finding text input caret position"),void 0;c=function(a){var d,e,f,g,b=0,c=0,h=document.selection.createRange();return h&&h.parentElement()==a&&(f=a.value.length,d=a.value.replace(/\r\n/g,"\n"),e=a.createTextRange(),e.moveToBookmark(h.getBookmark()),g=a.createTextRange(),g.collapse(!1),e.compareEndPoints("StartToEnd",g)>-1?b=c=f:(b=-e.moveStart("character",-f),b+=d.slice(0,b).split("\n").length-1,e.compareEndPoints("EndToEnd",g)>-1?c=f:(c=-e.moveEnd("character",-f),c+=d.slice(0,c).split("\n").length-1))),q(a,b,c)};var t=function(a,b){return b-(a.value.slice(0,b).split("\r\n").length-1)};d=function(a,b,c){var d=p(a,b,c),e=a.createTextRange(),f=t(a,d.start);e.collapse(!0),d.start==d.end?e.move("character",f):(e.moveEnd("character",t(a,d.end)),e.moveStart("character",f)),e.select()},k=function(a,b){var c=document.selection.createRange();c.collapse(b),c.select()}}r().removeChild(s),f=function(a,b,c,e){var f;b!=c&&(f=a.value,a.value=f.slice(0,b)+f.slice(c)),e&&d(a,b,b)},e=function(a){var b=c(a);f(a,b.start,b.end,!0)},j=function(a){var e,b=c(a);return b.start!=b.end&&(e=a.value,a.value=e.slice(0,b.start)+e.slice(b.end)),d(a,b.start,b.start),b.text};var u=function(a,b,c,e){var f=b+c.length;switch(e="string"==typeof e?e.toLowerCase():""){case"collapsetostart":d(a,b,b);break;case"collapsetoend":d(a,f,f);break;case"select":d(a,b,f)}};g=function(a,b,c,d){var e=a.value;a.value=e.slice(0,c)+b+e.slice(c),"boolean"==typeof d&&(d=d?"collapseToEnd":""),u(a,c,b,d)},h=function(a,b,d){var e=c(a),f=a.value;a.value=f.slice(0,e.start)+b+f.slice(e.end),u(a,e.start,b,d||"collapseToEnd")},i=function(a,d,e,f){typeof e==b&&(e=d);var g=c(a),h=a.value;a.value=h.slice(0,g.start)+d+g.text+e+h.slice(g.end);var i=g.start+d.length;u(a,i,g.text,f||"select")},a.fn.extend({getSelection:v(c,!1),setSelection:v(d,!0),collapseSelection:v(k,!0),deleteSelectedText:v(e,!0),deleteText:v(f,!0),extractSelectedText:v(j,!1),insertText:v(g,!0),replaceSelectedText:v(h,!0),surroundSelectedText:v(i,!0)})})})(jQuery);;

/* file-end: js/lib/textinputs_jquery.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/ljTour.js 
*/




Site.page.template['angular/bubbletour.ng.tmpl'] = '<div class=\"b-helptour\">\n    <header class=\"b-helptour-header\" ng-hide=\"current.length < 2\">\n        <span class=\"b-helptour-stage\">\n            <span class=\"b-helptour-stage-prev\" ng-bind=\"index\"></span>\n            <span class=\"b-helptour-stage-hr\">/</span>\n            <span class=\"b-helptour-stage-next\" ng-bind=\"current.length\"></span>\n        </span>\n    </header>\n    <div class=\"b-helptour-content b-text\">\n        <span lj-ml=\"{{step.tourText}}\" lj-ml-dynamic=\"index\"></span>\n    </div>\n    <footer class=\"b-helptour-footer\">\n        <ul class=\"b-helptour-controls b-helptour-state\">\n            <li class=\"b-helptour-control b-helptour-control-skip\"\n                ng-hide=\"step.tourNoSkip || index === current.length\">\n                <a class=\"b-helptour-skip-link b-helptour-link\" href=\"javascript:void(0)\" lj-ml=\"tour.steps.skip\"\n                   ng-click=\"end()\"></a>\n            </li>\n        </ul>\n        <ul class=\"b-helptour-controls b-helptour-step\">\n            <li class=\"b-helptour-control b-helptour-control-prev\"\n                ng-hide=\"step.tourNoBack || index === 1\">\n                <a class=\"b-helptour-prev-link b-helptour-link\" href=\"javascript:void(0)\" lj-ml=\"tour.steps.prev\"\n                   ng-click=\"prev()\"></a>\n            </li>\n            <li class=\"b-helptour-control b-helptour-control-next\"\n                ng-hide=\"step.tourNoNext || index === current.length\">\n                <a class=\"b-helptour-next-link b-helptour-link\" href=\"javascript:void(0)\" lj-ml=\"tour.steps.next\"\n                   ng-click=\"next()\"></a>\n            </li>\n            <li class=\"b-helptour-control b-helptour-control-done\"\n                ng-hide=\"index !== current.length\">\n                <a class=\"b-helptour-done-link b-helptour-link\" href=\"javascript:void(0)\" lj-ml=\"tour.steps.done\"\n                   ng-click=\"end()\"></a>\n            </li>\n        </ul>\n    </footer>\n</div>\n';
LJ.injectStyle('.b-bubble-tour{z-index:5001}.b-bubble-tour .b-popup-inner{padding:0}.b-helptour{width:350px}.b-helptour-header{margin:0 0 .3em;padding:10px 16px 0}.b-helptour-footer:after,.b-helptour-header:after{display:table;width:100%;clear:both;content:\"\"}.b-helptour-stage-title{margin-right:10px}.b-helptour P:first-child{margin:0 0 .3em}.b-helptour-content{margin:10px 0 .6em;padding:0 16px}.b-helptour-content P{margin:.3em 0}.b-helptour-content LI,.b-helptour-content UL{margin:0;padding:0;list-style:none}.b-helptour-footer{padding:6px 15px;border-radius:0 0 5px 5px;background-color:#DAE3E6}.b-helptour-controls{margin:0;padding:0}.b-helptour-state{float:left}.b-helptour-step{float:right}.b-helptour-control{display:inline;margin-right:4px;cursor:pointer}.b-helptour-control-done:after{display:inline-block;content:\"\";width:14px;height:12px;background-image:url(/img/icons/unit_v3.png?v=42878);background-repeat:no-repeat;background-position:0 -223px}.b-helptour-control-done A{padding-left:8px}.b-helptour-control-done A:link,.b-helptour-control-done A:visited,.b-helptour-control-next A:link,.b-helptour-control-prev A:link{color:#00A3D9}.b-helptour-control-skip A:link,.b-helptour-control-skip A:visited{color:#7A9199}.b-helptour-control A{font-size:13px}.b-helptour-control A:active,.b-helptour-control A:focus,.b-helptour-control A:hover{color:#0086b3}.p-ljtour .b-lenta .l-flatslide-container{position:static}.p-ljtour .l-flatslide-menu-controls{position:absolute;top:auto!important}.p-ljtour.p-openpopup .w-cs{overflow:visible}@media all and (max-width:650px){.p-ljtour.p-openpopup .b-fader{display:none!important}.b-bubble-tour{display:none}}');
//= require_ml tour.steps.prev
//= require_ml tour.steps.next
//= require_ml tour.steps.skip
//= require_ml tour.steps.done
!function(a){"use strict";angular.module("LJ.Tour",["LJ.Bubble","LJ.Templates","LJ.Directives","LJ.Api"]).factory("Tour",["Api",function(a){var b={};return b.queue={},b.checkAvailable=function(){var c=Object.keys(b.queue);return a.call("tour.is_available",{tours:c}).then(function(a){c.forEach(function(c){0===a.states[c]&&delete b.queue[c]})})},b.setDone=function(b){return a.call("tour.set_done",{tour:b})},b}]).directive("ljTour",["$timeout","$document","Bubble","Ref","Tour",function(b,c,d,e,f){return{scope:!0,link:function(g){function h(){a("body").find("[data-tour]").each(function(){var b=a(this),c=angular.extend({element:b},b.data());Array.isArray(x[c.tour])||(x[c.tour]=[]),x[c.tour].push(c)})}function i(){var a=Object.keys(x)[0],b=x[a];g.current=b.filter(function(a){return o(a)&&p(a)}).sort(function(a,b){return(a.tourStep||1)>b.tourStep}),g.current.forEach(function(a){e.add(a.tour+a.tourStep,a.element)}),delete x[a],r(g.current[0])?l():j()}function j(){Object.keys(x).length&&i()}function k(){d.close(),y.fadeOut(),angular.element("body").removeClass("p-ljtour").off("ljsale-load",s),f.setDone(g.step.tour),y.off("click",k),g.current=null,g.step=null,j()}function l(){return angular.element("body").addClass("p-ljtour").on("ljsale-load",function(a){a.originalEvent.data.slot&&s()}),y.is(":visible")?void b(l,300):(m(),y.on("click",k).fadeIn(),void(g.current=g.current.filter(function(a){return q(a.element)})))}function m(){var a=g.current.indexOf(g.step);a<g.current.length-1?(g.step=g.current[++a],g.index=++a,t()):k()}function n(){var a=g.current.indexOf(g.step);a>0&&(g.step=g.current[--a],g.index=++a,t())}function o(a){return a.hasOwnProperty("tourOwner")?LJ.get("remote.username")===LJ.get("journal.username"):!0}function p(a){return a.hasOwnProperty("tourSkipIf")?a.tourSkipIf.split(",").every(function(a){return a=a.trim(),"!"===a.charAt(0)?LJ.get(a.slice(1)):!LJ.get(a)}):!0}function q(a){return a.is(":visible")&&0!==a.css("opacity")&&"hidden"!==a.css("visibility")}function r(a){return a?a.hasOwnProperty("tourStartPage")?new RegExp(a.tourStartPage,"i").test(location.pathname):1===a.tourStep:!1}function s(){angular.element(window).trigger("resize"),u()}function t(){if(g.step){if(!g.step.element.is(":visible"))return m();d.current&&d.close(),b(function(){var a=d.options("tour")||{};d.open("tour",angular.extend(a,g.step.tourBubble),g.step.element),u()})}}function u(){e.scrollTo(g.step.tour+g.step.tourStep,{onlyOutOfScreen:!0})}function v(a){if(g.current&&g.current.length){switch(a.which){case 27:k();break;case 37:n();break;case 39:m()}g.$apply()}}var w,x=f.queue,y=angular.element(document.querySelector(".b-fader")),z=!1;w=d.register({name:"tour",template:"bubbletour.ng.tmpl",closeControl:!1},g),!LJ.Flags.isEnabled("friendsfeed_tour")||LJ.Support.isMobile()||z||(z=!0,b(function(){h(),f.checkAvailable().then(j)})),g.next=m,g.prev=n,g.end=k,c.on("keydown",v),g.$on("$destroy",function(){c.off("keydown",v),w()})}}}])}(jQuery);;

/* file-end: js/core/angular/ljTour.js 
----------------------------------------------------------------------------------*/

/*
 * For all text manipulation Rangyinputs is used
 *
 * https://code.google.com/p/rangyinputs/
 */

(function($) {

'use strict';

angular.module('Editor', ['LJ.Tour'])
.factory('Editor', function() {
  var factory = {};

  factory.getSelectedText = function() {
    var textarea = $('#body');

    return textarea.getSelection().text;
  };

  factory.htmlMode = function() {
    return $('#body').is(':visible');
  };

  /*
   * The main method to insert something to editor.
   * It handles HTML mode directly and sends events
   * to the visual editor plugins to handle.
   *
   * @param {String} type    Event type
   * @param {String} content Content for HTML mode
   * @param {Object} [data]  Data for visual editor
   */
  factory.insertContent = function(type, content, data, additional) {
    var textarea  = $('#body'),
        /* selector is used on update.bml and also s2 commenting form */
        selection;

    LJ.Event.trigger('contentInsert');
    if (factory.htmlMode()) {
      var parts = content.split('{caret}');

      textarea.surroundSelectedText(
        parts[0],
        parts.length > 1 ? (parts[parts.length - 1] || '') : ''
      ).trigger('input');

      selection = textarea.getSelection();

      // use text between {caret} if selection is empty,
      // move caret to the end
      if (parts.length === 3 && selection.length === 0) {
        textarea
          .replaceSelectedText(parts[1], 'collapseToEnd')
          .setSelection(selection.start + parts[1].length + parts[parts.length - 1].length);
      }
    } else {
      // @TODO: make the events consistent, selectedColor => color_response

      if (type === 'color') {
        return LJ.Event.trigger('selectedColor', data);
      }

      LJ.Event.trigger(type + '_response', data || content, additional);
    }
  };

  return factory;
})
.controller('EditorCtrl', ['$scope', 'Editor', 'Bubble', '$timeout',
                  function( $scope ,  Editor ,  Bubble ,  $timeout ) {

    var basicFormatting = {
      bold: '<b>{caret}</b>',
      italic: '<i>{caret}</i>',
      underline: '<u>{caret}</u>',
      strikethrough: '<s>{caret}</s>'
    };

    $scope.formattingAction = function(event, type) {
      event.preventDefault();

      if (basicFormatting[type]) {
        Editor.insertContent(type, basicFormatting[type]);
      }
    };

    $scope.userClick = function(event, type) {
      var selected = Editor.getSelectedText(),
          rxUsername = /^[A-Za-z0-9_\-]+$/;

      event.preventDefault();

      if (rxUsername.test(selected)) {
        Editor.insertContent(type, '<lj user="{caret}" />');
      } else {
        $timeout(function() {
          Bubble.open('user');
        });
      }
    };
}]);

})(jQuery);
;

/* file-end: js/editor/editor.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/editor/media.js 
*/

//= require_ml media.ramblerkassa.title
LJ.define("LJ.Media"),LJ.Media.parse=function(a){"use strict";function b(b,c){this.provider=b,a.extend(this,c),this._cache={}}function c(a,b){var c,d;for(c in e)if(e.hasOwnProperty(c)&&(d=e[c].parse(a,b)))return d;return null}function d(b,d){d=a.extend({thumbnail:!0},d||{});try{var e,f=a(b).first();if(f&&"iframe"===f.prop("tagName").toLowerCase()&&(e=f&&f.attr("src")))return c(e,d)}catch(g){return c(b,d)}}b.prototype.parse=function(b,c){var d,e=this,f=this.params(b,c);return f?(d=[],d.push("string"==typeof this.embed?this.toPromise(this.embed.supplant(f)):this.embed(f)),c.thumbnail&&this.thumbnail&&d.push("string"==typeof this.thumbnail?this.toPromise(this.thumbnail.supplant(f)):this.thumbnail(f)),a.when.apply(a,d).then(function(a,b){return{link:e.link.supplant(f),embed:a,thumb:b,site:e.provider}})):void 0},b.prototype.cache=function(a,b){return"undefined"==typeof b?this._cache[a]:void(this._cache[a]=b)},b.prototype.toPromise=function(b){var c=a.Deferred();return c.resolve(b),c.promise()};var e={ljVideo:new b("ljVideo",{link:"http://vc.videos.livejournal.com/index/player?player=new&record_id={storageid}",embed:function(a){return'<iframe data-link="{link}" data-thumb="{thumbnail}" frameBorder="0" height="315" src="{link}" width="560"></iframe>'.supplant(a)},thumbnail:function(a){return a.screenshot||this.cache(a.storageid)},params:function(b,c){var d=/.*livejournal\.com\/.*\?[\w=&]*record_id=(\d+).*$/,e=("string"==typeof b?b:c.url).match(d);return c.screenshot&&this.cache(c.storageid,c.screenshot),e&&a.extend(c,{storageid:e[1]})}}),coub:new b("coub",{link:"//coub.com/embed/{id}?muted=false&autostart=false&originalSize=false",embed:'<iframe src="//coub.com/embed/{id}?muted=false&autostart=false&originalSize=false&hideTopBar=false&startWithHD=false" allowfullscreen="true" frameborder="0" width="640" height="272"></iframe> ',thumbnail:function(a){var b=this.cache(a.id);return this.toPromise(b?b:null)},params:function(a){var b=/\/\/[w\.]*coub\.com\/embed\/(\w+)/,c=a.match(b);return c&&{id:c[1]}}}),youtube:new b("youtube",{link:"http://youtube.com/watch?v={id}",thumbnail:"http://img.youtube.com/vi/{id}/0.jpg",embed:'<iframe src="http://www.youtube.com/embed/{id}" width="560" height="315" frameborder="0" allowfullscreen data-link="http://youtube.com/watch?v={id}"></iframe>',params:function(a){var b=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\??v?=?))([^#\&\?]*).*/,c=a.match(b);return c&&-1===c[0].indexOf("youtu")?null:c&&{id:c[7]}}}),vimeo:new b("vimeo",{link:"http://vimeo.com/{id}",embed:'<iframe src="http://player.vimeo.com/video/{id}" width="560" height="315" frameborder="0" allowfullscreen data-link="http://vimeo.com/{id}"></iframe>',params:function(a){var b=/^(https?:\/\/)?(www\.)?(player\.)?vimeo.com\/(video\/|channels\/\w+\/)?(\d+)*/,c=a.match(b);return c&&{id:c[5]}},thumbnail:function(b){var c=this,d=this.cache(b.id);return d?this.toPromise(d):a.ajax({url:"http://vimeo.com/api/v2/video/"+b.id+".json",dataType:"jsonp"}).then(function(a){if(a&&a[0]){var d=a[0].thumbnail_large;if(d)return c.cache(b.id,d),d}else console.error("Data error",a)})}}),vine:new b("vine",{link:"http://vine.co/v/{id}",embed:'<iframe src="http://vine.co/v/{id}/card" width="380" height="380" frameborder="0" data-link="http://vine.co/v/{id}"></iframe>',params:function(a){var b=/vine.co\/v\/([^\/]*)/,c=a.match(b);return c&&{id:c[1]}}}),instagram:new b("instagram",{link:"http://instagram.com/p/{id}/",embed:'<iframe src="//instagram.com/p/{id}/embed/" width="612" height="710" frameborder="0" scrolling="no" allowtransparency="true"  data-link="http://instagram.com/p/{id}/"></iframe>',params:function(a){var b=/.*(?:instagram\.\w*|instagr\.am)\/p\/([^\/]+).*/,c=a.match(b);return c&&{id:c[1]}}}),gist:new b("gist",{link:"https://gist.github.com/{id}",embed:'<div class="gh-gist" data-gist-id="{id}"><a href="https://gist.github.com/{id}">gist.github.com/{id}</a></div>',params:function(a){var b=/.*(?:gist\.github\.com\/)([^\/]+\/{1}[^\/]+)\/{0,1}$/,c=a.match(b);return c&&{id:c[1]}}}),rutube:new b("rutube",{link:"http://rutube.ru/video/{id}/",embed:'<iframe src="http://rutube.ru/video/embed/{id}" width="560" height="315" frameborder="0" allowfullscreen data-link="http://rutube.ru/video/{id}/"></iframe>',params:function(a){var b=/^.*rutube.ru\/video(\/embed\/|\/private\/|\/)(\w{32}).*/,c=a.match(b);return c&&{id:c[2]}},thumbnail:function(b){var c=this,d=this.cache(b.id);return d?this.toPromise(d):a.ajax({url:"http://rutube.ru/api/video/"+b.id+"/?format=jsonp",dataType:"jsonp"}).done(function(a){if(a&&a.thumbnail_url){var d=a.thumbnail_url;if(d)return c.cache(b.id,d),d}else console.error("Data error",a)})}}),twitter:new b("twitter",{link:"https://twitter.com/{username}/status/{id}",params:function(a){var b=/^.*twitter.com\/(\w*)\/status\/(\w*).*/,c=a.match(b);return c&&{id:c[2],username:c[1]}},embed:function(b){var c=this,d=this.cache(b.id);return d?this.toPromise(d):a.ajax({url:"https://api.twitter.com/1/statuses/oembed.json?id={id}".supplant({id:b.id}),dataType:"jsonp"}).then(function(a){var d=a.html.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,"");return c.cache(b.id,d),d})}}),facebook:new b("facebook",{link:"{link}",params:function(a){var b=/(^.*facebook.com\/.*)/,c=a.match(b);return c&&{link:c[1]}},embed:function(b){var c,d=this,e='<div class="fb-post" data-href="{link}" data-width="500"><div class="fb-xfbml-parse-ignore"><a href="{link}">Facebook post</a></div></div>',f=/(^.*facebook.com\/)(\d*)(\/.*)/,g=b.link.match(f),h=a.Deferred(),i=g&&g[2],j=this.cache(b.link);return j?this.toPromise(j):(i?LJ.Social.load("facebook").then(function(){FB.api(i,function(a){var g=b.link.replace(f,"$1"+a.username+"$3");c=e.supplant({link:g}),d.cache(b.link,c),h.resolve(c)})}):(c=e.supplant({link:b.link}),this.cache(b.link,c),h.resolve(c)),h.promise())}}),ramblerKassa:new b("ramblerKassa",{link:"https://kassa.rambler.ru/movie/{id}",embed:'<lj-rkassa id="{id}" title="'+LJ.ml("media.ramblerkassa.title")+'" />',params:function(a){var b=/kassa\.rambler\.ru\/movie\/(\d+)$/,c=a.match(b);return c&&{id:c[1]}}})};return d}(jQuery);;

/* file-end: js/editor/media.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/video/editor.js 
*/






/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/pills.js 
*/

!function(){"use strict";angular.module("LJ.Pills",[]).factory("Pills",function(){var a={};return{group:function(b,c){return"undefined"==typeof c?a[b]:void(a[b]=c)}}}).directive("ljPillsGroup",["Pills",function(a){return{restrict:"A",link:function(b,c,d){var e=d.ljPillsGroupActive||"b-menu-item-active";b.$watch(function(){return a.group(d.ljPillsGroup)},function(a){c.find("[data-pill]").removeClass(e).filter('[data-pill="'+a+'"]').addClass(e)})}}}])}();;

/* file-end: js/core/angular/pills.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/authHelper.js 
*/

!function(){"use strict";angular.module("LJ.AuthHelper",[]).factory("AuthHelper",["$q","$interval",function(a,b){function c(c){var f,g=window.open(c,"Auth helper","height=450,width=650"),h=0;return d=a.defer(),f=b(function(){var a;h++,g.closed&&(a=LJ.Cookie.get("_Auth_token"),"undefined"!=typeof a?d.resolve(a):d.reject(),LJ.Cookie.setGlobal("_Auth_token",null),b.cancel(f)),h>e&&b.cancel(f)},200),d.promise}var d,e=1500;return{open:c}}])}();;

/* file-end: js/core/angular/authHelper.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/video/uploader.js 
*/


/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/adult.js 
*/

Site.page.template['angular/adult.ng.tmpl'] = '<label class=\"flatpopup-label\" lj-ml=\"flatmedia.adult.content\"></label>\n<select ng-model=\"model\" ng-options=\"item.value as item.title for item in adult.categories\"></select>\n';
//= require_ml flatmedia.adult.content
//= require_ml flatmedia.adult.content.default
//= require_ml flatmedia.adult.content.explicit
//= require_ml flatmedia.adult.content.none
!function(){"use strict";angular.module("LJ.Adult",[]).directive("ljAdult",[function(){return{scope:{model:"=ljAdult"},templateUrl:"adult.ng.tmpl",controllerAs:"adult",controller:["$scope","$element","$attrs",function(a,b,c){this.categories=[{title:LJ.ml("flatmedia.adult.content.none"),value:!1},{title:LJ.ml("flatmedia.adult.content.explicit"),value:!0}],c.hasOwnProperty("ljAdultNotStrict")&&this.categories.unshift({title:LJ.ml("flatmedia.adult.content.default"),value:""})}]}}])}();;

/* file-end: js/core/angular/adult.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/plupload.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/lib/plupload/plupload-2.1.2.full.min.js 
*/

/**
 * mOxie - multi-runtime File API & XMLHttpRequest L2 Polyfill
 * v1.2.1
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 *
 * Date: 2014-05-14
 */
!function(e,t){"use strict";function n(e,t){for(var n,i=[],r=0;r<e.length;++r){if(n=s[e[r]]||o(e[r]),!n)throw"module definition dependecy not found: "+e[r];i.push(n)}t.apply(null,i)}function i(e,i,r){if("string"!=typeof e)throw"invalid module definition, module id must be defined and be a string";if(i===t)throw"invalid module definition, dependencies must be specified";if(r===t)throw"invalid module definition, definition function must be specified";n(i,function(){s[e]=r.apply(null,arguments)})}function r(e){return!!s[e]}function o(t){for(var n=e,i=t.split(/[.\/]/),r=0;r<i.length;++r){if(!n[i[r]])return;n=n[i[r]]}return n}function a(n){for(var i=0;i<n.length;i++){for(var r=e,o=n[i],a=o.split(/[.\/]/),u=0;u<a.length-1;++u)r[a[u]]===t&&(r[a[u]]={}),r=r[a[u]];r[a[a.length-1]]=s[o]}}var s={},u="moxie/core/utils/Basic",c="moxie/core/I18n",l="moxie/core/utils/Mime",d="moxie/core/utils/Env",f="moxie/core/utils/Dom",h="moxie/core/Exceptions",p="moxie/core/EventTarget",m="moxie/core/utils/Encode",g="moxie/runtime/Runtime",v="moxie/runtime/RuntimeClient",y="moxie/file/Blob",w="moxie/file/File",E="moxie/file/FileInput",_="moxie/file/FileDrop",x="moxie/runtime/RuntimeTarget",b="moxie/file/FileReader",R="moxie/core/utils/Url",T="moxie/file/FileReaderSync",A="moxie/xhr/FormData",S="moxie/xhr/XMLHttpRequest",O="moxie/runtime/Transporter",I="moxie/image/Image",D="moxie/runtime/html5/Runtime",N="moxie/runtime/html5/file/Blob",L="moxie/core/utils/Events",M="moxie/runtime/html5/file/FileInput",C="moxie/runtime/html5/file/FileDrop",F="moxie/runtime/html5/file/FileReader",H="moxie/runtime/html5/xhr/XMLHttpRequest",P="moxie/runtime/html5/utils/BinaryReader",k="moxie/runtime/html5/image/JPEGHeaders",U="moxie/runtime/html5/image/ExifParser",B="moxie/runtime/html5/image/JPEG",z="moxie/runtime/html5/image/PNG",G="moxie/runtime/html5/image/ImageInfo",q="moxie/runtime/html5/image/MegaPixel",X="moxie/runtime/html5/image/Image",j="moxie/runtime/flash/Runtime",V="moxie/runtime/flash/file/Blob",W="moxie/runtime/flash/file/FileInput",Y="moxie/runtime/flash/file/FileReader",$="moxie/runtime/flash/file/FileReaderSync",J="moxie/runtime/flash/xhr/XMLHttpRequest",Z="moxie/runtime/flash/runtime/Transporter",K="moxie/runtime/flash/image/Image",Q="moxie/runtime/silverlight/Runtime",et="moxie/runtime/silverlight/file/Blob",tt="moxie/runtime/silverlight/file/FileInput",nt="moxie/runtime/silverlight/file/FileDrop",it="moxie/runtime/silverlight/file/FileReader",rt="moxie/runtime/silverlight/file/FileReaderSync",ot="moxie/runtime/silverlight/xhr/XMLHttpRequest",at="moxie/runtime/silverlight/runtime/Transporter",st="moxie/runtime/silverlight/image/Image",ut="moxie/runtime/html4/Runtime",ct="moxie/runtime/html4/file/FileInput",lt="moxie/runtime/html4/file/FileReader",dt="moxie/runtime/html4/xhr/XMLHttpRequest",ft="moxie/runtime/html4/image/Image";i(u,[],function(){var e=function(e){var t;return e===t?"undefined":null===e?"null":e.nodeType?"node":{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},t=function(i){var r;return n(arguments,function(o,s){s>0&&n(o,function(n,o){n!==r&&(e(i[o])===e(n)&&~a(e(n),["array","object"])?t(i[o],n):i[o]=n)})}),i},n=function(e,t){var n,i,r,o;if(e){try{n=e.length}catch(a){n=o}if(n===o){for(i in e)if(e.hasOwnProperty(i)&&t(e[i],i)===!1)return}else for(r=0;n>r;r++)if(t(e[r],r)===!1)return}},i=function(t){var n;if(!t||"object"!==e(t))return!0;for(n in t)return!1;return!0},r=function(t,n){function i(r){"function"===e(t[r])&&t[r](function(e){++r<o&&!e?i(r):n(e)})}var r=0,o=t.length;"function"!==e(n)&&(n=function(){}),t&&t.length||n(),i(r)},o=function(e,t){var i=0,r=e.length,o=new Array(r);n(e,function(e,n){e(function(e){if(e)return t(e);var a=[].slice.call(arguments);a.shift(),o[n]=a,i++,i===r&&(o.unshift(null),t.apply(this,o))})})},a=function(e,t){if(t){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(t,e);for(var n=0,i=t.length;i>n;n++)if(t[n]===e)return n}return-1},s=function(t,n){var i=[];"array"!==e(t)&&(t=[t]),"array"!==e(n)&&(n=[n]);for(var r in t)-1===a(t[r],n)&&i.push(t[r]);return i.length?i:!1},u=function(e,t){var i=[];return n(e,function(e){-1!==a(e,t)&&i.push(e)}),i.length?i:null},c=function(e){var t,n=[];for(t=0;t<e.length;t++)n[t]=e[t];return n},l=function(){var e=0;return function(t){var n=(new Date).getTime().toString(32),i;for(i=0;5>i;i++)n+=Math.floor(65535*Math.random()).toString(32);return(t||"o_")+n+(e++).toString(32)}}(),d=function(e){return e?String.prototype.trim?String.prototype.trim.call(e):e.toString().replace(/^\s*/,"").replace(/\s*$/,""):e},f=function(e){if("string"!=typeof e)return e;var t={t:1099511627776,g:1073741824,m:1048576,k:1024},n;return e=/^([0-9]+)([mgk]?)$/.exec(e.toLowerCase().replace(/[^0-9mkg]/g,"")),n=e[2],e=+e[1],t.hasOwnProperty(n)&&(e*=t[n]),e};return{guid:l,typeOf:e,extend:t,each:n,isEmptyObj:i,inSeries:r,inParallel:o,inArray:a,arrayDiff:s,arrayIntersect:u,toArray:c,trim:d,parseSizeStr:f}}),i(c,[u],function(e){var t={};return{addI18n:function(n){return e.extend(t,n)},translate:function(e){return t[e]||e},_:function(e){return this.translate(e)},sprintf:function(t){var n=[].slice.call(arguments,1);return t.replace(/%[a-z]/g,function(){var t=n.shift();return"undefined"!==e.typeOf(t)?t:""})}}}),i(l,[u,c],function(e,t){var n="application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe",i={mimes:{},extensions:{},addMimeType:function(e){var t=e.split(/,/),n,i,r;for(n=0;n<t.length;n+=2){for(r=t[n+1].split(/ /),i=0;i<r.length;i++)this.mimes[r[i]]=t[n];this.extensions[t[n]]=r}},extList2mimes:function(t,n){var i=this,r,o,a,s,u=[];for(o=0;o<t.length;o++)for(r=t[o].extensions.split(/\s*,\s*/),a=0;a<r.length;a++){if("*"===r[a])return[];if(s=i.mimes[r[a]])-1===e.inArray(s,u)&&u.push(s);else{if(!n||!/^\w+$/.test(r[a]))return[];u.push("."+r[a])}}return u},mimes2exts:function(t){var n=this,i=[];return e.each(t,function(t){if("*"===t)return i=[],!1;var r=t.match(/^(\w+)\/(\*|\w+)$/);r&&("*"===r[2]?e.each(n.extensions,function(e,t){new RegExp("^"+r[1]+"/").test(t)&&[].push.apply(i,n.extensions[t])}):n.extensions[t]&&[].push.apply(i,n.extensions[t]))}),i},mimes2extList:function(n){var i=[],r=[];return"string"===e.typeOf(n)&&(n=e.trim(n).split(/\s*,\s*/)),r=this.mimes2exts(n),i.push({title:t.translate("Files"),extensions:r.length?r.join(","):"*"}),i.mimes=n,i},getFileExtension:function(e){var t=e&&e.match(/\.([^.]+)$/);return t?t[1].toLowerCase():""},getFileMime:function(e){return this.mimes[this.getFileExtension(e)]||""}};return i.addMimeType(n),i}),i(d,[u],function(e){function t(e,t,n){var i=0,r=0,o=0,a={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},s=function(e){return e=(""+e).replace(/[_\-+]/g,"."),e=e.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,"."),e.length?e.split("."):[-8]},u=function(e){return e?isNaN(e)?a[e]||-7:parseInt(e,10):0};for(e=s(e),t=s(t),r=Math.max(e.length,t.length),i=0;r>i;i++)if(e[i]!=t[i]){if(e[i]=u(e[i]),t[i]=u(t[i]),e[i]<t[i]){o=-1;break}if(e[i]>t[i]){o=1;break}}if(!n)return o;switch(n){case">":case"gt":return o>0;case">=":case"ge":return o>=0;case"<=":case"le":return 0>=o;case"==":case"=":case"eq":return 0===o;case"<>":case"!=":case"ne":return 0!==o;case"":case"<":case"lt":return 0>o;default:return null}}var n=function(e){var t="",n="?",i="function",r="undefined",o="object",a="major",s="model",u="name",c="type",l="vendor",d="version",f="architecture",h="console",p="mobile",m="tablet",g={has:function(e,t){return-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()}},v={rgx:function(){for(var t,n=0,a,s,u,c,l,d,f=arguments;n<f.length;n+=2){var h=f[n],p=f[n+1];if(typeof t===r){t={};for(u in p)c=p[u],typeof c===o?t[c[0]]=e:t[c]=e}for(a=s=0;a<h.length;a++)if(l=h[a].exec(this.getUA())){for(u=0;u<p.length;u++)d=l[++s],c=p[u],typeof c===o&&c.length>0?2==c.length?t[c[0]]=typeof c[1]==i?c[1].call(this,d):c[1]:3==c.length?t[c[0]]=typeof c[1]!==i||c[1].exec&&c[1].test?d?d.replace(c[1],c[2]):e:d?c[1].call(this,d,c[2]):e:4==c.length&&(t[c[0]]=d?c[3].call(this,d.replace(c[1],c[2])):e):t[c]=d?d:e;break}if(l)break}return t},str:function(t,i){for(var r in i)if(typeof i[r]===o&&i[r].length>0){for(var a=0;a<i[r].length;a++)if(g.has(i[r][a],t))return r===n?e:r}else if(g.has(i[r],t))return r===n?e:r;return t}},y={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2000:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}},w={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[u,d,a],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[u,"Opera"],d,a],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[u,d,a],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[u,"IE"],d,a],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[u,"Yandex"],d,a],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[u,/_/g," "],d,a],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i],[u,d,a],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[u,"Dolphin"],d,a],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[u,"Chrome"],d,a],[/((?:android.+))version\/((\d+)?[\w\.]+)\smobile\ssafari/i],[[u,"Android Browser"],d,a],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[d,a,[u,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[d,a,u],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[u,[a,v.str,y.browser.oldsafari.major],[d,v.str,y.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[u,d,a],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[u,"Netscape"],d,a],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(uc\s?browser|polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[u,d,a]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[u,d],[/rv\:([\w\.]+).*(gecko)/i],[d,u]],os:[[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[u,[d,v.str,y.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[u,"Windows"],[d,v.str,y.os.windows.version]],[/\((bb)(10);/i],[[u,"BlackBerry"],d],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i],[u,d],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[u,"Symbian"],d],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[u,"Firefox OS"],d],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[u,d],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[u,"Chromium OS"],d],[/(sunos)\s?([\w\.]+\d)*/i],[[u,"Solaris"],d],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[u,d],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[u,"iOS"],[d,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[u,[d,/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[u,d]]},E=function(e){var n=e||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:t);this.getBrowser=function(){return v.rgx.apply(this,w.browser)},this.getEngine=function(){return v.rgx.apply(this,w.engine)},this.getOS=function(){return v.rgx.apply(this,w.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}},this.getUA=function(){return n},this.setUA=function(e){return n=e,this},this.setUA(n)};return(new E).getResult()}(),i=function(){var t={define_property:function(){return!1}(),create_canvas:function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}(),return_response_type:function(t){try{if(-1!==e.inArray(t,["","text","document"]))return!0;if(window.XMLHttpRequest){var n=new XMLHttpRequest;if(n.open("get","/"),"responseType"in n)return n.responseType=t,n.responseType!==t?!1:!0}}catch(i){}return!1},use_data_uri:function(){var e=new Image;return e.onload=function(){t.use_data_uri=1===e.width&&1===e.height},setTimeout(function(){e.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1),!1}(),use_data_uri_over32kb:function(){return t.use_data_uri&&("IE"!==r.browser||r.version>=9)},use_data_uri_of:function(e){return t.use_data_uri&&33e3>e||t.use_data_uri_over32kb()},use_fileinput:function(){var e=document.createElement("input");return e.setAttribute("type","file"),!e.disabled}};return function(n){var i=[].slice.call(arguments);return i.shift(),"function"===e.typeOf(t[n])?t[n].apply(this,i):!!t[n]}}(),r={can:i,browser:n.browser.name,version:parseFloat(n.browser.major),os:n.os.name,osVersion:n.os.version,verComp:t,swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return r.OS=r.os,r}),i(f,[d],function(e){var t=function(e){return"string"!=typeof e?e:document.getElementById(e)},n=function(e,t){if(!e.className)return!1;var n=new RegExp("(^|\\s+)"+t+"(\\s+|$)");return n.test(e.className)},i=function(e,t){n(e,t)||(e.className=e.className?e.className.replace(/\s+$/,"")+" "+t:t)},r=function(e,t){if(e.className){var n=new RegExp("(^|\\s+)"+t+"(\\s+|$)");e.className=e.className.replace(n,function(e,t,n){return" "===t&&" "===n?" ":""})}},o=function(e,t){return e.currentStyle?e.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(e,null)[t]:void 0},a=function(t,n){function i(e){var t,n,i=0,r=0;return e&&(n=e.getBoundingClientRect(),t="CSS1Compat"===s.compatMode?s.documentElement:s.body,i=n.left+t.scrollLeft,r=n.top+t.scrollTop),{x:i,y:r}}var r=0,o=0,a,s=document,u,c;if(t=t,n=n||s.body,t&&t.getBoundingClientRect&&"IE"===e.browser&&(!s.documentMode||s.documentMode<8))return u=i(t),c=i(n),{x:u.x-c.x,y:u.y-c.y};for(a=t;a&&a!=n&&a.nodeType;)r+=a.offsetLeft||0,o+=a.offsetTop||0,a=a.offsetParent;for(a=t.parentNode;a&&a!=n&&a.nodeType;)r-=a.scrollLeft||0,o-=a.scrollTop||0,a=a.parentNode;return{x:r,y:o}},s=function(e){return{w:e.offsetWidth||e.clientWidth,h:e.offsetHeight||e.clientHeight}};return{get:t,hasClass:n,addClass:i,removeClass:r,getStyle:o,getPos:a,getSize:s}}),i(h,[u],function(e){function t(e,t){var n;for(n in e)if(e[n]===t)return n;return null}return{RuntimeError:function(){function n(e){this.code=e,this.name=t(i,e),this.message=this.name+": RuntimeError "+this.code}var i={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};return e.extend(n,i),n.prototype=Error.prototype,n}(),OperationNotAllowedException:function(){function t(e){this.code=e,this.name="OperationNotAllowedException"}return e.extend(t,{NOT_ALLOWED_ERR:1}),t.prototype=Error.prototype,t}(),ImageError:function(){function n(e){this.code=e,this.name=t(i,e),this.message=this.name+": ImageError "+this.code}var i={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2};return e.extend(n,i),n.prototype=Error.prototype,n}(),FileException:function(){function n(e){this.code=e,this.name=t(i,e),this.message=this.name+": FileException "+this.code}var i={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};return e.extend(n,i),n.prototype=Error.prototype,n}(),DOMException:function(){function n(e){this.code=e,this.name=t(i,e),this.message=this.name+": DOMException "+this.code}var i={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};return e.extend(n,i),n.prototype=Error.prototype,n}(),EventException:function(){function t(e){this.code=e,this.name="EventException"}return e.extend(t,{UNSPECIFIED_EVENT_TYPE_ERR:0}),t.prototype=Error.prototype,t}()}}),i(p,[h,u],function(e,t){function n(){var n={};t.extend(this,{uid:null,init:function(){this.uid||(this.uid=t.guid("uid_"))},addEventListener:function(e,i,r,o){var a=this,s;return e=t.trim(e),/\s/.test(e)?void t.each(e.split(/\s+/),function(e){a.addEventListener(e,i,r,o)}):(e=e.toLowerCase(),r=parseInt(r,10)||0,s=n[this.uid]&&n[this.uid][e]||[],s.push({fn:i,priority:r,scope:o||this}),n[this.uid]||(n[this.uid]={}),void(n[this.uid][e]=s))},hasEventListener:function(e){return e?!(!n[this.uid]||!n[this.uid][e]):!!n[this.uid]},removeEventListener:function(e,i){e=e.toLowerCase();var r=n[this.uid]&&n[this.uid][e],o;if(r){if(i){for(o=r.length-1;o>=0;o--)if(r[o].fn===i){r.splice(o,1);break}}else r=[];r.length||(delete n[this.uid][e],t.isEmptyObj(n[this.uid])&&delete n[this.uid])}},removeAllEventListeners:function(){n[this.uid]&&delete n[this.uid]},dispatchEvent:function(i){var r,o,a,s,u={},c=!0,l;if("string"!==t.typeOf(i)){if(s=i,"string"!==t.typeOf(s.type))throw new e.EventException(e.EventException.UNSPECIFIED_EVENT_TYPE_ERR);i=s.type,s.total!==l&&s.loaded!==l&&(u.total=s.total,u.loaded=s.loaded),u.async=s.async||!1}if(-1!==i.indexOf("::")?!function(e){r=e[0],i=e[1]}(i.split("::")):r=this.uid,i=i.toLowerCase(),o=n[r]&&n[r][i]){o.sort(function(e,t){return t.priority-e.priority}),a=[].slice.call(arguments),a.shift(),u.type=i,a.unshift(u);var d=[];t.each(o,function(e){a[0].target=e.scope,d.push(u.async?function(t){setTimeout(function(){t(e.fn.apply(e.scope,a)===!1)},1)}:function(t){t(e.fn.apply(e.scope,a)===!1)})}),d.length&&t.inSeries(d,function(e){c=!e})}return c},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},convertEventPropsToHandlers:function(e){var n;"array"!==t.typeOf(e)&&(e=[e]);for(var i=0;i<e.length;i++)n="on"+e[i],"function"===t.typeOf(this[n])?this.addEventListener(e[i],this[n]):"undefined"===t.typeOf(this[n])&&(this[n]=null)}})}return n.instance=new n,n}),i(m,[],function(){var e=function(e){return unescape(encodeURIComponent(e))},t=function(e){return decodeURIComponent(escape(e))},n=function(e,n){if("function"==typeof window.atob)return n?t(window.atob(e)):window.atob(e);var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r,o,a,s,u,c,l,d,f=0,h=0,p="",m=[];if(!e)return e;e+="";do s=i.indexOf(e.charAt(f++)),u=i.indexOf(e.charAt(f++)),c=i.indexOf(e.charAt(f++)),l=i.indexOf(e.charAt(f++)),d=s<<18|u<<12|c<<6|l,r=d>>16&255,o=d>>8&255,a=255&d,m[h++]=64==c?String.fromCharCode(r):64==l?String.fromCharCode(r,o):String.fromCharCode(r,o,a);while(f<e.length);return p=m.join(""),n?t(p):p},i=function(t,n){if(n&&e(t),"function"==typeof window.btoa)return window.btoa(t);var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r,o,a,s,u,c,l,d,f=0,h=0,p="",m=[];if(!t)return t;do r=t.charCodeAt(f++),o=t.charCodeAt(f++),a=t.charCodeAt(f++),d=r<<16|o<<8|a,s=d>>18&63,u=d>>12&63,c=d>>6&63,l=63&d,m[h++]=i.charAt(s)+i.charAt(u)+i.charAt(c)+i.charAt(l);while(f<t.length);p=m.join("");var g=t.length%3;return(g?p.slice(0,g-3):p)+"===".slice(g||3)};return{utf8_encode:e,utf8_decode:t,atob:n,btoa:i}}),i(g,[u,f,p],function(e,t,n){function i(n,r,a,s,u){var c=this,l,d=e.guid(r+"_"),f=u||"browser";n=n||{},o[d]=this,a=e.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},a),n.preferred_caps&&(f=i.getMode(s,n.preferred_caps,f)),l=function(){var t={};return{exec:function(e,n,i,r){return l[n]&&(t[e]||(t[e]={context:this,instance:new l[n]}),t[e].instance[i])?t[e].instance[i].apply(this,r):void 0},removeInstance:function(e){delete t[e]},removeAllInstances:function(){var n=this;e.each(t,function(t,i){"function"===e.typeOf(t.instance.destroy)&&t.instance.destroy.call(t.context),n.removeInstance(i)})}}}(),e.extend(this,{initialized:!1,uid:d,type:r,mode:i.getMode(s,n.required_caps,f),shimid:d+"_container",clients:0,options:n,can:function(t,n){var r=arguments[2]||a;if("string"===e.typeOf(t)&&"undefined"===e.typeOf(n)&&(t=i.parseCaps(t)),"object"===e.typeOf(t)){for(var o in t)if(!this.can(o,t[o],r))return!1;return!0}return"function"===e.typeOf(r[t])?r[t].call(this,n):n===r[t]},getShimContainer:function(){var n,i=t.get(this.shimid);return i||(n=this.options.container?t.get(this.options.container):document.body,i=document.createElement("div"),i.id=this.shimid,i.className="moxie-shim moxie-shim-"+this.type,e.extend(i.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),n.appendChild(i),n=null),i},getShim:function(){return l},shimExec:function(e,t){var n=[].slice.call(arguments,2);return c.getShim().exec.call(this,this.uid,e,t,n)},exec:function(e,t){var n=[].slice.call(arguments,2);return c[e]&&c[e][t]?c[e][t].apply(this,n):c.shimExec.apply(this,arguments)},destroy:function(){if(c){var e=t.get(this.shimid);e&&e.parentNode.removeChild(e),l&&l.removeAllInstances(),this.unbindAll(),delete o[this.uid],this.uid=null,d=c=l=e=null}}}),this.mode&&n.required_caps&&!this.can(n.required_caps)&&(this.mode=!1)}var r={},o={};return i.order="html5,flash,silverlight,html4",i.getRuntime=function(e){return o[e]?o[e]:!1},i.addConstructor=function(e,t){t.prototype=n.instance,r[e]=t},i.getConstructor=function(e){return r[e]||null},i.getInfo=function(e){var t=i.getRuntime(e);return t?{uid:t.uid,type:t.type,mode:t.mode,can:function(){return t.can.apply(t,arguments)}}:null},i.parseCaps=function(t){var n={};return"string"!==e.typeOf(t)?t||{}:(e.each(t.split(","),function(e){n[e]=!0}),n)},i.can=function(e,t){var n,r=i.getConstructor(e),o;return r?(n=new r({required_caps:t}),o=n.mode,n.destroy(),!!o):!1},i.thatCan=function(e,t){var n=(t||i.order).split(/\s*,\s*/);for(var r in n)if(i.can(n[r],e))return n[r];return null},i.getMode=function(t,n,i){var r=null;if("undefined"===e.typeOf(i)&&(i="browser"),n&&!e.isEmptyObj(t)){if(e.each(n,function(n,i){if(t.hasOwnProperty(i)){var o=t[i](n);if("string"==typeof o&&(o=[o]),r){if(!(r=e.arrayIntersect(r,o)))return r=!1}else r=o}}),r)return-1!==e.inArray(i,r)?i:r[0];if(r===!1)return!1}return i},i.capTrue=function(){return!0},i.capFalse=function(){return!1},i.capTest=function(e){return function(){return!!e}},i}),i(v,[h,u,g],function(e,t,n){return function i(){var i;t.extend(this,{connectRuntime:function(r){function o(t){var s,u;return t.length?(s=t.shift(),(u=n.getConstructor(s))?(i=new u(r),i.bind("Init",function(){i.initialized=!0,setTimeout(function(){i.clients++,a.trigger("RuntimeInit",i)},1)}),i.bind("Error",function(){i.destroy(),o(t)}),i.mode?void i.init():void i.trigger("Error")):void o(t)):(a.trigger("RuntimeError",new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR)),void(i=null))}var a=this,s;if("string"===t.typeOf(r)?s=r:"string"===t.typeOf(r.ruid)&&(s=r.ruid),s){if(i=n.getRuntime(s))return i.clients++,i;throw new e.RuntimeError(e.RuntimeError.NOT_INIT_ERR)}o((r.runtime_order||n.order).split(/\s*,\s*/))},getRuntime:function(){return i&&i.uid?i:(i=null,null)},disconnectRuntime:function(){i&&--i.clients<=0&&(i.destroy(),i=null)}})}}),i(y,[u,m,v],function(e,t,n){function i(o,a){function s(t,n,o){var a,s=r[this.uid];return"string"===e.typeOf(s)&&s.length?(a=new i(null,{type:o,size:n-t}),a.detach(s.substr(t,a.size)),a):null}n.call(this),o&&this.connectRuntime(o),a?"string"===e.typeOf(a)&&(a={data:a}):a={},e.extend(this,{uid:a.uid||e.guid("uid_"),ruid:o,size:a.size||0,type:a.type||"",slice:function(e,t,n){return this.isDetached()?s.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),e,t,n)},getSource:function(){return r[this.uid]?r[this.uid]:null},detach:function(e){this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy"),this.disconnectRuntime(),this.ruid=null),e=e||"";var n=e.match(/^data:([^;]*);base64,/);n&&(this.type=n[1],e=t.atob(e.substring(e.indexOf("base64,")+7))),this.size=e.length,r[this.uid]=e},isDetached:function(){return!this.ruid&&"string"===e.typeOf(r[this.uid])},destroy:function(){this.detach(),delete r[this.uid]}}),a.data?this.detach(a.data):r[this.uid]=a}var r={};return i}),i(w,[u,l,y],function(e,t,n){function i(i,r){var o,a;if(r||(r={}),a=r.type&&""!==r.type?r.type:t.getFileMime(r.name),r.name)o=r.name.replace(/\\/g,"/"),o=o.substr(o.lastIndexOf("/")+1);else{var s=a.split("/")[0];o=e.guid((""!==s?s:"file")+"_"),t.extensions[a]&&(o+="."+t.extensions[a][0])}n.apply(this,arguments),e.extend(this,{type:a||"",name:o||e.guid("file_"),lastModifiedDate:r.lastModifiedDate||(new Date).toLocaleString()})}return i.prototype=n.prototype,i}),i(E,[u,l,f,h,p,c,w,g,v],function(e,t,n,i,r,o,a,s,u){function c(r){var c=this,d,f,h;if(-1!==e.inArray(e.typeOf(r),["string","node"])&&(r={browse_button:r}),f=n.get(r.browse_button),!f)throw new i.DOMException(i.DOMException.NOT_FOUND_ERR);h={accept:[{title:o.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:f.parentNode||document.body},r=e.extend({},h,r),"string"==typeof r.required_caps&&(r.required_caps=s.parseCaps(r.required_caps)),"string"==typeof r.accept&&(r.accept=t.mimes2extList(r.accept)),d=n.get(r.container),d||(d=document.body),"static"===n.getStyle(d,"position")&&(d.style.position="relative"),d=f=null,u.call(c),e.extend(c,{uid:e.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){c.convertEventPropsToHandlers(l),c.bind("RuntimeInit",function(t,i){c.ruid=i.uid,c.shimid=i.shimid,c.bind("Ready",function(){c.trigger("Refresh")},999),c.bind("Change",function(){var t=i.exec.call(c,"FileInput","getFiles");c.files=[],e.each(t,function(e){return 0===e.size?!0:void c.files.push(new a(c.ruid,e))})},999),c.bind("Refresh",function(){var t,o,a,s;a=n.get(r.browse_button),s=n.get(i.shimid),a&&(t=n.getPos(a,n.get(r.container)),o=n.getSize(a),s&&e.extend(s.style,{top:t.y+"px",left:t.x+"px",width:o.w+"px",height:o.h+"px"})),s=a=null}),i.exec.call(c,"FileInput","init",r)}),c.connectRuntime(e.extend({},r,{required_caps:{select_file:!0}}))},disable:function(t){var n=this.getRuntime();n&&n.exec.call(this,"FileInput","disable","undefined"===e.typeOf(t)?!0:t)},refresh:function(){c.trigger("Refresh")},destroy:function(){var t=this.getRuntime();t&&(t.exec.call(this,"FileInput","destroy"),this.disconnectRuntime()),"array"===e.typeOf(this.files)&&e.each(this.files,function(e){e.destroy()}),this.files=null}})}var l=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];return c.prototype=r.instance,c}),i(_,[c,f,h,u,w,v,p,l],function(e,t,n,i,r,o,a,s){function u(n){var a=this,u;"string"==typeof n&&(n={drop_zone:n}),u={accept:[{title:e.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}},n="object"==typeof n?i.extend({},u,n):u,n.container=t.get(n.drop_zone)||document.body,"static"===t.getStyle(n.container,"position")&&(n.container.style.position="relative"),"string"==typeof n.accept&&(n.accept=s.mimes2extList(n.accept)),o.call(a),i.extend(a,{uid:i.guid("uid_"),ruid:null,files:null,init:function(){a.convertEventPropsToHandlers(c),a.bind("RuntimeInit",function(e,t){a.ruid=t.uid,a.bind("Drop",function(){var e=t.exec.call(a,"FileDrop","getFiles");a.files=[],i.each(e,function(e){a.files.push(new r(a.ruid,e))})},999),t.exec.call(a,"FileDrop","init",n),a.dispatchEvent("ready")}),a.connectRuntime(n)},destroy:function(){var e=this.getRuntime();e&&(e.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime()),this.files=null}})}var c=["ready","dragenter","dragleave","drop","error"];return u.prototype=a.instance,u}),i(x,[u,v,p],function(e,t,n){function i(){this.uid=e.guid("uid_"),t.call(this),this.destroy=function(){this.disconnectRuntime(),this.unbindAll()}}return i.prototype=n.instance,i}),i(b,[u,m,h,p,y,w,x],function(e,t,n,i,r,o,a){function s(){function i(e,i){function l(e){o.readyState=s.DONE,o.error=e,o.trigger("error"),d()}function d(){c.destroy(),c=null,o.trigger("loadend")}function f(t){c.bind("Error",function(e,t){l(t)}),c.bind("Progress",function(e){o.result=t.exec.call(c,"FileReader","getResult"),o.trigger(e)}),c.bind("Load",function(e){o.readyState=s.DONE,o.result=t.exec.call(c,"FileReader","getResult"),o.trigger(e),d()}),t.exec.call(c,"FileReader","read",e,i)}if(c=new a,this.convertEventPropsToHandlers(u),this.readyState===s.LOADING)return l(new n.DOMException(n.DOMException.INVALID_STATE_ERR));if(this.readyState=s.LOADING,this.trigger("loadstart"),i instanceof r)if(i.isDetached()){var h=i.getSource();switch(e){case"readAsText":case"readAsBinaryString":this.result=h;break;case"readAsDataURL":this.result="data:"+i.type+";base64,"+t.btoa(h)}this.readyState=s.DONE,this.trigger("load"),d()}else f(c.connectRuntime(i.ruid));else l(new n.DOMException(n.DOMException.NOT_FOUND_ERR))}var o=this,c;e.extend(this,{uid:e.guid("uid_"),readyState:s.EMPTY,result:null,error:null,readAsBinaryString:function(e){i.call(this,"readAsBinaryString",e)},readAsDataURL:function(e){i.call(this,"readAsDataURL",e)},readAsText:function(e){i.call(this,"readAsText",e)},abort:function(){this.result=null,-1===e.inArray(this.readyState,[s.EMPTY,s.DONE])&&(this.readyState===s.LOADING&&(this.readyState=s.DONE),c&&c.getRuntime().exec.call(this,"FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))
},destroy:function(){this.abort(),c&&(c.getRuntime().exec.call(this,"FileReader","destroy"),c.disconnectRuntime()),o=c=null}})}var u=["loadstart","progress","load","abort","error","loadend"];return s.EMPTY=0,s.LOADING=1,s.DONE=2,s.prototype=i.instance,s}),i(R,[],function(){var e=function(t,n){for(var i=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],r=i.length,o={http:80,https:443},a={},s=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,u=s.exec(t||"");r--;)u[r]&&(a[i[r]]=u[r]);if(!a.scheme){n&&"string"!=typeof n||(n=e(n||document.location.href)),a.scheme=n.scheme,a.host=n.host,a.port=n.port;var c="";/^[^\/]/.test(a.path)&&(c=n.path,/(\/|\/[^\.]+)$/.test(c)?c+="/":c=c.replace(/\/[^\/]+$/,"/")),a.path=c+(a.path||"")}return a.port||(a.port=o[a.scheme]||80),a.port=parseInt(a.port,10),a.path||(a.path="/"),delete a.source,a},t=function(t){var n={http:80,https:443},i=e(t);return i.scheme+"://"+i.host+(i.port!==n[i.scheme]?":"+i.port:"")+i.path+(i.query?i.query:"")},n=function(t){function n(e){return[e.scheme,e.host,e.port].join("/")}return"string"==typeof t&&(t=e(t)),n(e())===n(t)};return{parseUrl:e,resolveUrl:t,hasSameOrigin:n}}),i(T,[u,v,m],function(e,t,n){return function(){function i(e,t){if(!t.isDetached()){var i=this.connectRuntime(t.ruid).exec.call(this,"FileReaderSync","read",e,t);return this.disconnectRuntime(),i}var r=t.getSource();switch(e){case"readAsBinaryString":return r;case"readAsDataURL":return"data:"+t.type+";base64,"+n.btoa(r);case"readAsText":for(var o="",a=0,s=r.length;s>a;a++)o+=String.fromCharCode(r[a]);return o}}t.call(this),e.extend(this,{uid:e.guid("uid_"),readAsBinaryString:function(e){return i.call(this,"readAsBinaryString",e)},readAsDataURL:function(e){return i.call(this,"readAsDataURL",e)},readAsText:function(e){return i.call(this,"readAsText",e)}})}}),i(A,[h,u,y],function(e,t,n){function i(){var e,i=[];t.extend(this,{append:function(r,o){var a=this,s=t.typeOf(o);o instanceof n?e={name:r,value:o}:"array"===s?(r+="[]",t.each(o,function(e){a.append(r,e)})):"object"===s?t.each(o,function(e,t){a.append(r+"["+t+"]",e)}):"null"===s||"undefined"===s||"number"===s&&isNaN(o)?a.append(r,"false"):i.push({name:r,value:o.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return e&&e.value||null},getBlobName:function(){return e&&e.name||null},each:function(n){t.each(i,function(e){n(e.value,e.name)}),e&&n(e.value,e.name)},destroy:function(){e=null,i=[]}})}return i}),i(S,[u,h,p,m,R,g,x,y,T,A,d,l],function(e,t,n,i,r,o,a,s,u,c,l,d){function f(){this.uid=e.guid("uid_")}function h(){function n(e,t){return y.hasOwnProperty(e)?1===arguments.length?l.can("define_property")?y[e]:v[e]:void(l.can("define_property")?y[e]=t:v[e]=t):void 0}function u(t){function i(){k&&(k.destroy(),k=null),s.dispatchEvent("loadend"),s=null}function r(r){k.bind("LoadStart",function(e){n("readyState",h.LOADING),s.dispatchEvent("readystatechange"),s.dispatchEvent(e),I&&s.upload.dispatchEvent(e)}),k.bind("Progress",function(e){n("readyState")!==h.LOADING&&(n("readyState",h.LOADING),s.dispatchEvent("readystatechange")),s.dispatchEvent(e)}),k.bind("UploadProgress",function(e){I&&s.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:e.total,loaded:e.loaded})}),k.bind("Load",function(t){n("readyState",h.DONE),n("status",Number(r.exec.call(k,"XMLHttpRequest","getStatus")||0)),n("statusText",p[n("status")]||""),n("response",r.exec.call(k,"XMLHttpRequest","getResponse",n("responseType"))),~e.inArray(n("responseType"),["text",""])?n("responseText",n("response")):"document"===n("responseType")&&n("responseXML",n("response")),U=r.exec.call(k,"XMLHttpRequest","getAllResponseHeaders"),s.dispatchEvent("readystatechange"),n("status")>0?(I&&s.upload.dispatchEvent(t),s.dispatchEvent(t)):(N=!0,s.dispatchEvent("error")),i()}),k.bind("Abort",function(e){s.dispatchEvent(e),i()}),k.bind("Error",function(e){N=!0,n("readyState",h.DONE),s.dispatchEvent("readystatechange"),D=!0,s.dispatchEvent(e),i()}),r.exec.call(k,"XMLHttpRequest","send",{url:E,method:_,async:w,user:b,password:R,headers:x,mimeType:A,encoding:T,responseType:s.responseType,withCredentials:s.withCredentials,options:P},t)}var s=this;M=(new Date).getTime(),k=new a,"string"==typeof P.required_caps&&(P.required_caps=o.parseCaps(P.required_caps)),P.required_caps=e.extend({},P.required_caps,{return_response_type:s.responseType}),t instanceof c&&(P.required_caps.send_multipart=!0),L||(P.required_caps.do_cors=!0),P.ruid?r(k.connectRuntime(P)):(k.bind("RuntimeInit",function(e,t){r(t)}),k.bind("RuntimeError",function(e,t){s.dispatchEvent("RuntimeError",t)}),k.connectRuntime(P))}function g(){n("responseText",""),n("responseXML",null),n("response",null),n("status",0),n("statusText",""),M=C=null}var v=this,y={timeout:0,readyState:h.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},w=!0,E,_,x={},b,R,T=null,A=null,S=!1,O=!1,I=!1,D=!1,N=!1,L=!1,M,C,F=null,H=null,P={},k,U="",B;e.extend(this,y,{uid:e.guid("uid_"),upload:new f,open:function(o,a,s,u,c){var l;if(!o||!a)throw new t.DOMException(t.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(o)||i.utf8_encode(o)!==o)throw new t.DOMException(t.DOMException.SYNTAX_ERR);if(~e.inArray(o.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])&&(_=o.toUpperCase()),~e.inArray(_,["CONNECT","TRACE","TRACK"]))throw new t.DOMException(t.DOMException.SECURITY_ERR);if(a=i.utf8_encode(a),l=r.parseUrl(a),L=r.hasSameOrigin(l),E=r.resolveUrl(a),(u||c)&&!L)throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);if(b=u||l.user,R=c||l.pass,w=s||!0,w===!1&&(n("timeout")||n("withCredentials")||""!==n("responseType")))throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);S=!w,O=!1,x={},g.call(this),n("readyState",h.OPENED),this.convertEventPropsToHandlers(["readystatechange"]),this.dispatchEvent("readystatechange")},setRequestHeader:function(r,o){var a=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(n("readyState")!==h.OPENED||O)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(r)||i.utf8_encode(r)!==r)throw new t.DOMException(t.DOMException.SYNTAX_ERR);return r=e.trim(r).toLowerCase(),~e.inArray(r,a)||/^(proxy\-|sec\-)/.test(r)?!1:(x[r]?x[r]+=", "+o:x[r]=o,!0)},getAllResponseHeaders:function(){return U||""},getResponseHeader:function(t){return t=t.toLowerCase(),N||~e.inArray(t,["set-cookie","set-cookie2"])?null:U&&""!==U&&(B||(B={},e.each(U.split(/\r\n/),function(t){var n=t.split(/:\s+/);2===n.length&&(n[0]=e.trim(n[0]),B[n[0].toLowerCase()]={header:n[0],value:e.trim(n[1])})})),B.hasOwnProperty(t))?B[t].header+": "+B[t].value:null},overrideMimeType:function(i){var r,o;if(~e.inArray(n("readyState"),[h.LOADING,h.DONE]))throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(i=e.trim(i.toLowerCase()),/;/.test(i)&&(r=i.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(i=r[1],r[2]&&(o=r[2])),!d.mimes[i])throw new t.DOMException(t.DOMException.SYNTAX_ERR);F=i,H=o},send:function(n,r){if(P="string"===e.typeOf(r)?{ruid:r}:r?r:{},this.convertEventPropsToHandlers(m),this.upload.convertEventPropsToHandlers(m),this.readyState!==h.OPENED||O)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(n instanceof s)P.ruid=n.ruid,A=n.type||"application/octet-stream";else if(n instanceof c){if(n.hasBlob()){var o=n.getBlob();P.ruid=o.ruid,A=o.type||"application/octet-stream"}}else"string"==typeof n&&(T="UTF-8",A="text/plain;charset=UTF-8",n=i.utf8_encode(n));this.withCredentials||(this.withCredentials=P.required_caps&&P.required_caps.send_browser_cookies&&!L),I=!S&&this.upload.hasEventListener(),N=!1,D=!n,S||(O=!0),u.call(this,n)},abort:function(){if(N=!0,S=!1,~e.inArray(n("readyState"),[h.UNSENT,h.OPENED,h.DONE]))n("readyState",h.UNSENT);else{if(n("readyState",h.DONE),O=!1,!k)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);k.getRuntime().exec.call(k,"XMLHttpRequest","abort",D),D=!0}},destroy:function(){k&&("function"===e.typeOf(k.destroy)&&k.destroy(),k=null),this.unbindAll(),this.upload&&(this.upload.unbindAll(),this.upload=null)}})}var p={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};f.prototype=n.instance;var m=["loadstart","progress","abort","error","load","timeout","loadend"],g=1,v=2;return h.UNSENT=0,h.OPENED=1,h.HEADERS_RECEIVED=2,h.LOADING=3,h.DONE=4,h.prototype=n.instance,h}),i(O,[u,m,v,p],function(e,t,n,i){function r(){function i(){l=d=0,c=this.result=null}function o(t,n){var i=this;u=n,i.bind("TransportingProgress",function(t){d=t.loaded,l>d&&-1===e.inArray(i.state,[r.IDLE,r.DONE])&&a.call(i)},999),i.bind("TransportingComplete",function(){d=l,i.state=r.DONE,c=null,i.result=u.exec.call(i,"Transporter","getAsBlob",t||"")},999),i.state=r.BUSY,i.trigger("TransportingStarted"),a.call(i)}function a(){var e=this,n,i=l-d;f>i&&(f=i),n=t.btoa(c.substr(d,f)),u.exec.call(e,"Transporter","receive",n,l)}var s,u,c,l,d,f;n.call(this),e.extend(this,{uid:e.guid("uid_"),state:r.IDLE,result:null,transport:function(t,n,r){var a=this;if(r=e.extend({chunk_size:204798},r),(s=r.chunk_size%3)&&(r.chunk_size+=3-s),f=r.chunk_size,i.call(this),c=t,l=t.length,"string"===e.typeOf(r)||r.ruid)o.call(a,n,this.connectRuntime(r));else{var u=function(e,t){a.unbind("RuntimeInit",u),o.call(a,n,t)};this.bind("RuntimeInit",u),this.connectRuntime(r)}},abort:function(){var e=this;e.state=r.IDLE,u&&(u.exec.call(e,"Transporter","clear"),e.trigger("TransportingAborted")),i.call(e)},destroy:function(){this.unbindAll(),u=null,this.disconnectRuntime(),i.call(this)}})}return r.IDLE=0,r.BUSY=1,r.DONE=2,r.prototype=i.instance,r}),i(I,[u,f,h,T,S,g,v,O,d,p,y,w,m],function(e,t,n,i,r,o,a,s,u,c,l,d,f){function h(){function i(e){e||(e=this.getRuntime().exec.call(this,"Image","getInfo")),this.size=e.size,this.width=e.width,this.height=e.height,this.type=e.type,this.meta=e.meta,""===this.name&&(this.name=e.name)}function c(t){var i=e.typeOf(t);try{if(t instanceof h){if(!t.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);m.apply(this,arguments)}else if(t instanceof l){if(!~e.inArray(t.type,["image/jpeg","image/png"]))throw new n.ImageError(n.ImageError.WRONG_FORMAT);g.apply(this,arguments)}else if(-1!==e.inArray(i,["blob","file"]))c.call(this,new d(null,t),arguments[1]);else if("string"===i)/^data:[^;]*;base64,/.test(t)?c.call(this,new l(null,{data:t}),arguments[1]):v.apply(this,arguments);else{if("node"!==i||"img"!==t.nodeName.toLowerCase())throw new n.DOMException(n.DOMException.TYPE_MISMATCH_ERR);c.call(this,t.src,arguments[1])}}catch(r){this.trigger("error",r.code)}}function m(t,n){var i=this.connectRuntime(t.ruid);this.ruid=i.uid,i.exec.call(this,"Image","loadFromImage",t,"undefined"===e.typeOf(n)?!0:n)}function g(t,n){function i(e){r.ruid=e.uid,e.exec.call(r,"Image","loadFromBlob",t)}var r=this;r.name=t.name||"",t.isDetached()?(this.bind("RuntimeInit",function(e,t){i(t)}),n&&"string"==typeof n.required_caps&&(n.required_caps=o.parseCaps(n.required_caps)),this.connectRuntime(e.extend({required_caps:{access_image_binary:!0,resize_image:!0}},n))):i(this.connectRuntime(t.ruid))}function v(e,t){var n=this,i;i=new r,i.open("get",e),i.responseType="blob",i.onprogress=function(e){n.trigger(e)},i.onload=function(){g.call(n,i.response,!0)},i.onerror=function(e){n.trigger(e)},i.onloadend=function(){i.destroy()},i.bind("RuntimeError",function(e,t){n.trigger("RuntimeError",t)}),i.send(null,t)}a.call(this),e.extend(this,{uid:e.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){this.bind("Load Resize",function(){i.call(this)},999),this.convertEventPropsToHandlers(p),c.apply(this,arguments)},downsize:function(t){var i={width:this.width,height:this.height,crop:!1,preserveHeaders:!0};t="object"==typeof t?e.extend(i,t):e.extend(i,{width:arguments[0],height:arguments[1],crop:arguments[2],preserveHeaders:arguments[3]});try{if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);if(this.width>h.MAX_RESIZE_WIDTH||this.height>h.MAX_RESIZE_HEIGHT)throw new n.ImageError(n.ImageError.MAX_RESOLUTION_ERR);this.getRuntime().exec.call(this,"Image","downsize",t.width,t.height,t.crop,t.preserveHeaders)}catch(r){this.trigger("error",r.code)}},crop:function(e,t,n){this.downsize(e,t,!0,n)},getAsCanvas:function(){if(!u.can("create_canvas"))throw new n.RuntimeError(n.RuntimeError.NOT_SUPPORTED_ERR);var e=this.connectRuntime(this.ruid);return e.exec.call(this,"Image","getAsCanvas")},getAsBlob:function(e,t){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);return e||(e="image/jpeg"),"image/jpeg"!==e||t||(t=90),this.getRuntime().exec.call(this,"Image","getAsBlob",e,t)},getAsDataURL:function(e,t){if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);return this.getRuntime().exec.call(this,"Image","getAsDataURL",e,t)},getAsBinaryString:function(e,t){var n=this.getAsDataURL(e,t);return f.atob(n.substring(n.indexOf("base64,")+7))},embed:function(i){function r(){if(u.can("create_canvas")){var t=a.getAsCanvas();if(t)return i.appendChild(t),t=null,a.destroy(),void o.trigger("embedded")}var r=a.getAsDataURL(c,l);if(!r)throw new n.ImageError(n.ImageError.WRONG_FORMAT);if(u.can("use_data_uri_of",r.length))i.innerHTML='<img src="'+r+'" width="'+a.width+'" height="'+a.height+'" />',a.destroy(),o.trigger("embedded");else{var d=new s;d.bind("TransportingComplete",function(){v=o.connectRuntime(this.result.ruid),o.bind("Embedded",function(){e.extend(v.getShimContainer().style,{top:"0px",left:"0px",width:a.width+"px",height:a.height+"px"}),v=null},999),v.exec.call(o,"ImageView","display",this.result.uid,m,g),a.destroy()}),d.transport(f.atob(r.substring(r.indexOf("base64,")+7)),c,e.extend({},p,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:i}))}}var o=this,a,c,l,d,p=arguments[1]||{},m=this.width,g=this.height,v;try{if(!(i=t.get(i)))throw new n.DOMException(n.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new n.DOMException(n.DOMException.INVALID_STATE_ERR);if(this.width>h.MAX_RESIZE_WIDTH||this.height>h.MAX_RESIZE_HEIGHT)throw new n.ImageError(n.ImageError.MAX_RESOLUTION_ERR);if(c=p.type||this.type||"image/jpeg",l=p.quality||90,d="undefined"!==e.typeOf(p.crop)?p.crop:!1,p.width)m=p.width,g=p.height||m;else{var y=t.getSize(i);y.w&&y.h&&(m=y.w,g=y.h)}return a=new h,a.bind("Resize",function(){r.call(o)}),a.bind("Load",function(){a.downsize(m,g,d,!1)}),a.clone(this,!1),a}catch(w){this.trigger("error",w.code)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime()),this.unbindAll()}})}var p=["progress","load","error","resize","embedded"];return h.MAX_RESIZE_WIDTH=6500,h.MAX_RESIZE_HEIGHT=6500,h.prototype=c.instance,h}),i(D,[u,h,g,d],function(e,t,n,i){function r(t){var r=this,s=n.capTest,u=n.capTrue,c=e.extend({access_binary:s(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return r.can("access_binary")&&!!a.Image},display_media:s(i.can("create_canvas")||i.can("use_data_uri_over32kb")),do_cors:s(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:s(function(){var e=document.createElement("div");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&("IE"!==i.browser||i.version>9)}()),filter_by_extension:s(function(){return"Chrome"===i.browser&&i.version>=28||"IE"===i.browser&&i.version>=10}()),return_response_headers:u,return_response_type:function(e){return"json"===e&&window.JSON?!0:i.can("return_response_type",e)},return_status_code:u,report_upload_progress:s(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return r.can("access_binary")&&i.can("create_canvas")},select_file:function(){return i.can("use_fileinput")&&window.File},select_folder:function(){return r.can("select_file")&&"Chrome"===i.browser&&i.version>=21},select_multiple:function(){return!(!r.can("select_file")||"Safari"===i.browser&&"Windows"===i.os||"iOS"===i.os&&i.verComp(i.osVersion,"7.0.4","<"))},send_binary_string:s(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:s(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||r.can("send_binary_string")},slice_blob:s(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return r.can("slice_blob")&&r.can("send_multipart")},summon_file_dialog:s(function(){return"Firefox"===i.browser&&i.version>=4||"Opera"===i.browser&&i.version>=12||"IE"===i.browser&&i.version>=10||!!~e.inArray(i.browser,["Chrome","Safari"])}()),upload_filesize:u},arguments[2]);n.call(this,t,arguments[1]||o,c),e.extend(this,{init:function(){this.trigger("Init")},destroy:function(e){return function(){e.call(r),e=r=null}}(this.destroy)}),e.extend(this.getShim(),a)}var o="html5",a={};return n.addConstructor(o,r),a}),i(N,[D,y],function(e,t){function n(){function e(e,t,n){var i;if(!window.File.prototype.slice)return(i=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?i.call(e,t,n):null;try{return e.slice(),e.slice(t,n)}catch(r){return e.slice(t,n-t)}}this.slice=function(){return new t(this.getRuntime().uid,e.apply(this,arguments))}}return e.Blob=n}),i(L,[u],function(e){function t(){this.returnValue=!1}function n(){this.cancelBubble=!0}var i={},r="moxie_"+e.guid(),o=function(o,a,s,u){var c,l;a=a.toLowerCase(),o.addEventListener?(c=s,o.addEventListener(a,c,!1)):o.attachEvent&&(c=function(){var e=window.event;e.target||(e.target=e.srcElement),e.preventDefault=t,e.stopPropagation=n,s(e)},o.attachEvent("on"+a,c)),o[r]||(o[r]=e.guid()),i.hasOwnProperty(o[r])||(i[o[r]]={}),l=i[o[r]],l.hasOwnProperty(a)||(l[a]=[]),l[a].push({func:c,orig:s,key:u})},a=function(t,n,o){var a,s;if(n=n.toLowerCase(),t[r]&&i[t[r]]&&i[t[r]][n]){a=i[t[r]][n];for(var u=a.length-1;u>=0&&(a[u].orig!==o&&a[u].key!==o||(t.removeEventListener?t.removeEventListener(n,a[u].func,!1):t.detachEvent&&t.detachEvent("on"+n,a[u].func),a[u].orig=null,a[u].func=null,a.splice(u,1),o===s));u--);if(a.length||delete i[t[r]][n],e.isEmptyObj(i[t[r]])){delete i[t[r]];try{delete t[r]}catch(c){t[r]=s}}}},s=function(t,n){t&&t[r]&&e.each(i[t[r]],function(e,i){a(t,i,n)})};return{addEvent:o,removeEvent:a,removeAllEvents:s}}),i(M,[D,u,f,L,l,d],function(e,t,n,i,r,o){function a(){var e=[],a;t.extend(this,{init:function(s){var u=this,c=u.getRuntime(),l,d,f,h,p,m;a=s,e=[],f=a.accept.mimes||r.extList2mimes(a.accept,c.can("filter_by_extension")),d=c.getShimContainer(),d.innerHTML='<input id="'+c.uid+'" type="file" style="font-size:999px;opacity:0;"'+(a.multiple&&c.can("select_multiple")?"multiple":"")+(a.directory&&c.can("select_folder")?"webkitdirectory directory":"")+(f?' accept="'+f.join(",")+'"':"")+" />",l=n.get(c.uid),t.extend(l.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),h=n.get(a.browse_button),c.can("summon_file_dialog")&&("static"===n.getStyle(h,"position")&&(h.style.position="relative"),p=parseInt(n.getStyle(h,"z-index"),10)||1,h.style.zIndex=p,d.style.zIndex=p-1,i.addEvent(h,"click",function(e){var t=n.get(c.uid);t&&!t.disabled&&t.click(),e.preventDefault()},u.uid)),m=c.can("summon_file_dialog")?h:d,i.addEvent(m,"mouseover",function(){u.trigger("mouseenter")},u.uid),i.addEvent(m,"mouseout",function(){u.trigger("mouseleave")},u.uid),i.addEvent(m,"mousedown",function(){u.trigger("mousedown")},u.uid),i.addEvent(n.get(a.container),"mouseup",function(){u.trigger("mouseup")},u.uid),l.onchange=function g(){if(e=[],a.directory?t.each(this.files,function(t){"."!==t.name&&e.push(t)}):e=[].slice.call(this.files),"IE"!==o.browser&&"IEMobile"!==o.browser)this.value="";else{var n=this.cloneNode(!0);this.parentNode.replaceChild(n,this),n.onchange=g}u.trigger("change")},u.trigger({type:"ready",async:!0}),d=null},getFiles:function(){return e},disable:function(e){var t=this.getRuntime(),i;(i=n.get(t.uid))&&(i.disabled=!!e)},destroy:function(){var t=this.getRuntime(),r=t.getShim(),o=t.getShimContainer();i.removeAllEvents(o,this.uid),i.removeAllEvents(a&&n.get(a.container),this.uid),i.removeAllEvents(a&&n.get(a.browse_button),this.uid),o&&(o.innerHTML=""),r.removeInstance(this.uid),e=a=o=r=null}})}return e.FileInput=a}),i(C,[D,u,f,L,l],function(e,t,n,i,r){function o(){function e(e){if(!e.dataTransfer||!e.dataTransfer.types)return!1;var n=t.toArray(e.dataTransfer.types||[]);return-1!==t.inArray("Files",n)||-1!==t.inArray("public.file-url",n)||-1!==t.inArray("application/x-moz-file",n)}function o(e){for(var n=[],i=0;i<e.length;i++)[].push.apply(n,e[i].extensions.split(/\s*,\s*/));return-1===t.inArray("*",n)?n:[]}function a(e){if(!f.length)return!0;var n=r.getFileExtension(e.name);return!n||-1!==t.inArray(n,f)}function s(e,n){var i=[];t.each(e,function(e){var t=e.webkitGetAsEntry();if(t)if(t.isFile){var n=e.getAsFile();a(n)&&d.push(n)}else i.push(t)}),i.length?u(i,n):n()}function u(e,n){var i=[];t.each(e,function(e){i.push(function(t){c(e,t)})}),t.inSeries(i,function(){n()})}function c(e,t){e.isFile?e.file(function(e){a(e)&&d.push(e),t()},function(){t()}):e.isDirectory?l(e,t):t()}function l(e,t){function n(e){r.readEntries(function(t){t.length?([].push.apply(i,t),n(e)):e()},e)}var i=[],r=e.createReader();n(function(){u(i,t)})}var d=[],f=[],h;t.extend(this,{init:function(n){var r=this,u;h=n,f=o(h.accept),u=h.container,i.addEvent(u,"dragover",function(t){e(t)&&(t.preventDefault(),t.dataTransfer.dropEffect="copy")},r.uid),i.addEvent(u,"drop",function(n){e(n)&&(n.preventDefault(),d=[],n.dataTransfer.items&&n.dataTransfer.items[0].webkitGetAsEntry?s(n.dataTransfer.items,function(){r.trigger("drop")}):(t.each(n.dataTransfer.files,function(e){a(e)&&d.push(e)}),r.trigger("drop")))},r.uid),i.addEvent(u,"dragenter",function(e){r.trigger("dragenter")},r.uid),i.addEvent(u,"dragleave",function(e){r.trigger("dragleave")},r.uid)},getFiles:function(){return d},destroy:function(){i.removeAllEvents(h&&n.get(h.container),this.uid),d=f=h=null}})}return e.FileDrop=o}),i(F,[D,m,u],function(e,t,n){function i(){function e(e){return t.atob(e.substring(e.indexOf("base64,")+7))}var i,r=!1;n.extend(this,{read:function(e,t){var o=this;i=new window.FileReader,i.addEventListener("progress",function(e){o.trigger(e)}),i.addEventListener("load",function(e){o.trigger(e)}),i.addEventListener("error",function(e){o.trigger(e,i.error)}),i.addEventListener("loadend",function(){i=null}),"function"===n.typeOf(i[e])?(r=!1,i[e](t.getSource())):"readAsBinaryString"===e&&(r=!0,i.readAsDataURL(t.getSource()))},getResult:function(){return i&&i.result?r?e(i.result):i.result:null},abort:function(){i&&i.abort()},destroy:function(){i=null}})}return e.FileReader=i}),i(H,[D,u,l,R,w,y,A,h,d],function(e,t,n,i,r,o,a,s,u){function c(){function e(e,t){var n=this,i,r;i=t.getBlob().getSource(),r=new window.FileReader,r.onload=function(){t.append(t.getBlobName(),new o(null,{type:i.type,data:r.result})),f.send.call(n,e,t)},r.readAsBinaryString(i)}function c(){return!window.XMLHttpRequest||"IE"===u.browser&&u.version<8?function(){for(var e=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],t=0;t<e.length;t++)try{return new ActiveXObject(e[t])}catch(n){}}():new window.XMLHttpRequest}function l(e){var t=e.responseXML,n=e.responseText;return"IE"===u.browser&&n&&t&&!t.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(e.getResponseHeader("Content-Type"))&&(t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.validateOnParse=!1,t.loadXML(n)),t&&("IE"===u.browser&&0!==t.parseError||!t.documentElement||"parsererror"===t.documentElement.tagName)?null:t}function d(e){var t="----moxieboundary"+(new Date).getTime(),n="--",i="\r\n",r="",a=this.getRuntime();if(!a.can("send_binary_string"))throw new s.RuntimeError(s.RuntimeError.NOT_SUPPORTED_ERR);return h.setRequestHeader("Content-Type","multipart/form-data; boundary="+t),e.each(function(e,a){r+=e instanceof o?n+t+i+'Content-Disposition: form-data; name="'+a+'"; filename="'+unescape(encodeURIComponent(e.name||"blob"))+'"'+i+"Content-Type: "+(e.type||"application/octet-stream")+i+i+e.getSource()+i:n+t+i+'Content-Disposition: form-data; name="'+a+'"'+i+i+unescape(encodeURIComponent(e))+i}),r+=n+t+n+i}var f=this,h,p;t.extend(this,{send:function(n,r){var s=this,l="Mozilla"===u.browser&&u.version>=4&&u.version<7,f="Android Browser"===u.browser,m=!1;if(p=n.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),h=c(),h.open(n.method,n.url,n.async,n.user,n.password),r instanceof o)r.isDetached()&&(m=!0),r=r.getSource();else if(r instanceof a){if(r.hasBlob())if(r.getBlob().isDetached())r=d.call(s,r),m=!0;else if((l||f)&&"blob"===t.typeOf(r.getBlob().getSource())&&window.FileReader)return void e.call(s,n,r);if(r instanceof a){var g=new window.FormData;r.each(function(e,t){e instanceof o?g.append(t,e.getSource()):g.append(t,e)}),r=g}}h.upload?(n.withCredentials&&(h.withCredentials=!0),h.addEventListener("load",function(e){s.trigger(e)}),h.addEventListener("error",function(e){s.trigger(e)}),h.addEventListener("progress",function(e){s.trigger(e)}),h.upload.addEventListener("progress",function(e){s.trigger({type:"UploadProgress",loaded:e.loaded,total:e.total})})):h.onreadystatechange=function v(){switch(h.readyState){case 1:break;case 2:break;case 3:var e,t;try{i.hasSameOrigin(n.url)&&(e=h.getResponseHeader("Content-Length")||0),h.responseText&&(t=h.responseText.length)}catch(r){e=t=0}s.trigger({type:"progress",lengthComputable:!!e,total:parseInt(e,10),loaded:t});break;case 4:h.onreadystatechange=function(){},s.trigger(0===h.status?"error":"load")}},t.isEmptyObj(n.headers)||t.each(n.headers,function(e,t){h.setRequestHeader(t,e)}),""!==n.responseType&&"responseType"in h&&(h.responseType="json"!==n.responseType||u.can("return_response_type","json")?n.responseType:"text"),m?h.sendAsBinary?h.sendAsBinary(r):!function(){for(var e=new Uint8Array(r.length),t=0;t<r.length;t++)e[t]=255&r.charCodeAt(t);h.send(e.buffer)}():h.send(r),s.trigger("loadstart")},getStatus:function(){try{if(h)return h.status}catch(e){}return 0},getResponse:function(e){var t=this.getRuntime();try{switch(e){case"blob":var i=new r(t.uid,h.response),o=h.getResponseHeader("Content-Disposition");if(o){var a=o.match(/filename=([\'\"'])([^\1]+)\1/);a&&(p=a[2])}return i.name=p,i.type||(i.type=n.getFileMime(p)),i;case"json":return u.can("return_response_type","json")?h.response:200===h.status&&window.JSON?JSON.parse(h.responseText):null;case"document":return l(h);default:return""!==h.responseText?h.responseText:null}}catch(s){return null}},getAllResponseHeaders:function(){try{return h.getAllResponseHeaders()}catch(e){}return""},abort:function(){h&&h.abort()},destroy:function(){f=p=null}})}return e.XMLHttpRequest=c}),i(P,[],function(){return function(){function e(e,t){var n=r?0:-8*(t-1),i=0,a;for(a=0;t>a;a++)i|=o.charCodeAt(e+a)<<Math.abs(n+8*a);return i}function n(e,t,n){n=3===arguments.length?n:o.length-t-1,o=o.substr(0,t)+e+o.substr(n+t)}function i(e,t,i){var o="",a=r?0:-8*(i-1),s;for(s=0;i>s;s++)o+=String.fromCharCode(t>>Math.abs(a+8*s)&255);n(o,e,i)}var r=!1,o;return{II:function(e){return e===t?r:void(r=e)},init:function(e){r=!1,o=e},SEGMENT:function(e,t,i){switch(arguments.length){case 1:return o.substr(e,o.length-e-1);case 2:return o.substr(e,t);case 3:n(i,e,t);break;default:return o}},BYTE:function(t){return e(t,1)},SHORT:function(t){return e(t,2)},LONG:function(n,r){return r===t?e(n,4):void i(n,r,4)},SLONG:function(t){var n=e(t,4);return n>2147483647?n-4294967296:n},STRING:function(t,n){var i="";for(n+=t;n>t;t++)i+=String.fromCharCode(e(t,1));return i}}}}),i(k,[P],function(e){return function t(n){var i=[],r,o,a,s=0;if(r=new e,r.init(n),65496===r.SHORT(0)){for(o=2;o<=n.length;)if(a=r.SHORT(o),a>=65488&&65495>=a)o+=2;else{if(65498===a||65497===a)break;s=r.SHORT(o+2)+2,a>=65505&&65519>=a&&i.push({hex:a,name:"APP"+(15&a),start:o,length:s,segment:r.SEGMENT(o,s)}),o+=s}return r.init(null),{headers:i,restore:function(e){var t,n;for(r.init(e),o=65504==r.SHORT(2)?4+r.SHORT(4):2,n=0,t=i.length;t>n;n++)r.SEGMENT(o,0,i[n].segment),o+=i[n].length;return e=r.SEGMENT(),r.init(null),e},strip:function(e){var n,i,o;for(i=new t(e),n=i.headers,i.purge(),r.init(e),o=n.length;o--;)r.SEGMENT(n[o].start,n[o].length,"");return e=r.SEGMENT(),r.init(null),e},get:function(e){for(var t=[],n=0,r=i.length;r>n;n++)i[n].name===e.toUpperCase()&&t.push(i[n].segment);return t},set:function(e,t){var n=[],r,o,a;for("string"==typeof t?n.push(t):n=t,r=o=0,a=i.length;a>r&&(i[r].name===e.toUpperCase()&&(i[r].segment=n[o],i[r].length=n[o].length,o++),!(o>=n.length));r++);},purge:function(){i=[],r.init(null),r=null}}}}}),i(U,[u,P],function(e,n){return function i(){function i(e,n){var i=a.SHORT(e),r,o,s,u,d,f,h,p,m=[],g={};for(r=0;i>r;r++)if(h=f=e+12*r+2,s=n[a.SHORT(h)],s!==t){switch(u=a.SHORT(h+=2),d=a.LONG(h+=2),h+=4,m=[],u){case 1:case 7:for(d>4&&(h=a.LONG(h)+c.tiffHeader),o=0;d>o;o++)m[o]=a.BYTE(h+o);break;case 2:d>4&&(h=a.LONG(h)+c.tiffHeader),g[s]=a.STRING(h,d-1);continue;case 3:for(d>2&&(h=a.LONG(h)+c.tiffHeader),o=0;d>o;o++)m[o]=a.SHORT(h+2*o);break;case 4:for(d>1&&(h=a.LONG(h)+c.tiffHeader),o=0;d>o;o++)m[o]=a.LONG(h+4*o);break;case 5:for(h=a.LONG(h)+c.tiffHeader,o=0;d>o;o++)m[o]=a.LONG(h+4*o)/a.LONG(h+4*o+4);break;case 9:for(h=a.LONG(h)+c.tiffHeader,o=0;d>o;o++)m[o]=a.SLONG(h+4*o);break;case 10:for(h=a.LONG(h)+c.tiffHeader,o=0;d>o;o++)m[o]=a.SLONG(h+4*o)/a.SLONG(h+4*o+4);break;default:continue}p=1==d?m[0]:m,g[s]=l.hasOwnProperty(s)&&"object"!=typeof p?l[s][p]:p}return g}function r(){var e=c.tiffHeader;return a.II(18761==a.SHORT(e)),42!==a.SHORT(e+=2)?!1:(c.IFD0=c.tiffHeader+a.LONG(e+=2),u=i(c.IFD0,s.tiff),"ExifIFDPointer"in u&&(c.exifIFD=c.tiffHeader+u.ExifIFDPointer,delete u.ExifIFDPointer),"GPSInfoIFDPointer"in u&&(c.gpsIFD=c.tiffHeader+u.GPSInfoIFDPointer,delete u.GPSInfoIFDPointer),!0)}function o(e,t,n){var i,r,o,u=0;if("string"==typeof t){var l=s[e.toLowerCase()];for(var d in l)if(l[d]===t){t=d;break}}i=c[e.toLowerCase()+"IFD"],r=a.SHORT(i);for(var f=0;r>f;f++)if(o=i+12*f+2,a.SHORT(o)==t){u=o+8;break}return u?(a.LONG(u,n),!0):!1}var a,s,u,c={},l;return a=new n,s={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},l={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(e){return c={tiffHeader:10},e!==t&&e.length?(a.init(e),65505===a.SHORT(0)&&"EXIF\x00"===a.STRING(4,5).toUpperCase()?r():!1):!1
},TIFF:function(){return u},EXIF:function(){var t;if(t=i(c.exifIFD,s.exif),t.ExifVersion&&"array"===e.typeOf(t.ExifVersion)){for(var n=0,r="";n<t.ExifVersion.length;n++)r+=String.fromCharCode(t.ExifVersion[n]);t.ExifVersion=r}return t},GPS:function(){var t;return t=i(c.gpsIFD,s.gps),t.GPSVersionID&&"array"===e.typeOf(t.GPSVersionID)&&(t.GPSVersionID=t.GPSVersionID.join(".")),t},setExif:function(e,t){return"PixelXDimension"!==e&&"PixelYDimension"!==e?!1:o("exif",e,t)},getBinary:function(){return a.SEGMENT()},purge:function(){a.init(null),a=u=null,c={}}}}}),i(B,[u,h,k,P,U],function(e,t,n,i,r){function o(o){function a(){for(var e=0,t,n;e<=u.length;){if(t=c.SHORT(e+=2),t>=65472&&65475>=t)return e+=5,{height:c.SHORT(e),width:c.SHORT(e+=2)};n=c.SHORT(e+=2),e+=n-2}return null}function s(){d&&l&&c&&(d.purge(),l.purge(),c.init(null),u=f=l=d=c=null)}var u,c,l,d,f,h;if(u=o,c=new i,c.init(u),65496!==c.SHORT(0))throw new t.ImageError(t.ImageError.WRONG_FORMAT);l=new n(o),d=new r,h=!!d.init(l.get("app1")[0]),f=a.call(this),e.extend(this,{type:"image/jpeg",size:u.length,width:f&&f.width||0,height:f&&f.height||0,setExif:function(t,n){return h?("object"===e.typeOf(t)?e.each(t,function(e,t){d.setExif(t,e)}):d.setExif(t,n),void l.set("app1",d.getBinary())):!1},writeHeaders:function(){return arguments.length?l.restore(arguments[0]):u=l.restore(u)},stripHeaders:function(e){return l.strip(e)},purge:function(){s.call(this)}}),h&&(this.meta={tiff:d.TIFF(),exif:d.EXIF(),gps:d.GPS()})}return o}),i(z,[h,u,P],function(e,t,n){function i(i){function r(){var e,t;return e=a.call(this,8),"IHDR"==e.type?(t=e.start,{width:u.LONG(t),height:u.LONG(t+=4)}):null}function o(){u&&(u.init(null),s=d=c=l=u=null)}function a(e){var t,n,i,r;return t=u.LONG(e),n=u.STRING(e+=4,4),i=e+=4,r=u.LONG(e+t),{length:t,type:n,start:i,CRC:r}}var s,u,c,l,d;s=i,u=new n,u.init(s),function(){var t=0,n=0,i=[35152,20039,3338,6666];for(n=0;n<i.length;n++,t+=2)if(i[n]!=u.SHORT(t))throw new e.ImageError(e.ImageError.WRONG_FORMAT)}(),d=r.call(this),t.extend(this,{type:"image/png",size:s.length,width:d.width,height:d.height,purge:function(){o.call(this)}}),o.call(this)}return i}),i(G,[u,h,B,z],function(e,t,n,i){return function(r){var o=[n,i],a;a=function(){for(var e=0;e<o.length;e++)try{return new o[e](r)}catch(n){}throw new t.ImageError(t.ImageError.WRONG_FORMAT)}(),e.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(e){return e},stripHeaders:function(e){return e},purge:function(){}}),e.extend(this,a),this.purge=function(){a.purge(),a=null}}}),i(q,[],function(){function e(e,i,r){var o=e.naturalWidth,a=e.naturalHeight,s=r.width,u=r.height,c=r.x||0,l=r.y||0,d=i.getContext("2d");t(e)&&(o/=2,a/=2);var f=1024,h=document.createElement("canvas");h.width=h.height=f;for(var p=h.getContext("2d"),m=n(e,o,a),g=0;a>g;){for(var v=g+f>a?a-g:f,y=0;o>y;){var w=y+f>o?o-y:f;p.clearRect(0,0,f,f),p.drawImage(e,-y,-g);var E=y*s/o+c<<0,_=Math.ceil(w*s/o),x=g*u/a/m+l<<0,b=Math.ceil(v*u/a/m);d.drawImage(h,0,0,w,v,E,x,_,b),y+=f}g+=f}h=p=null}function t(e){var t=e.naturalWidth,n=e.naturalHeight;if(t*n>1048576){var i=document.createElement("canvas");i.width=i.height=1;var r=i.getContext("2d");return r.drawImage(e,-t+1,0),0===r.getImageData(0,0,1,1).data[3]}return!1}function n(e,t,n){var i=document.createElement("canvas");i.width=1,i.height=n;var r=i.getContext("2d");r.drawImage(e,0,0);for(var o=r.getImageData(0,0,1,n).data,a=0,s=n,u=n;u>a;){var c=o[4*(u-1)+3];0===c?s=u:a=u,u=s+a>>1}i=null;var l=u/n;return 0===l?1:l}return{isSubsampled:t,renderTo:e}}),i(X,[D,u,h,m,w,G,q,l,d],function(e,t,n,i,r,o,a,s,u){function c(){function e(){if(!E&&!y)throw new n.ImageError(n.DOMException.INVALID_STATE_ERR);return E||y}function c(e){return i.atob(e.substring(e.indexOf("base64,")+7))}function l(e,t){return"data:"+(t||"")+";base64,"+i.btoa(e)}function d(e){var t=this;y=new Image,y.onerror=function(){g.call(this),t.trigger("error",n.ImageError.WRONG_FORMAT)},y.onload=function(){t.trigger("load")},y.src=/^data:[^;]*;base64,/.test(e)?e:l(e,x.type)}function f(e,t){var i=this,r;return window.FileReader?(r=new FileReader,r.onload=function(){t(this.result)},r.onerror=function(){i.trigger("error",n.ImageError.WRONG_FORMAT)},r.readAsDataURL(e),void 0):t(e.getAsDataURL())}function h(n,i,r,o){var a=this,s,u,c=0,l=0,d,f,h,g;if(R=o,g=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1,-1!==t.inArray(g,[5,6,7,8])){var v=n;n=i,i=v}return d=e(),r?(n=Math.min(n,d.width),i=Math.min(i,d.height),s=Math.max(n/d.width,i/d.height)):s=Math.min(n/d.width,i/d.height),s>1&&!r&&o?void this.trigger("Resize"):(E||(E=document.createElement("canvas")),f=Math.round(d.width*s),h=Math.round(d.height*s),r?(E.width=n,E.height=i,f>n&&(c=Math.round((f-n)/2)),h>i&&(l=Math.round((h-i)/2))):(E.width=f,E.height=h),R||m(E.width,E.height,g),p.call(this,d,E,-c,-l,f,h),this.width=E.width,this.height=E.height,b=!0,void a.trigger("Resize"))}function p(e,t,n,i,r,o){if("iOS"===u.OS)a.renderTo(e,t,{width:r,height:o,x:n,y:i});else{var s=t.getContext("2d");s.drawImage(e,n,i,r,o)}}function m(e,t,n){switch(n){case 5:case 6:case 7:case 8:E.width=t,E.height=e;break;default:E.width=e,E.height=t}var i=E.getContext("2d");switch(n){case 2:i.translate(e,0),i.scale(-1,1);break;case 3:i.translate(e,t),i.rotate(Math.PI);break;case 4:i.translate(0,t),i.scale(1,-1);break;case 5:i.rotate(.5*Math.PI),i.scale(1,-1);break;case 6:i.rotate(.5*Math.PI),i.translate(0,-t);break;case 7:i.rotate(.5*Math.PI),i.translate(e,-t),i.scale(-1,1);break;case 8:i.rotate(-.5*Math.PI),i.translate(-e,0)}}function g(){w&&(w.purge(),w=null),_=y=E=x=null,b=!1}var v=this,y,w,E,_,x,b=!1,R=!0;t.extend(this,{loadFromBlob:function(e){var t=this,i=t.getRuntime(),r=arguments.length>1?arguments[1]:!0;if(!i.can("access_binary"))throw new n.RuntimeError(n.RuntimeError.NOT_SUPPORTED_ERR);return x=e,e.isDetached()?(_=e.getSource(),void d.call(this,_)):void f.call(this,e.getSource(),function(e){r&&(_=c(e)),d.call(t,e)})},loadFromImage:function(e,t){this.meta=e.meta,x=new r(null,{name:e.name,size:e.size,type:e.type}),d.call(this,t?_=e.getAsBinaryString():e.getAsDataURL())},getInfo:function(){var t=this.getRuntime(),n;return!w&&_&&t.can("access_image_binary")&&(w=new o(_)),n={width:e().width||0,height:e().height||0,type:x.type||s.getFileMime(x.name),size:_&&_.length||x.size||0,name:x.name||"",meta:w&&w.meta||this.meta||{}}},downsize:function(){h.apply(this,arguments)},getAsCanvas:function(){return E&&(E.id=this.uid+"_canvas"),E},getAsBlob:function(e,t){return e!==this.type&&h.call(this,this.width,this.height,!1),new r(null,{name:x.name||"",type:e,data:v.getAsBinaryString.call(this,e,t)})},getAsDataURL:function(e){var t=arguments[1]||90;if(!b)return y.src;if("image/jpeg"!==e)return E.toDataURL("image/png");try{return E.toDataURL("image/jpeg",t/100)}catch(n){return E.toDataURL("image/jpeg")}},getAsBinaryString:function(e,t){if(!b)return _||(_=c(v.getAsDataURL(e,t))),_;if("image/jpeg"!==e)_=c(v.getAsDataURL(e,t));else{var n;t||(t=90);try{n=E.toDataURL("image/jpeg",t/100)}catch(i){n=E.toDataURL("image/jpeg")}_=c(n),w&&(_=w.stripHeaders(_),R&&(w.meta&&w.meta.exif&&w.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),_=w.writeHeaders(_)),w.purge(),w=null)}return b=!1,_},destroy:function(){v=null,g.call(this),this.getRuntime().getShim().removeInstance(this.uid)}})}return e.Image=c}),i(j,[u,d,f,h,g],function(e,t,n,i,r){function o(){var e;try{e=navigator.plugins["Shockwave Flash"],e=e.description}catch(t){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(n){e="0.0"}}return e=e.match(/\d+/g),parseFloat(e[0]+"."+e[1])}function a(a){var c=this,l;a=e.extend({swf_url:t.swf_url},a),r.call(this,a,s,{access_binary:function(e){return e&&"browser"===c.mode},access_image_binary:function(e){return e&&"browser"===c.mode},display_media:r.capTrue,do_cors:r.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===c.mode},resize_image:r.capTrue,return_response_headers:!1,return_response_type:function(t){return"json"===t&&window.JSON?!0:!e.arrayDiff(t,["","text","document"])||"browser"===c.mode},return_status_code:function(t){return"browser"===c.mode||!e.arrayDiff(t,[200,404])},select_file:r.capTrue,select_multiple:r.capTrue,send_binary_string:function(e){return e&&"browser"===c.mode},send_browser_cookies:function(e){return e&&"browser"===c.mode},send_custom_headers:function(e){return e&&"browser"===c.mode},send_multipart:r.capTrue,slice_blob:function(e){return e&&"browser"===c.mode},stream_upload:function(e){return e&&"browser"===c.mode},summon_file_dialog:!1,upload_filesize:function(t){return e.parseSizeStr(t)<=2097152||"client"===c.mode},use_http_method:function(t){return!e.arrayDiff(t,["GET","POST"])}},{access_binary:function(e){return e?"browser":"client"},access_image_binary:function(e){return e?"browser":"client"},report_upload_progress:function(e){return e?"browser":"client"},return_response_type:function(t){return e.arrayDiff(t,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(t){return e.arrayDiff(t,[200,404])?"browser":["client","browser"]},send_binary_string:function(e){return e?"browser":"client"},send_browser_cookies:function(e){return e?"browser":"client"},send_custom_headers:function(e){return e?"browser":"client"},stream_upload:function(e){return e?"client":"browser"},upload_filesize:function(t){return e.parseSizeStr(t)>=2097152?"client":"browser"}},"client"),o()<10&&(this.mode=!1),e.extend(this,{getShim:function(){return n.get(this.uid)},shimExec:function(e,t){var n=[].slice.call(arguments,2);return c.getShim().exec(this.uid,e,t,n)},init:function(){var n,r,o;o=this.getShimContainer(),e.extend(o.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"}),n='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+a.swf_url+'" ',"IE"===t.browser&&(n+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),n+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+a.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+t.global_event_dispatcher+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',"IE"===t.browser?(r=document.createElement("div"),o.appendChild(r),r.outerHTML=n,r=o=null):o.innerHTML=n,l=setTimeout(function(){c&&!c.initialized&&c.trigger("Error",new i.RuntimeError(i.RuntimeError.NOT_INIT_ERR))},5e3)},destroy:function(e){return function(){e.call(c),clearTimeout(l),a=l=e=c=null}}(this.destroy)},u)}var s="flash",u={};return r.addConstructor(s,a),u}),i(V,[j,y],function(e,t){var n={slice:function(e,n,i,r){var o=this.getRuntime();return 0>n?n=Math.max(e.size+n,0):n>0&&(n=Math.min(n,e.size)),0>i?i=Math.max(e.size+i,0):i>0&&(i=Math.min(i,e.size)),e=o.shimExec.call(this,"Blob","slice",n,i,r||""),e&&(e=new t(o.uid,e)),e}};return e.Blob=n}),i(W,[j],function(e){var t={init:function(e){this.getRuntime().shimExec.call(this,"FileInput","init",{name:e.name,accept:e.accept,multiple:e.multiple}),this.trigger("ready")}};return e.FileInput=t}),i(Y,[j,m],function(e,t){function n(e,n){switch(n){case"readAsText":return t.atob(e,"utf8");case"readAsBinaryString":return t.atob(e);case"readAsDataURL":return e}return null}var i="",r={read:function(e,t){var r=this,o=r.getRuntime();return"readAsDataURL"===e&&(i="data:"+(t.type||"")+";base64,"),r.bind("Progress",function(t,r){r&&(i+=n(r,e))}),o.shimExec.call(this,"FileReader","readAsBase64",t.uid)},getResult:function(){return i},destroy:function(){i=null}};return e.FileReader=r}),i($,[j,m],function(e,t){function n(e,n){switch(n){case"readAsText":return t.atob(e,"utf8");case"readAsBinaryString":return t.atob(e);case"readAsDataURL":return e}return null}var i={read:function(e,t){var i,r=this.getRuntime();return(i=r.shimExec.call(this,"FileReaderSync","readAsBase64",t.uid))?("readAsDataURL"===e&&(i="data:"+(t.type||"")+";base64,"+i),n(i,e,t.type)):null}};return e.FileReaderSync=i}),i(J,[j,u,y,w,T,A,O],function(e,t,n,i,r,o,a){var s={send:function(e,i){function r(){e.transport=l.mode,l.shimExec.call(c,"XMLHttpRequest","send",e,i)}function s(e,t){l.shimExec.call(c,"XMLHttpRequest","appendBlob",e,t.uid),i=null,r()}function u(e,t){var n=new a;n.bind("TransportingComplete",function(){t(this.result)}),n.transport(e.getSource(),e.type,{ruid:l.uid})}var c=this,l=c.getRuntime();if(t.isEmptyObj(e.headers)||t.each(e.headers,function(e,t){l.shimExec.call(c,"XMLHttpRequest","setRequestHeader",t,e.toString())}),i instanceof o){var d;if(i.each(function(e,t){e instanceof n?d=t:l.shimExec.call(c,"XMLHttpRequest","append",t,e)}),i.hasBlob()){var f=i.getBlob();f.isDetached()?u(f,function(e){f.destroy(),s(d,e)}):s(d,f)}else i=null,r()}else i instanceof n?i.isDetached()?u(i,function(e){i.destroy(),i=e.uid,r()}):(i=i.uid,r()):r()},getResponse:function(e){var n,o,a=this.getRuntime();if(o=a.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){if(o=new i(a.uid,o),"blob"===e)return o;try{if(n=new r,~t.inArray(e,["","text"]))return n.readAsText(o);if("json"===e&&window.JSON)return JSON.parse(n.readAsText(o))}finally{o.destroy()}}return null},abort:function(e){var t=this.getRuntime();t.shimExec.call(this,"XMLHttpRequest","abort"),this.dispatchEvent("readystatechange"),this.dispatchEvent("abort")}};return e.XMLHttpRequest=s}),i(Z,[j,y],function(e,t){var n={getAsBlob:function(e){var n=this.getRuntime(),i=n.shimExec.call(this,"Transporter","getAsBlob",e);return i?new t(n.uid,i):null}};return e.Transporter=n}),i(K,[j,u,O,y,T],function(e,t,n,i,r){var o={loadFromBlob:function(e){function t(e){r.shimExec.call(i,"Image","loadFromBlob",e.uid),i=r=null}var i=this,r=i.getRuntime();if(e.isDetached()){var o=new n;o.bind("TransportingComplete",function(){t(o.result.getSource())}),o.transport(e.getSource(),e.type,{ruid:r.uid})}else t(e.getSource())},loadFromImage:function(e){var t=this.getRuntime();return t.shimExec.call(this,"Image","loadFromImage",e.uid)},getAsBlob:function(e,t){var n=this.getRuntime(),r=n.shimExec.call(this,"Image","getAsBlob",e,t);return r?new i(n.uid,r):null},getAsDataURL:function(){var e=this.getRuntime(),t=e.Image.getAsBlob.apply(this,arguments),n;return t?(n=new r,n.readAsDataURL(t)):null}};return e.Image=o}),i(Q,[u,d,f,h,g],function(e,t,n,i,r){function o(e){var t=!1,n=null,i,r,o,a,s,u=0;try{try{n=new ActiveXObject("AgControl.AgControl"),n.IsVersionSupported(e)&&(t=!0),n=null}catch(c){var l=navigator.plugins["Silverlight Plug-In"];if(l){for(i=l.description,"1.0.30226.2"===i&&(i="2.0.30226.2"),r=i.split(".");r.length>3;)r.pop();for(;r.length<4;)r.push(0);for(o=e.split(".");o.length>4;)o.pop();do a=parseInt(o[u],10),s=parseInt(r[u],10),u++;while(u<o.length&&a===s);s>=a&&!isNaN(a)&&(t=!0)}}}catch(d){t=!1}return t}function a(a){var c=this,l;a=e.extend({xap_url:t.xap_url},a),r.call(this,a,s,{access_binary:r.capTrue,access_image_binary:r.capTrue,display_media:r.capTrue,do_cors:r.capTrue,drag_and_drop:!1,report_upload_progress:r.capTrue,resize_image:r.capTrue,return_response_headers:function(e){return e&&"client"===c.mode},return_response_type:function(e){return"json"!==e?!0:!!window.JSON},return_status_code:function(t){return"client"===c.mode||!e.arrayDiff(t,[200,404])},select_file:r.capTrue,select_multiple:r.capTrue,send_binary_string:r.capTrue,send_browser_cookies:function(e){return e&&"browser"===c.mode},send_custom_headers:function(e){return e&&"client"===c.mode},send_multipart:r.capTrue,slice_blob:r.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:r.capTrue,use_http_method:function(t){return"client"===c.mode||!e.arrayDiff(t,["GET","POST"])}},{return_response_headers:function(e){return e?"client":"browser"},return_status_code:function(t){return e.arrayDiff(t,[200,404])?"client":["client","browser"]},send_browser_cookies:function(e){return e?"browser":"client"},send_custom_headers:function(e){return e?"client":"browser"},use_http_method:function(t){return e.arrayDiff(t,["GET","POST"])?"client":["client","browser"]}}),o("2.0.31005.0")&&"Opera"!==t.browser||(this.mode=!1),e.extend(this,{getShim:function(){return n.get(this.uid).content.Moxie},shimExec:function(e,t){var n=[].slice.call(arguments,2);return c.getShim().exec(this.uid,e,t,n)},init:function(){var e;e=this.getShimContainer(),e.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+a.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+this.uid+",target="+t.global_event_dispatcher+'"/></object>',l=setTimeout(function(){c&&!c.initialized&&c.trigger("Error",new i.RuntimeError(i.RuntimeError.NOT_INIT_ERR))},"Windows"!==t.OS?1e4:5e3)},destroy:function(e){return function(){e.call(c),clearTimeout(l),a=l=e=c=null}}(this.destroy)},u)}var s="silverlight",u={};return r.addConstructor(s,a),u}),i(et,[Q,u,V],function(e,t,n){return e.Blob=t.extend({},n)}),i(tt,[Q],function(e){var t={init:function(e){function t(e){for(var t="",n=0;n<e.length;n++)t+=(""!==t?"|":"")+e[n].title+" | *."+e[n].extensions.replace(/,/g,";*.");return t}this.getRuntime().shimExec.call(this,"FileInput","init",t(e.accept),e.name,e.multiple),this.trigger("ready")}};return e.FileInput=t}),i(nt,[Q,f,L],function(e,t,n){var i={init:function(){var e=this,i=e.getRuntime(),r;return r=i.getShimContainer(),n.addEvent(r,"dragover",function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="copy"},e.uid),n.addEvent(r,"dragenter",function(e){e.preventDefault();var n=t.get(i.uid).dragEnter(e);n&&e.stopPropagation()},e.uid),n.addEvent(r,"drop",function(e){e.preventDefault();var n=t.get(i.uid).dragDrop(e);n&&e.stopPropagation()},e.uid),i.shimExec.call(this,"FileDrop","init")}};return e.FileDrop=i}),i(it,[Q,u,Y],function(e,t,n){return e.FileReader=t.extend({},n)}),i(rt,[Q,u,$],function(e,t,n){return e.FileReaderSync=t.extend({},n)}),i(ot,[Q,u,J],function(e,t,n){return e.XMLHttpRequest=t.extend({},n)}),i(at,[Q,u,Z],function(e,t,n){return e.Transporter=t.extend({},n)}),i(st,[Q,u,K],function(e,t,n){return e.Image=t.extend({},n,{getInfo:function(){var e=this.getRuntime(),n=["tiff","exif","gps"],i={meta:{}},r=e.shimExec.call(this,"Image","getInfo");return r.meta&&t.each(n,function(e){var t=r.meta[e],n,o,a,s;if(t&&t.keys)for(i.meta[e]={},o=0,a=t.keys.length;a>o;o++)n=t.keys[o],s=t[n],s&&(/^(\d|[1-9]\d+)$/.test(s)?s=parseInt(s,10):/^\d*\.\d+$/.test(s)&&(s=parseFloat(s)),i.meta[e][n]=s)}),i.width=parseInt(r.width,10),i.height=parseInt(r.height,10),i.size=parseInt(r.size,10),i.type=r.type,i.name=r.name,i}})}),i(ut,[u,h,g,d],function(e,t,n,i){function r(t){var r=this,s=n.capTest,u=n.capTrue;n.call(this,t,o,{access_binary:s(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:s(a.Image&&(i.can("create_canvas")||i.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:s(function(){return"Chrome"===i.browser&&i.version>=28||"IE"===i.browser&&i.version>=10}()),resize_image:function(){return a.Image&&r.can("access_binary")&&i.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(t){return"json"===t&&window.JSON?!0:!!~e.inArray(t,["text","document",""])},return_status_code:function(t){return!e.arrayDiff(t,[200,404])},select_file:function(){return i.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return r.can("select_file")},summon_file_dialog:s(function(){return"Firefox"===i.browser&&i.version>=4||"Opera"===i.browser&&i.version>=12||!!~e.inArray(i.browser,["Chrome","Safari"])}()),upload_filesize:u,use_http_method:function(t){return!e.arrayDiff(t,["GET","POST"])}}),e.extend(this,{init:function(){this.trigger("Init")},destroy:function(e){return function(){e.call(r),e=r=null}}(this.destroy)}),e.extend(this.getShim(),a)}var o="html4",a={};return n.addConstructor(o,r),a}),i(ct,[ut,u,f,L,l,d],function(e,t,n,i,r,o){function a(){function e(){var r=this,l=r.getRuntime(),d,f,h,p,m,g;g=t.guid("uid_"),d=l.getShimContainer(),a&&(h=n.get(a+"_form"),h&&t.extend(h.style,{top:"100%"})),p=document.createElement("form"),p.setAttribute("id",g+"_form"),p.setAttribute("method","post"),p.setAttribute("enctype","multipart/form-data"),p.setAttribute("encoding","multipart/form-data"),t.extend(p.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"}),m=document.createElement("input"),m.setAttribute("id",g),m.setAttribute("type","file"),m.setAttribute("name",c.name||"Filedata"),m.setAttribute("accept",u.join(",")),t.extend(m.style,{fontSize:"999px",opacity:0}),p.appendChild(m),d.appendChild(p),t.extend(m.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"}),"IE"===o.browser&&o.version<10&&t.extend(m.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"}),m.onchange=function(){var t;this.value&&(t=this.files?this.files[0]:{name:this.value},s=[t],this.onchange=function(){},e.call(r),r.bind("change",function i(){var e=n.get(g),t=n.get(g+"_form"),o;r.unbind("change",i),r.files.length&&e&&t&&(o=r.files[0],e.setAttribute("id",o.uid),t.setAttribute("id",o.uid+"_form"),t.setAttribute("target",o.uid+"_iframe")),e=t=null},998),m=p=null,r.trigger("change"))},l.can("summon_file_dialog")&&(f=n.get(c.browse_button),i.removeEvent(f,"click",r.uid),i.addEvent(f,"click",function(e){m&&!m.disabled&&m.click(),e.preventDefault()},r.uid)),a=g,d=h=f=null}var a,s=[],u=[],c;t.extend(this,{init:function(t){var o=this,a=o.getRuntime(),s;c=t,u=t.accept.mimes||r.extList2mimes(t.accept,a.can("filter_by_extension")),s=a.getShimContainer(),function(){var e,r,u;e=n.get(t.browse_button),a.can("summon_file_dialog")&&("static"===n.getStyle(e,"position")&&(e.style.position="relative"),r=parseInt(n.getStyle(e,"z-index"),10)||1,e.style.zIndex=r,s.style.zIndex=r-1),u=a.can("summon_file_dialog")?e:s,i.addEvent(u,"mouseover",function(){o.trigger("mouseenter")},o.uid),i.addEvent(u,"mouseout",function(){o.trigger("mouseleave")},o.uid),i.addEvent(u,"mousedown",function(){o.trigger("mousedown")},o.uid),i.addEvent(n.get(t.container),"mouseup",function(){o.trigger("mouseup")},o.uid),e=null}(),e.call(this),s=null,o.trigger({type:"ready",async:!0})},getFiles:function(){return s},disable:function(e){var t;(t=n.get(a))&&(t.disabled=!!e)},destroy:function(){var e=this.getRuntime(),t=e.getShim(),r=e.getShimContainer();i.removeAllEvents(r,this.uid),i.removeAllEvents(c&&n.get(c.container),this.uid),i.removeAllEvents(c&&n.get(c.browse_button),this.uid),r&&(r.innerHTML=""),t.removeInstance(this.uid),a=s=u=c=r=t=null}})}return e.FileInput=a}),i(lt,[ut,F],function(e,t){return e.FileReader=t}),i(dt,[ut,u,f,R,h,L,y,A],function(e,t,n,i,r,o,a,s){function u(){function e(e){var t=this,i,r,a,s,u=!1;if(l){if(i=l.id.replace(/_iframe$/,""),r=n.get(i+"_form")){for(a=r.getElementsByTagName("input"),s=a.length;s--;)switch(a[s].getAttribute("type")){case"hidden":a[s].parentNode.removeChild(a[s]);break;case"file":u=!0}a=[],u||r.parentNode.removeChild(r),r=null}setTimeout(function(){o.removeEvent(l,"load",t.uid),l.parentNode&&l.parentNode.removeChild(l);var n=t.getRuntime().getShimContainer();n.children.length||n.parentNode.removeChild(n),n=l=null,e()},1)}}var u,c,l;t.extend(this,{send:function(d,f){function h(){var n=m.getShimContainer()||document.body,r=document.createElement("div");r.innerHTML='<iframe id="'+g+'_iframe" name="'+g+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>',l=r.firstChild,n.appendChild(l),o.addEvent(l,"load",function(){var n;try{n=l.contentWindow.document||l.contentDocument||window.frames[l.id].document,/^4(0[0-9]|1[0-7]|2[2346])\s/.test(n.title)?u=n.title.replace(/^(\d+).*$/,"$1"):(u=200,c=t.trim(n.body.innerHTML),p.trigger({type:"progress",loaded:c.length,total:c.length}),w&&p.trigger({type:"uploadprogress",loaded:w.size||1025,total:w.size||1025}))}catch(r){if(!i.hasSameOrigin(d.url))return void e.call(p,function(){p.trigger("error")});u=404}e.call(p,function(){p.trigger("load")})},p.uid)}var p=this,m=p.getRuntime(),g,v,y,w;if(u=c=null,f instanceof s&&f.hasBlob()){if(w=f.getBlob(),g=w.uid,y=n.get(g),v=n.get(g+"_form"),!v)throw new r.DOMException(r.DOMException.NOT_FOUND_ERR)}else g=t.guid("uid_"),v=document.createElement("form"),v.setAttribute("id",g+"_form"),v.setAttribute("method",d.method),v.setAttribute("enctype","multipart/form-data"),v.setAttribute("encoding","multipart/form-data"),v.setAttribute("target",g+"_iframe"),m.getShimContainer().appendChild(v);f instanceof s&&f.each(function(e,n){if(e instanceof a)y&&y.setAttribute("name",n);else{var i=document.createElement("input");t.extend(i,{type:"hidden",name:n,value:e}),y?v.insertBefore(i,y):v.appendChild(i)}}),v.setAttribute("action",d.url),h(),v.submit(),p.trigger("loadstart")},getStatus:function(){return u},getResponse:function(e){if("json"===e&&"string"===t.typeOf(c)&&window.JSON)try{return JSON.parse(c.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(n){return null}return c},abort:function(){var t=this;l&&l.contentWindow&&(l.contentWindow.stop?l.contentWindow.stop():l.contentWindow.document.execCommand?l.contentWindow.document.execCommand("Stop"):l.src="about:blank"),e.call(this,function(){t.dispatchEvent("abort")})}})}return e.XMLHttpRequest=u}),i(ft,[ut,X],function(e,t){return e.Image=t}),a([u,c,l,d,f,h,p,m,g,v,y,w,E,_,x,b,R,T,A,S,O,I,L])}(this);;(function(e){"use strict";var t={},n=e.moxie.core.utils.Basic.inArray;return function r(e){var i,s;for(i in e)s=typeof e[i],s==="object"&&!~n(i,["Exceptions","Env","Mime"])?r(e[i]):s==="function"&&(t[i]=e[i])}(e.moxie),t.Env=e.moxie.core.utils.Env,t.Mime=e.moxie.core.utils.Mime,t.Exceptions=e.moxie.core.Exceptions,e.mOxie=t,e.o||(e.o=t),t})(this);
/**
 * Plupload - multi-runtime File Uploader
 * v2.1.2
 *
 * Copyright 2013, Moxiecode Systems AB
 * Released under GPL License.
 *
 * License: http://www.plupload.com/license
 * Contributing: http://www.plupload.com/contributing
 *
 * Date: 2014-05-14
 */
;(function(e,t,n){function s(e){function r(e,t,r){var i={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};i[e]?n[i[e]]=t:r||(n[e]=t)}var t=e.required_features,n={};if(typeof t=="string")o.each(t.split(/\s*,\s*/),function(e){r(e,!0)});else if(typeof t=="object")o.each(t,function(e,t){r(t,e)});else if(t===!0){e.chunk_size>0&&(n.slice_blob=!0);if(e.resize.enabled||!e.multipart)n.send_binary_string=!0;o.each(e,function(e,t){r(t,!!e,!0)})}return n}var r=e.setTimeout,i={},o={VERSION:"2.1.2",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:t.mimes,ua:t.ua,typeOf:t.typeOf,extend:t.extend,guid:t.guid,get:function(n){var r=[],i;t.typeOf(n)!=="array"&&(n=[n]);var s=n.length;while(s--)i=t.get(n[s]),i&&r.push(i);return r.length?r:null},each:t.each,getPos:t.getPos,getSize:t.getSize,xmlEncode:function(e){var t={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"},n=/[<>&\"\']/g;return e?(""+e).replace(n,function(e){return t[e]?"&"+t[e]+";":e}):e},toArray:t.toArray,inArray:t.inArray,addI18n:t.addI18n,translate:t.translate,isEmptyObj:t.isEmptyObj,hasClass:t.hasClass,addClass:t.addClass,removeClass:t.removeClass,getStyle:t.getStyle,addEvent:t.addEvent,removeEvent:t.removeEvent,removeAllEvents:t.removeAllEvents,cleanName:function(e){var t,n;n=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"];for(t=0;t<n.length;t+=2)e=e.replace(n[t],n[t+1]);return e=e.replace(/\s+/g,"_"),e=e.replace(/[^a-z0-9_\-\.]+/gi,""),e},buildUrl:function(e,t){var n="";return o.each(t,function(e,t){n+=(n?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)}),n&&(e+=(e.indexOf("?")>0?"&":"?")+n),e},formatSize:function(e){function t(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}if(e===n||/\D/.test(e))return o.translate("N/A");var r=Math.pow(1024,4);return e>r?t(e/r,1)+" "+o.translate("tb"):e>(r/=1024)?t(e/r,1)+" "+o.translate("gb"):e>(r/=1024)?t(e/r,1)+" "+o.translate("mb"):e>1024?Math.round(e/1024)+" "+o.translate("kb"):e+" "+o.translate("b")},parseSize:t.parseSizeStr,predictRuntime:function(e,n){var r,i;return r=new o.Uploader(e),i=t.Runtime.thatCan(r.getOption().required_features,n||e.runtimes),r.destroy(),i},addFileFilter:function(e,t){i[e]=t}};o.addFileFilter("mime_types",function(e,t,n){e.length&&!e.regexp.test(t.name)?(this.trigger("Error",{code:o.FILE_EXTENSION_ERROR,message:o.translate("File extension error."),file:t}),n(!1)):n(!0)}),o.addFileFilter("max_file_size",function(e,t,n){var r;e=o.parseSize(e),t.size!==r&&e&&t.size>e?(this.trigger("Error",{code:o.FILE_SIZE_ERROR,message:o.translate("File size error."),file:t}),n(!1)):n(!0)}),o.addFileFilter("prevent_duplicates",function(e,t,n){if(e){var r=this.files.length;while(r--)if(t.name===this.files[r].name&&t.size===this.files[r].size){this.trigger("Error",{code:o.FILE_DUPLICATE_ERROR,message:o.translate("Duplicate file error."),file:t}),n(!1);return}}n(!0)}),o.Uploader=function(e){function g(){var e,t=0,n;if(this.state==o.STARTED){for(n=0;n<f.length;n++)!e&&f[n].status==o.QUEUED?(e=f[n],this.trigger("BeforeUpload",e)&&(e.status=o.UPLOADING,this.trigger("UploadFile",e))):t++;t==f.length&&(this.state!==o.STOPPED&&(this.state=o.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",f))}}function y(e){e.percent=e.size>0?Math.ceil(e.loaded/e.size*100):100,b()}function b(){var e,t;d.reset();for(e=0;e<f.length;e++)t=f[e],t.size!==n?(d.size+=t.origSize,d.loaded+=t.loaded*t.origSize/t.size):d.size=n,t.status==o.DONE?d.uploaded++:t.status==o.FAILED?d.failed++:d.queued++;d.size===n?d.percent=f.length>0?Math.ceil(d.uploaded/f.length*100):0:(d.bytesPerSec=Math.ceil(d.loaded/((+(new Date)-p||1)/1e3)),d.percent=d.size>0?Math.ceil(d.loaded/d.size*100):0)}function w(){var e=c[0]||h[0];return e?e.getRuntime().uid:!1}function E(e,n){if(e.ruid){var r=t.Runtime.getInfo(e.ruid);if(r)return r.can(n)}return!1}function S(){this.bind("FilesAdded FilesRemoved",function(e){e.trigger("QueueChanged"),e.refresh()}),this.bind("CancelUpload",O),this.bind("BeforeUpload",C),this.bind("UploadFile",k),this.bind("UploadProgress",L),this.bind("StateChanged",A),this.bind("QueueChanged",b),this.bind("Error",_),this.bind("FileUploaded",M),this.bind("Destroy",D)}function x(e,n){var r=this,i=0,s=[],u={runtime_order:e.runtimes,required_caps:e.required_features,preferred_caps:l,swf_url:e.flash_swf_url,xap_url:e.silverlight_xap_url};o.each(e.runtimes.split(/\s*,\s*/),function(t){e[t]&&(u[t]=e[t])}),e.browse_button&&o.each(e.browse_button,function(n){s.push(function(s){var a=new t.FileInput(o.extend({},u,{accept:e.filters.mime_types,name:e.file_data_name,multiple:e.multi_selection,container:e.container,browse_button:n}));a.onready=function(){var e=t.Runtime.getInfo(this.ruid);t.extend(r.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),multi_selection:e.can("select_multiple")}),i++,c.push(this),s()},a.onchange=function(){r.addFile(this.files)},a.bind("mouseenter mouseleave mousedown mouseup",function(r){v||(e.browse_button_hover&&("mouseenter"===r.type?t.addClass(n,e.browse_button_hover):"mouseleave"===r.type&&t.removeClass(n,e.browse_button_hover)),e.browse_button_active&&("mousedown"===r.type?t.addClass(n,e.browse_button_active):"mouseup"===r.type&&t.removeClass(n,e.browse_button_active)))}),a.bind("mousedown",function(){r.trigger("Browse")}),a.bind("error runtimeerror",function(){a=null,s()}),a.init()})}),e.drop_element&&o.each(e.drop_element,function(e){s.push(function(n){var s=new t.FileDrop(o.extend({},u,{drop_zone:e}));s.onready=function(){var e=t.Runtime.getInfo(this.ruid);r.features.dragdrop=e.can("drag_and_drop"),i++,h.push(this),n()},s.ondrop=function(){r.addFile(this.files)},s.bind("error runtimeerror",function(){s=null,n()}),s.init()})}),t.inSeries(s,function(){typeof n=="function"&&n(i)})}function T(e,r,i){var s=new t.Image;try{s.onload=function(){if(r.width>this.width&&r.height>this.height&&r.quality===n&&r.preserve_headers&&!r.crop)return this.destroy(),i(e);s.downsize(r.width,r.height,r.crop,r.preserve_headers)},s.onresize=function(){i(this.getAsBlob(e.type,r.quality)),this.destroy()},s.onerror=function(){i(e)},s.load(e)}catch(o){i(e)}}function N(e,n,r){function f(e,t,n){var r=a[e];switch(e){case"max_file_size":e==="max_file_size"&&(a.max_file_size=a.filters.max_file_size=t);break;case"chunk_size":if(t=o.parseSize(t))a[e]=t,a.send_file_name=!0;break;case"multipart":a[e]=t,t||(a.send_file_name=!0);break;case"unique_names":a[e]=t,t&&(a.send_file_name=!0);break;case"filters":o.typeOf(t)==="array"&&(t={mime_types:t}),n?o.extend(a.filters,t):a.filters=t,t.mime_types&&(a.filters.mime_types.regexp=function(e){var t=[];return o.each(e,function(e){o.each(e.extensions.split(/,/),function(e){/^\s*\*\s*$/.test(e)?t.push("\\.*"):t.push("\\."+e.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+t.join("|")+")$","i")}(a.filters.mime_types));break;case"resize":n?o.extend(a.resize,t,{enabled:!0}):a.resize=t;break;case"prevent_duplicates":a.prevent_duplicates=a.filters.prevent_duplicates=!!t;break;case"browse_button":case"drop_element":t=o.get(t);case"container":case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":a[e]=t,n||(u=!0);break;default:a[e]=t}n||i.trigger("OptionChanged",e,t,r)}var i=this,u=!1;typeof e=="object"?o.each(e,function(e,t){f(t,e,r)}):f(e,n,r),r?(a.required_features=s(o.extend({},a)),l=s(o.extend({},a,{required_features:!0}))):u&&(i.trigger("Destroy"),x.call(i,a,function(e){e?(i.runtime=t.Runtime.getInfo(w()).type,i.trigger("Init",{runtime:i.runtime}),i.trigger("PostInit")):i.trigger("Error",{code:o.INIT_ERROR,message:o.translate("Init error.")})}))}function C(e,t){if(e.settings.unique_names){var n=t.name.match(/\.([^.]+)$/),r="part";n&&(r=n[1]),t.target_name=t.id+"."+r}}function k(e,n){function h(){u-->0?r(p,1e3):(n.loaded=f,e.trigger("Error",{code:o.HTTP_ERROR,message:o.translate("HTTP Error."),file:n,response:m.responseText,status:m.status,responseHeaders:m.getAllResponseHeaders()}))}function p(){var d,v,g={},y;if(n.status!==o.UPLOADING||e.state===o.STOPPED)return;e.settings.send_file_name&&(g.name=n.target_name||n.name),s&&a.chunks&&c.size>s?(y=Math.min(s,c.size-f),d=c.slice(f,f+y)):(y=c.size,d=c),s&&a.chunks&&(e.settings.send_chunk_number?(g.chunk=Math.ceil(f/s),g.chunks=Math.ceil(c.size/s)):(g.offset=f,g.total=c.size)),m=new t.XMLHttpRequest,m.upload&&(m.upload.onprogress=function(t){n.loaded=Math.min(n.size,f+t.loaded),e.trigger("UploadProgress",n)}),m.onload=function(){if(m.status>=400){h();return}u=e.settings.max_retries,y<c.size?(d.destroy(),f+=y,n.loaded=Math.min(f,c.size),e.trigger("ChunkUploaded",n,{offset:n.loaded,total:c.size,response:m.responseText,status:m.status,responseHeaders:m.getAllResponseHeaders()}),t.Env.browser==="Android Browser"&&e.trigger("UploadProgress",n)):n.loaded=n.size,d=v=null,!f||f>=c.size?(n.size!=n.origSize&&(c.destroy(),c=null),e.trigger("UploadProgress",n),n.status=o.DONE,e.trigger("FileUploaded",n,{response:m.responseText,status:m.status,responseHeaders:m.getAllResponseHeaders()})):r(p,1)},m.onerror=function(){h()},m.onloadend=function(){this.destroy(),m=null},e.settings.multipart&&a.multipart?(m.open("post",i,!0),o.each(e.settings.headers,function(e,t){m.setRequestHeader(t,e)}),v=new t.FormData,o.each(o.extend(g,e.settings.multipart_params),function(e,t){v.append(t,e)}),v.append(e.settings.file_data_name,d),m.send(v,{runtime_order:e.settings.runtimes,required_caps:e.settings.required_features,preferred_caps:l,swf_url:e.settings.flash_swf_url,xap_url:e.settings.silverlight_xap_url})):(i=o.buildUrl(e.settings.url,o.extend(g,e.settings.multipart_params)),m.open("post",i,!0),m.setRequestHeader("Content-Type","application/octet-stream"),o.each(e.settings.headers,function(e,t){m.setRequestHeader(t,e)}),m.send(d,{runtime_order:e.settings.runtimes,required_caps:e.settings.required_features,preferred_caps:l,swf_url:e.settings.flash_swf_url,xap_url:e.settings.silverlight_xap_url}))}var i=e.settings.url,s=e.settings.chunk_size,u=e.settings.max_retries,a=e.features,f=0,c;n.loaded&&(f=n.loaded=s?s*Math.floor(n.loaded/s):0),c=n.getSource(),e.settings.resize.enabled&&E(c,"send_binary_string")&&!!~t.inArray(c.type,["image/jpeg","image/png"])?T.call(this,c,e.settings.resize,function(e){c=e,n.size=e.size,p()}):p()}function L(e,t){y(t)}function A(e){if(e.state==o.STARTED)p=+(new Date);else if(e.state==o.STOPPED)for(var t=e.files.length-1;t>=0;t--)e.files[t].status==o.UPLOADING&&(e.files[t].status=o.QUEUED,b())}function O(){m&&m.abort()}function M(e){b(),r(function(){g.call(e)},1)}function _(e,t){t.code===o.INIT_ERROR?e.destroy():t.file&&(t.file.status=o.FAILED,y(t.file),e.state==o.STARTED&&(e.trigger("CancelUpload"),r(function(){g.call(e)},1)))}function D(e){e.stop(),o.each(f,function(e){e.destroy()}),f=[],c.length&&(o.each(c,function(e){e.destroy()}),c=[]),h.length&&(o.each(h,function(e){e.destroy()}),h=[]),l={},v=!1,p=m=null,d.reset()}var u=o.guid(),a,f=[],l={},c=[],h=[],p,d,v=!1,m;a={runtimes:t.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_file_name:!0,send_chunk_number:!0},N.call(this,e,null,!0),d=new o.QueueProgress,o.extend(this,{id:u,uid:u,state:o.STOPPED,features:{},runtime:null,files:f,settings:a,total:d,init:function(){var e=this;typeof a.preinit=="function"?a.preinit(e):o.each(a.preinit,function(t,n){e.bind(n,t)}),S.call(this);if(!a.browse_button||!a.url){this.trigger("Error",{code:o.INIT_ERROR,message:o.translate("Init error.")});return}x.call(this,a,function(n){typeof a.init=="function"?a.init(e):o.each(a.init,function(t,n){e.bind(n,t)}),n?(e.runtime=t.Runtime.getInfo(w()).type,e.trigger("Init",{runtime:e.runtime}),e.trigger("PostInit")):e.trigger("Error",{code:o.INIT_ERROR,message:o.translate("Init error.")})})},setOption:function(e,t){N.call(this,e,t,!this.runtime)},getOption:function(e){return e?a[e]:a},refresh:function(){c.length&&o.each(c,function(e){e.trigger("Refresh")}),this.trigger("Refresh")},start:function(){this.state!=o.STARTED&&(this.state=o.STARTED,this.trigger("StateChanged"),g.call(this))},stop:function(){this.state!=o.STOPPED&&(this.state=o.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){v=arguments[0]!==n?arguments[0]:!0,c.length&&o.each(c,function(e){e.disable(v)}),this.trigger("DisableBrowse",v)},getFile:function(e){var t;for(t=f.length-1;t>=0;t--)if(f[t].id===e)return f[t]},addFile:function(e,n){function c(e,n){var r=[];t.each(s.settings.filters,function(t,n){i[n]&&r.push(function(r){i[n].call(s,t,e,function(e){r(!e)})})}),t.inSeries(r,n)}function h(e){var i=t.typeOf(e);if(e instanceof t.File){if(!e.ruid&&!e.isDetached()){if(!l)return!1;e.ruid=l,e.connectRuntime(l)}h(new o.File(e))}else e instanceof t.Blob?(h(e.getSource()),e.destroy()):e instanceof o.File?(n&&(e.name=n),u.push(function(t){c(e,function(n){n||(f.push(e),a.push(e),s.trigger("FileFiltered",e)),r(t,1)})})):t.inArray(i,["file","blob"])!==-1?h(new t.File(null,e)):i==="node"&&t.typeOf(e.files)==="filelist"?t.each(e.files,h):i==="array"&&(n=null,t.each(e,h))}var s=this,u=[],a=[],l;l=w(),h(e),u.length&&t.inSeries(u,function(){a.length&&s.trigger("FilesAdded",a)})},removeFile:function(e){var t=typeof e=="string"?e:e.id;for(var n=f.length-1;n>=0;n--)if(f[n].id===t)return this.splice(n,1)[0]},splice:function(e,t){var r=f.splice(e===n?0:e,t===n?f.length:t),i=!1;return this.state==o.STARTED&&(o.each(r,function(e){if(e.status===o.UPLOADING)return i=!0,!1}),i&&this.stop()),this.trigger("FilesRemoved",r),o.each(r,function(e){e.destroy()}),i&&this.start(),r},bind:function(e,t,n){var r=this;o.Uploader.prototype.bind.call(this,e,function(){var e=[].slice.call(arguments);return e.splice(0,1,r),t.apply(this,e)},0,n)},destroy:function(){this.trigger("Destroy"),a=d=null,this.unbindAll()}})},o.Uploader.prototype=t.EventTarget.instance,o.File=function(){function n(n){o.extend(this,{id:o.guid(),name:n.name||n.fileName,type:n.type||"",size:n.size||n.fileSize,origSize:n.size||n.fileSize,loaded:0,percent:0,status:o.QUEUED,lastModifiedDate:n.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var e=this.getSource().getSource();return t.inArray(t.typeOf(e),["blob","file"])!==-1?e:null},getSource:function(){return e[this.id]?e[this.id]:null},destroy:function(){var t=this.getSource();t&&(t.destroy(),delete e[this.id])}}),e[this.id]=n}var e={};return n}(),o.QueueProgress=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}},e.plupload=o})(window,mOxie);;

/* file-end: js/lib/plupload/plupload-2.1.2.full.min.js 
----------------------------------------------------------------------------------*/

!function(){"use strict";angular.module("angular-plupload",[]).provider("pluploadOption",function(){var a={flash_swf_url:LJ.get("siteroot")+"/js/lib/plupload/Moxie.cdn.swf",runtimes:"html5,flash",max_file_size:"10mb",multipart:!0,filters:[{title:"Image files",extensions:"jpg,jpeg,gif,png"}],chunk_size:0};return{setOptions:function(b){angular.extend(a,b)},$get:function(){return a}}}).directive("plupload",["$timeout","pluploadOption",function(a,b){function c(a){return a.charAt(0).toLowerCase()+a.slice(1)}return{scope:{url:"=plupload",options:"=pluploadOptions",callbacks:"=pluploadCallbacks",disbled:"=pluploadDisableOnUpload"},link:function(a){var d=b;d.url=a.url,angular.extend(d,a.options);var e=a.disbled,f=new plupload.Uploader(d);if(a.callbacks){var g=["Init","PostInit","OptionChanged","Refresh","StateChanged","UploadFile","BeforeUpload","QueueChanged","UploadProgress","FilesRemoved","FileFiltered","FilesAdded","FileUploaded","ChunkUploaded","UploadComplete","Error","Destroy"];angular.forEach(g,function(b){var d=a.callbacks[c(b)]||angular.noop;f.bind(b,function(){d.apply(null,arguments),a.$$phase||a.$root.$$phase||a.$apply()})})}f.init(),e&&f.bind("BeforeUpload",function(){f.addFile=angular.noop})}}}])}();;

/* file-end: js/core/angular/plupload.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/privacy.js 
*/


/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/checked.js 
*/

angular.module("LJ.Checked",[]).factory("checkedGroup",[function(){function a(){this._models={}}function b(b){return c[b]?c[b]:(c[b]=new a,c[b])}var c={};return a.prototype.reset=function(a){var b,c=this.models();for(b in c)c.hasOwnProperty(b)&&delete c[b];return angular.isObject(a)&&angular.extend(c,a),this},a.prototype.length=function(){return Object.keys(this.models()).length},a.prototype.count=function(){var a,b=this.models(),c=0;for(a in b)b.hasOwnProperty(a)&&b[a]&&(c+=1);return c},a.prototype.models=function(){return this._models},a.prototype.toggle=function(a,b){var c=this.models(),d="undefined"!=typeof b;Array.isArray(a)||(a=[a]),a.forEach(function(a){c[a]=d?b:!Boolean(c[a])})},a.prototype.isChecked=function(a){return Boolean(this.models()[a])},a.prototype.isAllChecked=function(a){var b=this.models();return"undefined"==typeof a?this.count()===this.length():(Array.isArray(a)||(a=[a]),a.every(function(a){return b[a]}))},a.prototype.isNoneChecked=function(a){var b=this.models();return"undefined"==typeof a?0===this.count():(Array.isArray(a)||(a=[a]),a.every(function(a){return!b[a]}))},a.prototype.getChecked=function(a){var b,c=this.models(),d=[];for(b in c)c.hasOwnProperty(b)&&c[b]&&d.push(b);return"undefined"!=typeof a&&(Array.isArray(a)||(a=[a]),a=a.map(String),d=d.filter(function(b){return-1!==a.indexOf(b)})),d},b}]);;

/* file-end: js/core/angular/checked.js 
----------------------------------------------------------------------------------*/

Site.page.template['angular/privacy.ng.tmpl'] = ' <span>\n\n  <select\n          name=\"privacy\"\n          ng-model=\"model.privacy\"\n          ng-attr-tabindex=\"{{tab}}\"\n          ng-options=\"item.value as item.title for item in privacy.all\">\n  </select>\n\n  <ul class=\"privacy-list\" ng-if=\"model.privacy === \'custom\'\">\n    <li class=\"privacy-item\" ng-repeat=\"group in privacy.groups track by group.id\">\n        <label>\n          <input type=\"checkbox\" ng-model=\"privacy.selected[group.id]\" name=\"custom_bit_{{group.id}}\" ng-attr-tabindex=\"{{tab}}\">\n          <span ng-bind=\"group.name\"></span>\n        </label>\n    </li>\n  </ul>\n\n</span>\n';
//= require_ml flatmedia.security
//= require_ml admin.writers_block.answer.private
//= require_ml admin.writers_block.answer.public
//= require_ml admin.writers_block.answer.custom
//= require_ml admin.writers_block.answer.friends
//= require_ml admin.writers_block.answer.default
//= require_ml admin.writers_block.answer.members
//= require_ml admin.writers_block.answer.maintainers
!function(){"use strict";angular.module("LJ.Privacy",["LJ.Templates","LJ.Api","LJ.Checked"]).factory("Privacy",["Api",function(a){function b(b){return a.call("user.get_privacy_list",b,{cache:!0}).then(function(a){return a.list})}function c(b){return b=b||{},a.call("groups.list",b,{cache:!0}).then(function(a){return a.groups})}return{getGroups:c,getPrivacyList:b}}]).directive("ljPrivacy",["$timeout","Privacy","checkedGroup",function(a,b,c){return{scope:{model:"=ljPrivacy",scope:"=ljPrivacyScope",user:"=ljPrivacyUser",tab:"=ljPrivacyTabindex",init:"=ljPrivacyInit"},templateUrl:"privacy.ng.tmpl",controllerAs:"privacy",controller:["$scope","$attrs",function(d,e){function f(){d.$watchCollection(function(){return i.getChecked()},function(a){d.model.groupids=a.map(Number)})}function g(){j&&(h.selected=i.models(),b.getPrivacyList({scope:d.scope,user:d.user}).then(function(a){if(h.all=[],a.forEach(function(a){h.all.push({title:LJ.ml("admin.writers_block.answer."+a),value:a})}),e.hasOwnProperty("ljPrivacyDeafult")&&h.all.unshift({title:LJ.ml("admin.writers_block.answer.default"),value:""}),!d.communityChanged)var b=h.all.find(function(a){return a.value===d.model.privacy});b||(d.model.privacy=h.all[0].value)}),b.getGroups({journal:d.user}).then(function(a){h.groups=a,i.toggle(d.model.groupids,!0),f()}))}var h=this,i=c("custom"),j=!0;e.hasOwnProperty("ljPrivacyInit")&&d.$watch("init",function(b){j=b,a(g)}),d.$watch("user",g),d.$watchCollection("model.groupids",function(){i.toggle(d.model.groupids,!0)}),LJ.Event.on("community:change",function(){d.needStateRestore?d.needStateRestore=!1:d.communityChanged=!0}),LJ.Event.on("state_restore",function(){d.needStateRestore=!0})}]}}])}();;

/* file-end: js/core/angular/privacy.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/video/video.js 
*/

//= require_ml flatmedia.adult.content.default
//= require_ml flatmedia.adult.content.none
//= require_ml flatmedia.adult.content.explicit
//= require_ml flatmedia.select.album.none
!function(){"use strict";angular.module("Video.Service",[]).factory("Video",["Api",function(a){function b(b){return a.call("video.create_record",b).then(function(a){return s(a.record),a.record})}function c(b){return a.call("video.get_albums",Object.assign({user:v},b),{cache:!0}).then(function(a){a.albums.forEach(j)})}function d(b){return a.call("video.get_album",{id:b,user:v},{cache:!0}).then(function(a){j(a.album)})}function e(b,c){return a.call("video.get_records",Object.assign({albumid:b,user:v},c),{cache:!0}).then(function(a){var b=a.records;return s(b),b})}function f(b){return a.call("video.get_record",{storageid:b},{cache:!0}).then(function(a){var b=a.record;return s(b),b})}function g(b){return a.call("video.update_album",b).then(function(){j(b),a.invalidate("video.get_albums",{user:v}),a.invalidate("video.get_album",{id:b.id,user:v})})}function h(b){var c=angular.extend({},{security:"public",user:v},b);return a.call("video.create_album",c).then(function(b){var c=b.album;return j(c),a.invalidate("video.get_albums",{user:v}),c})}function i(b){return a.call("video.delete_album",{id:b}).then(function(c){return k(b),a.invalidate("video.get_albums",{user:v}),a.invalidate("video.get_album",{user:v,id:b}),c})}function j(a){w[a.id]=a}function k(a){delete w[a],p(a).forEach(function(a){l(a.id)})}function l(a){delete x[a]}function m(){var a=[];return angular.forEach(w,function(b){a.push(b)}),a.sort(function(a,b){return b.id-a.id}),a}function n(a){return w[a]}function o(a){return x[a]}function p(a){var b=[];return angular.forEach(x,function(c){c.albumid===a&&b.push(c)}),b.sort(function(a,b){return b.timecreate-a.timecreate}),b}function q(b){return a.call("video.update_records",b).then(function(b){var c=b.records;return c.forEach(function(b){var c=o(b.id);a.invalidate("video.get_records",{albumid:b.albumid,user:v}),a.invalidate("video.get_album",{user:v,id:b.albumid}),a.invalidate("video.get_records",{albumid:c.albumid,user:v}),a.invalidate("video.get_album",{user:v,id:c.albumid}),a.invalidate("video.get_albums",{user:v}),s(b)}),c})}function r(b){return a.call("video.delete_records",{ids:b}).then(function(){b.forEach(function(a){l(a)})})}function s(a){Array.isArray(a)||(a=[a]),a.forEach(function(a){x[a.id]=a})}var t={NON_SELECTED_ALBUM:{id:-1,name:LJ.ml("flatmedia.select.album.none")},RECORD_ADULT:!1,RECORD_PRIVACY:"public",ALBUM_PRIVACY:"public",ALBUM_NAME:""},u={createRecord:b,fetchAlbums:c,getAlbums:m,fetchAlbum:d,getAlbumById:n,fetchRecords:e,fetchRecordByStorageId:f,getRecordById:o,getRecordsByAlbumId:p,createAlbum:h,updateAlbum:g,removeAlbum:i,updateRecords:q,removeRecords:r,defaults:t},v=LJ.get("journal.username")||LJ.get("remote.username"),w={},x={};return u}])}();;

/* file-end: js/video/video.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/video/selectAlbum.js 
*/


Site.page.template['angular/video/selectVideoAlbum.ng.tmpl'] = '<div class=\"b-ljform-field\"\n  ng-class=\"{\n    \'flatpopup-create-state\': directive.state.create\n  }\"\n  >\n\n  <div class=\"flatmedia-edit-field\">\n    <label class=\"flatpopup-label\" lj-ml=\"flatmedia.select.album\"></label>\n    <select\n      ng-model=\"directive.selectedAlbumId\"\n      ng-options=\"album.id as album.name for album in directive.albums\"\n      ></select>\n    <span lj-ml=\"flatmedia.or\"></span>\n    <a\n      class=\"flatmedia-action-link\"\n      href=\"javascript:void(0);\"\n      ng-click=\"directive.toggle(true)\"\n      lj-ml=\"flatmedia.album.create.new\"\n      ></a>\n  </div>\n\n  <div class=\"flatmedia-create-field\">\n    <label class=\"flatpopup-label\" lj-ml=\"flatmedia.album.name\"></label>\n    <a\n      class=\"flatpopup-action-link flatpopup-aside-link\"\n      href=\"javascript:void(0);\"\n      ng-click=\"directive.toggle(false)\"\n      lj-ml=\"flatmedia.button.back\"\n      ng-if=\"directive.albums.length\"\n      ></a>\n    <input\n      type=\"text\"\n      class=\"b-input b-input-max\"\n      ng-model=\"directive.newAlbum.name\"\n      maxlength=\"150\"\n      />\n  </div>\n</div>\n';
//= require_ml flatmedia.album.create.new
//= require_ml flatmedia.album.name
//= require_ml flatmedia.button.back
//= require_ml flatmedia.or
//= require_ml flatmedia.select.album
!function(){"use strict";angular.module("Video.SelectAlbum",["LJ.Templates","Video.Service"]).directive("selectVideoAlbum",["Video",function(a){return{templateUrl:"selectVideoAlbum.ng.tmpl",controllerAs:"directive",scope:{album:"=selectVideoAlbum",allowNonSelected:"=?allowNonSelected"},controller:["$scope","$attrs","Video",function(a,b,c){function d(){var c=b.allowNonSelected;return"string"==typeof c&&0===c.length?!0:a.allowNonSelected}function e(a){var b=[];return d()&&b.push(c.defaults.NON_SELECTED_ALBUM),b.concat(a?a:c.getAlbums())}var f=this,g=this.state={init:!1,create:!1};this.newAlbum={name:""},this.init=function(){g.init=!0,f.albums=angular.copy(c.getAlbums()),a.album.id?this.selectedAlbumId=a.album.id:0!==f.albums.length&&(this.selectedAlbumId=f.albums[0].id),a.$watch(function(){return f.selectedAlbumId+f.newAlbum.name+g.create},function(){a.album=g.create?f.newAlbum:c.getAlbumById(f.selectedAlbumId)}),a.$watchCollection(c.getAlbums,function(a){f.albums=e(a),0===a.length&&(g.create=!0)}),"undefined"!=typeof b.allowNonSelected&&a.$watch("allowNonSelected",function(){f.albums=e()})},this.toggle=function(a){g.create=a,this.newAlbum.name=""}}],link:function(b,c,d,e){if("undefined"==typeof b.album)throw new TypeError("You should provide album object");a.fetchAlbums().then(function(){e.init()})}}}])}();;

/* file-end: js/video/selectAlbum.js 
----------------------------------------------------------------------------------*/

Site.page.template['angular/video/uploaderVideo.ng.tmpl'] = '<div\n    class=\"flatpopup__body-inner flatpopup__text\"\n    ng-if=\"directive.state.init\"\n    ng-class=\'{\n        \"flatpopup-uploading\": directive.state.uploadInProgress,\n        \"flatpopup-uploading-complete\": directive.state.uploadDone\n    }\'\n    >\n    <div\n        class=\"b-ljform-field upload__box\"\n        id=\"upload-panel-video\"\n        plupload=\"directive.uploadUrl\"\n        plupload-options=\"directive.uploadOptions\"\n        plupload-callbacks=\"directive.uploadCallbacks\"\n        >\n        <label\n            for=\"pickfiles-video\"\n            class=\"upload__box-label\"\n            lj-ml=\"{\n                \'videouploader.upload.dragOrClick\': !directive.files.length,\n                \'videouploader.upload.selectedFile\': directive.files.length\n            }\"\n            lj-ml-resolve=\"{ filename: directive.files.length && directive.files[0].name }\"\n            lj-ml-dynamic=\"directive.files.length\"\n            ></label>\n        <input\n            type=\"file\"\n            class=\"upload__input\"\n            name=\"media\"\n            id=\"pickfiles-video\"\n            ng-hide=\"directive.state.uploading\"\n            >\n    </div>\n\n    <div class=\"upload-bar\">\n        <span\n            class=\"upload-bar__inner\"\n            ng-style=\"{ width: directive.file.percent + \'%\' }\"\n            ></span>\n    </div>\n\n    <div class=\"flatpopup__msg\">\n        <span\n            class=\"\n                b-bubble\n                b-bubble-warning\n                b-bubble-noarrow\n                flatpopup__msg-warning\n                flatpopup__msg-text\n                \"\n            ></span>\n    </div>\n\n    <div class=\"b-ljform-field\">\n        <div class=\"b-ljform-field-head\">\n            <label\n                class=\"flatpopup-label\"\n                lj-ml=\"flatmedia.name\"\n                ></label>\n        </div>\n        <div class=\"b-ljform-field-body\">\n            <input\n                class=\"b-input b-input-max\"\n                type=\"text\"\n                name=\"title\"\n                ng-model=\"directive.model.name\"\n                >\n        </div>\n    </div>\n\n    <div class=\"b-ljform-field\">\n        <div select-video-album=\"directive.model.album\"></div>\n    </div>\n\n    <div class=\"b-ljform-field flatmedia-privacy__field\">\n        <label lj-ml=\"flatmedia.security\"></label>\n        <span\n            lj-privacy=\"directive.model\"\n            lj-privacy-scope=\"video\"\n            ></span>\n    </div>\n\n    <div\n        class=\"b-ljform-field\"\n        lj-adult=\"directive.model.adult_content\"\n        ></div>\n\n    <div class=\"b-ljform-field\">\n        <lj-flatbutton lj-flatbutton=\"[\'button\', \'flatmedia.upload.video\', \'b-flatbutton b-flatbutton-simple\', \'ng-disabled\', \'!directive.isUploadAllowed()\', \'ng-click\', \'directive.upload()\']\">\n        </lj-flatbutton>\n        <a\n            class=\"flatpopup-action-link\"\n            href=\"javascript:void(0)\"\n            ng-click=\"directive.cancel()\"\n            lj-ml=\"flatmedia.button.cancel\"\n            ></a>\n    </div>\n\n</div>\n\n<div class=\"b-photouploader-initfail\" ng-if=\"!directive.state.init\">\n    <span\n        class=\"b-photouploader-initfail-flash\"\n        lj-ml=\"photouploader.upload.initFail\"\n        ></span>\n</div>\n';
//= require_ml flatmedia.button.cancel
//= require_ml flatmedia.name
//= require_ml flatmedia.upload.video
//= require_ml videouploader.upload.dragOrClick
//= require_ml videouploader.upload.selectedFile
//= require_ml photouploader.upload.initFail
!function(){"use strict";angular.module("Video.Uploader",["LJ.Templates","LJ.Api","LJ.Adult","LJ.Privacy","LJ.Messages","angular-plupload","Video.SelectAlbum","Video.Service"]).directive("ljVideoUploader",["$timeout",function(a){return{templateUrl:"uploaderVideo.ng.tmpl",scope:{albumId:"=ljVideoUploader",callback:"&ljVideoUploaderCallback",cancelUpload:"&ljVideoUploaderCancel"},controllerAs:"directive",controller:["$scope","$q","$rootScope","$element","$attrs","Video","Messages",function(b,c,d,e,f,g,h){function i(){return{name:g.defaults.ALBUM_NAME,privacy:g.defaults.RECORD_PRIVACY,album:g.getAlbumById(b.albumId)||{},adult_content:g.defaults.RECORD_ADULT}}var j,k=this,l=this.state={init:!1,error:!1,uploadInProgress:!1,uploadDone:!1,fileAdded:!1};this.isUploadAllowed=function(){return j&&0!==j.trim().length&&0!==this.model.name.trim().length&&(this.model.album.id||0!==this.model.album.name.trim().length)&&!this.state.uploadInProgress},this.init=function(){l.init=!0,this.model=i()},this.upload=function(){k.state.uploadInProgress=!0,this.beforeUpload().then(function(a){var c=k.uploader.files;LJ.Event.trigger("video:upload:start"),c[0].name=a.name,k.file.id=a.id,k.uploader.settings.url=a.upload_link,k.uploader.start(),LJ.Event.once("video:upload:done",function(){b.callback({record:a})})})},this.cancel=function(){LJ.Event.trigger("video:upload:cancel"),k.state.uploadInProgress=!1,"function"==typeof b.cancelUpload&&b.cancelUpload()},this.beforeUpload=function(){var a=angular.copy(k.model),b=c.defer(),d=b.promise;return"undefined"==typeof a.album.id?d=g.createAlbum({name:a.album.name}):b.resolve(a.album),delete a.album,d.then(function(b){var c=k.uploader.files[0],d=angular.extend(a,{name:k.model.name.trim(),size:c.size});return a.albumid=b.id,g.createRecord(d).then(function(a){return a})})},this.uploadUrl="/sampleUrl",this.uploadOptions={drop_element:"upload-panel-video",browse_button:"pickfiles-video",multi_selection:!1,filters:{max_file_size:"10240mb",mime_types:[{title:"Video files",extensions:"avi,mp4,mov,3gp,wmv,mkv,webm"}]},multipart:!0,file_data_name:"media"},this.uploadCallbacks={init:function(a){k.uploader=a},filesAdded:function(b,c){a(function(){k.state.uploadDone=!1,k.file=angular.copy(c[0]),b.splice(0,b.files.length-1),j=k.model.name=c[0].name})},uploadProgress:function(a,b){k.file.percent=b.percent},uploadComplete:function(){k.state.error||(k.state.uploadInProgress=!1,k.state.uploadDone=!0,LJ.Event.trigger("video:upload:done"))},error:function(b,c){return k.state.uploadInProgress=!1,k.state.error=!0,c.code===window.plupload.INIT_ERROR?void(k.state.init=!1):(c.code===window.plupload.HTTP_ERROR&&k.file&&g.removeRecords([k.file.id]),void a(function(){h.error({body:c.message})}))}},LJ.Event.on("Uploader:filesAdded:video",function(b){a(function(){k.file=angular.copy(b[0])})})}],link:function(b,c,d,e){a(function(){e.init()})}}}])}();;

/* file-end: js/video/uploader.js 
----------------------------------------------------------------------------------*/


LJ.injectStyle('.b-photouploader {\n    width: 480px;\n    }\n\n\n\n/* items */\n.b-photouploader-items {\n    margin: 0;\n    }\n    .b-photouploader-item {\n        margin: 0;\n        padding: 1em 0 0;\n        }\n    /* item upload */\n    .b-photouploader-item-upload {\n        }\n        /* start */\n        .b-photouploader-item-upload-start {\n            }\n            .b-photouploader-item-upload-start .b-photouploader-panel-pictures,\n            .b-photouploader-item-upload-start .b-photouploader-panel-controls {\n                display: none;\n                }\n                .b-photouploader-item-upload-start .b-photouploader-panel-upload {\n                    margin-bottom: 0;\n                    }\n        /* uploaded */\n        .b-photouploader-item-upload-uploaded {\n            }\n            .b-photouploader-item-upload-uploaded .b-photouploader-panel-pictures {\n                margin-bottom: 15px;\n                overflow: auto;\n                max-height: 250px;\n                }\n\n        /* from flatmedia.css */\n        /* edit media popup */\n        .flatmedia-create-field {\n            display: none;\n            }\n\n        /* states */\n        .flatpopup-loading .flatpopup__preloader {\n            display: block;\n            }\n            .flatpopup-loading .flatpopup__body:after {\n                display: block;\n                position: absolute;\n                top: 0;\n                right: 0;\n                bottom: 0;\n                left: 0;\n                background: #FFF;\n                opacity: .6;\n                z-index: 1;\n                }\n        .flatpopup-warning-state .flatpopup__msg-warning,\n        .flatpopup-success-state .flatpopup__msg-success {\n            display: block;\n            }\n        .flatpopup-create-state .flatmedia-create-field {\n            display: block;\n            }\n        .flatpopup-create-state .flatmedia-edit-field {\n            display: none;\n            }\n        .flatpopup-loading-state {\n            position: relative;\n            width: 100%;\n            min-height: 34px;\n            }\n            .flatpopup-loading-state:before {\n                display: block;\n                position: absolute;\n                z-index: 1;\n                top: 0;\n                right: 0;\n                bottom: 0;\n                left: 0;\n                opacity: .6;\n                content: \"\";\n                background: #FFF;\n                }\n            .flatpopup-loading-state:after {\n                display: block;\n                position: absolute;\n                z-index: 2;\n                top: 50%;\n                left: 50%;\n                width: 34px;\n                height: 34px;\n                margin-top: -17px;\n                margin-left: -17px;\n                content: \"\";\n                background: url(/img/preloader/preloader-disc-blue-white.gif?v=39255) 50% 50% no-repeat;\n                }\n        /* create-edit popups */\n        .flatpopup-delete-btn {\n            display: none;\n            }\n        .flatpopup-edit-state .flatpopup-delete-btn {\n            display: inline-block;\n            }\n        /* flatpopup form elements */\n        .flatpopup SELECT,\n        .flatpopup-label+SELECT {\n            max-width: 160px;\n            margin: 0 5px 0 0;\n            font-size: 14px;\n            vertical-align: middle;\n            }\n        .flatpopup-label {\n            color: #004359;\n            }\n            .b-ljform-field .flatpopup-label {\n                margin-right: 6px;\n                }\n        /* upload container */\n        .upload__box {\n            overflow: hidden;\n            position: relative;\n            min-height: 49px;\n            border: 4px dashed #DAE3E6;\n            background: #FFF;\n            text-align: center;\n            }\n            .upload__box-label {\n                display: block;\n                margin: -5px;\n                padding: 15px;\n                border: 4px dashed #DAE3E6;\n                background: #FFF;\n                cursor: pointer;\n                }\n        .upload__input {\n            position: absolute !important;\n            top: 0;\n            right: 0;\n            width: 100%;\n            height: 50px;\n            margin: 0;\n            padding: 0;\n            border: 0;\n            opacity: 0;\n            filter: alpha(opacity=0);\n            zoom: 1;\n            font-size: 10000px;\n            cursor: pointer;\n            }\n        .upload__items {\n            position: relative;\n            margin: 25px 0 19px;\n            padding: 0;\n            list-style: none;\n            }\n            .upload__item {\n                display: inline-block;\n                position: relative;\n                width: 144px;\n                height: 144px;\n                margin: 0 20px 30px;\n                padding: 22px;\n                cursor: pointer;\n                background-color: #FFF;\n                box-shadow: 0 7px 22px -9px #999;\n                box-sizing: border-box;\n                }\n                .upload__item_pic {\n                    display: block;\n                    width: 100px;\n                    height: 100px;\n                    background-position: 0 0;\n                    background-repeat: no-repeat;\n                    background-size: cover;\n                    text-align: center;\n                    }\n                .upload__item_remove {\n                    display: inline-block;\n                    position: absolute;\n                    top: -11px;\n                    right: -11px;\n                    width: 20px;\n                    height: 20px;\n                    border: 2px solid #cf0011;\n                    border-radius: 50%;\n                    cursor: pointer;\n                    background-color: #FFF;\n                    box-shadow: 0 3px 5px -3px #000000;\n                    }\n                    .upload__item_remove .svgicon {\n                        position: absolute;\n                        top: 50%;\n                        left: 50%;\n                        width: 12px;\n                        height: 12px;\n                        margin-top: -6px;\n                        margin-left: -6px;\n                        }\n\n        /* uploading progress bar animation */\n        .upload-bar {\n            opacity: 0;\n            position: relative;\n            height: 6px;\n            margin: 0 0 10px;\n            border-radius: 6px;\n            background-color: #CCC;\n            }\n            .upload-bar__inner {\n                position: absolute;\n                left: 0;\n                top: 0;\n                height: 6px;\n                border-radius: 6px;\n                background-color: #0099CC;\n                }\n                .upload-bar__inner:after {\n                    content: \"\";\n                    z-index: 1;\n                    position: absolute;\n                    overflow: hidden;\n                    top: 0;\n                    left: 0;\n                    bottom: 0;\n                    right: 0;\n                    background-image:\n                       -webkit-gradient(linear, 0 0, 100% 100%,\n                          color-stop(.25, rgba(255, 255, 255, .2)),\n                          color-stop(.25, transparent), color-stop(.5, transparent),\n                          color-stop(.5, rgba(255, 255, 255, .2)),\n                          color-stop(.75, rgba(255, 255, 255, .2)),\n                          color-stop(.75, transparent), to(transparent)\n                       );\n                    background-image:\n                        -webkit-linear-gradient(\n                          -45deg,\n                          rgba(255, 255, 255, .2) 25%,\n                          transparent 25%,\n                          transparent 50%,\n                          rgba(255, 255, 255, .2) 50%,\n                          rgba(255, 255, 255, .2) 75%,\n                          transparent 75%,\n                          transparent\n                       );\n                    background-image:\n                        -moz-linear-gradient(\n                          -45deg,\n                          rgba(255, 255, 255, .2) 25%,\n                          transparent 25%,\n                          transparent 50%,\n                          rgba(255, 255, 255, .2) 50%,\n                          rgba(255, 255, 255, .2) 75%,\n                          transparent 75%,\n                          transparent\n                       );\n                    background-image:\n                        -ms-linear-gradient(\n                          -45deg,\n                          rgba(255, 255, 255, .2) 25%,\n                          transparent 25%,\n                          transparent 50%,\n                          rgba(255, 255, 255, .2) 50%,\n                          rgba(255, 255, 255, .2) 75%,\n                          transparent 75%,\n                          transparent\n                       );\n                    background-image:\n                        -o-linear-gradient(\n                          -45deg,\n                          rgba(255, 255, 255, .2) 25%,\n                          transparent 25%,\n                          transparent 50%,\n                          rgba(255, 255, 255, .2) 50%,\n                          rgba(255, 255, 255, .2) 75%,\n                          transparent 75%,\n                          transparent\n                       );\n                    background-size:         50px 50px;\n                    -webkit-animation: move 2s linear infinite;\n                       -moz-animation: move 2s linear infinite;\n                        -ms-animation: move 2s linear infinite;\n                            animation: move 2s linear infinite;\n                    }\n\n                    @-webkit-keyframes move {\n                        0% { background-position: 0 0; }\n                        100% { background-position: 50px 50px;}\n                        }\n                    @-moz-keyframes move {\n                        0% { background-position: 0 0; }\n                        100% { background-position: 50px 50px;}\n                        }\n                    @-o-keyframes move {\n                        0% { background-position: 0 0; }\n                        100% { background-position: 50px 50px;}\n                        }\n                    @keyframes move {\n                        0% { background-position: 0 0; }\n                        100% { background-position: 50px 50px;}\n                        }\n\n            .flatpopup-uploading .upload-bar {\n                opacity: 1;\n                }\n\n            .flatpopup-uploading .upload-bar__inner,\n            .flatpopup-uploading .upload-bar {\n                -webkit-transition-property: all;\n                   -moz-transition-property: all;\n                    -ms-transition-property: all;\n                        transition-property: all;\n                -webkit-transition-duration: .3s;\n                   -moz-transition-duration: .3s;\n                    -ms-transition-duration: .3s;\n                        transition-duration: .3s;\n                }\n            .flatpopup-uploading-complete .upload-bar {\n                opacity: 0;\n                -webkit-transition-property: opacity;\n                   -moz-transition-property: opacity;\n                    -ms-transition-property: opacity;\n                        transition-property: opacity;\n                -webkit-transition-duration: .3s;\n                   -moz-transition-duration: .3s;\n                    -ms-transition-duration: .3s;\n                        transition-duration: .3s;\n\n                }\n        .flatpopup__msg-text {\n            display: none;\n            margin: 1em 0;\n            }\n        .flatpopup-action-link {\n            white-space: nowrap;\n            border: 0;\n            background-color: transparent;\n            color: #00A3D9;\n            }\n        .b-flatbutton + .flatpopup-action-link {\n            margin-left: 4px;\n            font: 14px/1 \"ProximaNovaSemibold\",Tahoma,Arial,sans-serif;\n            font: 0.875em/1 normal normal \'ProximaNovaSemibold\', Tahoma, Arial, sans-serif;\n            text-transform: uppercase;\n            }\n        .flatpopup-aside-link {\n            float: right;\n            }\n\n\n\n\n/* panel */\n.b-photouploader-panel {\n    margin: 0;\n    }\n.b-photouploader-panel:after {\n    content: \"\";\n    display: table;\n    border-collapse: collapse;\n    clear: both;\n    }\n/* upload */\n.b-photouploader-panel-upload {\n    margin: 0 0 15px;\n    }\n/* pictures */\n.b-photouploader-panel-pictures {\n    margin: 0;\n    }\n/* albums */\n.b-photouploader-panel-albums {\n    margin: 0;\n    }\n/* url */\n.b-photouploader-panel-url {\n    margin: 0 0 15px;\n    }\n/* dropbox login */\n.b-photouploader-panel-dropbox {\n    text-align: center;\n    }\n    .b-photouploader-panel-dropbox-intro {\n        width: 75%;\n        margin: 0 auto 1em;\n        line-height: 1.4;\n        }\n/* instagram login */\n.b-photouploader-panel-instalogin {\n    text-align: center;\n    }\n    .b-photouploader-panel-instalogin-intro {\n        width: 70%;\n        margin: 0 auto 1em;\n        text-align: left;\n        line-height: 1.4;\n        }\n\n\n\n/* by url */\n.b-photouploader-byurl {\n    margin: 0 0 0 110px;\n    padding: 0;\n    }\n.b-photouploader-byurl:after {\n    content: \"\";\n    display: table;\n    border-collapse: collapse;\n    clear: both;\n    }\n    .b-photouploader-byurl-picture {\n        position: relative;\n        left: -110px;\n        float: left;\n        width: 100px;\n        max-height: 100px;\n        margin: 0 -100px 0 0;\n        padding: 0;\n        box-shadow: 0 0 10px #BBB;\n        background: #FFF;\n        }\n        .b-photouploader-byurl-image {\n            max-width: 100px;\n            max-height: 100px;\n            margin: 0;\n            vertical-align: top;\n            }\n        .b-photouploader-byurl-sub {\n            display: block;\n            margin: 0;\n            padding: 10px;\n            font-size: 86%;\n            color: #999;\n            }\n    .b-photouploader-byurl-form {\n        margin: 0 0 1em;\n        }\n        .b-photouploader-byurl-label {\n            display: block;\n            margin: 0 0 0.5em;\n            }\n        .b-photouploader-byurl-br {\n            display: none;\n            }\n        .b-photouploader-byurl-src {\n            margin: 0;\n            width: 380px;\n            }\n        .b-photouploader-byurl-link {\n            margin: 0;\n            width: 250px;\n            }\n        .b-photouploader-byurl-note {\n            display: block;\n            margin: 0.5em 0 0;\n            font-size: 86%;\n            font-style: normal;\n            color: #666;\n            }\n\n\n\n/* separatorÂ */\n.b-photouploader-albumsettings-separator {\n    display: none;\n    }\n\n\n\n/* controls */\n.b-photouploader-panel-controls {\n    margin: 0 -15px;\n    padding: 15px;\n    border-top: 1px solid #FFF;\n    box-shadow: 0 -1px 0 #CCC;\n    }\n    .b-photouploader-panel-controls .b-photouploader-albumselector {\n        float: left;\n        width: 70%;\n        }\n        .b-photouploader-albumselector-item {\n            margin: 0 0 0.5em;\n            }\n            .b-photouploader-albumselector-input {\n                width: 280px;\n                }\n    .b-photouploader-panel-controls .b-photouploader-albumsettings {\n        float: left;\n        }\n        .b-photouploader-albumsettings-select {\n            margin: 0 1em 0 0;\n            }\n    .b-photouploader-panel-controls .b-photouploader-urlsettings {\n        margin: 0 0 1em;\n        }\n        .b-photouploader-urlsettings-label {\n            margin: 0 .5em 0 0;\n            }\n    .b-photouploader-panel-controls .b-photouploader-instasettings {\n        float: left;\n        width: 75%;\n        }\n        .b-photouploader-instasettings-label {\n            margin: 0 1em 0 0;\n            }\n        .b-photouploader-instasettings-annex {\n            display: block;\n            margin: 0 0 0 1.7em;\n            color: #999;\n            }\n    .b-photouploader-panel-controls .b-ljbutton {\n        float: right;\n        }\n    .b-photouploader-panel-controls .b-flatbutton {\n        float: right;\n        }\n    /* show old-design buttons and show new one (LJSUP-19180)Â */\n    .b-photouploader-panel-controls .b-ljbutton {\n        display: inline-block;\n        }\n    .b-photouploader-panel-controls .b-flatbutton {\n        display: none;\n        }\n    .s-schemius .b-photouploader-panel-controls .b-ljbutton {\n        display: none;\n        }\n    .s-schemius .b-photouploader-panel-controls .b-flatbutton {\n        display: inline-block;\n        }\n\n\n\n/* uploader */\n.b-photouploader-uploader {\n    margin: 0;\n    padding: 25px 15px;\n    border: 1px solid #BBB;\n    border-radius: 5px;\n    text-align: center;\n    line-height: 2;\n    color: #666;\n    }\n.drag-and-drop .b-photouploader-uploader {\n    box-shadow: inset 0 0 15px #526283;\n    border: 2px dashed #999;\n    border-radius: 0;\n    background: #FFF;\n    }\n    .b-photouploader-uploader-drop {\n        display: none;\n        margin: 0;\n        padding: 0;\n        color: #666;\n        }\n        .b-photouploader-uploader-drop STRONG {\n            font-size: 1.5em;\n            font-weight: normal;\n            color: #666;\n            }\n    .b-photouploader-uploader-nodrop {\n        margin: 0;\n        }\n        .b-photouploader-uploader-nodrop STRONG {\n            font-size: 1.5em;\n            font-weight: normal;\n            color: #666;\n            }\n    .drag-and-drop .b-photouploader-uploader-drop {\n        display: block;\n        }\n    .drag-and-drop .b-photouploader-uploader-nodrop {\n        display: none;\n        }\n    .b-photouploader-uploader-input {\n        color: #666;\n        }\n    .b-photouploader-uploader-list {\n        width: 40%;\n        margin: 5px auto;\n        padding: 0;\n        list-style-type: decimal;\n        text-align: left;\n        line-height: 1.2;\n        }\n        .b-photouploader-uploader-list-item {\n            margin: 0 0 0.5em;\n            padding: 0;\n            }\n\n\n\n/* pictures */\n.b-photouploader-pictures {\n    margin: 0;\n    padding: 0;\n    list-style: none;\n    }\n    /* item */\n    .b-photouploader-pictures-item {\n        position: relative;\n        display: inline-block;\n        width: 142px;\n        margin: 0 5px 5px 0;\n        padding: 10px;\n        vertical-align: top;\n        }\n        .b-photouploader-pictures-pic {\n            display: table-cell;\n            width: 132px;\n            height: 132px;\n            margin: 0;\n            padding: 5px;\n            vertical-align: middle;\n            box-shadow: 0 5px 10px #CCC;\n            background: #FFF;\n            text-align: center;\n            }\n            .b-photouploader-pictures-img {\n                max-width: 132px;\n                max-height: 132px;\n                vertical-align: top;\n                }\n        .b-photouploader-pictures-remove {\n            display: none;\n            overflow: hidden;\n            position: absolute;\n            top: 0;\n            right: 0;\n            z-index: 1;\n            width: 21px;\n            height: 21px;\n            background: url(/img/icons/remove.png?v=37651) no-repeat 0 0;\n            font: 0/0 a;\n            cursor: pointer;\n            }\n        .b-photouploader-pictures-title {\n            display: none;\n            overflow: hidden;\n            margin: 0;\n            padding: 5px 5px 0;\n            white-space: nowrap;\n            text-overflow: ellipsis;\n            text-align: center;\n            font-size: 90%;\n            font-weight: normal;\n            }\n    /* selected */\n    .b-photouploader-pictures-item.selected {\n        border-radius: 3px;\n        box-shadow: inset 0 0 4px #444;\n        background: #2C5188;\n        background: #2C5188 -moz-linear-gradient(top, #2C5188 0%, #2E8FED 100%);\n        background: #2C5188 -webkit-linear-gradient(top, #2C5188 0%,#2E8FED 100%);\n        background: #2C5188 -o-linear-gradient(top, #2C5188 0%,#2E8FED 100%);\n        background: #2C5188 linear-gradient(to bottom, #2C5188 0%,#2E8FED 100%);\n        color: #FFF;\n        }\n        .b-photouploader-pictures-item.selected .b-photouploader-pictures-pic {\n            box-shadow: 0 2px 4px #666;\n            }\n        .b-photouploader-pictures-item.selected .b-photouploader-pictures-title {\n            color: #FFF;\n            }\n/* pictures with remove button */\n.b-photouploader-pictures-withremove {\n    }\n    .b-photouploader-pictures-withremove .b-photouploader-pictures-remove {\n        display: block;\n        }\n/* pictures with title */\n.b-photouploader-pictures-withtitle {\n    }\n    .b-photouploader-pictures-withtitle .b-photouploader-pictures-title {\n        display: block;\n        }\n\n/* pictures with move pointer */\n.b-photouploader-pictures-withmove {\n    }\n    .b-photouploader-pictures-withmove .b-photouploader-pictures-pic {\n        cursor: move;\n        }\n\n\n\n/* nav */\n.b-photouploader-nav {\n    position: absolute;\n    top: 0;\n    left: 0;\n    z-index: 2;\n    width: 100%;\n    margin: 0;\n    padding: 10px 0 25px;\n    list-style: none;\n    background: -moz-linear-gradient(top, rgba(247,249,250,1) 0%, rgba(247,249,250,0) 100%);\n    background: -webkit-linear-gradient(top, rgba(247,249,250,1) 0%,rgba(247,249,250,0) 100%);\n    background: -o-linear-gradient(top, rgba(247,249,250,1) 0%,rgba(247,249,250,0) 100%);\n    background: linear-gradient(to bottom, rgba(247,249,250,1) 0%,rgba(247,249,250,0) 100%);\n    }\n    .b-photouploader-nav-item {\n        display: inline;\n        margin: 0;\n        padding: 0;\n        }\n    .b-photouploader-nav-item:before {\n        content: \"/\";\n        }\n    .b-photouploader-nav-item:first-child:before {\n        content: \"\";\n        }\n        .b-photouploader-nav-item A:link,\n        .b-photouploader-nav-item A:visited {\n            border-bottom: 1px dotted;\n            text-decoration: none;\n            color: #0051B7 !important;\n            }\n        .b-photouploader-nav-item A:hover,\n        .b-photouploader-nav-item A:active {\n            border-bottom: 1px dotted;\n            text-decoration: none;\n            color: #C00 !important;\n            }\n\n\n\n/* albums */\n.b-photouploader-albums {\n    position: relative;\n    }\n    .b-photouploader-albums-inner {\n        overflow: auto;\n        height: 250px;\n        margin: 0 -15px;\n        padding: 10px 15px 0;\n        background: #F7F9FA;\n        }\n/* albums with nav */\n.b-photouploader-albums-withnav {\n    }\n    .b-photouploader-albums-withnav .b-photouploader-albums-inner {\n        padding-top: 40px;\n        }\n/* loading */\n.b-photouploader-albums-loading {\n    }\n    .b-photouploader-albums-loading .b-photouploader-albums-inner:after {\n        content: \" \";\n        position: absolute;\n        bottom: 0;\n        left: 50%;\n        width: 30px;\n        height: 30px;\n        margin: 0 0 0 -15px;\n        padding: 0;\n        background: url(/img/preloader/preloader-blue-blue.gif?v=16423) no-repeat 0 0;\n        font: 0/0 a;\n        }\n\n.b-photouploader-albums-select {\n    max-width: 200px;\n    }\n\n.b-photouploader-search {\n    margin: 0 -15px 1px;\n    padding: 0 15px 15px;\n    border-bottom: 1px solid #CCC;\n    box-shadow: 0 1px 0 #FFF;\n    }\n    .b-photouploader-search-input {\n        width: 100%;\n        box-sizing: border-box;\n        }\n\n\n\n.b-photouploader-subhead {\n    margin: 0 0 0.5em;\n    font-weight: bold;\n    font-size: 1em;\n    }\n    .b-photouploader-subhead-annex {\n        font-weight: normal;\n        }\n.b-photouploader-subtext {\n    margin: 0 0 1em;\n    font-size: 1em;\n    line-height: 1.4;\n    }\n.b-photouploader-logout {\n    margin: 0;\n    }\n.b-photouploader .b-photouploader-logout:link,\n.b-photouploader .b-photouploader-logout:visited {\n    border-bottom: 1px dotted;\n    text-decoration: none;\n    color: #0051B7 !important;\n    }\n.b-photouploader .b-photouploader-logout:hover,\n.b-photouploader .b-photouploader-logout:active {\n    text-decoration: none;\n    color: #C00 !important;\n    }\n\n\n\n/* subhead at instagram panel */\n.b-photouploader-instahead {\n    margin: 0;\n    }\n.b-photouploader-instahead:after {\n    content: \"\";\n    display: table;\n    border-collapse: collapse;\n    clear: both;\n    }\n    .b-photouploader-instahead .b-photouploader-subhead {\n        float: left;\n        }\n    .b-photouploader-instahead .b-photouploader-logout {\n        float: right;\n        }\n\n\n\n.b-photouploader-instagram-signup:link {\n    display: inline-block;\n    position: relative;\n    margin: 0 0 1px;\n    padding: 0.5em 1.75em 0.5em 1em;\n    border: 1px solid #CCC;\n    border-right: 0.25em solid #00558D;\n    border-radius: 0.25em;\n    background: #F8F8F8;\n    text-shadow: 1px 1px #FFF;\n    text-decoration: none;\n    font-size: 1.5em;\n    color: #333;\n    }\n:root * > .b-photouploader-instagram-signup:before,\n:root * > .b-photouploader-instagram-signup:after {\n    content: \' \';\n    display: block;\n    position: absolute;\n    }\n.b-photouploader-instagram-signup:before {\n    top: 0;\n    right: 0;\n    width: 0.25em;\n    height: 100%;\n    background: #FBB03B;\n    border-left: 0.25em solid #D4145A;\n    border-right: 0.25em solid #00A99D;\n    }\n.b-photouploader-instagram-signup:after {\n    width: 100%;\n    height: 100%;\n    top: 0;\n    left: 0;\n    border-radius: 0.25em;\n    padding-left: 0.25em;\n    box-shadow: inset 1px 1px 0px rgba(255,255,255,0.5), inset -1px -1px 0 rgba(0,0,0,0.1);\n    background: -moz-linear-gradient(top, rgba(255,255,255,0.35) 0%, rgba(255,255,255,0.2) 49%, rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 100%);\n    background: -webkit-linear-gradient(top, rgba(255,255,255,0.35) 0%, rgba(255,255,255,0.2) 49%, rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 100%);\n    background: linear-gradient(to bottom, rgba(255,255,255,0.35) 0%, rgba(255,255,255,0.2) 49%, rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 100%);\n    }\n.b-photouploader-instagram-signup,\n.b-photouploader-instagram-signup:before {\n    -webkit-transition-property: background, border;\n    -webkit-transition: 0.1s ease-in;\n    -moz-transition-property: background, border;\n    -moz-transition: 0.1s ease-in;\n    -o-transition-property: background, border;\n    -o-transition: 0.1s ease-in;\n    transition-property: background, border;\n    transition: 0.1s ease-in;\n    }\n.b-photouploader-instagram-signup:hover,\n.b-photouploader-instagram-signup:focus  {\n    background: #FFF;\n    }\n.b-photouploader-instagram-signup:hover {\n    border-right: 0.25em solid #09C;\n    }\n.b-photouploader-instagram-signup:hover:before {\n    background: #FC6;\n    border-left: 0.25em solid #F06;\n    border-right: 0.25em solid #0CC;\n    }\n.b-photouploader-instagram-signup:hover:after {\n    background: -moz-linear-gradient(top, rgba(255,255,255,0.25) 0%, rgba(255,255,255,0.1) 49%, rgba(255,255,255,0) 50%, rgba(0,0,0,0.05) 100%);\n    background: -webkit-linear-gradient(top, rgba(255,255,255,0.25) 0%, rgba(255,255,255,0.1) 49%, rgba(255,255,255,0) 50%, rgba(0,0,0,0.05) 100%);\n    background: linear-gradient(to bottom, rgba(255,255,255,0.25) 0%, rgba(255,255,255,0.1) 49%, rgba(255,255,255,0) 50%, rgba(0,0,0,0.05) 100%);\n    }\n.b-photouploader-instagram-signup:active {\n    margin: 1px 0 0;\n    }\n.b-popup .b-photouploader-instagram-signup:link,\n.b-popup .b-photouploader-instagram-signup:visited,\n.b-popup .b-photouploader-instagram-signup:hover,\n.b-popup .b-photouploader-instagram-signup:active {\n    border: 1px solid #CCC;\n    border-right: 0.25em solid #00558D;\n    text-decoration: none;\n    }\n\n\n\n@media all and (max-width: 650px) {\n\n    .b-photouploader {\n        width: auto;\n        }\n\n    /* separatorÂ */\n    .b-photouploader-albumsettings-separator {\n        display: block;\n        }\n\n    .b-photouploader-byurl {\n        margin-left: 0;\n        }\n        .b-photouploader-byurl-picture {\n            left: auto;\n            float: none;\n            width: 100%;\n            max-width: 380px;\n            margin: 0 auto 20px;\n            text-align: center;\n            }\n\n}\n');
LJ.injectStyle('.b-menu{position:relative;margin:0;padding:0;list-style:none}.b-menu:after{content:\"\";display:table;border-collapse:collapse;clear:both}.b-menu-item{display:block;font-family:ProximaNovaSemibold,Helvetica,sans-serif;text-transform:uppercase}.b-menu-item-link{position:relative;margin:0;padding:0}.b-menu-item .b-menu-item-link:not(.b-menu-item-link-external):link,.b-menu-item .b-menu-item-link:not(.b-menu-item-link-external):visited{color:#7A9199}.b-menu-item .b-menu-item-link:not(.b-menu-item-link-external):active,.b-menu-item .b-menu-item-link:not(.b-menu-item-link-external):hover{color:#242F33}.b-menu-item-disabled{opacity:.5;color:#7A9199}.b-menu-item-disabled .b-menu-item-link{pointer-events:none}.b-menu-item-active{color:#242F33}.b-menu-hrz .b-menu-item{display:inline-block}.b-menu-pills{margin:0;font-size:.8125rem}.b-menu-pills .b-menu-item-link{display:inline-block;padding:10px 13px}.b-menu-pills .b-menu-item-link:link,.b-menu-pills .b-menu-item-link:visited{color:#7A9199}.b-menu-pills .b-menu-item-link:active,.b-menu-pills .b-menu-item-link:hover{color:#00A3D9}.b-menu-pills .b-menu-item-active{padding:0}.b-menu-pills .b-menu-item-active .b-menu-item-link{background:#DAE3E6;cursor:default}.b-menu-pills .b-menu-item-active .b-menu-item-link:active,.b-menu-pills .b-menu-item-active .b-menu-item-link:hover{color:#7A9199}.b-menu-pills.b-menu-hrz{margin:0}.b-menu-pills.b-menu-hrz .b-menu-item-active{padding:0}.b-menu-tabs{overflow:hidden;margin:0;padding:0}.b-menu-tabs:before{content:\" \";position:absolute;bottom:0;left:0;right:0;height:0;border-bottom:1px solid #dae3e6}.b-menu-tabs .b-menu-item{position:relative;display:inline-block;margin:0;padding:1em 1.5em;text-align:center;border:1px solid transparent;border-bottom:none;vertical-align:top;white-space:nowrap;text-transform:uppercase;letter-spacing:.05em;font-size:13px}.b-menu-tabs .b-menu-item-active{padding:1em 2em;border-color:#dae3e6;border-radius:2px 2px 0 0;background:#FFF}.b-menu-tabs .b-menu-item-active .b-menu-item-link{display:inline;margin:0;padding:0;border-radius:0;box-shadow:none;background:0 0;color:#242F33}.b-menu-tabs-min .b-menu-item{padding:.4em .7em}@media screen and (max-width:1260px){#settings_nav.b-menu-tabs:not(.b-menu-little)::before{content:none}#settings_nav.b-menu-tabs:not(.b-menu-little) .b-menu-item-active{border:1px solid #DAE3E6}}@media screen and (max-width:1050px){.b-menu-tabs .b-menu-item{padding:1em}.b-menu-tabs-min .b-menu-item{padding:.4em .7em}}@media screen and (max-width:880px){.b-menu-tabs{margin:0 10px}.b-menu-tabs .b-menu-item:last-child{margin-bottom:10px}.b-menu-tabs .b-menu-item-active{border-bottom:1px solid #DAE3E6}}@media print{.b-menu{display:none}}');
Site.page.template['angular/video.ng.tmpl'] = '<div\n    class=\"b-photouploader\"\n    ng-controller=\"VideoEditorCtrl as video\"\n    >\n\n\n\n    <!-- menu -->\n    <ul\n        class=\"\n            b-menu\n            b-menu-hrz\n            b-menu-pills\n            b-menu-pseudo\n            b-photouploader-menu\n            \"\n        lj-pills-group=\"uploadVideo\"\n        ng-init=\"video.pill()\"\n        ng-if=\"video.state.canUpload\"\n        ><!--\n        --><li\n            class=\"b-menu-item\"\n            data-pill=\"upload\"\n            >\n            <a\n                href=\"javascript:void(0);\"\n                ng-click=\"video.pill(\'upload\')\"\n                class=\"b-menu-item-link\"\n                lj-ml=\"videouploader.upload.title\"\n                ></a>\n        </li><!--\n        --><li\n            class=\"b-menu-item b-menu-item-active\"\n            data-pill=\"album\"\n            >\n            <a\n                href=\"javascript:void(0);\"\n                ng-click=\"video.pill(\'album\')\"\n                class=\"b-menu-item-link\"\n                lj-ml=\"videouploader.album.title\"\n                ></a>\n        </li><!--\n        --><li\n            class=\"b-menu-item\"\n            data-pill=\"embed\"\n            >\n            <a\n                href=\"javascript:void(0);\"\n                ng-click=\"video.pill(\'embed\')\"\n                class=\"b-menu-item-link\"\n                lj-ml=\"videouploader.embed.title\"\n                ></a>\n        </li><!--\n    --></ul>\n\n\n    <!-- items -->\n    <div class=\"b-photouploader-items\">\n\n\n\n        <!-- upload from computer -->\n        <div\n            class=\"\n                b-photouploader-item\n                b-photouploader-item-upload\n                \"\n            ng-class=\"\'b-photouploader-item-upload-\' + upload.state()\"\n            ng-if=\"video.state.canUpload && video.state.isOpen && video.isPill(\'upload\')\"\n            >\n            <!-- insert upload directive -->\n            <div lj-video-uploader\n                 lj-video-uploader-callback=\"video.records.insertUploadedRecord(record)\"\n                 lj-video-uploader-cancel=\"video.bubble.close()\"\n                />\n\n        </div><!-- /uploads item -->\n\n\n\n        <!-- select from albums -->\n        <div\n            class=\"\n                b-photouploader-item\n                b-photouploader-item-albums\n                \"\n            ng-hide=\"!video.isPill(\'album\')\"\n            >\n\n            <!-- albums -->\n            <div\n                class=\"\n                    b-photouploader-panel\n                    b-photouploader-panel-albums\n                    \"\n                >\n\n                <h4\n                    class=\"b-photouploader-subhead\"\n                    lj-ml=\"videouploader.album.select\"\n                    ></h4>\n\n                <div class=\"\n                        b-photouploader-albums\n                        b-photouploader-albums-withnav\n                        \">\n                    <div\n                        class=\"b-photouploader-albums-inner\"\n                        lj-when-scrolled=\"albums.loadMore()\"\n                        >\n                        <!-- albums nav -->\n                        <div\n                            class=\"b-photouploader-nav\"\n                            >\n                            <label\n                                for=\"albums\"\n                                class=\"b-photouploader-nav-label\"\n                                lj-ml=\"photouploader.album.your\"\n                                ></label>\n                            <select\n                                id=\"albums\"\n                                class=\"b-photouploader-albums-select\"\n                                ng-model=\"video.albums.current\"\n                                ng-options=\"item as item.name for item in video.albums.all\"\n                                >\n                            </select>\n                        </div>\n\n                        <!-- pictures -->\n                        <ul\n                            class=\"\n                                b-photouploader-pictures\n                                b-photouploader-pictures-withtitle\n                                b-photouploader-pictures-withmove\n                                \"\n                            lj-ref=\"videoUploader\"\n                            ng-model=\"video.records.current\"\n                            >\n                            <li\n                                class=\"b-photouploader-pictures-item\"\n                                ng-repeat=\"record in video.records.all\"\n                                ng-click=\"video.records.toggleRecord(record)\"\n                                ng-class=\"{ \'selected\': record.selected }\"\n                                >\n                                <span class=\"b-photouploader-pictures-pic\"><!--\n                                    --><img\n                                        class=\"b-photouploader-pictures-img\"\n                                        ng-src=\"{{ record.screenshot }}\"\n                                        ><!--\n                                --></span>\n                                <strong\n                                    class=\"b-photouploader-pictures-title\"\n                                    ng-bind=\"record.name\"\n                                    ng-show=\"record.name\"\n                                    ><!--\n                                --></strong>\n                            </li>\n                        </ul>\n\n                    </div>\n                </div><!-- /albums -->\n\n            </div>\n\n            <!-- controls -->\n            <div\n                class=\"\n                    b-photouploader-panel\n                    b-photouploader-panel-controls\n                    \"\n                >\n                <div\n                    class=\"\n                        b-ljbutton\n                        b-ljbutton-submit\n                        \"\n                    >\n                    <button\n                        type=\"submit\"\n                        name=\"submit\"\n                        lj-disabled=\"video.records.noneSelected()\"\n                        lj-ml=\"videouploader.album.insert\"\n                        ></button>\n                </div>\n                <button\n                    type=\"submit\"\n                    name=\"submit\"\n                    class=\"\n                        b-flatbutton\n                        b-flatbutton-simple\n                        \"\n                    lj-disabled=\"video.records.noneSelected()\"\n                    ng-click=\"video.insert()\"\n                    lj-ml=\"videouploader.album.insert\"\n                    ></button>\n            </div>\n\n        </div><!-- /albums item -->\n\n\n        <div\n            class=\"b-photouploader-item\n                b-photouploader-item-embed\"\n            ng-hide=\"!video.isPill(\'embed\') && video.state.canUpload\"\n            ng-controller=\"MediaCtrl\">\n            <div class=\"b-updateform-bubble-video-fields\">\n\n                <label for=\"updateform-video-url\"\n                       lj-ml=\"talk.video\"></label>\n                <br>\n\n                <textarea\n                    rows=\"5\"\n                    cols=\"60\"\n                    id=\"updateform-video-url\"\n                    class=\"b-updateform-bubble-input\"\n                    ng-model=\"media\"\n                    focus-and-select=\"show\"\n                    lj-enter=\"insert()\"\n                    lj-enter-with-meta\n                    ></textarea>\n\n                <span\n                    class=\"b-updateform-bubble-hint\"\n                    ng-click=\"setHint($event)\"\n                    lj-ml=\"talk.video.paste\"\n                    ></span>\n            </div>\n\n            <div class=\"b-updateform-bubble-video-button\">\n                <div\n                    class=\"\n                        b-ljbutton\n                        b-ljbutton-submit\n                        \"\n                    >\n                    <button\n                        type=\"button\"\n                        lj-disabled=\"!media\"\n                        ng-click=\"insert()\"\n                        lj-ml=\"talk.video.insert\">\n                    </button>\n                </div>\n                <button\n                    type=\"button\"\n                    class=\"\n                        b-flatbutton\n                        b-flatbutton-simple\n                        \"\n                    lj-disabled=\"!media\"\n                    ng-click=\"insert()\"\n                    lj-ml=\"talk.video.insert\">\n                </button>\n            </div>\n        </div>\n\n    </div><!-- /items -->\n\n\n\n</div>\n';
//= require_ml videouploader.embed.title
//= require_ml videouploader.upload.title
//= require_ml videouploader.byUrl.title
//= require_ml videouploader.album.title
//= require_ml videouploader.album.select
//= require_ml videouploader.album.insert
//= require_ml tour.video_update_tour.tip
//= require_ml talk.video
//= require_ml talk.video.paste
//= require_ml talk.video.insert
!function(){"use strict";function a(a,b,c,d,e,f,g,h){function i(a){var b=c.defer();return b.resolve(a),b.promise}function j(){var a=LiveJournal.parseGetArgs().video_id,b=LiveJournal.parseGetArgs().record_id;a&&l.records.insertRecords(a.split(","),{user:LiveJournal.parseGetArgs().user}),b&&h.fetchRecordByStorageId(b).then(function(a){l.records.all=[a],l.records.toggleRecord(a),l.insert()})}function k(){angular.element(".cke_button_LJEmbedLink").attr({ljTour:"",dataTour:"video_update_tour",dataStep:"1",dataTourText:"tour.regionalrating.step1.tip"})}var l=this;this.state={canUpload:LJ.get("remote")&&!LJ.get("remote_is_identity"),isOpen:!1},this.bubble=a.bubble,this.isPill=function(a){return f.group("uploadVideo")===a},this.pill=function(a){a=a||LJ.Storage.getItem("videoUploadPill")||"upload",f.group("uploadVideo",a),LJ.Storage.setItem("videoUploadPill",a)},this.albums={init:function(){return h.fetchAlbums({user:LJ.get("remote.username")}).then(function(){h.getAlbums().length&&(l.albums.all=h.getAlbums(),l.albums.current=h.getAlbums()[0])})},mapped:function(a){return l.albums._mappedAlbums||(l.albums._mappedAlbums=h.getAlbums().reduce(function(a,b){return a[b.id]=b,a},{})),a?l.albums._mappedAlbums[a]:l.albums._mappedAlbums[l.albums.current.id]}},this.records={request:function(a){return a=a||{},l.state.canUpload?d.call("video.get_records",a).then(function(a){return a.records?(l.records.all=a.records.slice(),a.records):void 0}):c.reject()},insertRecords:function(a,b){return b=b||{},Array.isArray(a)||(a=[a]),b.ids=a,l.records.request(b).then(function(a){l.records.all=a.map(function(a){return a.selected=!0,a}),l.insert()})},insertUploadedRecord:function(a){l.records.toggleRecord(a),l.records.all=[a],l.insert()},toggleRecord:function(a){a.selected=!a.selected},noneSelected:function(){return 0===(l.records.all||[]).filter(LJ.Function.get("selected")).length}},a.$watch(function(){return l.albums.current},function(a,b){a&&a!==b&&h.fetchRecords(a.id,{user:LJ.get("remote.username")}).then(function(){l.records.all=h.getRecordsByAlbumId(a.id),g.scrollTo("videoUploader",{toParent:!0})})}),l.insert=function(){function c(){try{e.insertContent("video",f.map(LJ.Function.get("embed")).join("\n"),f.map(i),f),a.bubble.close()}catch(d){l.state.isOpen&&b(c)}}if(l.records.all){var d='<iframe data-link="{url}" data-thumbnail="{thumbnail}" frameBorder="0" height="315" src="{url}" width="560"></iframe>',f=l.records.all.filter(LJ.Function.get("selected")).map(function(a){return a.thumbnail=a.screenshot,a.embed=d.supplant(a),a.link=a.url,a});c()}},a.$on("bubble:open:video",function(){l.state.canUpload&&l.albums.init(),l.state.isOpen=!0}),a.$on("bubble:close:video",function(){l.state.canUpload&&l.albums.all&&l.records.all&&l.records.all.filter(LJ.Function.get("selected")).map(function(a){delete a.selected}),l.state.isOpen=!1}),LJ.Event.on("video:upload:done",function(){l.bubble.close()}),LJ.get("is_dev_server")?LJ.Event.on("rte_embed_ready",function(){j(),k()}):b(function(){j(),k()})}angular.module("Video.Editor",["LJ.AuthHelper","LJ.Messages","LJ.Pills","LJ.Api","Video.Uploader","Video.Service","Editor"]).controller("VideoEditorCtrl",["$scope","$timeout","$q","Api","Editor","Pills","Ref","Video",a])}();;

/* file-end: js/video/editor.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/editor/photouploader.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/lib/jquery-ui/jquery.ui.mouse.min.js 
*/

/*! jQuery UI - v1.8.24 - 2012-09-28
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.mouse.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){var c=!1;a(document).mouseup(function(a){c=!1}),a.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var b=this;this.element.bind("mousedown."+this.widgetName,function(a){return b._mouseDown(a)}).bind("click."+this.widgetName,function(c){if(!0===a.data(c.target,b.widgetName+".preventClickEvent"))return a.removeData(c.target,b.widgetName+".preventClickEvent"),c.stopImmediatePropagation(),!1}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(b){if(c)return;this._mouseStarted&&this._mouseUp(b),this._mouseDownEvent=b;var d=this,e=b.which==1,f=typeof this.options.cancel=="string"&&b.target.nodeName?a(b.target).closest(this.options.cancel).length:!1;if(!e||f||!this._mouseCapture(b))return!0;this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){d.mouseDelayMet=!0},this.options.delay));if(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)){this._mouseStarted=this._mouseStart(b)!==!1;if(!this._mouseStarted)return b.preventDefault(),!0}return!0===a.data(b.target,this.widgetName+".preventClickEvent")&&a.removeData(b.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(a){return d._mouseMove(a)},this._mouseUpDelegate=function(a){return d._mouseUp(a)},a(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),b.preventDefault(),c=!0,!0},_mouseMove:function(b){return!a.browser.msie||document.documentMode>=9||!!b.button?this._mouseStarted?(this._mouseDrag(b),b.preventDefault()):(this._mouseDistanceMet(b)&&this._mouseDelayMet(b)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,b)!==!1,this._mouseStarted?this._mouseDrag(b):this._mouseUp(b)),!this._mouseStarted):this._mouseUp(b)},_mouseUp:function(b){return a(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,b.target==this._mouseDownEvent.target&&a.data(b.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(b)),!1},_mouseDistanceMet:function(a){return Math.max(Math.abs(this._mouseDownEvent.pageX-a.pageX),Math.abs(this._mouseDownEvent.pageY-a.pageY))>=this.options.distance},_mouseDelayMet:function(a){return this.mouseDelayMet},_mouseStart:function(a){},_mouseDrag:function(a){},_mouseStop:function(a){},_mouseCapture:function(a){return!0}})})(jQuery);;

/* file-end: js/lib/jquery-ui/jquery.ui.mouse.min.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/lib/jquery-ui/jquery.ui.sortable.min.js 
*/

/*! jQuery UI - v1.8.24 - 2012-09-28
* https://github.com/jquery/jquery-ui
* Includes: jquery.ui.sortable.js
* Copyright (c) 2012 AUTHORS.txt; Licensed MIT, GPL */
(function(a,b){a.widget("ui.sortable",a.ui.mouse,{widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var a=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?a.axis==="x"||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},destroy:function(){a.Widget.prototype.destroy.call(this),this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var b=this.items.length-1;b>=0;b--)this.items[b].item.removeData(this.widgetName+"-item");return this},_setOption:function(b,c){b==="disabled"?(this.options[b]=c,this.widget()[c?"addClass":"removeClass"]("ui-sortable-disabled")):a.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(b,c){var d=this;if(this.reverting)return!1;if(this.options.disabled||this.options.type=="static")return!1;this._refreshItems(b);var e=null,f=this,g=a(b.target).parents().each(function(){if(a.data(this,d.widgetName+"-item")==f)return e=a(this),!1});a.data(b.target,d.widgetName+"-item")==f&&(e=a(b.target));if(!e)return!1;if(this.options.handle&&!c){var h=!1;a(this.options.handle,e).find("*").andSelf().each(function(){this==b.target&&(h=!0)});if(!h)return!1}return this.currentItem=e,this._removeCurrentsFromItems(),!0},_mouseStart:function(b,c,d){var e=this.options,f=this;this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(b),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},a.extend(this.offset,{click:{left:b.pageX-this.offset.left,top:b.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(b),this.originalPageX=b.pageX,this.originalPageY=b.pageY,e.cursorAt&&this._adjustOffsetFromHelper(e.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),e.containment&&this._setContainment(),e.cursor&&(a("body").css("cursor")&&(this._storedCursor=a("body").css("cursor")),a("body").css("cursor",e.cursor)),e.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",e.opacity)),e.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",e.zIndex)),this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",b,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions();if(!d)for(var g=this.containers.length-1;g>=0;g--)this.containers[g]._trigger("activate",b,f._uiHash(this));return a.ui.ddmanager&&(a.ui.ddmanager.current=this),a.ui.ddmanager&&!e.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(b),!0},_mouseDrag:function(b){this.position=this._generatePosition(b),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs);if(this.options.scroll){var c=this.options,d=!1;this.scrollParent[0]!=document&&this.scrollParent[0].tagName!="HTML"?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-b.pageY<c.scrollSensitivity?this.scrollParent[0].scrollTop=d=this.scrollParent[0].scrollTop+c.scrollSpeed:b.pageY-this.overflowOffset.top<c.scrollSensitivity&&(this.scrollParent[0].scrollTop=d=this.scrollParent[0].scrollTop-c.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-b.pageX<c.scrollSensitivity?this.scrollParent[0].scrollLeft=d=this.scrollParent[0].scrollLeft+c.scrollSpeed:b.pageX-this.overflowOffset.left<c.scrollSensitivity&&(this.scrollParent[0].scrollLeft=d=this.scrollParent[0].scrollLeft-c.scrollSpeed)):(b.pageY-a(document).scrollTop()<c.scrollSensitivity?d=a(document).scrollTop(a(document).scrollTop()-c.scrollSpeed):a(window).height()-(b.pageY-a(document).scrollTop())<c.scrollSensitivity&&(d=a(document).scrollTop(a(document).scrollTop()+c.scrollSpeed)),b.pageX-a(document).scrollLeft()<c.scrollSensitivity?d=a(document).scrollLeft(a(document).scrollLeft()-c.scrollSpeed):a(window).width()-(b.pageX-a(document).scrollLeft())<c.scrollSensitivity&&(d=a(document).scrollLeft(a(document).scrollLeft()+c.scrollSpeed))),d!==!1&&a.ui.ddmanager&&!c.dropBehaviour&&a.ui.ddmanager.prepareOffsets(this,b)}this.positionAbs=this._convertPositionTo("absolute");if(!this.options.axis||this.options.axis!="y")this.helper[0].style.left=this.position.left+"px";if(!this.options.axis||this.options.axis!="x")this.helper[0].style.top=this.position.top+"px";for(var e=this.items.length-1;e>=0;e--){var f=this.items[e],g=f.item[0],h=this._intersectsWithPointer(f);if(!h)continue;if(f.instance!==this.currentContainer)continue;if(g!=this.currentItem[0]&&this.placeholder[h==1?"next":"prev"]()[0]!=g&&!a.ui.contains(this.placeholder[0],g)&&(this.options.type=="semi-dynamic"?!a.ui.contains(this.element[0],g):!0)){this.direction=h==1?"down":"up";if(this.options.tolerance=="pointer"||this._intersectsWithSides(f))this._rearrange(b,f);else break;this._trigger("change",b,this._uiHash());break}}return this._contactContainers(b),a.ui.ddmanager&&a.ui.ddmanager.drag(this,b),this._trigger("sort",b,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(b,c){if(!b)return;a.ui.ddmanager&&!this.options.dropBehaviour&&a.ui.ddmanager.drop(this,b);if(this.options.revert){var d=this,e=d.placeholder.offset();d.reverting=!0,a(this.helper).animate({left:e.left-this.offset.parent.left-d.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:e.top-this.offset.parent.top-d.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){d._clear(b)})}else this._clear(b,c);return!1},cancel:function(){var b=this;if(this.dragging){this._mouseUp({target:null}),this.options.helper=="original"?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var c=this.containers.length-1;c>=0;c--)this.containers[c]._trigger("deactivate",null,b._uiHash(this)),this.containers[c].containerCache.over&&(this.containers[c]._trigger("out",null,b._uiHash(this)),this.containers[c].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.options.helper!="original"&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),a.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?a(this.domPosition.prev).after(this.currentItem):a(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},a(c).each(function(){var c=(a(b.item||this).attr(b.attribute||"id")||"").match(b.expression||/(.+)[-=_](.+)/);c&&d.push((b.key||c[1]+"[]")+"="+(b.key&&b.expression?c[1]:c[2]))}),!d.length&&b.key&&d.push(b.key+"="),d.join("&")},toArray:function(b){var c=this._getItemsAsjQuery(b&&b.connected),d=[];return b=b||{},c.each(function(){d.push(a(b.item||this).attr(b.attribute||"id")||"")}),d},_intersectsWith:function(a){var b=this.positionAbs.left,c=b+this.helperProportions.width,d=this.positionAbs.top,e=d+this.helperProportions.height,f=a.left,g=f+a.width,h=a.top,i=h+a.height,j=this.offset.click.top,k=this.offset.click.left,l=d+j>h&&d+j<i&&b+k>f&&b+k<g;return this.options.tolerance=="pointer"||this.options.forcePointerForContainers||this.options.tolerance!="pointer"&&this.helperProportions[this.floating?"width":"height"]>a[this.floating?"width":"height"]?l:f<b+this.helperProportions.width/2&&c-this.helperProportions.width/2<g&&h<d+this.helperProportions.height/2&&e-this.helperProportions.height/2<i},_intersectsWithPointer:function(b){var c=this.options.axis==="x"||a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,b.top,b.height),d=this.options.axis==="y"||a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,b.left,b.width),e=c&&d,f=this._getDragVerticalDirection(),g=this._getDragHorizontalDirection();return e?this.floating?g&&g=="right"||f=="down"?2:1:f&&(f=="down"?2:1):!1},_intersectsWithSides:function(b){var c=a.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,b.top+b.height/2,b.height),d=a.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,b.left+b.width/2,b.width),e=this._getDragVerticalDirection(),f=this._getDragHorizontalDirection();return this.floating&&f?f=="right"&&d||f=="left"&&!d:e&&(e=="down"&&c||e=="up"&&!c)},_getDragVerticalDirection:function(){var a=this.positionAbs.top-this.lastPositionAbs.top;return a!=0&&(a>0?"down":"up")},_getDragHorizontalDirection:function(){var a=this.positionAbs.left-this.lastPositionAbs.left;return a!=0&&(a>0?"right":"left")},refresh:function(a){return this._refreshItems(a),this.refreshPositions(),this},_connectWith:function(){var a=this.options;return a.connectWith.constructor==String?[a.connectWith]:a.connectWith},_getItemsAsjQuery:function(b){var c=this,d=[],e=[],f=this._connectWith();if(f&&b)for(var g=f.length-1;g>=0;g--){var h=a(f[g]);for(var i=h.length-1;i>=0;i--){var j=a.data(h[i],this.widgetName);j&&j!=this&&!j.options.disabled&&e.push([a.isFunction(j.options.items)?j.options.items.call(j.element):a(j.options.items,j.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),j])}}e.push([a.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):a(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var g=e.length-1;g>=0;g--)e[g][0].each(function(){d.push(this)});return a(d)},_removeCurrentsFromItems:function(){var a=this.currentItem.find(":data("+this.widgetName+"-item)");for(var b=0;b<this.items.length;b++)for(var c=0;c<a.length;c++)a[c]==this.items[b].item[0]&&this.items.splice(b,1)},_refreshItems:function(b){this.items=[],this.containers=[this];var c=this.items,d=this,e=[[a.isFunction(this.options.items)?this.options.items.call(this.element[0],b,{item:this.currentItem}):a(this.options.items,this.element),this]],f=this._connectWith();if(f&&this.ready)for(var g=f.length-1;g>=0;g--){var h=a(f[g]);for(var i=h.length-1;i>=0;i--){var j=a.data(h[i],this.widgetName);j&&j!=this&&!j.options.disabled&&(e.push([a.isFunction(j.options.items)?j.options.items.call(j.element[0],b,{item:this.currentItem}):a(j.options.items,j.element),j]),this.containers.push(j))}}for(var g=e.length-1;g>=0;g--){var k=e[g][1],l=e[g][0];for(var i=0,m=l.length;i<m;i++){var n=a(l[i]);n.data(this.widgetName+"-item",k),c.push({item:n,instance:k,width:0,height:0,left:0,top:0})}}},refreshPositions:function(b){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var c=this.items.length-1;c>=0;c--){var d=this.items[c];if(d.instance!=this.currentContainer&&this.currentContainer&&d.item[0]!=this.currentItem[0])continue;var e=this.options.toleranceElement?a(this.options.toleranceElement,d.item):d.item;b||(d.width=e.outerWidth(),d.height=e.outerHeight());var f=e.offset();d.left=f.left,d.top=f.top}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var c=this.containers.length-1;c>=0;c--){var f=this.containers[c].element.offset();this.containers[c].containerCache.left=f.left,this.containers[c].containerCache.top=f.top,this.containers[c].containerCache.width=this.containers[c].element.outerWidth(),this.containers[c].containerCache.height=this.containers[c].element.outerHeight()}return this},_createPlaceholder:function(b){var c=b||this,d=c.options;if(!d.placeholder||d.placeholder.constructor==String){var e=d.placeholder;d.placeholder={element:function(){var b=a(document.createElement(c.currentItem[0].nodeName)).addClass(e||c.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return e||(b.style.visibility="hidden"),b},update:function(a,b){if(e&&!d.forcePlaceholderSize)return;b.height()||b.height(c.currentItem.innerHeight()-parseInt(c.currentItem.css("paddingTop")||0,10)-parseInt(c.currentItem.css("paddingBottom")||0,10)),b.width()||b.width(c.currentItem.innerWidth()-parseInt(c.currentItem.css("paddingLeft")||0,10)-parseInt(c.currentItem.css("paddingRight")||0,10))}}}c.placeholder=a(d.placeholder.element.call(c.element,c.currentItem)),c.currentItem.after(c.placeholder),d.placeholder.update(c,c.placeholder)},_contactContainers:function(b){var c=null,d=null;for(var e=this.containers.length-1;e>=0;e--){if(a.ui.contains(this.currentItem[0],this.containers[e].element[0]))continue;if(this._intersectsWith(this.containers[e].containerCache)){if(c&&a.ui.contains(this.containers[e].element[0],c.element[0]))continue;c=this.containers[e],d=e}else this.containers[e].containerCache.over&&(this.containers[e]._trigger("out",b,this._uiHash(this)),this.containers[e].containerCache.over=0)}if(!c)return;if(this.containers.length===1)this.containers[d]._trigger("over",b,this._uiHash(this)),this.containers[d].containerCache.over=1;else if(this.currentContainer!=this.containers[d]){var f=1e4,g=null,h=this.positionAbs[this.containers[d].floating?"left":"top"];for(var i=this.items.length-1;i>=0;i--){if(!a.ui.contains(this.containers[d].element[0],this.items[i].item[0]))continue;var j=this.containers[d].floating?this.items[i].item.offset().left:this.items[i].item.offset().top;Math.abs(j-h)<f&&(f=Math.abs(j-h),g=this.items[i],this.direction=j-h>0?"down":"up")}if(!g&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[d],g?this._rearrange(b,g,null,!0):this._rearrange(b,null,this.containers[d].element,!0),this._trigger("change",b,this._uiHash()),this.containers[d]._trigger("change",b,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[d]._trigger("over",b,this._uiHash(this)),this.containers[d].containerCache.over=1}},_createHelper:function(b){var c=this.options,d=a.isFunction(c.helper)?a(c.helper.apply(this.element[0],[b,this.currentItem])):c.helper=="clone"?this.currentItem.clone():this.currentItem;return d.parents("body").length||a(c.appendTo!="parent"?c.appendTo:this.currentItem[0].parentNode)[0].appendChild(d[0]),d[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(d[0].style.width==""||c.forceHelperSize)&&d.width(this.currentItem.width()),(d[0].style.height==""||c.forceHelperSize)&&d.height(this.currentItem.height()),d},_adjustOffsetFromHelper:function(b){typeof b=="string"&&(b=b.split(" ")),a.isArray(b)&&(b={left:+b[0],top:+b[1]||0}),"left"in b&&(this.offset.click.left=b.left+this.margins.left),"right"in b&&(this.offset.click.left=this.helperProportions.width-b.right+this.margins.left),"top"in b&&(this.offset.click.top=b.top+this.margins.top),"bottom"in b&&(this.offset.click.top=this.helperProportions.height-b.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var b=this.offsetParent.offset();this.cssPosition=="absolute"&&this.scrollParent[0]!=document&&a.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(b.left+=this.scrollParent.scrollLeft(),b.top+=this.scrollParent.scrollTop());if(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&this.offsetParent[0].tagName.toLowerCase()=="html"&&a.browser.msie)b={top:0,left:0};return{top:b.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:b.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if(this.cssPosition=="relative"){var a=this.currentItem.position();return{top:a.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:a.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var b=this.options;b.containment=="parent"&&(b.containment=this.helper[0].parentNode);if(b.containment=="document"||b.containment=="window")this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,a(b.containment=="document"?document:window).width()-this.helperProportions.width-this.margins.left,(a(b.containment=="document"?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top];if(!/^(document|window|parent)$/.test(b.containment)){var c=a(b.containment)[0],d=a(b.containment).offset(),e=a(c).css("overflow")!="hidden";this.containment=[d.left+(parseInt(a(c).css("borderLeftWidth"),10)||0)+(parseInt(a(c).css("paddingLeft"),10)||0)-this.margins.left,d.top+(parseInt(a(c).css("borderTopWidth"),10)||0)+(parseInt(a(c).css("paddingTop"),10)||0)-this.margins.top,d.left+(e?Math.max(c.scrollWidth,c.offsetWidth):c.offsetWidth)-(parseInt(a(c).css("borderLeftWidth"),10)||0)-(parseInt(a(c).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,d.top+(e?Math.max(c.scrollHeight,c.offsetHeight):c.offsetHeight)-(parseInt(a(c).css("borderTopWidth"),10)||0)-(parseInt(a(c).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(b,c){c||(c=this.position);var d=b=="absolute"?1:-1,e=this.options,f=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,g=/(html|body)/i.test(f[0].tagName);return{top:c.top+this.offset.relative.top*d+this.offset.parent.top*d-(a.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollTop():g?0:f.scrollTop())*d),left:c.left+this.offset.relative.left*d+this.offset.parent.left*d-(a.browser.safari&&this.cssPosition=="fixed"?0:(this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():g?0:f.scrollLeft())*d)}},_generatePosition:function(b){var c=this.options,d=this.cssPosition=="absolute"&&(this.scrollParent[0]==document||!a.ui.contains(this.scrollParent[0],this.offsetParent[0]))?this.offsetParent:this.scrollParent,e=/(html|body)/i.test(d[0].tagName);this.cssPosition=="relative"&&(this.scrollParent[0]==document||this.scrollParent[0]==this.offsetParent[0])&&(this.offset.relative=this._getRelativeOffset());var f=b.pageX,g=b.pageY;if(this.originalPosition){this.containment&&(b.pageX-this.offset.click.left<this.containment[0]&&(f=this.containment[0]+this.offset.click.left),b.pageY-this.offset.click.top<this.containment[1]&&(g=this.containment[1]+this.offset.click.top),b.pageX-this.offset.click.left>this.containment[2]&&(f=this.containment[2]+this.offset.click.left),b.pageY-this.offset.click.top>this.containment[3]&&(g=this.containment[3]+this.offset.click.top));if(c.grid){var h=this.originalPageY+Math.round((g-this.originalPageY)/c.grid[1])*c.grid[1];g=this.containment?h-this.offset.click.top<this.containment[1]||h-this.offset.click.top>this.containment[3]?h-this.offset.click.top<this.containment[1]?h+c.grid[1]:h-c.grid[1]:h:h;var i=this.originalPageX+Math.round((f-this.originalPageX)/c.grid[0])*c.grid[0];f=this.containment?i-this.offset.click.left<this.containment[0]||i-this.offset.click.left>this.containment[2]?i-this.offset.click.left<this.containment[0]?i+c.grid[0]:i-c.grid[0]:i:i}}return{top:g-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(a.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollTop():e?0:d.scrollTop()),left:f-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(a.browser.safari&&this.cssPosition=="fixed"?0:this.cssPosition=="fixed"?-this.scrollParent.scrollLeft():e?0:d.scrollLeft())}},_rearrange:function(a,b,c,d){c?c[0].appendChild(this.placeholder[0]):b.item[0].parentNode.insertBefore(this.placeholder[0],this.direction=="down"?b.item[0]:b.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var e=this,f=this.counter;window.setTimeout(function(){f==e.counter&&e.refreshPositions(!d)},0)},_clear:function(b,c){this.reverting=!1;var d=[],e=this;!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null;if(this.helper[0]==this.currentItem[0]){for(var f in this._storedCSS)if(this._storedCSS[f]=="auto"||this._storedCSS[f]=="static")this._storedCSS[f]="";this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!c&&d.push(function(a){this._trigger("receive",a,this._uiHash(this.fromOutside))}),(this.fromOutside||this.domPosition.prev!=this.currentItem.prev().not(".ui-sortable-helper")[0]||this.domPosition.parent!=this.currentItem.parent()[0])&&!c&&d.push(function(a){this._trigger("update",a,this._uiHash())}),this!==this.currentContainer&&(c||(d.push(function(a){this._trigger("remove",a,this._uiHash())}),d.push(function(a){return function(b){a._trigger("receive",b,this._uiHash(this))}}.call(this,this.currentContainer)),d.push(function(a){return function(b){a._trigger("update",b,this._uiHash(this))}}.call(this,this.currentContainer))));for(var f=this.containers.length-1;f>=0;f--)c||d.push(function(a){return function(b){a._trigger("deactivate",b,this._uiHash(this))}}.call(this,this.containers[f])),this.containers[f].containerCache.over&&(d.push(function(a){return function(b){a._trigger("out",b,this._uiHash(this))}}.call(this,this.containers[f])),this.containers[f].containerCache.over=0);this._storedCursor&&a("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex",this._storedZIndex=="auto"?"":this._storedZIndex),this.dragging=!1;if(this.cancelHelperRemoval){if(!c){this._trigger("beforeStop",b,this._uiHash());for(var f=0;f<d.length;f++)d[f].call(this,b);this._trigger("stop",b,this._uiHash())}return this.fromOutside=!1,!1}c||this._trigger("beforeStop",b,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null;if(!c){for(var f=0;f<d.length;f++)d[f].call(this,b);this._trigger("stop",b,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){a.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(b){var c=b||this;return{helper:c.helper,placeholder:c.placeholder||a([]),position:c.position,originalPosition:c.originalPosition,offset:c.positionAbs,item:c.currentItem,sender:b?b.element:null}}}),a.extend(a.ui.sortable,{version:"1.8.24"})})(jQuery);;

/* file-end: js/lib/jquery-ui/jquery.ui.sortable.min.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/lib/angular/ui/sortable.js 
*/

/*
 jQuery UI Sortable plugin wrapper

 @param [ui-sortable] {object} Options to pass to $.fn.sortable() merged onto ui.config
 */
angular.module('ui.sortable', [])
  .value('uiSortableConfig',{})
  .directive('uiSortable', [
    'uiSortableConfig', '$timeout', '$log',
    function(uiSortableConfig, $timeout, $log) {
      return {
        require: '?ngModel',
        link: function(scope, element, attrs, ngModel) {
          var savedNodes;

          function combineCallbacks(first,second){
            if(second && (typeof second === 'function')) {
              return function(e, ui) {
                first(e, ui);
                second(e, ui);
              };
            }
            return first;
          }

          var opts = {};

          var callbacks = {
            receive: null,
            remove:null,
            start:null,
            stop:null,
            update:null
          };

          angular.extend(opts, uiSortableConfig);

          if (ngModel) {

            // When we add or remove elements, we need the sortable to 'refresh'
            // so it can find the new/removed elements.
            scope.$watch(attrs.ngModel+'.length', function() {
              // Timeout to let ng-repeat modify the DOM
              $timeout(function() {
                element.sortable('refresh');
              });
            });

            callbacks.start = function(e, ui) {
              // Save the starting position of dragged item
              ui.item.sortable = {
                index: ui.item.index(),
                cancel: function () {
                  ui.item.sortable._isCanceled = true;
                },
                isCanceled: function () {
                  return ui.item.sortable._isCanceled;
                },
                _isCanceled: false
              };
            };

            callbacks.activate = function(/*e, ui*/) {
              // We need to make a copy of the current element's contents so
              // we can restore it after sortable has messed it up.
              // This is inside activate (instead of start) in order to save
              // both lists when dragging between connected lists.
              savedNodes = element.contents();

              // If this list has a placeholder (the connected lists won't),
              // don't inlcude it in saved nodes.
              var placeholder = element.sortable('option','placeholder');

              // placeholder.element will be a function if the placeholder, has
              // been created (placeholder will be an object).  If it hasn't
              // been created, either placeholder will be false if no
              // placeholder class was given or placeholder.element will be
              // undefined if a class was given (placeholder will be a string)
              if (placeholder && placeholder.element && typeof placeholder.element === 'function') {
                var phElement = placeholder.element();
                // workaround for jquery ui 1.9.x,
                // not returning jquery collection
                if (!phElement.jquery) {
                  phElement = angular.element(phElement);
                }

                // exact match with the placeholder's class attribute to handle
                // the case that multiple connected sortables exist and
                // the placehoilder option equals the class of sortable items
                var excludes = element.find('[class="' + phElement.attr('class') + '"]');

                savedNodes = savedNodes.not(excludes);
              }
            };

            callbacks.update = function(e, ui) {
              // Save current drop position but only if this is not a second
              // update that happens when moving between lists because then
              // the value will be overwritten with the old value
              if(!ui.item.sortable.received) {
                ui.item.sortable.dropindex = ui.item.index();
                ui.item.sortable.droptarget = ui.item.parent();

                // Cancel the sort (let ng-repeat do the sort for us)
                // Don't cancel if this is the received list because it has
                // already been canceled in the other list, and trying to cancel
                // here will mess up the DOM.
                element.sortable('cancel');
              }

              // Put the nodes back exactly the way they started (this is very
              // important because ng-repeat uses comment elements to delineate
              // the start and stop of repeat sections and sortable doesn't
              // respect their order (even if we cancel, the order of the
              // comments are still messed up).
              savedNodes.detach();
              if (element.sortable('option','helper') === 'clone') {
                // first detach all the savedNodes and then restore all of them
                // except .ui-sortable-helper element (which is placed last).
                // That way it will be garbage collected.
                savedNodes = savedNodes.not(savedNodes.last());
              }
              savedNodes.appendTo(element);

              // If received is true (an item was dropped in from another list)
              // then we add the new item to this list otherwise wait until the
              // stop event where we will know if it was a sort or item was
              // moved here from another list
              if(ui.item.sortable.received && !ui.item.sortable.isCanceled()) {
                scope.$apply(function () {
                  ngModel.$modelValue.splice(ui.item.sortable.dropindex, 0,
                    ui.item.sortable.moved);
                });
              }
            };

            callbacks.stop = function(e, ui) {
              // If the received flag hasn't be set on the item, this is a
              // normal sort, if dropindex is set, the item was moved, so move
              // the items in the list.
              if(!ui.item.sortable.received &&
                ('dropindex' in ui.item.sortable) &&
                !ui.item.sortable.isCanceled()) {

                scope.$apply(function () {
                  ngModel.$modelValue.splice(
                    ui.item.sortable.dropindex, 0,
                    ngModel.$modelValue.splice(ui.item.sortable.index, 1)[0]);
                });
              } else {
                // if the item was not moved, then restore the elements
                // so that the ngRepeat's comment are correct.
                if((!('dropindex' in ui.item.sortable) || ui.item.sortable.isCanceled()) && element.sortable('option','helper') !== 'clone') {
                  savedNodes.detach().appendTo(element);
                }
              }
            };

            callbacks.receive = function(e, ui) {
              // An item was dropped here from another list, set a flag on the
              // item.
              ui.item.sortable.received = true;
            };

            callbacks.remove = function(e, ui) {
              // Remove the item from this list's model and copy data into item,
              // so the next list can retrive it
              if (!ui.item.sortable.isCanceled()) {
                scope.$apply(function () {
                  ui.item.sortable.moved = ngModel.$modelValue.splice(
                    ui.item.sortable.index, 1)[0];
                });
              }
            };

            scope.$watch(attrs.uiSortable, function(newVal /*, oldVal*/) {
              angular.forEach(newVal, function(value, key) {
                if(callbacks[key]) {
                  if( key === 'stop' ){
                    // call apply after stop
                    value = combineCallbacks(
                      value, function() { scope.$apply(); });
                  }
                  // wrap the callback
                  value = combineCallbacks(callbacks[key], value);
                }
                element.sortable('option', key, value);
              });
            }, true);

            angular.forEach(callbacks, function(value, key) {
              opts[key] = combineCallbacks(value, opts[key]);
            });

          } else {
            $log.info('ui.sortable: ngModel not provided!', element);
          }

          // Create sortable
          element.sortable(opts);
        }
      };
    }
  ]);
;

/* file-end: js/lib/angular/ui/sortable.js 
----------------------------------------------------------------------------------*/






// error: photouploader.css is already included
// error: menu_v2.css is already included
Site.page.template['angular/photouploader.ng.tmpl'] = '<div\n    class=\"b-photouploader\"\n    ng-controller=\"PhotouploaderCtrl\"\n    >\n\n\n\n    <!-- menu -->\n    <ul\n        class=\"\n            b-menu\n            b-menu-hrz\n            b-menu-pills\n            b-menu-pseudo\n            b-photouploader-menu\n            \"\n        lj-pills-group=\"photouploader\"\n        ><!--\n        --><li\n            class=\"b-menu-item b-menu-item-active\"\n            data-pill=\"upload\"\n            ng-if=\"hasUploadAbilities\"\n            >\n            <a\n                href=\"javascript:void(0);\"\n                ng-click=\"pills.select(\'upload\')\"\n                class=\"b-menu-item-link\"\n                lj-ml=\"photouploader.upload.title\"\n                ></a>\n        </li><!--\n        --><li\n            class=\"b-menu-item\"\n            data-pill=\"album\"\n            ng-if=\"hasUploadAbilities && hasAlbums()\"\n            >\n            <a\n                href=\"javascript:void(0);\"\n                ng-click=\"pills.select(\'album\')\"\n                class=\"b-menu-item-link\"\n                lj-ml=\"photouploader.album.title\"\n                ></a>\n        </li><!--\n        --><li\n            class=\"b-menu-item\"\n            data-pill=\"paste\"\n            >\n            <a\n                href=\"javascript:void(0);\"\n                ng-click=\"pills.select(\'paste\')\"\n                class=\"b-menu-item-link\"\n                lj-ml=\"photouploader.paste.title\"\n                ></a>\n        </li><!--\n        --><li\n            class=\"b-menu-item\"\n            data-pill=\"dropbox\"\n            >\n            <a\n                href=\"javascript:void(0);\"\n                ng-click=\"pills.select(\'dropbox\')\"\n                class=\"b-menu-item-link\"\n                lj-ml=\"photouploader.dropbox.title\"\n                ></a>\n        </li><!--\n        --><li\n            class=\"b-menu-item\"\n            data-pill=\"instagram\"\n            >\n            <a\n                href=\"javascript:void(0);\"\n                ng-click=\"pills.select(\'instagram\')\"\n                class=\"b-menu-item-link\"\n                lj-ml=\"photouploader.instagram.title\"\n                ></a>\n        </li><!--\n    --></ul>\n\n\n    <!-- items -->\n    <div class=\"b-photouploader-items\">\n\n\n\n        <!-- upload from computer -->\n        <div\n            class=\"\n                b-photouploader-item\n                b-photouploader-item-upload\n                \"\n            ng-hide=\"!pills.isActive(\'upload\')\"\n            ng-class=\"\'b-photouploader-item-upload-\' + upload.state()\"\n            ng-if=\"hasUploadAbilities && pills.isActive(\'upload\')\"\n            >\n\n            <!-- upload form -->\n            <div\n                id=\"upload-panel\"\n                class=\"\n                    b-photouploader-panel\n                    b-photouploader-panel-upload\n                    \"\n                >\n                <div class=\"b-photouploader-uploader\"\n                     plupload=\"upload.url\"\n                     plupload-options=\"pluploadOptions\"\n                     plupload-callbacks=\"pluploadCallbacks\"\n                     ng-hide=\"!uploaderInit\"\n                     >\n                    <p\n                        class=\"b-photouploader-uploader-drop\"\n                        lj-ml=\"photouploader.upload.drop\"\n                        ></p>\n                    <p\n                        class=\"b-photouploader-uploader-nodrop\"\n                        lj-ml=\"photouploader.upload.nodrop\"\n                        ></p>\n                    <input\n                        type=\"file\"\n                        multiple=\"multiple\"\n                        id=\"pickfiles\"\n                        value=\"Choose an image to upload\"\n                        class=\"b-photouploader-uploader-input\"\n                        ng-hide=\"upload.inProgress\"\n                        >\n                    <ol class=\"b-photouploader-uploader-list\">\n                        <li\n                            class=\"b-photouploader-uploader-list-item\"\n                            ng-repeat=\"file in upload.files\"\n                            >\n                            {{ file.name }} &mdash; {{ file.percent }}% ({{ file.formattedSize }})\n\n                            <a\n                                href=\"\"\n                                ng-show=\"file.percent < 100\"\n                                ng-click=\"upload.cancel(file);\"\n                                lj-ml=\"photouploader.upload.cancel\"\n                                ></a>\n                        </li>\n                    </ol>\n                </div>\n                <div class=\"b-photouploader-initfail\" ng-if=\"!uploaderInit\">\n                    <span class=\"b-photouploader-initfail-flash\" lj-ml=\"photouploader.upload.initFail\"></span>\n                </div>\n            </div>\n\n            <!-- select pictures -->\n            <div\n                class=\"\n                    b-photouploader-panel\n                    b-photouploader-panel-pictures\n                    \"\n                >\n                <ul\n                    class=\"\n                        b-photouploader-pictures\n                        b-photouploader-pictures-withremove\n                        b-photouploader-pictures-withmove\n                        \"\n                    ui-sortable=\"ui.sortableOptions\"\n                    ng-model=\"albums.current.photos\"\n                    >\n                    <li\n                        class=\"b-photouploader-pictures-item\"\n                        ng-repeat=\"photo in upload.photos()\"\n                        >\n                        <span class=\"b-photouploader-pictures-pic\"><!--\n                            --><img\n                                class=\"b-photouploader-pictures-img\"\n                                ng-src=\"{{ photo.photo_src }}\"\n                                ><!--\n                        --></span>\n                        <span\n                            class=\"b-photouploader-pictures-remove\"\n                            title=\"Remove Picture\"\n                            ng-click=\"upload.removePhoto(photo);\"\n                            lj-ml=\"photouploader.upload.remove\"\n                            lj-ml-attr=\"title\"\n                            ></span>\n                    </li>\n                </ul>\n            </div>\n\n            <!-- controls -->\n            <div\n                class=\"\n                    b-photouploader-panel\n                    b-photouploader-panel-controls\n                    \"\n                >\n                <div class=\"b-photouploader-albumselector\">\n                    <div class=\"b-photouploader-albumselector-item\">\n                        <span\n                            class=\"b-photouploader-albumselector-albums\"\n                            ng-show=\"!newAlbum\"\n                            >\n                            <label\n                                for=\"album\"\n                                class=\"b-photouploader-albumselector-label\"\n                                lj-ml=\"photouploader.upload.addto\"\n                                ></label>\n                            <select\n                                id=\"album\"\n                                class=\"b-photouploader-albumselector-select\"\n                                ng-model=\"upload.album\"\n                                ng-options=\"item as item.album_title for item in albums.list\"\n                                >\n                            </select>\n                            <span lj-ml=\"photouploader.upload.or\"></span>\n                            <a\n                                href=\"javascript:void(0);\"\n                                ng-click=\"newAlbum = true;\"\n                                lj-ml=\"photouploader.upload.create\"\n                                ></a>\n                        </span>\n                        <span\n                            class=\"b-photouploader-albumselector-newalbum\"\n                            ng-show=\"newAlbum\"\n                            >\n                            <label\n                                for=\"album\"\n                                class=\"b-photouploader-albumselector-label\"\n                                lj-ml=\"photouploader.album.create\"\n                                ></label>\n                            <input\n                                type=\"text\"\n                                id=\"\"\n                                value=\"\"\n                                size=\"40\"\n                                class=\"b-photouploader-albumselector-input\"\n                                ng-model=\"upload.newAlbumName\"\n                                >\n                            <br>\n                            <a\n                                href=\"javascript:void(0);\"\n                                ng-click=\"newAlbum = false;\"\n                                lj-ml=\"photouploader.upload.back\"\n                                ></a>\n                        </span>\n                    </div>\n                    <div class=\"b-photouploader-albumselector-item\">\n                        <label\n                            for=\"privacy\"\n                            class=\"b-photouploader-albumselector-label\"\n                            lj-ml=\"photouploader.upload.privacy\"\n                            ></label>\n                        <select\n                            id=\"privacy\"\n                            class=\"b-photouploader-albumselector-select\"\n                            ng-model=\"upload.privacy.current\"\n                            ng-options=\"item as item.groupname for item in upload.privacy.list\"\n                            >\n                        </select>\n                    </div>\n\n                    <div class=\"b-photouploader-albumselector-item\">\n                        <label\n                            for=\"upload-size\"\n                            class=\"b-photouploader-albumselector-label\"\n                            lj-ml=\"photouploader.upload.size\"\n                            ></label>\n                        <select\n                            id=\"upload-size\"\n                            class=\"b-photouploader-albumselector-select\"\n                            ng-model=\"ui.size.current\"\n                            ng-options=\"item as item.text for item in ui.size.list\"\n                            >\n                        </select>\n                    </div>\n\n\n                    <div class=\"b-photouploader-albumselector-item\">\n                        <input\n                            type=\"checkbox\"\n                            id=\"linktoneworiginal\"\n                            class=\"b-photouploader-albumselector-check\"\n                            ng-model=\"albums.originalLink\"\n                            />\n                        <label\n                            for=\"linktoneworiginal\"\n                            class=\"b-photouploader-albumselector-label\"\n                            lj-ml=\"photouploader.upload.addlink\"\n                            ></label>\n                    </div>\n\n                </div>\n\n                <div\n                    class=\"\n                        b-ljbutton\n                        b-ljbutton-submit\n                        \"\n                    >\n                    <button\n                        type=\"submit\"\n                        name=\"submit\"\n                        ng-click=\"upload.insert()\"\n                        lj-disabled=\"ui.insertInProgress\"\n                        lj-ml=\"photouploader.upload.insert\"\n                        ></button>\n                </div>\n\n                <!--\n                <button\n                    type=\"submit\"\n                    name=\"submit\"\n                    class=\"\n                        b-flatbutton\n                        b-flatbutton-simple\n                        \"\n                    ng-click=\"upload.insert()\"\n                    lj-disabled=\"ui.insertInProgress\"\n                    lj-ml=\"photouploader.upload.insert\"\n                    ></button> -->\n\n                <lj-flatbutton lj-flatbutton=\"[\'submit\', \'photouploader.upload.insert\', \'b-flatbutton b-flatbutton-simple\', \'ng-click\', \'upload.insert()\', \'lj-disabled\', \'ui.insertInProgress\', \'name\', \'submit\']\"></lj-flatbutton>\n\n            </div>\n\n        </div><!-- /uploads item -->\n\n\n\n        <!-- select from albums -->\n        <div\n            class=\"\n                b-photouploader-item\n                b-photouploader-item-albums\n                \"\n            ng-show=\"pills.isActive(\'album\')\"\n            ng-if=\"hasUploadAbilities\"\n            >\n\n            <!-- albums -->\n            <div\n                class=\"\n                    b-photouploader-panel\n                    b-photouploader-panel-albums\n                    \"\n                >\n\n                <h4\n                    class=\"b-photouploader-subhead\"\n                    lj-ml=\"photouploader.album.select\"\n                    ></h4>\n\n                <div class=\"\n                        b-photouploader-albums\n                        b-photouploader-albums-withnav\n                        \">\n                    <div\n                        class=\"b-photouploader-albums-inner\"\n                        lj-when-scrolled=\"albums.loadMore()\"\n                        >\n                        <!-- albums nav -->\n                        <div\n                            class=\"b-photouploader-nav\"\n                            >\n                            <label\n                                for=\"albums\"\n                                class=\"b-photouploader-nav-label\"\n                                lj-ml=\"photouploader.album.your\"\n                                ></label>\n                            <select\n                                id=\"albums\"\n                                ng-model=\"albums.current\"\n                                ng-options=\"item as item.album_title for item in albums.list\"\n                                >\n                            </select>\n                        </div>\n\n                        <!-- pictures -->\n                        <ul\n                            class=\"\n                                b-photouploader-pictures\n                                b-photouploader-pictures-withtitle\n                                b-photouploader-pictures-withmove\n                                \"\n                            ng-model=\"albums.current.photos\"\n                            >\n                            <li\n                                class=\"b-photouploader-pictures-item\"\n                                ng-repeat=\"photo in albums.current.photos\"\n                                ng-click=\"albums.togglePhoto(photo)\"\n                                ng-class=\"{ \'selected\': photo.selected }\"\n                                >\n                                <span class=\"b-photouploader-pictures-pic\"><!--\n                                    --><img\n                                        class=\"b-photouploader-pictures-img\"\n                                        ng-src=\"{{ photo.photo_url || photo.photo_src }}\"\n                                        ><!--\n                                --></span>\n                                <strong\n                                    class=\"b-photouploader-pictures-title\"\n                                    ng-bind=\"photo.photo_title\"\n                                    ng-show=\"photo.photo_title\"\n                                    ><!--\n                                --></strong>\n                            </li>\n                        </ul>\n\n                    </div>\n                </div><!-- /albums -->\n\n            </div>\n\n            <!-- controls -->\n            <div\n                class=\"\n                    b-photouploader-panel\n                    b-photouploader-panel-controls\n                    \"\n                >\n                <div class=\"b-photouploader-albumsettings\">\n                    <label\n                        for=\"sizepictures\"\n                        class=\"b-photouploader-albumsettings-label\"\n                        lj-ml=\"photouploader.album.size\"\n                        ></label>\n                    <select\n                        id=\"sizepictures\"\n                        class=\"b-photouploader-albumsettings-select\"\n                        ng-model=\"ui.size.current\"\n                        ng-options=\"item as item.text for item in ui.size.list\"\n                        >\n                    </select>\n                    <input\n                        type=\"checkbox\"\n                        id=\"linktooriginal\"\n                        class=\"b-photouploader-albumsettings-check\"\n                        ng-model=\"albums.originalLink\"\n                        />\n                    <label\n                        for=\"linktooriginal\"\n                        class=\"b-photouploader-albumsettings-label\"\n                        lj-ml=\"photouploader.album.addlink\"\n                        ></label>\n                </div>\n                <div\n                    class=\"\n                        b-ljbutton\n                        b-ljbutton-submit\n                        \"\n                    >\n                    <button\n                        type=\"submit\"\n                        name=\"submit\"\n                        lj-disabled=\"albums.noneSelected() || ui.insertInProgress\"\n                        ng-click=\"albums.insert()\"\n                        lj-ml=\"photouploader.album.insert\"\n                        ></button>\n                </div>\n                <!-- \n                <button\n                    type=\"submit\"\n                    name=\"submit\"\n                    class=\"\n                        b-flatbutton\n                        b-flatbutton-simple\n                        \"\n                    lj-disabled=\"albums.noneSelected() || ui.insertInProgress\"\n                    ng-click=\"albums.insert()\"\n                    lj-ml=\"photouploader.album.insert\"\n                    ></button>\n                -->\n                <lj-flatbutton lj-flatbutton=\"[\'submit\', \'photouploader.album.insert\', \'b-flatbutton b-flatbutton-simple\', \'name\', \'submit\', \'lj-disabled\', \'albums.noneSelected() || ui.insertInProgress\', \'ng-click\', \'albums.insert()\']\">\n                </lj-flatbutton>\n            </div>\n\n        </div><!-- /albums item -->\n\n\n\n        <!-- by url -->\n        <div\n            class=\"\n                b-photouploader-item\n                b-photouploader-item-url\n                \"\n            ng-show=\"pills.isActive(\'paste\')\"\n            >\n\n            <form ng-submit=\"paste.insertUrl()\">\n\n                <!-- url form -->\n                <div\n                    class=\"\n                        b-photouploader-panel\n                        b-photouploader-panel-url\n                        \"\n                    >\n\n                    <dl class=\"b-photouploader-byurl\">\n\n                        <dt class=\"b-photouploader-byurl-picture\">\n                            <img\n                                ng-src=\"{{ paste.url }}\"\n                                ng-show=\"paste.url\"\n                                class=\"b-photouploader-byurl-image\"\n                                >\n                            <span\n                                ng-show=\"!paste.url\"\n                                class=\"b-photouploader-byurl-sub\"\n                                lj-ml=\"photouploader.paste.correctUrl\"\n                                ></span>\n                        </dt>\n\n                        <dd class=\"b-photouploader-byurl-form\">\n                            <label\n                                for=\"url\"\n                                class=\"b-photouploader-byurl-label\"\n                                lj-ml=\"photouploader.paste.pasteURL\"\n                                ></label>\n                            <br class=\"b-photouploader-byurl-br\">\n                            <input\n                                type=\"text\"\n                                id=\"url\"\n                                size=\"55\"\n                                class=\"b-photouploader-byurl-src\"\n                                placeholder=\"http://\"\n                                ng-model=\"paste.url\"\n                                focus-and-select=\"pills.isActive(\'paste\')\"\n                                >\n                            <br class=\"b-photouploader-byurl-br\">\n                            <em\n                                class=\"b-photouploader-byurl-note\"\n                                lj-ml=\"photouploader.paste.notice\"\n                                ></em>\n                        </dd>\n\n                        <dd class=\"b-photouploader-byurl-form\">\n                            <label\n                                for=\"imagelink\"\n                                class=\"b-photouploader-byurl-label\"\n                                lj-ml=\"photouploader.paste.link\"\n                                ></label>\n                            <br class=\"b-photouploader-byurl-br\">\n                            <input\n                                type=\"text\"\n                                id=\"imagelink\"\n                                size=\"35\"\n                                class=\"b-photouploader-byurl-link\"\n                                placeholder=\"http://\"\n                                ng-model=\"paste.link\"\n                                >\n                        </dd>\n\n                    </dl>\n\n                </div><!-- /panel -->\n\n                <!-- controls -->\n                <div\n                    class=\"\n                        b-photouploader-panel\n                        b-photouploader-panel-controls\n                        \"\n                    >\n                    <div class=\"b-photouploader-urlsettings\">\n                        <label\n                            for=\"picturesize\"\n                            class=\"b-photouploader-urlsettings-label\"\n                            lj-ml=\"photouploader.paste.size\"\n                            ></label>\n                        <select\n                            id=\"picturesize\"\n                            class=\"b-photouploader-urlsettings-select\"\n                            ng-model=\"ui.size.current\"\n                            ng-options=\"item as item.text for item in ui.size.list\"\n                            >\n                        </select>\n                    </div>\n                    <div\n                        class=\"\n                            b-ljbutton\n                            b-ljbutton-submit\n                            \"\n                        >\n                        <button\n                            type=\"submit\"\n                            name=\"submit\"\n                            lj-disabled=\"!paste.url\"\n                            lj-ml=\"photouploader.paste.insert\"\n                            ></button>\n                    </div>\n\n                    <!--\n                    <button\n                        type=\"submit\"\n                        name=\"submit\"\n                        class=\"\n                            b-flatbutton\n                            b-flatbutton-simple\n                            \"\n                        lj-disabled=\"!paste.url\"\n                        lj-ml=\"photouploader.paste.insert\"\n                        ></button>\n                    -->\n                    <lj-flatbutton lj-flatbutton=\"[\'submit\', \'photouploader.paste.insert\', \'b-flatbutton b-flatbutton-simple\', \'lj-disabled\', \'!paste.url\', \'name\', \'submit\']\">\n                    </lj-flatbutton>\n\n\n                </div><!-- /panel -->\n\n            </form>\n\n        </div><!-- /url item -->\n\n\n\n        <!-- dropbox -->\n        <div\n            class=\"\n                b-photouploader-item\n                b-photouploader-item-dropbox\n                \"\n            ng-show=\"pills.isActive(\'dropbox\')\"\n            >\n            <div\n                class=\"\n                    b-photouploader-panel\n                    b-photouploader-panel-dropbox\n                    \"\n                >\n                <p\n                    class=\"b-photouploader-panel-dropbox-intro\"\n                    lj-ml=\"photouploader.dropbox.choose\"\n                    ></p>\n                <span lj-dropbox-button></span>\n            </div>\n        </div><!-- /dropbox item -->\n\n\n\n        <!-- instagram -->\n        <div\n            class=\"\n                b-photouploader-item\n                b-photouploader-item-instargam\n                \"\n            ng-show=\"pills.isActive(\'instagram\')\"\n            >\n\n            <!-- login to instagram -->\n            <div\n                class=\"\n                    b-photouploader-panel\n                    b-photouploader-panel-instalogin\n                    \"\n                ng-show=\"!instagram.token()\"\n                >\n                <p\n                    class=\"b-photouploader-panel-instalogin-intro\"\n                    lj-ml=\"photouploader.instagram.intro\"\n                    ></p>\n                <a\n                    href=\"javascript:void(0);\"\n                    class=\"b-photouploader-instagram-signup\"\n                    ng-click=\"instagram.login()\"\n                    lj-ml=\"photouploader.instagram.loginButton\"\n                    ></a>\n            </div>\n\n            <!-- select pictures from instagram -->\n            <div\n                class=\"\n                    b-photouploader-panel\n                    b-photouploader-panel-pictures\n                    \"\n                ng-show=\"instagram.token()\"\n                >\n\n                <div class=\"b-photouploader-instahead\">\n                    <h4 class=\"b-photouploader-subhead\">\n                        <span\n                            lj-ml=\"photouploader.instagram.select\"\n                            ></span>\n                        <span\n                            class=\"b-photouploader-subhead-annex\"\n                            lj-ml=\"photouploader.instagram.select.help\"\n                            ></span>\n                    </h4>\n\n                    <a\n                        class=\"b-photouploader-logout\"\n                        href=\"javascript:void(0);\"\n                        ng-click=\"instagram.logout()\"\n                        lj-ml=\"photouploader.instagram.logout\"\n                        ></a>\n                </div>\n\n                <div\n                    class=\"\n                        b-photouploader-albums\n                        \"\n                    ng-class=\"{ \'b-photouploader-albums-loading\': instagram.loading }\"\n                    >\n                    <div\n                        class=\"b-photouploader-albums-inner\"\n                        lj-when-scrolled=\"instagram.loadMore()\"\n                        >\n                        <ul\n                            class=\"\n                                b-photouploader-pictures\n                                b-photouploader-pictures-withtitle\n                                b-photouploader-pictures-withmove\n                                \"\n                            ng-model=\"instagram.media\"\n                            ui-sortable=\"ui.sortableOptions\"\n                            >\n                            <li\n                                class=\"b-photouploader-pictures-item\"\n                                ng-repeat=\"media in instagram.media\"\n                                ng-click=\"instagram.select(media);\"\n                                ng-class=\"{ \'selected\': media.selected }\"\n                                >\n                                <span class=\"b-photouploader-pictures-pic\"><!--\n                                    --><img\n                                        ng-src=\"{{ media.images.thumbnail.url }}\"\n                                        class=\"b-photouploader-pictures-img\"\n                                        ><!--\n                                --></span>\n                                <strong\n                                    class=\"b-photouploader-pictures-title\"\n                                    title=\"{{ media.caption.text }}\"\n                                    ng-show=\"media.caption\"\n                                    ><!--\n                                    -->{{ media.caption.text }}<!--\n                                --></strong>\n                            </li>\n                        </ul><!-- /pictures -->\n                    </div>\n                </div><!-- /albums -->\n\n            </div><!-- /panel -->\n\n            <!-- controls -->\n            <div\n                class=\"\n                    b-photouploader-panel\n                    b-photouploader-panel-controls\n                    \"\n                ng-show=\"instagram.token()\"\n                >\n                <div class=\"b-photouploader-instasettings\">\n                    <input\n                        type=\"checkbox\"\n                        id=\"webembeds\"\n                        class=\"b-photouploader-instasettings-check\"\n                        ng-model=\"instagram.asEmbed\"\n                        />\n                    <label\n                        for=\"webembeds\"\n                        class=\"b-photouploader-instasettings-label\"\n                        ><!--\n                        --><span\n                            lj-ml=\"photouploader.instagram.asEmbeds\"\n                            ></span>\n                        <span\n                            class=\"b-photouploader-instasettings-annex\"\n                            lj-ml=\"photouploader.instagram.asEmbeds.help\"\n                            ></span><!--\n                    --></label>\n                </div>\n                <div\n                    class=\"\n                        b-ljbutton\n                        b-ljbutton-submit\n                        \"\n                    >\n                    <button\n                        type=\"submit\"\n                        name=\"submit\"\n                        lj-disabled=\"instagram.noneSelected()\"\n                        ng-click=\"instagram.insert()\"\n                        lj-ml=\"photouploader.instagram.insert\"\n                        ></button>\n                </div>\n                <!--\n                <button\n                    type=\"submit\"\n                    name=\"submit\"\n                    class=\"\n                        b-flatbutton\n                        b-flatbutton-simple\n                        \"\n                    lj-disabled=\"instagram.noneSelected()\"\n                    ng-click=\"instagram.insert()\"\n                    lj-ml=\"photouploader.instagram.insert\"\n                    ></button> -->\n\n                <lj-flatbutton lj-flatbutton=\"[\'submit\', \'photouploader.instagram.insert\', \'b-flatbutton b-flatbutton-simple\', \'lj-disabled\', \'instagram.noneSelected()\', \'ng-click\', \'instagram.insert()\', \'name\', \'submit\']\">\n            </lj-flatbutton>\n            </div><!-- /panel -->\n\n        </div><!-- /instagram item -->\n\n\n\n    </div><!-- /items -->\n\n\n\n</div>\n';
!function(a){"use strict";angular.module("LJ.Photouploader",["ui.sortable","LJ.AuthHelper","LJ.Messages","LJ.Pills","angular-plupload"]).factory("Photouploader",["$timeout",function(b){var c={};if(c.albums=angular.copy(LJ.get("fotki.uploader.albumsData")),c.sizesData=LJ.get("fotki.uploader.sizesData"),c.space=LJ.get("fotki.uploader.availableSpace"),c.albums.forEach(function(a){a.photos=[]}),c.album=c.albums[0],c.hasUploadAbilities=Boolean(LJ.get("remote.username")&&!LJ.get("remote.is_identity")),c.keys={dropbox:"7ye0n6mhwlsdh9u",instagram:"a0b3f92cbfe748e991ca49c6fdda113b"},c.getUnsortedAlbum=function(){return c.albums[0]},c.fetchAlbum=function(d,e){var f=20;c.hasUploadAbilities&&d.album.album_id&&(d.album.allFetched||a.ajax({url:(LJ.get("photo_prefix")||"")+"/__rpc_fotki_imgs?func=get_photos",dataType:"json",data:{album_id:d.album.album_id,start:d.start||0,required_size:100,count:f}}).then(function(a){var c=a.filter(LJ.Function.get("photo_url"));c.length<f&&(d.album.allFetched=!0),b(function(){e(c)})}))},c.updatePhotos=function(c,d,e){var f={photos_data:c};d.required_size&&(f.required_size=d.required_size),d.privacy&&(f.privacy=d.privacy),d.action&&(f.action=d.action),d.type&&(f.type=d.type),d.album&&("string"==typeof d.album?f.album_title=d.album:f.album_id=d.album.album_id),a.ajax({type:"POST",url:(LJ.get("photo_prefix")||"")+"/__rpc_fotki_imgs?func=update_photos",data:{data_to_update:angular.toJson(f)},dataType:"json"}).then(function(a){var f=a.resizes_data;if(d.required_size&&f){var g=c.reduce(function(a,b){return a[b.photo_id]=b,a},{});for(var h in f)g[h]["size_"+d.required_size]=f[h].image_url}b(function(){e(c)})})},c.removePhoto=function(a){var b=c.getUnsortedAlbum().photos,d=b.indexOf(a);-1!==d&&b.splice(d,1),a.is_deleted=1,c.updatePhotos([a],{},function(){})},c.getAlbumById=function(a){return c.albums.find(function(b){return b.album_id===a})},c.addAlbum=function(a,b){if(!a.album_id)throw new Error("album_id should be provided.");if(!a.album_title)throw new Error("album_title should be provided.");return e=angular.extend({photos:[]},a),b&&b.prepend?c.albums.unshift(e):c.albums.push(e),e},c.addPhotos=function(a,b,d){var e=c.getAlbumById(a);if(!e)throw new Error("Album with id %s not found",a);return d&&d.prepend?Array.prototype.unshift.apply(e.photos,b):Array.prototype.push.apply(e.photos,b),e},function(){var a,b=LJ.Storage.getItem("photouploader_album_id");b&&(a=c.getAlbumById(b),a&&(c.album=a))}(),LJ.get("fotki.insert")){var d=Number(LiveJournal.parseGetArgs().albums_id);if(d)c.album=c.getAlbumById(d),c.album.allFetched=!0,c.addPhotos(d,LJ.get("fotki.insert"));else{var e=c.addAlbum({album_id:"selected",album_title:LJ.ml("photouploader.album.scrapbookSelected"),photos:LJ.get("fotki.insert")});c.album=e}c.album.photos.forEach(LJ.Function.set("selected",!0))}return c}]).controller("PhotouploaderCtrl",["$scope","$q","$timeout","Pills","Editor","Photouploader","Messages","AuthHelper",function(b,c,d,e,f,g,h,i){var j=[];b.pluploadOptions={drop_element:"upload-panel",browse_button:"pickfiles",multi_selection:!0,filters:{max_file_size:"10mb",mime_types:[{title:"Image files",extensions:"jpg,jpeg,gif,png"}]},multipart:!0,multipart_params:{form_auth:LJ.get("fotki.uploader.guid")},file_data_name:"file"},LJ.Flags.isEnabled("photo_v4")||(b.hasUploadAbilities=g.hasUploadAbilities,b.hasAlbums=function(){return 0!==g.albums.length},b.$on("bubble:open:photouploader",function(){b.albums.current=g.album,LJ.get("fotki.insert")?e.group("photouploader","album"):(e.group("photouploader",b.hasUploadAbilities?LJ.Storage.getItem("photouploader2_state")||"upload":"paste"),"album"!==e.group("photouploader")||b.hasAlbums()||e.group("photouploader","upload"))}),b.$on("bubble:close:photouploader",function(){e.group("photouploader",null)}),b.ui={size:{list:g.sizesData,current:g.sizesData.find(LJ.Function.get("is_default"))||g.sizesData[0]},insertInProgress:!1,sortableOptions:{helper:"clone"}},b.upload={files:[],url:(LJ.get("photo_prefix")||"")+"/up",privacy:{current:LJ.get("fotki.uploader.privacyData")[0],list:LJ.get("fotki.uploader.privacyData")},space:g.space,album:g.getUnsortedAlbum(),inProgress:!1,insert:function(){if(!b.ui.insertInProgress){b.ui.insertInProgress=!0;var a=b.ui.size.current.size,c=b.upload.photos();g.updatePhotos(c,{privacy:b.upload.privacy.current.security,required_size:a,album:b.upload.newAlbumName||b.upload.album,action:"add_new_post",type:"upload"},function(){LJ.Event.trigger("uploadInsert",a,c)})}},cancel:function(a){var c=b.upload.files.indexOf(a);-1!==c&&b.upload.files.splice(c,1)},photos:function(){return b.hasAlbums()?g.getUnsortedAlbum().photos.filter(LJ.Function.get("uploaded")):[]},removePhoto:function(a){g.removePhoto(a)},state:function(){return b.upload.photos().length>0?"uploaded":"start"}},b.pills={isActive:function(a){return e.group("photouploader")===a},select:function(a){e.group("photouploader",a),LJ.Storage.setItem("photouploader2_state",a)}},b.paste={url:"",link:"",insertUrl:function(){var a,c=Number(b.ui.size.current.size)||"",d='<img src="'+b.paste.url+'" width="'+c+'" />';a=b.paste.link?'<a href="'+LJ.String.linkify(b.paste.link)+'">'+d+"</a>":d,f.insertContent("photouploader",a,[a]),b.paste.url="",b.paste.link="",b.bubble.close(),LJ.Track.event("Photouploader","Paste","Insert")}},b.albums={current:{photos:[]},list:g.albums,originalLink:!1,noneSelected:function(){return b.hasAlbums()?0===b.albums.current.photos.filter(LJ.Function.get("selected")).length:!0},togglePhoto:function(a){a.selected=!a.selected},insert:function(){if(!b.ui.insertInProgress){b.ui.insertInProgress=!0;var a=b.ui.size.current.size,c=b.albums.current.photos.filter(LJ.Function.get("selected"));"custom"!==a?g.updatePhotos(c,{required_size:a},function(){LJ.Event.trigger("albumInsert",a,c)}):LJ.Event.trigger("albumInsert",a,c)}},loadMore:function(){g.fetchAlbum({album:b.albums.current,start:b.albums.current.photos.length},function(a){g.addPhotos(b.albums.current.album_id,a)})}},b.$watch("albums.current",function(a){a&&a.album_id&&(g.album=a,g.fetchAlbum({album:a},function(b){g.addPhotos(a.album_id,b)}),LJ.Storage.setItem("photouploader_album_id",a.album_id))}),b.instagram={media:[],_token:null,token:function(a){var c=LJ.get("remote.username"),d="instagram_token",e={domain:LJ.get("siteroot").replace(/^https?:\/\/www/,"")};return c&&(d="instagram_token_"+c),"undefined"==typeof a?b.instagram._token||LJ.Cookie.get(d):(b.instagram._token=a,void LJ.Cookie.set(d,a,e))},noneSelected:function(){return 0===this.media.filter(LJ.Function.get("selected")).length},select:function(a){a.selected=!a.selected},insert:function(){var a,d,e=b.instagram.media.filter(LJ.Function.get("selected"));b.instagram.asEmbed?(d=e.map(function(a){return LJ.Media.parse(a.link).then(LJ.Function.get("embed"))}),c.all(d).then(function(a){f.insertContent("video",a.join("\n"),a)})):(a=e.map(function(a){return'<img src="{url}" title="{caption}">'.supplant({url:a.images.standard_resolution.url,caption:LJ.String.encodeHTML(a.caption&&a.caption.text||"")})}),f.insertContent("photouploader",a.join("\n"),a),LJ.Track.event("Photouploader","Instagram","Insert")),b.instagram.media.forEach(LJ.Function.set("selected",!1)),b.bubble.close()},login:function(){i.open(["https://instagram.com/oauth/authorize/?client_id=",g.keys.instagram,"&amp;redirect_uri=","http://www.livejournal.com","/auth_helper.html&amp;response_type=token"].join("")).then(function(a){a&&LJ.Event.trigger("instagram_token",a)})},logout:function(){(new Image).src="https://instagram.com/accounts/logout/",b.instagram.token(null),b.instagram.allFetched=!1,b.instagram.media.length=0},loadMore:function(){var c=b.instagram;if(c.token()&&!c.loading&&!c.allFetched){c.loading=!0;var e=["https://api.instagram.com","/v1/users/self/media/recent/?callback=?&access_token=",c.token()];if(c.media.length>0){var f=c.media[c.media.length-1].id;e.push("&max_id="+f)}a.getJSON(e.join("")).then(function(a){d(function(){a.data&&0===a.data.length&&(c.allFetched=!0),Array.prototype.push.apply(c.media,a.data),c.loading=!1})})}}},b.$watch(function(){return b.instagram.token()},b.instagram.loadMore),LJ.Event.on("instagram_token",function(a){d(function(){b.instagram.token(a)})}),b.dropbox={init:function(){window.Dropbox||LJ.injectScript("https://www.dropbox.com/static/api/2/dropins.js").done(function(){window.Dropbox&&(window.Dropbox.appKey=g.keys.dropbox),LJ.Event.trigger("dropbox_loaded",{linkType:"preview",multiselect:!0,extensions:["images"],success:function(a){d(function(){var c=a.map(function(a){return'<img src="{url}" alt="" title="">'.supplant({url:a.link.replace("www.dropbox.com","dl.dropboxusercontent.com")})});f.insertContent("photouploader",c.join("\n"),c),b.bubble.close(),LJ.Track.event("Photouploader","Dropbox","Success")})}})})}},b.dropbox.init(),b.uploaderInit=!0,b.pluploadCallbacks={filesAdded:function(a,c){b.upload.inProgress=!0,d(function(){b.upload.files.length=0,Array.prototype.push.apply(b.upload.files,angular.copy(c)),a.start()})},fileUploaded:function(a,c,d){return d=JSON.parse(d.response),"error"===d.status?(b.upload.files.shift(),void b.pluploadCallbacks.uploadError(a,d)):(d.photo_name=-1!==c.name.lastIndexOf(".")?c.name.substr(0,c.name.lastIndexOf(".")):c.name,void j.push(d))},uploadComplete:function(){j.length&&d(function(){var a,c=j[0].album_id;b.upload.inProgress=!1,j.forEach(LJ.Function.set("uploaded",!0)),g.getAlbumById(c)||(a=g.addAlbum({album_id:c,album_title:LJ.ml("fotki.album.default_album_name"),allFetched:!0},{prepend:!0}),b.albums.current=b.upload.album=a),g.addPhotos(c,j,{prepend:!0}),b.upload.files.length=0,j.length=0})},uploadProgress:function(a,c){d(function(){var a=b.upload.files.find(function(a){return a.id===c.id});a&&isFinite(c.percent)&&(a.percent=c.percent)})},uploadError:function(a,c){b.upload.inProgress=!1,c.code===plupload.INIT_ERROR?b.uploaderInit=!1:d(function(){h.error({body:c.message})})}},LJ.Event.on("uploadInsert",function(a,c){d(function(){var d=c.map(function(c){var d='<img src="{url}" alt="{name}" title="{name}">'.supplant({url:c["size_"+a],name:c.photo_name||""});return b.albums.originalLink?'<a target="_blank" href="'+c.photo_orig+'">'+d+"</a>":d});f.insertContent("photouploader",d.join("\n"),d),b.ui.insertInProgress=!1,c.forEach(LJ.Function.set("uploaded",!1)),b.bubble.close()})}),LJ.Event.on("albumInsert",function(a,c){var d=c.map(function(c){var d='<img src="{url}" alt="{name}" title="{name}">'.supplant({url:c["size_"+a],name:c.photo_title||""});return b.albums.originalLink?'<a target="_blank" href="'+c.photo_orig+'">'+d+"</a>":d});f.insertContent("photouploader",d.join("\n"),d),b.ui.insertInProgress=!1,b.albums.current.photos.forEach(LJ.Function.set("selected",!1)),b.bubble.close(),LJ.Track.event("Photouploader","Albums","Insert")}))}]).directive("ljWhenScrolled",function(){return function(a,b,c){var d=b[0];b.bind("scroll",function(){d.scrollTop+d.offsetHeight>=d.scrollHeight&&a.$apply(c.ljWhenScrolled)})}})}(jQuery);;

/* file-end: js/editor/photouploader.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/photo/editor.js 
*/




/* ---------------------------------------------------------------------------------
   file-start: js/core/array.js 
*/

!function(){"use strict";LJ.define("LJ.Array"),LJ.Array.intersection=function(a,b){var c;return b.length>a.length&&(c=b,b=a,a=c),a.filter(function(a){return-1!==b.indexOf(a)})}}();;

/* file-end: js/core/array.js 
----------------------------------------------------------------------------------*/




/* ---------------------------------------------------------------------------------
   file-start: js/photo/uploader.js 
*/




/* ---------------------------------------------------------------------------------
   file-start: js/photo/photo.js 
*/

//= require_ml flatmedia.adult.content.default
//= require_ml flatmedia.adult.content.none
//= require_ml flatmedia.adult.content.explicit
//= require_ml flatmedia.select.album.none
!function(){"use strict";angular.module("Photo.Service",[]).factory("Photo",["$q","Api",function(a,b){function c(a){return b.call("photo.create_record",a).then(function(a){return w(a.record),a.record})}function d(a){return b.call("photo.get_albums",Object.assign({user:z},a),{cache:!0}).then(function(a){a.albums.forEach(k)})}function e(c){var d=C.indexOf(c);return-1!==d?a.when(null):(C.push(c),b.call("photo.get_album",{id:c,user:z},{cache:!0}).then(function(a){C.splice(d,1),k(a.album)}))}function f(c,d,e){return"undefined"==typeof e&&(e=!0),d.offset<0?a.when(null):b.call("photo.get_records",Object.assign({albumid:c,user:z},d),{cache:e}).then(function(a){var b=a.records;return w(b),b})}function g(a){return b.call("photo.get_record",Object.assign({user:z},a),{cache:!0}).then(function(a){return a.record})}function h(a){return b.call("photo.update_album",a).then(function(c){return k(c.album),b.invalidate("photo.get_albums",{user:z}),b.invalidate("photo.get_album",{id:a.id,user:z}),c.album})}function i(a){var c=angular.extend({},{security:"public",user:z},a);return b.call("photo.create_album",c).then(function(a){var c=a.album;return k(c),b.invalidate("photo.get_albums",{user:z}),c})}function j(a){return b.call("photo.delete_album",{id:a}).then(function(c){return l(a),b.invalidate("photo.get_albums",{user:z}),b.invalidate("photo.get_album",{user:z,id:a}),c})}function k(a){A[a.id]=a}function l(a){delete A[a],q(a).forEach(function(a){m(a.id)})}function m(a){var c=p(a);b.invalidate("photo.get_albums",{user:z}),b.invalidate("photo.get_album",{user:z,id:c.albumid}),b.invalidate("photo.get_records",{albumid:c.albumid,user:z,offset:Math.floor(c.index/20),limit:20}),delete B[a]}function n(){var a=[];return angular.forEach(A,function(b){a.push(b)}),a.sort(function(a,b){return b.id-a.id}),a}function o(a){return A[a]}function p(a){return B[a]}function q(a,b){var c,d,e=[];return angular.forEach(B,function(b){b.albumid===a&&e.push(b)}),e=e.sort(function(a,b){return b.id-a.id}),b&&(c=b.offset,d=b.offset+b.limit,e=e.filter(function(a){return a.index>=c&&a.index<d})),e}function r(b,c){var d,e,g=a.defer();return 0>c?(g.resolve(),g.promise):(e=Object.keys(B).filter(function(a){return B[a].albumid===b}),d=e.find(function(a){var b=B[a];return b.index===c}),d?(g.resolve(B[d]),g.promise):f(b,{offset:c,limit:1}).then(function(a){return a[0]}))}function s(a){return b.call("photo.update_records",a).then(function(a){var b=a.records;return b.forEach(u),b})}function t(a){return b.call("photo.update_record",a).then(function(a){var b=a.record;return u(b),b})}function u(a){var c=p(a.id);b.invalidate("photo.get_records",{albumid:a.albumid,user:z,offset:Math.floor(a.index/20),limit:20}),b.invalidate("photo.get_album",{user:z,id:a.albumid}),b.invalidate("photo.get_albums",{user:z}),c&&(b.invalidate("photo.get_records",{albumid:c.albumid,user:z,offset:Math.floor(c.index/20),limit:20}),b.invalidate("photo.get_album",{user:z,id:c.albumid})),e(a.albumid),w(a)}function v(a,c){return b.call("photo.delete_records",{ids:a}).then(function(){c&&c.notCached||a.forEach(function(a){m(a)})})}function w(a){Array.isArray(a)||(a=[a]),a.forEach(function(a){B[a.id]=a})}var x={NON_SELECTED_ALBUM:{id:-1,name:LJ.ml("flatmedia.select.album.none")},RECORD_ADULT:!1,RECORD_PRIVACY:"public",ALBUM_PRIVACY:"public",ALBUM_NAME:""},y={createRecord:c,fetchAlbums:d,getAlbums:n,fetchAlbum:e,getAlbumById:o,fetchRecords:f,fetchRecordById:g,getRecordById:p,getRecordByIndex:r,getRecordsByAlbumId:q,createAlbum:i,updateAlbum:h,removeAlbum:j,updateRecord:t,updateRecords:s,removeRecords:v,defaults:x},z=LJ.get("journal.username")||LJ.get("remote.username"),A={},B={},C=[];return y}]).factory("PhotoSize",function(){function a(){var a=LJ.Cookie.get("photo_size"),b=a?LJ.Function.get("size",a.toString()):LJ.Function.get("is_default");return c&&(b&&c.filter(b)[0]||c[0])}function b(a){for(var b=c.map(LJ.Function.get("size")),d=0,e=a.length;e>d;d++)b=LJ.Array.intersection(a[d],b);return c.filter(function(a){return-1!==b.indexOf(a.size)})}var c=LJ.get("fotki.uploader.sizesData");return{list:c,current:a(),insertInProgress:!1,sortableOptions:{helper:"clone"},intersect:b,getDefaultSize:a}}).filter("decodeRecord",[function(){return function(a){function b(a){return"&lt;"===a?"<":">"}return a.name=(a.name||"").replace(/(&(gt|lt);)/g,b),a.description=(a.description||"").replace(/(&(gt|lt);)/g,b),a}}])}();;

/* file-end: js/photo/photo.js 
----------------------------------------------------------------------------------*/


/* ---------------------------------------------------------------------------------
   file-start: js/photo/selectAlbum.js 
*/


Site.page.template['angular/photo/selectPhotoAlbum.ng.tmpl'] = '<div class=\"b-ljform-field\"\n  ng-class=\"{\n    \'flatpopup-create-state\': directive.state.create\n  }\"\n  >\n\n  <div class=\"flatmedia-edit-field\">\n    <label class=\"flatpopup-label\" lj-ml=\"flatmedia.select.album\"></label>\n    <select\n      ng-model=\"directive.selectedAlbumId\"\n      ng-options=\"album.id as album.name for album in directive.albums\"\n      ></select>\n    <span lj-ml=\"flatmedia.or\"></span>\n    <a\n      class=\"flatmedia-action-link\"\n      href=\"javascript:void(0);\"\n      ng-click=\"directive.toggle(true)\"\n      lj-ml=\"flatmedia.album.create.new\"\n      ></a>\n  </div>\n\n  <div class=\"flatmedia-create-field\">\n    <label class=\"flatpopup-label\" lj-ml=\"flatmedia.album.name\"></label>\n    <a\n      class=\"flatpopup-action-link flatpopup-aside-link\"\n      href=\"javascript:void(0);\"\n      ng-click=\"directive.toggle(false)\"\n      lj-ml=\"flatmedia.button.back\"\n      ng-if=\"directive.albums.length\"\n      ></a>\n    <input\n      type=\"text\"\n      class=\"b-input b-input-max\"\n      maxlength=\"150\"\n      ng-model=\"directive.newAlbum.name\"\n      />\n  </div>\n</div>\n';
//= require_ml flatmedia.album.create.new
//= require_ml flatmedia.album.name
//= require_ml flatmedia.button.back
//= require_ml flatmedia.or
//= require_ml flatmedia.select.album
!function(){"use strict";angular.module("Photo.SelectAlbum",["LJ.Templates","Photo.Service"]).directive("selectPhotoAlbum",["Photo",function(a){return{templateUrl:"selectPhotoAlbum.ng.tmpl",controllerAs:"directive",scope:{album:"=selectPhotoAlbum",allowNonSelected:"=?allowNonSelected",scope:"=selectPhotoAlbumScope"},controller:["$scope","$attrs","Photo",function(a,b,c){function d(){var c=b.allowNonSelected;return"string"==typeof c&&0===c.length?!0:a.allowNonSelected}function e(a){var b=[];return d()&&b.push(c.defaults.NON_SELECTED_ALBUM),b.concat(a?a:c.getAlbums())}var f=this,g=this.state={init:!1,create:!1};this.newAlbum={name:""},this.init=function(){g.init=!0,f.albums=angular.copy(c.getAlbums()),a.album.id?this.selectedAlbumId=a.album.id:0!==f.albums.length&&(this.selectedAlbumId=f.albums[0].id),a.$watch(function(){return f.selectedAlbumId+f.newAlbum.name+g.create},function(){a.album=g.create?f.newAlbum:c.getAlbumById(f.selectedAlbumId)}),a.$watchCollection(c.getAlbums,function(a){f.albums=e(a),0===a.length&&(g.create=!0)}),"undefined"!=typeof b.allowNonSelected&&a.$watch("allowNonSelected",function(){f.albums=e()})},this.toggle=function(a){g.create=a,this.newAlbum.name=""}}],link:function(b,c,d,e){var f={};if("undefined"==typeof b.album)throw new TypeError("You should provide album object");"photo"!==b.scope&&(f={user:LJ.get("remote.username")}),a.fetchAlbums(f).then(function(){e.init()})}}}])}();;

/* file-end: js/photo/selectAlbum.js 
----------------------------------------------------------------------------------*/

Site.page.template['angular/photo/uploaderPhoto.ng.tmpl'] = '<div\n    class=\"flatpopup__body-inner\"\n    ng-if=\"directive.state.init\"\n    ng-class=\'{\n       \"flatpopup-uploading\": directive.state.uploadInProgress,\n       \"flatpopup-uploading-complete\": directive.state.uploadDone\n    }\'>\n    <div\n        class=\"b-ljform-field upload__box\"\n        id=\"upload-panel-photo\"\n        plupload=\"directive.uploadUrl\"\n        plupload-options=\"directive.uploadOptions\"\n        plupload-callbacks=\"directive.uploadCallbacks\"\n        plupload-disable-on-upload=\"directive.scope === \'photo\'\"\n        >\n        <label\n            class=\"upload__box-label\"\n            for=\"pickfiles-photo\"\n            lj-ml=\"{\n                  \'photouploader.upload.dragOrClick\':   directive.modulo() === -1,\n                  \'photouploader.upload.filesAdded1\':   directive.modulo() === 1,\n                  \'photouploader.upload.filesAdded2-4\': directive.modulo() >=  2 && directive.modulo() <= 4,\n                  \'photouploader.upload.filesAdded5\':   directive.modulo() === 0 || directive.modulo() >= 5\n                }\"\n            lj-ml-resolve=\"{ number: directive.files.length }\"\n            lj-ml-dynamic=\"directive.uploaded.length || directive.files.length\"\n            ></label>\n        <input\n            type=\"file\"\n            class=\"upload__input\"\n            name=\"media\"\n            id=\"pickfiles-photo\"\n            ng-value=\"directive.model.name\"\n            ng-placeholder=\"directive.inProgress\"\n            lj-disabled=\"directive.state.uploadInProgress\"\n            >\n    </div>\n\n    <ul\n        class=\"upload__items\"\n        ng-if=\"directive.state.preview\"\n        >\n        <li\n            class=\"upload__item\"\n            ng-repeat=\"photo in directive.uploaded\"\n            >\n            <span class=\"upload__item_pic\"><!--\n                --><img\n                    class=\"b-photouploader-pictures-img\"\n                    ng-src=\"{{ photo.thumbnail_url }}\"\n                    ><!--\n            --></span>\n            <span\n                class=\"upload__item_remove\"\n                lj-svg-icon=\"flaticon--cross\"\n                lj-ml=\"photouploader.upload.remove\"\n                lj-ml-attr=\"title\"\n                ng-click=\"directive.remove(photo, $index)\"\n                ></span>\n        </li>\n    </ul>\n\n    <div class=\"upload-bar\">\n        <span\n            class=\"upload-bar__inner\"\n            ng-style=\"{ width: directive.progress + \'%\' }\"\n            ></span>\n    </div>\n\n    <div class=\"flatpopup__msg\">\n        <span\n            class=\"\n                b-bubble\n                b-bubble-warning\n                b-bubble-noarrow\n                flatpopup__msg-warning\n                flatpopup__msg-text\n                \"\n            ></span>\n    </div>\n\n    <div class=\"b-ljform-field\">\n        <div select-photo-album=\"directive.model.album\" select-photo-album-scope=\"directive.scope\"></div>\n    </div>\n\n    <div class=\"b-ljform-field flatmedia-privacy__field\">\n        <label lj-ml=\"flatmedia.security\"></label>\n        <span\n            lj-privacy=\"directive.model\"\n            lj-privacy-scope=\"photo\"></span>\n    </div>\n\n    <div\n        class=\"b-ljform-field\"\n        ng-if=\"directive.state.selectSize && directive.sizes.list\"\n        >\n        <label\n            for=\"albums\"\n            class=\"b-photouploader-nav-label\"\n            lj-ml=\"photouploader.album.size\"\n            ></label>\n        <select\n            id=\"albums\"\n            ng-model=\"directive.sizes.current\"\n            ng-options=\"size as size.text for size in directive.sizes.list\"\n            ></select>\n    </div>\n\n    <div\n        class=\"b-photouploader-albumselector-item\"\n        ng-if=\"directive.state.selectSize && directive.sizes.list\"\n        >\n        <input\n            type=\"checkbox\"\n            id=\"linktoneworiginal\"\n            class=\"b-photouploader-albumselector-check\"\n            ng-model=\"directive.originalLink\"\n            >\n        <label\n            for=\"linktoneworiginal\"\n            class=\"b-photouploader-albumselector-label\"\n            lj-ml=\"photouploader.upload.addlink\"\n            ></label>\n    </div>\n\n    <div class=\"b-ljform-field\">\n        <button\n            class=\"\n                b-flatbutton\n                b-flatbutton-simple\n                \"\n            lj-ml=\"{\n                    \'flatmedia.upload.photo\': directive.scope === \'photo\',\n                    \'photouploader.upload.insert\': directive.scope !== \'photo\'\n                }\"\n            lj-disabled=\"!directive.isSaveAllowed()\"\n            ng-click=\"directive.save()\"\n            ></button>\n        <a\n            class=\"flatpopup-action-link\"\n            href=\"javascript:void(0)\"\n            ng-click=\"directive.cancel()\"\n            lj-ml=\"flatmedia.button.cancel\"\n            ></a>\n    </div>\n\n</div>\n\n<div class=\"b-photouploader-initfail\" ng-if=\"!directive.state.init\">\n    <span class=\"b-photouploader-initfail-flash\" lj-ml=\"photouploader.upload.initFail\"></span>\n</div>\n';
//= require_ml flatmedia.button.cancel
//= require_ml flatmedia.name
//= require_ml flatmedia.upload.photo
//= require_ml photouploader.upload.initFail
//= require_ml photouploader.upload.dragOrClick
//= require_ml photouploader.upload.filesAdded1
//= require_ml photouploader.upload.filesAdded2-4
//= require_ml photouploader.upload.filesAdded5
//= require_ml photouploader.upload.insert
!function(){"use strict";angular.module("Photo.Uploader",["LJ.Templates","LJ.Messages","LJ.Api","angular-plupload","Photo.SelectAlbum","Photo.Service","Editor"]).directive("ljPhotoUploader",["$timeout",function(a){return{templateUrl:"uploaderPhoto.ng.tmpl",scope:{albumId:"=ljPhotoUploader",scope:"@ljPhotoUploaderScope",callback:"&ljPhotoUploaderCallback",cancelUpload:"&ljPhotoUploaderCancel"},controllerAs:"directive",controller:["$scope","$q","$rootScope","$element","$attrs","Photo","Editor","Bubble","Messages","PhotoSize",function(b,c,d,e,f,g,h,i,j,k){function l(){A.model=p(),x("ready")}function m(){function a(a){"function"==typeof b.callback&&b.callback({photo:a}),"photo"===A.scope&&LJ.Event.trigger("upload:photo:back"),z(),x("init")}LJ.Event.trigger("photo:upload:save"),v().then(u).then(a)}function n(){"function"==typeof b.cancelUpload&&b.cancelUpload(),x("cancel"),A.uploaded.map(o),B.length=0,i.close()}function o(a){g.removeRecords([a.id],{notCached:!0}).then(function(){A.uploaded.splice(A.uploaded.indexOf(a),1)})}function p(){return{name:g.defaults.ALBUM_NAME,privacy:g.defaults.RECORD_PRIVACY,album:g.getAlbumById(b.albumId)||{}}}function q(){return B.length&&B.every(function(a){return 0!==a.trim().length})&&(A.model.album.id||0!==A.model.album.name.trim().length)&&!A.state.inProgress}function r(){var a=A.files.length;return 0===a?-1:10>a||a>20?a%10:0}function s(){return A.state.inProgress?void LJ.Event.once("photo:upload:done",s):(x("uploading"),void A.uploader.start())}function t(){A.state.isWaiting||(A.state.isWaiting=!0,LJ.Event.once("photo:upload:save",s))}function u(){var a=A.uploaded.map(function(a,b){return g.updateRecord({id:a.id,albumid:A.model.album.id,privacy:A.model.privacy,name:B[b]})});return c.all(a)}function v(){if("photo"===A.scope&&!A.uploaded.length)return LJ.Event.once("photo:upload:done",m),c.reject();"editor"===A.scope&&x("progress");var a=angular.copy(A.model),b=c.defer(),d=b.promise;return"undefined"==typeof a.album.id?d=g.createAlbum({name:a.album.name}):b.resolve(a.album),delete a.album,d.then(function(a){A.model.album.id=a.id})}function w(a){return x("error"),a.code&&a.code===window.plupload.INIT_ERROR?void(A.state.init=!1):(A.files.pop(),void j.error({body:a.message}))}function x(a){var c={inProgress:!1,uploadInProgress:!1,uploadDone:!1,error:!1,preview:f.hasOwnProperty("ljPhotoUploaderPreview"),selectSize:f.hasOwnProperty("ljPhotoUploaderSize")};switch(A.state=angular.extend({},A.state,c),a){default:case"init":break;case"progress":A.state.inProgress=!0;break;case"cancel":LJ.Event.trigger("photo:upload:cancel");break;case"uploading":LJ.Event.trigger("photo:upload:start"),A.state.inProgress=!0,A.state.uploadInProgress=!0;break;case"uploaded":LJ.Event.trigger("photo:upload:done"),A.state.uploadDone=!0;break;case"ready":A.state.init=!0,b.$apply();break;case"error":A.state.error=!0}}function y(){var a=A.state.selectSize&&A.sizes.current.size,b='<img src="{url}" alt="{name}" title="{name}">',c='<a target="_blank" href="{originalLink}">{img}</a>';return A.uploaded.map(function(d){var e=b.supplant({url:a?d.url.replace("original",a):d.url,name:d.photo_name||d.name});return A.originalLink?c.supplant({originalLink:d.url,img:e}):e})}function z(){var a=y();h.insertContent("photouploader",a.join("\n"),a),A.uploaded.length=0,i.close()}var A=this,B=[];x(),A.init=l,A.files=[],A.uploaded=[],A.save=m,A.cancel=n,A.remove=o,A.isSaveAllowed=q,A.modulo=r,A.scope=b.scope,A.sizes=k,A.uploadUrl=(LJ.get("photo_prefix")||"")+"/up",A.uploadOptions={drop_element:"upload-panel-photo",browse_button:"pickfiles-photo",multi_selection:!0,filters:{max_file_size:"10mb",mime_types:[{title:"Image files",extensions:"jpg,jpeg,gif,png"}]},multipart:!0,multipart_params:{form_auth:LJ.get("fotki.uploader.guid")||LJ.get("page.guid")},file_data_name:"file"},A.uploadCallbacks={init:function(a){A.uploader=a,a.refresh()},filesAdded:function(b,c){x("init"),A.files.lenght=0,Array.prototype.push.apply(A.files,angular.copy(c)),Array.prototype.push.apply(B,c.map(LJ.Function.get("name"))),a("photo"!==A.scope?s:t)},fileUploaded:function(a,c,d){return d=JSON.parse(d.response),A.files.shift(),b.$apply(),"error"===d.status?void w(d):void(A.state.error||A.uploaded.push(d))},uploadProgress:function(a,b){var c=100/(A.files.length+A.uploaded.length);A.progress=isFinite(c)?Math.floor(c*(A.uploaded.length+b.percent/100)):0},uploadComplete:function(){A.progress=0,x("uploaded")},error:function(a,b){w(b)}}}],link:function(b,c,d,e){a(e.init)}}}])}();;

/* file-end: js/photo/uploader.js 
----------------------------------------------------------------------------------*/


// error: photouploader.css is already included
// error: menu_v2.css is already included
Site.page.template['angular/photo.ng.tmpl'] = '<div\n    class=\"b-photouploader\"\n    ng-controller=\"PhotoEditorCtrl as photo\"\n    >\n\n\n\n    <!-- menu -->\n    <ul\n        class=\"\n            b-menu\n            b-menu-hrz\n            b-menu-pills\n            b-menu-pseudo\n            b-photouploader-menu\n            \"\n        lj-pills-group=\"uploadPhoto\"\n        ><!--\n        --><li\n            class=\"b-menu-item b-menu-item-active\"\n            data-pill=\"upload\"\n            ng-if=\"photo.state.canUpload\"\n            >\n            <a\n                href=\"javascript:void(0);\"\n                ng-click=\"photo.pill(\'upload\')\"\n                class=\"b-menu-item-link\"\n                lj-ml=\"photouploader.upload.title\"\n                ></a>\n        </li><!--\n        --><li\n            class=\"b-menu-item\"\n            data-pill=\"album\"\n            ng-if=\"photo.state.canUpload && photo.albums.list\"\n            >\n            <a\n                href=\"javascript:void(0);\"\n                ng-click=\"photo.pill(\'album\')\"\n                class=\"b-menu-item-link\"\n                lj-ml=\"photouploader.album.title\"\n                ></a>\n        </li><!--\n        --><li\n            class=\"b-menu-item\"\n            data-pill=\"paste\"\n            >\n            <a\n                href=\"javascript:void(0);\"\n                ng-click=\"photo.pill(\'paste\')\"\n                class=\"b-menu-item-link\"\n                lj-ml=\"photouploader.paste.title\"\n                ></a>\n        </li><!--\n        --><li\n            class=\"b-menu-item\"\n            data-pill=\"dropbox\"\n            >\n            <a\n                href=\"javascript:void(0);\"\n                ng-click=\"photo.pill(\'dropbox\')\"\n                class=\"b-menu-item-link\"\n                lj-ml=\"photouploader.dropbox.title\"\n                ></a>\n        </li><!--\n        --><li\n            class=\"b-menu-item\"\n            data-pill=\"instagram\"\n            >\n            <a\n                href=\"javascript:void(0);\"\n                ng-click=\"photo.pill(\'instagram\')\"\n                class=\"b-menu-item-link\"\n                lj-ml=\"photouploader.instagram.title\"\n                ></a>\n        </li><!--\n    --></ul>\n\n\n    <!-- items -->\n    <div class=\"b-photouploader-items\">\n        <!-- upload from computer -->\n        <div\n            class=\"\n                b-photouploader-item\n                b-photouploader-item-upload\n                \"\n            ng-class=\"\'b-photouploader-item-upload-\' + upload.state()\"\n            ng-if=\"photo.state.canUpload && photo.isPill(\'upload\')\"\n            >\n                <div lj-photo-uploader\n                     lj-photo-uploader-callback=\"photo.loaded(photo)\"\n                     lj-photo-uploader-cancel=\"photoUploadCancelled()\"\n                     lj-photo-uploader-scope=\"editor\"\n                     lj-photo-uploader-preview\n                     lj-photo-uploader-size\n                     ></div>\n            </div>\n\n\n        <!-- select from albums -->\n        <div\n            class=\"\n                b-photouploader-item\n                b-photouploader-item-albums\n                \"\n            ng-show=\"photo.isPill(\'album\')\"\n            ng-if=\"photo.state.canUpload\"\n            >\n\n            <!-- albums -->\n            <div\n                class=\"\n                    b-photouploader-panel\n                    b-photouploader-panel-albums\n                    \"\n                >\n\n                <h4\n                    class=\"b-photouploader-subhead\"\n                    lj-ml=\"photouploader.album.select\"\n                    ></h4>\n\n                <div class=\"\n                        b-photouploader-albums\n                        b-photouploader-albums-withnav\n                        \">\n                    <div\n                        class=\"b-photouploader-albums-inner\"\n                        lj-when-scrolled=\"photo.albums.loadMore()\"\n                        >\n                        <!-- albums nav -->\n                        <div\n                            class=\"b-photouploader-nav\"\n                            >\n                            <label\n                                for=\"albums\"\n                                class=\"b-photouploader-nav-label\"\n                                lj-ml=\"photouploader.album.your\"\n                                ></label>\n                            <select\n                                id=\"albums\"\n                                ng-model=\"photo.albums.current\"\n                                ng-options=\"item as item.name for item in photo.albums.list\"\n                                >\n                            </select>\n                        </div>\n\n                        <!-- pictures -->\n                        <ul\n                            class=\"\n                                b-photouploader-pictures\n                                b-photouploader-pictures-withtitle\n                                b-photouploader-pictures-withmove\n                                \"\n                            ng-model=\"photo.albums.current.photos\"\n                            >\n                            <li\n                                class=\"b-photouploader-pictures-item\"\n                                ng-repeat=\"item in photo.albums.current.photos\"\n                                ng-click=\"photo.albums.togglePhoto(item)\"\n                                ng-class=\"{ \'selected\': item.selected }\"\n                                >\n                                <span class=\"b-photouploader-pictures-pic\"><!--\n                                    --><img\n                                    class=\"b-photouploader-pictures-img\"\n                                    ng-src=\"{{ item.thumbnail_url || item.url }}\"\n                                    ><!--\n                                --></span>\n                                <strong\n                                    class=\"b-photouploader-pictures-title\"\n                                    ng-bind=\"item.name\"\n                                    ng-show=\"item.name\"\n                                    ><!--\n                                --></strong>\n                            </li>\n                        </ul>\n\n                    </div>\n                </div><!-- /albums -->\n\n            </div>\n\n            <!-- controls -->\n            <div\n                class=\"\n                    b-photouploader-panel\n                    b-photouploader-panel-controls\n                    \"\n                >\n                <div class=\"b-photouploader-albumsettings\">\n                    <label\n                        for=\"sizepictures\"\n                        class=\"b-photouploader-albumsettings-label\"\n                        lj-ml=\"photouploader.album.size\"\n                        ></label>\n                    <select\n                        id=\"sizepictures\"\n                        class=\"b-photouploader-albumsettings-select\"\n                        ng-model=\"photo.ui.current\"\n                        ng-options=\"item as item.text for item in photo.ui.list\"\n                        >\n                    </select>\n                    <div class=\"b-photouploader-albumsettings-separator\"></div>\n                    <input\n                        type=\"checkbox\"\n                        id=\"linktooriginal\"\n                        class=\"b-photouploader-albumsettings-check\"\n                        ng-model=\"photo.albums.originalLink\"\n                        />\n                    <label\n                        for=\"linktooriginal\"\n                        class=\"b-photouploader-albumsettings-label\"\n                        lj-ml=\"photouploader.album.addlink\"\n                        ></label>\n                </div>\n                <div\n                    class=\"\n                        b-ljbutton\n                        b-ljbutton-submit\n                        \"\n                    >\n                    <button\n                        type=\"submit\"\n                        name=\"submit\"\n                        lj-disabled=\"photo.albums.noneSelected() || photo.ui.insertInProgress\"\n                        ng-click=\"photo.albums.insert()\"\n                        lj-ml=\"photouploader.album.insert\"\n                        ></button>\n                </div>\n                <button\n                    type=\"submit\"\n                    name=\"submit\"\n                    class=\"\n                        b-flatbutton\n                        b-flatbutton-simple\n                        \"\n                    lj-disabled=\"photo.albums.noneSelected() || photo.ui.insertInProgress\"\n                    ng-click=\"photo.albums.insert()\"\n                    lj-ml=\"photouploader.album.insert\"\n                    ></button>\n            </div>\n\n        </div><!-- /albums item -->\n\n\n        <!-- by url -->\n        <div\n            class=\"\n                b-photouploader-item\n                b-photouploader-item-url\n                \"\n            ng-show=\"photo.isPill(\'paste\')\"\n            >\n\n            <form ng-submit=\"photo.paste.insertUrl()\">\n\n                <!-- url form -->\n                <div\n                    class=\"\n                        b-photouploader-panel\n                        b-photouploader-panel-url\n                        \"\n                    >\n\n                    <dl class=\"b-photouploader-byurl\">\n\n                        <dt class=\"b-photouploader-byurl-picture\">\n                            <img\n                                ng-src=\"{{ photo.paste.url }}\"\n                                ng-show=\"photo.paste.url\"\n                                class=\"b-photouploader-byurl-image\"\n                                >\n                            <span\n                                ng-show=\"!photo.paste.url\"\n                                class=\"b-photouploader-byurl-sub\"\n                                lj-ml=\"photouploader.paste.correctUrl\"\n                                ></span>\n                        </dt>\n\n                        <dd class=\"b-photouploader-byurl-form\">\n                            <label\n                                for=\"url\"\n                                class=\"b-photouploader-byurl-label\"\n                                lj-ml=\"photouploader.paste.pasteURL\"\n                                ></label>\n                            <br class=\"b-photouploader-byurl-br\">\n                            <input\n                                type=\"text\"\n                                id=\"url\"\n                                size=\"55\"\n                                class=\"b-photouploader-byurl-src\"\n                                placeholder=\"http://\"\n                                ng-model=\"photo.paste.url\"\n                                focus-and-select=\"photo.isPill(\'paste\')\"\n                                >\n                            <br class=\"b-photouploader-byurl-br\">\n                            <em\n                                class=\"b-photouploader-byurl-note\"\n                                lj-ml=\"photouploader.paste.notice\"\n                                ></em>\n                        </dd>\n\n                        <dd class=\"b-photouploader-byurl-form\">\n                            <label\n                                for=\"imagelink\"\n                                class=\"b-photouploader-byurl-label\"\n                                lj-ml=\"photouploader.paste.link\"\n                                ></label>\n                            <br class=\"b-photouploader-byurl-br\">\n                            <input\n                                type=\"text\"\n                                id=\"imagelink\"\n                                size=\"35\"\n                                class=\"b-photouploader-byurl-link\"\n                                placeholder=\"http://\"\n                                ng-model=\"photo.paste.link\"\n                                >\n                        </dd>\n\n                    </dl>\n\n                </div><!-- /panel -->\n\n                <!-- controls -->\n                <div\n                    class=\"\n                        b-photouploader-panel\n                        b-photouploader-panel-controls\n                        \"\n                    >\n                    <div class=\"b-photouploader-urlsettings\">\n                        <label\n                            for=\"picturesize\"\n                            class=\"b-photouploader-urlsettings-label\"\n                            lj-ml=\"photouploader.paste.size\"\n                            ></label>\n                        <select\n                            id=\"picturesize\"\n                            class=\"b-photouploader-urlsettings-select\"\n                            ng-model=\"photo.ui.current\"\n                            ng-options=\"item as item.text for item in photo.ui.list\"\n                            >\n                        </select>\n                    </div>\n                    <div\n                        class=\"\n                            b-ljbutton\n                            b-ljbutton-submit\n                            \"\n                        >\n                        <button\n                            type=\"submit\"\n                            name=\"submit\"\n                            lj-disabled=\"!photo.paste.url\"\n                            lj-ml=\"photouploader.paste.insert\"\n                            ></button>\n                    </div>\n                    <button\n                        type=\"submit\"\n                        name=\"submit\"\n                        class=\"\n                            b-flatbutton\n                            b-flatbutton-simple\n                            \"\n                        lj-disabled=\"!photo.paste.url\"\n                        lj-ml=\"photouploader.paste.insert\"\n                        ></button>\n                </div><!-- /panel -->\n\n            </form>\n\n        </div><!-- /url item -->\n\n\n\n        <!-- dropbox -->\n        <div\n            class=\"\n                b-photouploader-item\n                b-photouploader-item-dropbox\n                \"\n            ng-show=\"photo.isPill(\'dropbox\')\"\n            >\n            <div\n                class=\"\n                    b-photouploader-panel\n                    b-photouploader-panel-dropbox\n                    \"\n                >\n                <p\n                    class=\"b-photouploader-panel-dropbox-intro\"\n                    lj-ml=\"photouploader.dropbox.choose\"\n                    ></p>\n                <span lj-dropbox-button></span>\n            </div>\n        </div><!-- /dropbox item -->\n\n\n\n        <!-- instagram -->\n        <div\n            class=\"\n                b-photouploader-item\n                b-photouploader-item-instargam\n                \"\n            ng-show=\"photo.isPill(\'instagram\')\"\n            >\n\n            <!-- login to instagram -->\n            <div\n                class=\"\n                    b-photouploader-panel\n                    b-photouploader-panel-instalogin\n                    \"\n                ng-show=\"!photo.instagram.token()\"\n                >\n                <p\n                    class=\"b-photouploader-panel-instalogin-intro\"\n                    lj-ml=\"photouploader.instagram.intro\"\n                    ></p>\n                <a\n                    href=\"javascript:void(0);\"\n                    class=\"b-photouploader-instagram-signup\"\n                    ng-click=\"photo.instagram.login()\"\n                    lj-ml=\"photouploader.instagram.loginButton\"\n                    ></a>\n            </div>\n\n            <!-- select pictures from instagram -->\n            <div\n                class=\"\n                    b-photouploader-panel\n                    b-photouploader-panel-pictures\n                    \"\n                ng-show=\"photo.instagram.token()\"\n                >\n\n                <div class=\"b-photouploader-instahead\">\n                    <h4 class=\"b-photouploader-subhead\">\n                        <span\n                            lj-ml=\"photouploader.instagram.select\"\n                            ></span>\n                        <span\n                            class=\"b-photouploader-subhead-annex\"\n                            lj-ml=\"photouploader.instagram.select.help\"\n                            ></span>\n                    </h4>\n\n                    <a\n                        class=\"b-photouploader-logout\"\n                        href=\"javascript:void(0);\"\n                        ng-click=\"photo.instagram.logout()\"\n                        lj-ml=\"photouploader.instagram.logout\"\n                        ></a>\n                </div>\n\n                <div\n                    class=\"\n                        b-photouploader-albums\n                        \"\n                    ng-class=\"{ \'b-photouploader-albums-loading\': photo.instagram.loading }\"\n                    >\n                    <div\n                        class=\"b-photouploader-albums-inner\"\n                        lj-when-scrolled=\"photo.instagram.loadMore()\"\n                        >\n                        <ul\n                            class=\"\n                                b-photouploader-pictures\n                                b-photouploader-pictures-withtitle\n                                b-photouploader-pictures-withmove\n                                \"\n                            ng-model=\"photo.instagram.media\"\n                            ui-sortable=\"photo.ui.sortableOptions\"\n                            >\n                            <li\n                                class=\"b-photouploader-pictures-item\"\n                                ng-repeat=\"media in photo.instagram.media\"\n                                ng-click=\"photo.instagram.select(media);\"\n                                ng-class=\"{ \'selected\': media.selected }\"\n                                >\n                                <span class=\"b-photouploader-pictures-pic\"><!--\n                                    --><img\n                                    ng-src=\"{{ media.images.thumbnail.url }}\"\n                                    class=\"b-photouploader-pictures-img\"\n                                    ><!--\n                                --></span>\n                                <strong\n                                    class=\"b-photouploader-pictures-title\"\n                                    title=\"{{ media.caption.text }}\"\n                                    ng-show=\"media.caption\"\n                                    ><!--\n                                    -->{{ media.caption.text }}<!--\n                                --></strong>\n                            </li>\n                        </ul><!-- /pictures -->\n                    </div>\n                </div><!-- /albums -->\n\n            </div><!-- /panel -->\n\n            <!-- controls -->\n            <div\n                class=\"\n                    b-photouploader-panel\n                    b-photouploader-panel-controls\n                    \"\n                ng-show=\"photo.instagram.token()\"\n                >\n                <div class=\"b-photouploader-instasettings\">\n                    <input\n                        type=\"checkbox\"\n                        id=\"webembeds\"\n                        class=\"b-photouploader-instasettings-check\"\n                        ng-model=\"photo.instagram.asEmbed\"\n                        />\n                    <label\n                        for=\"webembeds\"\n                        class=\"b-photouploader-instasettings-label\"\n                        ><!--\n                        --><span\n                        lj-ml=\"photouploader.instagram.asEmbeds\"\n                        ></span>\n                        <span\n                            class=\"b-photouploader-instasettings-annex\"\n                            lj-ml=\"photouploader.instagram.asEmbeds.help\"\n                            ></span><!--\n                    --></label>\n                </div>\n                <div class=\"b-photouploader-instasettings\">\n                    <input\n                        lj-disabled=\"photo.instagram.asEmbed\"\n                        type=\"checkbox\"\n                        id=\"webneedtitle\"\n                        class=\"b-photouploader-instasettings-check\"\n                        ng-model=\"photo.instagram.needTitle\"\n                        />\n                    <label\n                        for=\"webneedtitle\"\n                        class=\"b-photouploader-instasettings-label\"\n                        ><!--\n                        --><span\n                            lj-ml=\"photouploader.instagram.needTitle\"\n                            ></span>\n                        <span\n                            class=\"b-photouploader-instasettings-annex\"\n                            lj-ml=\"photouploader.instagram.needTitle.help\"\n                            ></span><!--\n                    --></label>\n                </div>\n                <div\n                    class=\"\n                        b-ljbutton\n                        b-ljbutton-submit\n                        \"\n                    >\n                    <button\n                        type=\"submit\"\n                        name=\"submit\"\n                        lj-disabled=\"photo.instagram.noneSelected()\"\n                        ng-click=\"photo.instagram.insert()\"\n                        lj-ml=\"photouploader.instagram.insert\"\n                        ></button>\n                </div>\n                <button\n                    type=\"submit\"\n                    name=\"submit\"\n                    class=\"\n                        b-flatbutton\n                        b-flatbutton-simple\n                        \"\n                    lj-disabled=\"photo.instagram.noneSelected()\"\n                    ng-click=\"photo.instagram.insert()\"\n                    lj-ml=\"photouploader.instagram.insert\"\n                    ></button>\n            </div><!-- /panel -->\n\n        </div><!-- /instagram item -->\n\n\n    </div>\n</div>\n';
//= require_ml photouploader.embed.title
//= require_ml photouploader.upload.title
//= require_ml photouploader.byUrl.title
//= require_ml photouploader.album.title
//= require_ml photouploader.album.select
//= require_ml photouploader.album.insert
//= require_ml fotki.album.edit.empty.photo.title
//= require_ml tour.photo_update_tour.tip
//= require_ml talk.photo
//= require_ml talk.photo.paste
//= require_ml talk.photo.insert
!function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){var a=LiveJournal.parseGetArgs().photo_id,b=LiveJournal.parseGetArgs().albums_id;return a?o(a):b?(s.requestAlbumId=+b,p(s.requestAlbumId)):void 0}function o(a){var b;b=a.split(",").map(function(a){return f.fetchRecordById({id:a})}),b.push(f.fetchAlbums()),c.all(b).then(function(a){a.splice(-1),s.albums.current=r(a.map(d("decodeRecord")))})}function p(a){LJ.Event.on("photo:albums:loaded",function(){var b=s.albums.list.find(function(b){return b.id===a});b.selected=!0,s.albums.current=b})}function q(){s.state.canUpload&&f.fetchAlbums({user:LJ.get("remote.username")}).then(function(){s.albums.list=f.getAlbums(),s.albums.current=s.albums.list[0],LJ.Event.trigger("photo:albums:loaded")})}function r(a){var b={id:"selected",name:LJ.ml("photouploader.album.scrapbookSelected"),photos:a.map(LJ.Function.set("selected",!0))};return s.albums.list.push(b),b}var s=this;s.state={canUpload:LJ.get("remote")&&!LJ.get("remote_is_identity"),insertInProgress:!1,uploadInProgress:!1,isOpen:!1},s.instagram=i,s.paste=j,s.albums=k,s.ui=l,s.hasAlbums=function(){return 0!==k.length},s.isPill=function(a){return e.group("uploadPhoto")===a},s.pill=function(a){a=a||LJ.Storage.getItem("photoUploadPill")||"paste",e.group("uploadPhoto",a),LJ.Storage.setItem("photoUploadPill",a)},a.$watch(function(){return s.state.isOpen},function(a){a===!0&&(h.init(),q())}),a.$watch(function(){return s.instagram.asEmbed},function(a){a&&(s.instagram.needTitle=!1)}),a.$watch(function(){return s.instagram.token()},s.instagram.loadMore),LJ.Event.on("instagram_token",function(a){b(function(){s.instagram.token(a)})}),a.$watch(function(){return s.ui&&s.ui.current},function(a,b){a&&a!==b&&LJ.Cookie.set("photo_size",a.size)}),a.$watch(function(){return s.albums.current},function(a){if(a&&a.id&&/\d/.test(a.id)){if(LJ.get("fotki.insert")&&a.id===s.requestAlbumId){if(!s.cachedRequestPhotos){var b=LJ.get("fotki.insert").map(function(a){return{id:a.photo_id,name:a.photo_title?a.photo_title:LJ.ml("fotki.album.edit.empty.photo.title"),description:a.photo_desc,thumbnail_url:a.photo_url,url:a.photo_orig,available_sizes:a.available_sizes,selected:!0}});s.cachedRequestPhotos=b.map(d("decodeRecord"))}s.albums.current.photos=s.cachedRequestPhotos}else f.fetchRecords(a.id,{offset:0,limit:20,user:LJ.get("remote.username")}).then(function(a){s.albums.current.photos=a.map(d("decodeRecord"))});LJ.Storage.setItem("photouploader_album_id",a.id)}}),a.$on("bubble:open:photouploader",function(){var a=LiveJournal.parseGetArgs().albums_id||LiveJournal.parseGetArgs().photo_id;s.state.isOpen=!0,LJ.get("fotki.insert")||a&&s.state.canUpload?(s.pill("album"),n()):(s.pill(s.state.canUpload?LJ.Storage.getItem("photouploader2_state")||"upload":"paste"),s.isPill("album")&&!s.hasAlbums()&&s.pill("upload"))}),a.$on("bubble:close:photouploader",function(){s.state.isOpen=!1}),LJ.Event.on("photo:upload:start",function(){s.state.uploadInProgress=!0}),LJ.Event.on("upload:photo:cancel",function(){s.state.uploadInProgress=!1}),LJ.Event.on("upload:photo:done",function(){m.close()})}angular.module("Photo.Editor",["LJ.AuthHelper","LJ.Pills","LJ.Api","LJ.Bubble","Photo.Service","Photo.Uploader","LJ.Photouploader","Editor"]).factory("DropboxPhoto",["$timeout","Editor","Bubble","Photouploader",function(a,b,c,d){var e={};return e.init=function(){window.Dropbox||LJ.injectScript("https://www.dropbox.com/static/api/2/dropins.js").done(function(){window.Dropbox&&(window.Dropbox.appKey=d.keys.dropbox),LJ.Event.trigger("dropbox_loaded",{linkType:"preview",multiselect:!0,extensions:["images"],success:function(d){a(function(){var a=d.map(function(a){return'<img src="{url}" alt="" title="">'.supplant({url:a.link.replace("www.dropbox.com","dl.dropboxusercontent.com")})});b.insertContent("photouploader",a.join("\n"),a),c.close(),LJ.Track.event("Photouploader","Dropbox","Success")})}})})},e}]).factory("InstagramPhoto",["$timeout","$q","Editor","Bubble","AuthHelper","Photouploader",function(a,b,c,d,e,f){var g={media:[]},h=null;return g.token=function(a){var b=LJ.get("remote.username"),c="instagram_token",d={domain:LJ.get("siteroot").replace(/^https?:\/\/www/,"")};return b&&(c="instagram_token_"+b),"undefined"==typeof a?h||LJ.Cookie.get(c):(h=a,void LJ.Cookie.set(c,a,d))},g.insert=function(){var a,e,f=g.media.filter(LJ.Function.get("selected"));g.asEmbed?(e=f.map(function(a){return LJ.Media.parse(a.link).then(LJ.Function.get("embed"))}),b.all(e).then(function(a){c.insertContent("video",a.join("\n"),a)})):(a=f.map(function(a){var b=LJ.String.encodeHTML(a.caption&&a.caption.text||"");return'<div>{title}<img src="{url}" alt="{caption}" title="{caption}"></div>'.supplant({url:a.images.standard_resolution.url,caption:b,title:g.needTitle?"<p>"+b+"</p>":""})}),c.insertContent("photouploader",a.join("\n"),a),LJ.Track.event("Photouploader","Instagram","Insert")),g.media.forEach(LJ.Function.set("selected",!1)),d.close()},g.noneSelected=function(){return 0===g.media.filter(LJ.Function.get("selected")).length},g.select=function(a){a.selected=!a.selected},g.login=function(){e.open(["https://instagram.com/oauth/authorize/?client_id=",f.keys.instagram,"&amp;redirect_uri=","http://www.livejournal.com","/auth_helper.html&amp;response_type=token"].join("")).then(function(a){a&&LJ.Event.trigger("instagram_token",a)})},g.logout=function(){(new Image).src="https://instagram.com/accounts/logout/",g.token(null),g.allFetched=!1,g.media.length=0},g.loadMore=function(){if(g.token()&&!g.loading&&!g.allFetched){g.loading=!0;var b=["https://api.instagram.com","/v1/users/self/media/recent/?callback=?&access_token=",g.token()];if(g.media.length>0){var c=g.media[g.media.length-1].id;b.push("&max_id="+c)}jQuery.getJSON(b.join("")).then(function(b){a(function(){b.data&&0===b.data.length&&(g.allFetched=!0),Array.prototype.push.apply(g.media,b.data),g.loading=!1})})}},g}]).factory("PastePhoto",["Editor","Bubble","PhotoSize",function(a,b,c){var d={url:"",link:""};return d.insertUrl=function(){var e,f='<img src="{url}" alt="" {width}/>'.supplant({url:d.url,width:Number(c.current.size)?'width="'+c.current.size+'" ':""});e=d.link?'<a href="'+LJ.String.linkify(d.link)+'">'+f+"</a>":f,a.insertContent("photouploader",e,[e]),d.url="",d.link="",b.close(),LJ.Track.event("Photouploader","Paste","Insert")},d}]).factory("AlbumPhoto",["$q","Editor","PhotoSize","Photouploader","Bubble","Photo",function(a,b,c,d,e,f){var g=c.list,h={current:{photos:[]},list:f.getAlbums(),originalLink:!1};return h.noneSelected=function(){return h.list.length&&h.current.photos?0===h.current.photos.filter(LJ.Function.get("selected")).length:!0},h.insert=function(){var a,b;c.insertInProgress||(c.insertInProgress=!0,a=c.current.size,b=h.current.photos.filter(LJ.Function.get("selected")),LJ.Event.trigger("albumInsert",a,b))},h.loadMore=function(b){var c=h.current;return c.photos&&c.photos.length!==c.count&&"selected"!==c.id?f.fetchRecords(c.id,{offset:c.photos.length||0,limit:b||20,user:LJ.get("remote.username")}).then(function(a){Array.prototype.push.apply(c.photos,a)}):a.when(null)},h.togglePhoto=function(a){a.selected=!a.selected,c.list=c.intersect(h.current.photos.filter(LJ.Function.get("selected")).map(LJ.Function.get("available_sizes"))),-1===c.list.indexOf(c.current)&&(c.current=c.list.slice(-2)[0])},LJ.Event.on("albumInsert",function(a,d){var f=d.map(function(b){var c='<img src="{url}" alt="{description}" title="{name}">'.supplant({url:b.url.replace("original",a),name:(b.name||"").encodeHTML(),description:(b.description||b.name).encodeHTML()});return h.originalLink?'<a target="_blank" href="'+b.url+'">'+c+"</a>":c});b.insertContent("photouploader",f.join("\n"),f),c.insertInProgress=!1,c.list=g,h.current.photos.forEach(LJ.Function.set("selected",!1)),e.close(),LJ.Track.event("Photouploader","Albums","Insert")}),h}]).controller("PhotoEditorCtrl",["$scope","$timeout","$q","$filter","Pills","Photo","Photouploader","DropboxPhoto","InstagramPhoto","PastePhoto","AlbumPhoto","PhotoSize","Bubble",a]).directive("ljDropboxButton",function(){return function(a,b){LJ.Event.on("dropbox_loaded",function(a){b[0].appendChild(window.Dropbox.createChooseButton(a))})}})}();;

/* file-end: js/photo/editor.js 
----------------------------------------------------------------------------------*/

!function(a){"use strict";angular.module("BasicToolbar",["LJ.Api","LJ.Autocomplete","LJ.Bubble","LJ.Photouploader","Photo.Editor","Video.Editor","Editor","Users"]).controller("MediaCtrl",["$scope","Editor",function(b,c){b.media="",b.setHint=function(a){var c=a.target,d=c.getAttribute("href");d&&(b.media=d),a.preventDefault()},b.getMedia=function(b){var c=LJ.Media.parse(b,{thumbnail:!1}),d=a.Deferred();return c?c.then(function(a){a&&a.embed&&(d.resolve(a),LJ.Track.event("Editor","Embed",a.site))}):/^<(embed|iframe|object).*>$/.test(b)?(d.resolve({embed:["<lj-embed>",b,"</lj-embed>"].join("\n")}),LJ.Track.event("Editor","Embed","lj-embed")):(d.resolve({embed:'<a href="{link}">{caret}{link}{caret}</a>'.supplant({link:b})}),LJ.Track.event("Editor","Embed","link (not parsed)")),d},b.insert=function(){a.when(b.getMedia(b.media)).done(function(a){c.insertContent("video",a.embed,b.media),b.media=""}),b.bubble.close()}}]).controller("LinkCtrl",["$scope","Editor",function(a,b){a.newWindow="undefined"!=typeof LJ.Storage.getItem("newWindow")?LJ.Storage.getItem("newWindow"):!0,a.unlink=function(){LJ.Event.trigger("unlink"),a.bubble.close()},a.saveOption=function(){LJ.Storage.setItem("newWindow",a.newWindow)},a.$on("bubble:open:link",function(){a.link=a.bubble.options.defaultText||"",a.showUnlink=!(!a.bubble.options.rangeNotCollapsed&&!a.bubble.options.editMode),"undefined"!=typeof a.bubble.options.hasTarget?a.newWindow=a.bubble.options.hasTarget:"undefined"!=typeof LJ.Storage.getItem("newWindow")&&(a.newWindow=LJ.Storage.getItem("newWindow"))}),a.insertOrSave=function(c){c.preventDefault(),b.insertContent("link",'<a href="{text}"{target}>{caret}{text}{caret}</a>'.supplant({text:LJ.String.linkify(a.link),target:a.newWindow?' target="_blank"':""}),{url:a.link,target:a.newWindow?"_blank":""}),a.link="",a.bubble.close()}}]).controller("UserCtrl",["$scope","Editor","Api","Users",function(a,b,c,d){a.friends=null,a.$on("bubble:open:user",function(){a.user=a.bubble.options.user||"",LJ.get("remote")&&!a.friends&&d.fetchFriends().then(function(b){a.friends=b.map(LJ.Function.get("username"))}),a.title="undefined"===a.bubble.options.title?"":a.bubble.options.title||"",a.error=!1}),a.$watch("user",function(){a.error=!1}),a.insertOrSave=function(){a.user&&c.call("ljuser.get",{user:a.user,raw:!0},function(c){c.error?a.error=!0:(b.insertContent("user",'<lj user="{caret}{text}{caret}" />'.supplant({text:a.user}),c,a.title),a.user="",a.title="",a.bubble.close())})}}])}(jQuery);;

/* file-end: js/editor/basicToolbar.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/discovery/directives.js 
*/


Site.page.template['angular/ljImage.ng.tmpl'] = '<a ng-href=\"{{link}}\">\n    <figure class=\"b-journalpicture\">\n        <img\n            class=\"b-journalpicture-image\"\n            title=\"{{textContent}}\"\n            alt=\"{{textContent}}\"\n            ng-src=\"{{source}}\"\n            ng-style=\"dimensions\"\n            >\n        <figcaption class=\"b-journalpicture-caption\" lj-html=\"content\"></figcaption>\n    </figure>\n</a>\n';
Site.page.template['angular/ljGallery.ng.tmpl'] = '<div\n    class=\"b-journalgallery\"\n    ng-style=\"dimensions\"\n    ng-class=\"{\n        \'b-journalgallery-hightpriority\': isTall\n    }\"\n    >\n    <div\n        class=\"b-journalgallery-container\"\n        ng-style=\"dimensions\"\n        >\n        <figure\n            class=\"b-journalgallery-picture\"\n            ng-repeat=\"item in items\"\n            ng-style=\"dimensions\"\n            ng-if=\"isNearby($index)\"\n            ng-class=\"{\n                \'b-journalgallery-picture-prev\': $index < state.index,\n                \'b-journalgallery-picture-current\': $index === state.index,\n                \'b-journalgallery-picture-next\': $index > state.index\n            }\"\n            >\n            <span\n                class=\"\n                    b-journalgallery-preloader\n                    svgpreloader\n                    svgpreloader-tag\n                    svgpreloader-16\n                    \"\n                    ></span>\n            <div class=\"b-journalgallery-wrapper\">\n                <img\n                    ng-src=\"{{item.src}}\"\n                    class=\"b-journalgallery-image\"\n                    lj-gallery-load\n                    >\n            </div>\n            <figcaption class=\"b-journalgallery-caption\">\n                <span\n                    class=\"b-journalgallery-caption-title\"\n                    lj-html=\"item.content\"></span>\n            </figcaption>\n        </figure>\n    </div>\n    <span\n        class=\"b-journalgallery-counter\"\n        ng-bind=\"(state.index + 1) + \'/\' + (state.total+1)\"\n        ></span>\n    <span\n        class=\"b-journalgallery-nav b-journalgallery-nav-prev\"\n        ng-show=\"state.index !== 0\"\n        ng-click=\"prev()\"\n        ></span>\n    <span\n        class=\"b-journalgallery-nav b-journalgallery-nav-next\"\n        ng-show=\"state.index < state.total\"\n        ng-click=\"next()\"\n        ></span>\n</div>\n';
Site.page.template['angular/discovery/ljSuggest.ng.tmpl'] = '<div\n    class=\"b-mainpage-seealso\"\n    ng-if=\"suggest\"\n    >\n\n    <!-- head -->\n    <h3\n        class=\"b-mainpage-seealso-head\"\n        lj-ml=\"discovery.article.seealso\"\n        ></h3>\n\n    <!-- items -->\n    <ul class=\"b-mainpage-seealso-items\">\n        <li\n            class=\"b-mainpage-seealso-item\"\n            ng-repeat=\"suggested in suggest\"\n            >\n            <a\n                ng-href=\"{{suggested.url}}\"\n                class=\"b-mainpage-seealso-link\"\n                data-track-event=\"LJMag:Post:OpenSeeAlso\"\n                >\n                <span\n                    class=\"b-mainpage-seealso-pic\"\n                    ng-if=\"suggested.image\"\n                    ng-style=\"{ backgroundImage: \'url({{suggested.image}})\' }\"\n                    ></span>\n                <span\n                    class=\"b-mainpage-seealso-title\"\n                    lj-html=\"suggested.subject\"\n                    ></span>\n            </a>\n            <span class=\"b-mainpage-seealso-user\" ng-if=\"suggested.user\">\n                <span\n                    lj-user-dynamic=\"suggested.user.username\"\n                    lj-user-dynamic-options=\"{target: \'_blank\'}\"\n                    ></span>\n            </span>\n        </li>\n    </ul><!-- /items -->\n\n</div>\n';
Site.page.template['angular/widgets/authors/posts.ng.tmpl'] = '<!-- author\'s posts -->\n\n<div\n    class=\"\n        b-authorsposts\n        l-flatslide-aside-block\n        \"\n    ng-class=\"{\n        \'b-authorsposts-loading\': state.isLoading,\n        \'b-authorsposts-empty\': !posts.length\n    }\"\n    >\n\n    <!-- head -->\n    <header class=\"b-authorsposts-head\">\n        <h3\n            class=\"b-authorsposts-title\"\n            lj-ml=\"main.authorsposts.head\"\n            >\n        </h3>\n    </header>\n\n    <!-- body -->\n    <div class=\"b-authorsposts-body\">\n\n        <!-- items -->\n        <ul class=\"b-authorsposts-items\">\n\n            <!-- item -->\n            <li class=\"b-authorsposts-item\"\n                ng-repeat=\"post in posts\">\n\n                <!-- link -->\n                <a\n                    class=\"b-authorsposts-link\"\n                    data-track-event=\"LJMag:Post:OpenAnotherPostByAuthor:{{post.user.username}}\"\n                    ng-href=\"{{ post.url }}\"\n                    >\n                    <!-- pic -->\n                    <span\n                        class=\"b-authorsposts-pic\"\n                        style=\"background-image: url({{post.image}});\"\n                        ng-if=\"post.image\"\n                        ></span>\n                    <!-- subject -->\n                    <span\n                        class=\"b-authorsposts-subject\"\n                        lj-html=\"post.subject\"\n                        ></span>\n                </a>\n\n            </li>\n\n        </ul>\n\n        <!-- dummy loader -->\n        <div class=\"b-authorsposts-dummy\">\n            <div class=\"b-authorsposts-dummy-item\">\n                <span class=\"b-authorsposts-dummy-pic\"></span>\n                <div class=\"b-authorsposts-dummy-caption\">\n                    <span class=\"b-authorsposts-dummy-subject\"></span>\n                </div>\n            </div>\n            <div class=\"b-authorsposts-dummy-item\">\n                <span class=\"b-authorsposts-dummy-pic\"></span>\n                <div class=\"b-authorsposts-dummy-caption\">\n                    <span class=\"b-authorsposts-dummy-subject\"></span>\n                </div>\n            </div>\n            <div class=\"b-authorsposts-dummy-item\">\n                <span class=\"b-authorsposts-dummy-pic\"></span>\n                <div class=\"b-authorsposts-dummy-caption\">\n                    <span class=\"b-authorsposts-dummy-subject\"></span>\n                </div>\n            </div>\n        </div>\n\n    </div><!-- /body -->\n\n</div><!-- /authorsposts -->\n\n\n';
LJ.injectStyle('.b-journalgallery{overflow:hidden;display:block;position:relative;width:100%;margin:0 auto;padding:0 0 70px;font:.8125rem/1.1 ProximaNovaSemibold,Tahoma,Arial,sans-serif}.b-journalgallery-container{position:relative;background:#FFF}.b-journalgallery-picture{position:absolute;width:100%;margin:0;-webkit-transition:500ms cubic-bezier(.25,.25,.75,.75) all;-moz-transition:500ms cubic-bezier(.25,.25,.75,.75) all;-ms-transition:500ms cubic-bezier(.25,.25,.75,.75) all;-o-transition:500ms cubic-bezier(.25,.25,.75,.75) all;transition:500ms cubic-bezier(.25,.25,.75,.75) all;text-align:center}.b-journalgallery-picture::after{content:\'\';display:inline-block;height:100%;margin:0 0 0 -.05em;vertical-align:middle}.b-journalgallery-preloader.svgpreloader{position:absolute;top:50%;left:50%;margin:-8px 0 0 -8px}.b-journalgallery-wrapper{display:inline-block;vertical-align:middle;max-width:99%;max-width:calc(100% - .3em)}.b-journalgallery-hightpriority .b-journalgallery-wrapper{display:inline}.b-journalgallery-image{position:relative;max-width:100%;margin:0;vertical-align:top;opacity:1;-webkit-transition:500ms cubic-bezier(.25,.25,.75,.75) all;-moz-transition:500ms cubic-bezier(.25,.25,.75,.75) all;-ms-transition:500ms cubic-bezier(.25,.25,.75,.75) all;-o-transition:500ms cubic-bezier(.25,.25,.75,.75) all;transition:500ms cubic-bezier(.25,.25,.75,.75) all}.b-journalgallery-hightpriority .b-journalgallery-image{max-height:100%}.b-journalgallery-caption{position:absolute;top:100%;left:0;right:0;height:70px;margin:0;padding:0;border:0;text-align:center;background:#FFF;color:#829399}.b-journalgallery-caption-title{overflow:hidden;position:absolute;top:0;right:40px;left:40px;height:2.2em;margin:0;padding:10px 2px 0}.b-journalgallery-picture-loaded{background-image:none}.b-journalgallery-picture-loaded .b-journalgallery-image{opacity:1}.b-journalgallery-picture-prev{-webkit-transform:translate3d(-100%,0,0);-moz-transform:translate3d(-100%,0,0);-ms-transform:translate3d(-100%,0,0);-o-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0);opacity:0}.b-journalgallery-picture-next{-webkit-transform:translate3d(100%,0,0);-moz-transform:translate3d(100%,0,0);-ms-transform:translate3d(100%,0,0);-o-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0);opacity:0}.b-journalgallery-picture-current{-webkit-transform:translate3d(0,0,0);-moz-transform:translate3d(0,0,0);-ms-transform:translate3d(0,0,0);-o-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}.b-journalgallery-counter{position:absolute;bottom:44px;right:0;margin:0;padding:2px;border:0;text-align:right;color:#829399}.b-journalgallery-nav{position:absolute;top:0;bottom:70px;margin:0;padding:0;border:0;cursor:pointer;font:0/0 a}.b-journalgallery-nav:before{content:\" \";position:absolute;top:50%;width:50px;height:50px;margin:-25px 0 0;padding:0;border:0;border-radius:3px;background:#839399}.b-journalgallery-nav:hover:before{background:#09C}.b-discoveryarticle .b-journalgallery-nav:hover:before{background:#39BF71}.b-journalgallery-nav:after{content:\" \";position:absolute;top:50%;width:9px;height:16px;margin:-8px 0 0;padding:0;background:url(/img/icons/journalgallery.png?v=39648) no-repeat}.b-journalgallery-nav-prev{left:0;width:30%}.b-journalgallery-nav-prev::before{left:20px}.b-journalgallery-nav-prev::after{left:40px}.b-journalgallery-nav-next{right:0;width:70%}.b-journalgallery-nav-next::before{right:20px}.b-journalgallery-nav-next::after{right:40px;background-position:0 -17px}@media all and (max-width:1100px){.b-journalgallery,.b-journalgallery-container,.b-journalgallery-picture{max-height:450px}}@media all and (max-width:1000px){.b-journalgallery,.b-journalgallery-container,.b-journalgallery-picture{max-height:400px}}@media all and (max-width:650px){.b-journalgallery,.b-journalgallery-container,.b-journalgallery-picture{max-height:300px}}@media all and (max-width:480px){.b-journalgallery,.b-journalgallery-container,.b-journalgallery-picture{max-height:200px}.b-journalgallery-nav-prev::before{left:0}.b-journalgallery-nav-prev::after{left:20px}.b-journalgallery-nav-next::before{right:0}.b-journalgallery-nav-next::after{right:20px}}');
angular.module("Discovery.Tags",["LJ.Templates","LJ.Api"]).directive("ljDiscoveryTags",["$compile",function(a){var b=["lj-gallery","[lj-memories]","[lj-lazy]","[lj-share]","[lj-cut]","[lj-screenable]","[lj-remove-repost]"];return{restrict:"A",terminal:!0,link:function(c,d){a(d.find(b.join(",")))(c)}}}]).directive("ljGallery",["$templateCache","$compile",function(a,b){return{restrict:"E",scope:!0,link:function(c,d,e){c.dimensions={maxWidth:e.width+"px",height:e.height||350},c.items=d.find("lj-gallery-item").map(function(){var a=angular.element(this).find("img"),b=angular.element(this).find("a"),c=angular.element(this).find("lj-gallery-item-capture");return{content:c.html(),src:a.attr("src"),href:b.attr("href")}}).toArray(),c.isTall="undefined"!=typeof e.tall,c.next=function(){c.state.index+=1},c.prev=function(){c.state.index-=1},c.state={index:0,total:c.items.length-1},c.isNearby=function(a){return Math.abs(c.state.index-a)<=1},d.html(b(a.get("ljGallery.ng.tmpl"))(c))}}}]).directive("ljSuggest",["Api",function(a){return{templateUrl:"ljSuggest.ng.tmpl",scope:{itemId:"@ljSuggest"},link:function(b){a.call("discovery.suggest",{itemid:b.itemId},{cache:!0}).then(function(a){b.suggest=a.items})}}}]).directive("ljWidgetAuthorsPosts",["Api",function(a){return{templateUrl:"posts.ng.tmpl",scope:{userId:"@ljWidgetAuthorsPosts",itemId:"@ljWidgetAuthorsPostsExclude"},link:function(b){b.state={isLoading:!0},a.call("discovery.author_posts",{itemid:b.itemId,userid:b.userId},{cache:!0}).then(function(a){b.state.isLoading=!1,b.posts=a.items})}}}]);;

/* file-end: js/discovery/directives.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/ljMemories.js 
*/



Site.page.template['angular/memories.ng.tmpl'] = '<div ng-controller=\"MemoriesCtrl\">\n\n    <div\n        class=\"b-addtomemories\"\n        ng-class=\"{ \'b-addtomemories-loading\': loading }\"\n        >\n\n        <!-- head -->\n        <h3\n            class=\"b-addtomemories-head\"\n            lj-ml=\"memories.title\"\n            ></h3>\n\n        <!-- intro -->\n        <p class=\"b-addtomemories-intro\">\n            <span\n                ng-show=\"!security\"\n                lj-ml=\"memories.title.add\"\n                ></span>\n            <span\n                ng-show=\"security\"\n                lj-ml=\"memories.title.edit\"\n                ></span>\n        </p>\n\n        <!-- items -->\n        <ul class=\"b-addtomemories-items\">\n\n            <li class=\"b-addtomemories-item\">\n                <label class=\"b-addtomemories-label\">\n                    <input\n                        type=\"radio\"\n                        name=\"security\"\n                        class=\"b-addtomemories-radio\"\n                        value=\"public\"\n                        ng-model=\"security\"\n                        ng-change=\"update()\"\n                        >\n                    <span\n                        class=\"b-addtomemories-title\"\n                        lj-ml=\"memories.security.public\"\n                        ></span>\n                </label>\n            </li>\n\n            <li class=\"b-addtomemories-item\">\n                <label class=\"b-addtomemories-label\">\n                    <input\n                        type=\"radio\"\n                        name=\"security\"\n                        class=\"b-addtomemories-radio\"\n                        value=\"friends\"\n                        ng-model=\"security\"\n                        ng-change=\"update()\"\n                        >\n                    <span\n                        class=\"b-addtomemories-title\"\n                        lj-ml=\"memories.security.friends\"\n                        ></span>\n                </label>\n            </li>\n\n            <li class=\"b-addtomemories-item\">\n                <label class=\"b-addtomemories-label\">\n                    <input\n                        type=\"radio\"\n                        name=\"security\"\n                        class=\"b-addtomemories-radio\"\n                        value=\"private\"\n                        ng-model=\"security\"\n                        ng-change=\"update()\"\n                        >\n                    <span\n                        class=\"b-addtomemories-title\"\n                        lj-ml=\"memories.security.private\"\n                        ></span>\n                </label>\n            </li>\n\n        </ul><!-- /items -->\n\n        <!-- footer -->\n        <div\n            class=\"b-addtomemories-footer\"\n            ng-show=\"removeButton\"\n            >\n            \n            <lj-flatbutton lj-flatbutton=\"[\'button\', \'memories.remove\', \'b-flatbutton b-flatbutton-simple b-flatbutton-red\', \'ng-click\', \'remove()\']\"></lj-flatbutton>\n        </div><!-- /footer -->\n\n        <p class=\"b-addtomemories-options\">\n            <a\n                ng-href=\"{{siteroot}}/tools/memadd.bml?journal={{bubble.options.journal}}&amp;itemid={{bubble.options.ditemid}}\"\n                target=\"_blank\"\n                lj-ml=\"memories.options\"\n                ></a>\n        </p>\n\n    </div><!-- /addtomemories -->\n\n</div>\n';
LJ.injectStyle('.b-addtomemories{width:150px;margin:0;padding:0;text-align:left}.b-addtomemories-head{margin:0 0 .5em;padding:0;font:700 1.13em/1.1 Arial,sans-serif;color:#000}.b-addtomemories-intro{margin:0 0 .3em}.b-addtomemories-items{margin:0;padding:0;list-style:none}.b-addtomemories-item{margin:0;padding:0}.b-addtomemories-label{display:block;margin:0 -5px;padding:5px;cursor:pointer}.b-addtomemories-item:hover .b-addtomemories-label{background:#C8E6FF}.b-addtomemories-footer{margin:1em 0}.b-addtomemories-options{margin:.3em -5px 0;padding:.3em 5px 0;border-top:1px solid #DAE3E6}.b-addtomemories-loading{background:url(/img/preloader/preloader-blue-gray.gif?v=16423) 50% 50% no-repeat}.b-addtomemories-loading .b-addtomemories-footer,.b-addtomemories-loading .b-addtomemories-head,.b-addtomemories-loading .b-addtomemories-intro,.b-addtomemories-loading .b-addtomemories-items,.b-addtomemories-loading .b-addtomemories-options{visibility:hidden}');
!function(a){angular.module("LJ.Memories",["LJ.Bubble","LJ.Api"]).directive("ljMemories",["$parse","$timeout","Bubble",function(b,c,d){return{scope:{ljMemories:"&"},link:function(b,c){function e(e){e.preventDefault(),f||(f="function"==typeof b.ljMemories?b.ljMemories({element:c}):b.ljMemories),d.open("memories",f,a(c)),b.$apply()}var f;c.on("click",e),b.$on("$destroy",function(){c.off("click",e)})}}}]).controller("MemoriesCtrl",["$scope","Api",function(b,c){var d=b.bubble;b.security=null,b.$watch("removeButton",function(){a(window).trigger("resize")}),b.$on("bubble:open:memories",function(){c.call("memories.get",d.options,function(a){b.security=a.result?a.result.security:null,b.removeButton=Boolean(b.security)})}),b.$on("bubble:close:memories",function(){b.removeButton=!1}),b.siteroot=LJ.get("siteroot"),b.update=function(){c.call("memories.set",{journal:d.options.journal,ditemid:d.options.ditemid,description:d.options.journal+": "+d.options.title.decodeHTML(),security:b.security},function(a){b.security=a,d.close(),b.removeButton=!0})},b.remove=function(){c.call("memories.remove",{journal:d.options.journal,ditemid:d.options.ditemid},function(){b.security=null,d.close(),b.removeButton=!1})},LJ.Event.on("api:request:change",function(a,c){/^memories/.test(a)&&(b.loading=c)})}])}(jQuery);;

/* file-end: js/core/angular/ljMemories.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/share.js 
*/



Site.page.template['angular/share.ng.tmpl'] = '<p\n    class=\"b-sharethis-head\"\n    lj-ml=\"sharing.popup.title\"\n    ></p>\n\n<ul\n    ng-controller=\"ShareBubbleCtrl as share\"\n    class=\"\n        b-sharethis-services\n        b-sharethis-services-{{ share.version }}\n        \"\n    >\n    <li\n        ng-repeat=\"service in share.services\"\n        class=\"\n            b-sharethis-services-item\n            b-sharethis-{{ service.name }}\n            \"\n        >\n        <a\n            target=\"_blank\"\n            class=\"b-sharethis-services-link\"\n            ng-click=\"share.openPopup($event, service.name, bubble.options.params);\"\n            ng-href=\"{{ service.link }}\"\n            ng-bind=\"service.title\"\n            ></a>\n    </li>\n</ul>\n';
//= require_ml sharing.popup.title
!function(){"use strict";angular.module("LJ.Share",["LJ.Directives","LJ.Templates","LJ.Bubble"]).config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|viber):/)}]).directive("ljShare",["Bubble",function(a){return{restrict:"A",scope:!0,link:function(b,c,d){function e(){a.open("share",{params:f,services:g},c),b.$evalAsync()}var f=b.$eval(d.ljShare),g=b.$eval(d.ljShareServices),h=b.$eval(d.ljShareServicesExclude);if(g=g?LJ.String.smartSplit(g):LJ.Social.Share.services(),h=h?LJ.String.smartSplit(h):[],h.length&&(g=g.filter(function(a){return-1===h.indexOf(a)})),g.length){var i=a.register({name:"share",template:"share.ng.tmpl",recalculateOnScroll:d.hasOwnProperty("ljShareScrollable")});c.on("click",e),b.$on("$destroy",function(){c.off("click",e),i()})}}}}]).controller("ShareBubbleCtrl",["$scope","Bubble",function(a,b){var c=this;a.$on("bubble:open:share",function(){c.version=LJ.Flags.isEnabled("adaptive_lj_mobile")?"v4":"v3",c.services=a.bubble.options.services.map(function(b){return{name:b,link:LJ.Social.Share.getUrl(b,a.bubble.options.params),title:LJ.Social.Share.getTitle(b)}})}),c.openPopup=function(a,c,d){return LJ.Social.Share.isTab(c)?void b.close("share"):(a.preventDefault(),LJ.Social.Share.openPopup(c,d),void b.close("share"))}}])}();;

/* file-end: js/core/angular/share.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/lib/jquery.qrcode.min.js 
*/

(function(r){r.fn.qrcode=function(h){var s;function u(a){this.mode=s;this.data=a}function o(a,c){this.typeNumber=a;this.errorCorrectLevel=c;this.modules=null;this.moduleCount=0;this.dataCache=null;this.dataList=[]}function q(a,c){if(void 0==a.length)throw Error(a.length+"/"+c);for(var d=0;d<a.length&&0==a[d];)d++;this.num=Array(a.length-d+c);for(var b=0;b<a.length-d;b++)this.num[b]=a[b+d]}function p(a,c){this.totalCount=a;this.dataCount=c}function t(){this.buffer=[];this.length=0}u.prototype={getLength:function(){return this.data.length},
write:function(a){for(var c=0;c<this.data.length;c++)a.put(this.data.charCodeAt(c),8)}};o.prototype={addData:function(a){this.dataList.push(new u(a));this.dataCache=null},isDark:function(a,c){if(0>a||this.moduleCount<=a||0>c||this.moduleCount<=c)throw Error(a+","+c);return this.modules[a][c]},getModuleCount:function(){return this.moduleCount},make:function(){if(1>this.typeNumber){for(var a=1,a=1;40>a;a++){for(var c=p.getRSBlocks(a,this.errorCorrectLevel),d=new t,b=0,e=0;e<c.length;e++)b+=c[e].dataCount;
for(e=0;e<this.dataList.length;e++)c=this.dataList[e],d.put(c.mode,4),d.put(c.getLength(),j.getLengthInBits(c.mode,a)),c.write(d);if(d.getLengthInBits()<=8*b)break}this.typeNumber=a}this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(a,c){this.moduleCount=4*this.typeNumber+17;this.modules=Array(this.moduleCount);for(var d=0;d<this.moduleCount;d++){this.modules[d]=Array(this.moduleCount);for(var b=0;b<this.moduleCount;b++)this.modules[d][b]=null}this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-
7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(a,c);7<=this.typeNumber&&this.setupTypeNumber(a);null==this.dataCache&&(this.dataCache=o.createData(this.typeNumber,this.errorCorrectLevel,this.dataList));this.mapData(this.dataCache,c)},setupPositionProbePattern:function(a,c){for(var d=-1;7>=d;d++)if(!(-1>=a+d||this.moduleCount<=a+d))for(var b=-1;7>=b;b++)-1>=c+b||this.moduleCount<=c+b||(this.modules[a+d][c+b]=
0<=d&&6>=d&&(0==b||6==b)||0<=b&&6>=b&&(0==d||6==d)||2<=d&&4>=d&&2<=b&&4>=b?!0:!1)},getBestMaskPattern:function(){for(var a=0,c=0,d=0;8>d;d++){this.makeImpl(!0,d);var b=j.getLostPoint(this);if(0==d||a>b)a=b,c=d}return c},createMovieClip:function(a,c,d){a=a.createEmptyMovieClip(c,d);this.make();for(c=0;c<this.modules.length;c++)for(var d=1*c,b=0;b<this.modules[c].length;b++){var e=1*b;this.modules[c][b]&&(a.beginFill(0,100),a.moveTo(e,d),a.lineTo(e+1,d),a.lineTo(e+1,d+1),a.lineTo(e,d+1),a.endFill())}return a},
setupTimingPattern:function(){for(var a=8;a<this.moduleCount-8;a++)null==this.modules[a][6]&&(this.modules[a][6]=0==a%2);for(a=8;a<this.moduleCount-8;a++)null==this.modules[6][a]&&(this.modules[6][a]=0==a%2)},setupPositionAdjustPattern:function(){for(var a=j.getPatternPosition(this.typeNumber),c=0;c<a.length;c++)for(var d=0;d<a.length;d++){var b=a[c],e=a[d];if(null==this.modules[b][e])for(var f=-2;2>=f;f++)for(var i=-2;2>=i;i++)this.modules[b+f][e+i]=-2==f||2==f||-2==i||2==i||0==f&&0==i?!0:!1}},setupTypeNumber:function(a){for(var c=
j.getBCHTypeNumber(this.typeNumber),d=0;18>d;d++){var b=!a&&1==(c>>d&1);this.modules[Math.floor(d/3)][d%3+this.moduleCount-8-3]=b}for(d=0;18>d;d++)b=!a&&1==(c>>d&1),this.modules[d%3+this.moduleCount-8-3][Math.floor(d/3)]=b},setupTypeInfo:function(a,c){for(var d=j.getBCHTypeInfo(this.errorCorrectLevel<<3|c),b=0;15>b;b++){var e=!a&&1==(d>>b&1);6>b?this.modules[b][8]=e:8>b?this.modules[b+1][8]=e:this.modules[this.moduleCount-15+b][8]=e}for(b=0;15>b;b++)e=!a&&1==(d>>b&1),8>b?this.modules[8][this.moduleCount-
b-1]=e:9>b?this.modules[8][15-b-1+1]=e:this.modules[8][15-b-1]=e;this.modules[this.moduleCount-8][8]=!a},mapData:function(a,c){for(var d=-1,b=this.moduleCount-1,e=7,f=0,i=this.moduleCount-1;0<i;i-=2)for(6==i&&i--;;){for(var g=0;2>g;g++)if(null==this.modules[b][i-g]){var n=!1;f<a.length&&(n=1==(a[f]>>>e&1));j.getMask(c,b,i-g)&&(n=!n);this.modules[b][i-g]=n;e--; -1==e&&(f++,e=7)}b+=d;if(0>b||this.moduleCount<=b){b-=d;d=-d;break}}}};o.PAD0=236;o.PAD1=17;o.createData=function(a,c,d){for(var c=p.getRSBlocks(a,
c),b=new t,e=0;e<d.length;e++){var f=d[e];b.put(f.mode,4);b.put(f.getLength(),j.getLengthInBits(f.mode,a));f.write(b)}for(e=a=0;e<c.length;e++)a+=c[e].dataCount;if(b.getLengthInBits()>8*a)throw Error("code length overflow. ("+b.getLengthInBits()+">"+8*a+")");for(b.getLengthInBits()+4<=8*a&&b.put(0,4);0!=b.getLengthInBits()%8;)b.putBit(!1);for(;!(b.getLengthInBits()>=8*a);){b.put(o.PAD0,8);if(b.getLengthInBits()>=8*a)break;b.put(o.PAD1,8)}return o.createBytes(b,c)};o.createBytes=function(a,c){for(var d=
0,b=0,e=0,f=Array(c.length),i=Array(c.length),g=0;g<c.length;g++){var n=c[g].dataCount,h=c[g].totalCount-n,b=Math.max(b,n),e=Math.max(e,h);f[g]=Array(n);for(var k=0;k<f[g].length;k++)f[g][k]=255&a.buffer[k+d];d+=n;k=j.getErrorCorrectPolynomial(h);n=(new q(f[g],k.getLength()-1)).mod(k);i[g]=Array(k.getLength()-1);for(k=0;k<i[g].length;k++)h=k+n.getLength()-i[g].length,i[g][k]=0<=h?n.get(h):0}for(k=g=0;k<c.length;k++)g+=c[k].totalCount;d=Array(g);for(k=n=0;k<b;k++)for(g=0;g<c.length;g++)k<f[g].length&&
(d[n++]=f[g][k]);for(k=0;k<e;k++)for(g=0;g<c.length;g++)k<i[g].length&&(d[n++]=i[g][k]);return d};s=4;for(var j={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,
78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(a){for(var c=a<<10;0<=j.getBCHDigit(c)-j.getBCHDigit(j.G15);)c^=j.G15<<j.getBCHDigit(c)-j.getBCHDigit(j.G15);return(a<<10|c)^j.G15_MASK},getBCHTypeNumber:function(a){for(var c=a<<12;0<=j.getBCHDigit(c)-
j.getBCHDigit(j.G18);)c^=j.G18<<j.getBCHDigit(c)-j.getBCHDigit(j.G18);return a<<12|c},getBCHDigit:function(a){for(var c=0;0!=a;)c++,a>>>=1;return c},getPatternPosition:function(a){return j.PATTERN_POSITION_TABLE[a-1]},getMask:function(a,c,d){switch(a){case 0:return 0==(c+d)%2;case 1:return 0==c%2;case 2:return 0==d%3;case 3:return 0==(c+d)%3;case 4:return 0==(Math.floor(c/2)+Math.floor(d/3))%2;case 5:return 0==c*d%2+c*d%3;case 6:return 0==(c*d%2+c*d%3)%2;case 7:return 0==(c*d%3+(c+d)%2)%2;default:throw Error("bad maskPattern:"+
a);}},getErrorCorrectPolynomial:function(a){for(var c=new q([1],0),d=0;d<a;d++)c=c.multiply(new q([1,l.gexp(d)],0));return c},getLengthInBits:function(a,c){if(1<=c&&10>c)switch(a){case 1:return 10;case 2:return 9;case s:return 8;case 8:return 8;default:throw Error("mode:"+a);}else if(27>c)switch(a){case 1:return 12;case 2:return 11;case s:return 16;case 8:return 10;default:throw Error("mode:"+a);}else if(41>c)switch(a){case 1:return 14;case 2:return 13;case s:return 16;case 8:return 12;default:throw Error("mode:"+
a);}else throw Error("type:"+c);},getLostPoint:function(a){for(var c=a.getModuleCount(),d=0,b=0;b<c;b++)for(var e=0;e<c;e++){for(var f=0,i=a.isDark(b,e),g=-1;1>=g;g++)if(!(0>b+g||c<=b+g))for(var h=-1;1>=h;h++)0>e+h||c<=e+h||0==g&&0==h||i==a.isDark(b+g,e+h)&&f++;5<f&&(d+=3+f-5)}for(b=0;b<c-1;b++)for(e=0;e<c-1;e++)if(f=0,a.isDark(b,e)&&f++,a.isDark(b+1,e)&&f++,a.isDark(b,e+1)&&f++,a.isDark(b+1,e+1)&&f++,0==f||4==f)d+=3;for(b=0;b<c;b++)for(e=0;e<c-6;e++)a.isDark(b,e)&&!a.isDark(b,e+1)&&a.isDark(b,e+
2)&&a.isDark(b,e+3)&&a.isDark(b,e+4)&&!a.isDark(b,e+5)&&a.isDark(b,e+6)&&(d+=40);for(e=0;e<c;e++)for(b=0;b<c-6;b++)a.isDark(b,e)&&!a.isDark(b+1,e)&&a.isDark(b+2,e)&&a.isDark(b+3,e)&&a.isDark(b+4,e)&&!a.isDark(b+5,e)&&a.isDark(b+6,e)&&(d+=40);for(e=f=0;e<c;e++)for(b=0;b<c;b++)a.isDark(b,e)&&f++;a=Math.abs(100*f/c/c-50)/5;return d+10*a}},l={glog:function(a){if(1>a)throw Error("glog("+a+")");return l.LOG_TABLE[a]},gexp:function(a){for(;0>a;)a+=255;for(;256<=a;)a-=255;return l.EXP_TABLE[a]},EXP_TABLE:Array(256),
LOG_TABLE:Array(256)},m=0;8>m;m++)l.EXP_TABLE[m]=1<<m;for(m=8;256>m;m++)l.EXP_TABLE[m]=l.EXP_TABLE[m-4]^l.EXP_TABLE[m-5]^l.EXP_TABLE[m-6]^l.EXP_TABLE[m-8];for(m=0;255>m;m++)l.LOG_TABLE[l.EXP_TABLE[m]]=m;q.prototype={get:function(a){return this.num[a]},getLength:function(){return this.num.length},multiply:function(a){for(var c=Array(this.getLength()+a.getLength()-1),d=0;d<this.getLength();d++)for(var b=0;b<a.getLength();b++)c[d+b]^=l.gexp(l.glog(this.get(d))+l.glog(a.get(b)));return new q(c,0)},mod:function(a){if(0>
this.getLength()-a.getLength())return this;for(var c=l.glog(this.get(0))-l.glog(a.get(0)),d=Array(this.getLength()),b=0;b<this.getLength();b++)d[b]=this.get(b);for(b=0;b<a.getLength();b++)d[b]^=l.gexp(l.glog(a.get(b))+c);return(new q(d,0)).mod(a)}};p.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],
[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,
116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,
43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,
3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,
55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,
45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];p.getRSBlocks=function(a,c){var d=p.getRsBlockTable(a,c);if(void 0==d)throw Error("bad rs block @ typeNumber:"+a+"/errorCorrectLevel:"+c);for(var b=d.length/3,e=[],f=0;f<b;f++)for(var h=d[3*f+0],g=d[3*f+1],j=d[3*f+2],l=0;l<h;l++)e.push(new p(g,j));return e};p.getRsBlockTable=function(a,c){switch(c){case 1:return p.RS_BLOCK_TABLE[4*(a-1)+0];case 0:return p.RS_BLOCK_TABLE[4*(a-1)+1];case 3:return p.RS_BLOCK_TABLE[4*
(a-1)+2];case 2:return p.RS_BLOCK_TABLE[4*(a-1)+3]}};t.prototype={get:function(a){return 1==(this.buffer[Math.floor(a/8)]>>>7-a%8&1)},put:function(a,c){for(var d=0;d<c;d++)this.putBit(1==(a>>>c-d-1&1))},getLengthInBits:function(){return this.length},putBit:function(a){var c=Math.floor(this.length/8);this.buffer.length<=c&&this.buffer.push(0);a&&(this.buffer[c]|=128>>>this.length%8);this.length++}};"string"===typeof h&&(h={text:h});h=r.extend({},{render:"canvas",width:256,height:256,typeNumber:-1,
correctLevel:2,background:"#ffffff",foreground:"#000000"},h);return this.each(function(){var a;if("canvas"==h.render){a=new o(h.typeNumber,h.correctLevel);a.addData(h.text);a.make();var c=document.createElement("canvas");c.width=h.width;c.height=h.height;for(var d=c.getContext("2d"),b=h.width/a.getModuleCount(),e=h.height/a.getModuleCount(),f=0;f<a.getModuleCount();f++)for(var i=0;i<a.getModuleCount();i++){d.fillStyle=a.isDark(f,i)?h.foreground:h.background;var g=Math.ceil((i+1)*b)-Math.floor(i*b),
j=Math.ceil((f+1)*b)-Math.floor(f*b);d.fillRect(Math.round(i*b),Math.round(f*e),g,j)}}else{a=new o(h.typeNumber,h.correctLevel);a.addData(h.text);a.make();c=r("<table></table>").css("width",h.width+"px").css("height",h.height+"px").css("border","0px").css("border-collapse","collapse").css("background-color",h.background);d=h.width/a.getModuleCount();b=h.height/a.getModuleCount();for(e=0;e<a.getModuleCount();e++){f=r("<tr></tr>").css("height",b+"px").appendTo(c);for(i=0;i<a.getModuleCount();i++)r("<td></td>").css("width",
d+"px").css("background-color",a.isDark(e,i)?h.foreground:h.background).appendTo(f)}}a=c;jQuery(a).appendTo(this)})}})(jQuery);
;

/* file-end: js/lib/jquery.qrcode.min.js 
----------------------------------------------------------------------------------*/

;( function($) {
  'use strict';

  // fix forms
  $(function() {
    $('[type="submit"]').on('click', function(event) {
      var form = $(this).closest('form');

      if ( (!form.attr('action') && !form.attr('ng-submit')) || form.attr('onclick') ) {
        event.preventDefault();
        form.submit();
      }
    });
  });

  angular
    .module('Entry', [
      'LJ.Templates',
      'BasicToolbar',
      'LJ.Share',
      'LJ.Memories',
      'Discovery.Tags',
      'LJ.Sale'
    ]);

  angular
    .module('Entry')
    .run(EntryRun)
    .config(EntryConfig)
    .directive('ljSaleEntry', ljSaleEntry)
    .directive('ljQrcode', ljQrcode)
    .directive('ljSmi', ljSmi)
    ;

  /*
   * Comment page uses lj-bubble directive (comment form),
   * which uses ng-include inside bubble template.
   *
   * ng-include needs $AnchorScrollProvider, which lists $LocationProvider
   * as a dependency, which triggers $locationChangeStart. This sends $digest
   * into infinite loop when pushState is used from
   * non-Angular code (s1 comments).
   *
   * This way we supress $LocationProvider init.
   */
  // HTML5 mode is on to keep anchor links working
  // by LJSUP-20115

  EntryRun.$inject = ['$timeout'];
  function EntryRun  ( $timeout ) {

    // fix html5mode anchor scrolling on page load.
    // Using timeout to include generating elements on jQueryUI pages.
    // Do not use $timeout with no jQuery dynamically generated elements.
    $timeout(function() {
      updateLinks();
    });

    LJ.Event.on('entry/fixLinks', updateLinks);

    function updateLinks() {
      $('a:not([target])').attr('target', '_self');
    }
  }

  EntryConfig.$inject = ['$sceProvider', '$locationProvider'];
  function EntryConfig  ( $sceProvider,   $locationProvider ) {
    $sceProvider.enabled(false);

    // HTML5 mode on to anchor links working.
    // Fix IE redirect to the main page: angular redirects us on base url /
    if ( !LJ.Support.history && angular.element('base').length === 0 ) {
      angular.element('<base />')
        .attr('href', location.href)
        .appendTo('head');
    } else {
      $locationProvider.html5Mode(true);
    }
  };

  /**
   * Directive for place banner in post
   */
  function ljSaleEntry() {
    return {
        link: linkFunc
      };

    function linkFunc() {
      /* eslint dot-notation: 0 */
      var post = document.querySelector('.b-singlepost-body'),
          blockTags = ['DIV', 'ARTICLE'],
          floatTags = ['IMG', 'IFRAME', 'TABLE'],
          blackClass = ['lj-like'],
          tags = [].concat(blockTags).concat(floatTags),
          uniq = Math.random().toString(36).substring(7),
          deep = 4, // find levels
          opt = {
            wmin: 1001,
            wmax: 1500,
            winmarg: 30, // side space around post
            post: 1100,
            width: 300,
            height: 600,
            margin: 30
          };

      if (!LJ.get('adv.s1_right')) {
        return;
      }

      tryToInsert(post, 0).catch(insertBanner);

      function tryToInsert(post, level) {
        return new Promise(fx);

        function fx(resolve, reject) {
          if (
              post.className === uniq ||
              level === deep ||
              !~blockTags.indexOf(post.nodeName) ||
              blackClass.filter(_hasClass(post)).length
             ) {
            resolve();
            return;
          }

          var end = post.appendChild(document.createElement('div'));
          end.className = uniq;

          [].reduce.call(post.childNodes, _splitBlock, [])
            .reduce(_findPlace, Promise.resolve({
              reffer: post.firstChild,
              offset: 0,
              level: level,
              prev: null
            }))
            .then(resolve)
            .catch(function(reffer) {
              reject(reffer);
            });
        }
      }

      function _hasClass(elem) {
        return function(klass) {
          return ~elem.className.indexOf(klass);
        };
      }

      function _splitBlock(res, elem) {
        var last = res[res.length - 1],
            dspl;

        if (!last || last.el) {
          res.push({ el: null });
          last = res[res.length - 1];
        }

        if ( ~tags.indexOf(elem.nodeName) ||
             (elem.querySelectorAll &&
              elem.querySelectorAll(tags).length) ) {
          last.el = elem;
          dspl = getComputedStyle(elem, null).display;
          if ( dspl !== 'block' || dspl !== 'none' ) {
          //  elem.style.display = 'inline-block';
          }
        }
        return res;
      }

      function _findPlace(previous, block) {
        return previous
          .then(function(obj) {
            return checkBlock(block.el)
              .then(checkPlace.bind(null, block.el, obj));
          });
      }

      function checkBlock(block) {
        var imgs = (block.nodeName === 'IMG') ?
                   [block] :
                    block.querySelectorAll('img');

        return Promise.all( [].map.call(imgs, checkImg) );
      }

      function checkImg(elem) {
        return new Promise(load);

        function load(resolve) {
          elem.complete ? resolve() : elem.onload = resolve;
        }
      }

      // not clean function!
      function checkPlace(block, obj) {
        var WW = window.innerWidth - opt.winmarg * 2,
            blockBottom = block.offsetTop + block.offsetHeight,
            blockRight = block.offsetLeft + block.offsetWidth,
            WIDTH = opt.width + opt.margin, // without right margin (not need)
            HEIGHT = opt.height + opt.margin * 2,
            cond = WW <= opt.wmax && WW >= opt.wmin;

        return new Promise(_check);

        function _check(resolve, reject) {

          // previous + current text
          if (cond && obj.prev &&
              block.offsetTop - obj.prev.top > HEIGHT) {
            reject(obj.prev.reffer);
            return;
          }

          // update previous
          if (cond && WW - blockRight > WIDTH) {
            obj.prev = obj.prev ? obj.prev : {
                top: obj.offset,
                reffer: obj.reffer
              };
          } else {
            obj.prev = null;
          }

          // new previous (with current block)
          if (cond && obj.prev &&
              blockBottom - obj.prev.top > HEIGHT) {
            reject(obj.prev.reffer);
            return;
          }

          // only current text
          if (cond &&
              block.offsetTop - obj.offset > HEIGHT) {
            reject(obj.reffer);
            return;
          }

          tryToInsert(block, obj.level + 1).then(function() {
            // find next
            resolve({
              reffer: block.nextSibling,
              offset: blockBottom,
              prev: obj.prev
            });
          }).catch(function(reffer){
            reject(reffer);
          });
        }
      }

      // not clean function!
      function insertBanner(reffer) {
        var WW = window.innerWidth - opt.winmarg * 2,
            banner, ngAppInjector, ban, offset;

        banner = document.createElement('div');

        banner.setAttribute('lj-sale', 's1_right');
        banner.setAttribute('lj-sale-hide-cookie', 's1_rightbanner_closed');
        banner.className = 'ljsale ljsale--empty b-singlepost-postbanner';

        offset = (opt.post - WW < opt.winmarg) ? opt.post - WW : 0;
        banner.style.marginRight = String(offset) + 'px';

        reffer.parentElement.insertBefore(banner, reffer);

        ngAppInjector = angular.element('.b-singlepost').injector();
        ban = angular.element(banner);
        if (ngAppInjector) {
          ngAppInjector.invoke(['$compile', function($compile) {
            $compile(ban)(ban.scope());
          }]);
        }
      }
    }
  }

  /**
   * Directive for add qrcode
   */
  function ljQrcode() {
    return {
      scope: {
        text: '@ljQrcode',
        width: '@ljQrcodeWidth',
        height: '@ljQrcodeHeight'
      },
      link: function ($scope, $element) {
        $element.qrcode({
          text: $scope.text,
          width: $scope.width,
          height: $scope.height
        });
      }
    };
  }

  ljSmi.$inject = ['$http'];
  function ljSmi  ( $http ) {
    return {
      scope: true,
      link: function ($scope, $element) {
        var url = '//news.smi2.ru/data/js/82652.js',
            id = '82630',
            template;

        template = '<div class="sk_item_{id}">' +
            '<a href="{url}" class="sk_img_{id}" ' +
            'style="width: 150px !important; height: 120px !important;">' +
              '<img src="{img}" alt="{title}" ' +
              'style="width: 150px !important; height: 120px !important;" />' +
            '</a>' +
            '<a href="{url}" class="sk_text_{id}">{title}</a>' +
          '</div>';

        if (!url) {
          $element.remove();
          return;
        }

        $http.get(url)
          .success(function(data) {

            $element.html( data.news.reduce( function(result, elem) {
              return result + template.supplant({
                id: id || '',
                url: elem.url,
                img: elem.img,
                title: elem.title
              });
            }, '') );
          });
      }
    };
  }

  /* legacy code for comments initialization, moved here from inline calls */
  $(function() {

    $('.b-grove').commentsMassActions().commentsOperations();

    var node = jQuery('.b-watering');

    node.commentator({
        publicKey: LJ.get('captcha_public'),
        captchaContainerId: 'captcha-container',
        selectors: {
            errorBlock: '.b-msgsystem-error-ajax',

            blockingErrorBlocks: '.b-msgsystem-error',
            preloaderElem: '.b-watering-preload',
            submitControl: '.b-ljbutton-submit',

            captchaBox: '.b-watering-captchabox'
        },
        classNames: {
            captchaActive: 'b-watering-captchabox-active',
            replyPage: 'b-watering-replypage'
        }
    })
    .commentform();

    if (LJ.get('remoteUser') && LJ.get('hasuserpics')) {
        node.userpicker();
    }

    //the authtype widget should go last, because it passes information about current
    //authorization to other widgets
    node.authtype({
        forceStartupCaptcha: Boolean(LJ.get('need_captcha')),
        classNames: {
            expanded: 'b-watering-user-options-show',
            startAuthTypePrefix: 'b-watering-trueauth-',
            captchaForAnonymous: 'b-watering-captcha-anon',
            captchaForNonFriends: 'b-watering-captcha-nonfriend',
            notfriend: 'b-watering-user-notafriend',
            notaspammer: 'b-watering-notaspammer',
            captchaForAll: 'b-watering-captcha-all',
            authTypePrefix: 'b-watering-authtype-'
        },

        selectors: {
            activeSelectItem: 'a[href=#{authType}]',
            selectControl: '.b-watering-user-options',
            authTypesControls: '.b-watering-user-services-item a',
            authTypeRadios: '.b-watering-user-login-{authType} .b-watering-user-login-checkbox'
        }
    });

    $('.b-grove').comments();

    /*
     * Track linkbar clicks (prev, next, memories, etc) to Google Analytics
     */

    $('.b-linkbar').on('click', '.b-controls', function(event) {
      var className = event.currentTarget.className,
          match     = className.match(/b-controls-([a-z]+)/),
          control   = match && match[1];

      if (control) {
        LJ.Track.event('S1 Entry', 'Linkbar', control);
      }
    });
  });

})(jQuery);
;

/* file-end: js/entry/main.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/controlstrip.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.calendarEvents.js 
*/

!function(a){var b={};a.fn.calendarEvents=function(c){function d(a,b){return"cache_"+a+b}function e(a,b){var c=this;this.calendar=a,this.events=null,this.options=b,this._ajaxActive=!1,this._currentDate;var e,f=function(b,f){"string"!=typeof a.data("noFetch")&&(clearTimeout(e),c._currentDate=d(b.getFullYear(),b.getMonth()+1),e=setTimeout(function(){c.fetchEvents(b.getFullYear(),b.getMonth()+1,f)},200))};this.calendar.bind("dateChange",function(a){var b=c.calendar[c.options.calendarType]("option","displayedMonth"),d=1===Math.abs(12*(a.date.getFullYear()-b.getFullYear())+(a.date.getMonth()-b.getMonth()));f(a.date,d)}),this.options.fetchOnFirstDisplay&&this.calendar.one("calendarshow",function(){f(new Date,!0)})}var f={calendarType:"calendar",classNames:{idle:"idle"},fetchOnFirstDisplay:!1};return e.prototype={getEvents:function(a,b,c){var d={};return d[+a]={},d[+a][+b-1]=c,d},fetchEvents:function(c,e,f){f=arguments.length>=3?!!f:!0;var g=this,h=(this.calendar[this.options.calendarType]("option","displayedMonth"),this.calendar[this.options.calendarType]("getElement",f?"month":"year")),i=this.options.classNames.idle,j=!0,k=function(){g._ajaxActive||j||h.removeClass(i)};this.calendar[this.options.calendarType]("getElement","year").removeClass(i),this.calendar[this.options.calendarType]("getElement","month").removeClass(i),h.addClass(i),this._ajaxActive=!0,setTimeout(function(){j=!1,k()},500);var l=d(c,e);processResults=function(){l===g._currentDate&&(g.events=b[l],g.calendar[g.options.calendarType]("option","events",g.getEvents(g.events.year,g.events.month,g.events.days)),g._ajaxActive=!1,k())},l in b?processResults(b[l]):a.getJSON(LiveJournal.getAjaxUrl("calendar"),{year:c,month:e},function(a){b[l]=a,processResults(a)})}},this.each(function(){new e(a(this),a.extend({},f,c))})}}(jQuery);;

/* file-end: js/jquery/jquery.calendarEvents.js 
----------------------------------------------------------------------------------*/

/* ---------------------------------------------------------------------------------
   file-start: js/relations/menu.js 
*/


/* ---------------------------------------------------------------------------------
   file-start: js/core/angular/ljUser.js 
*/



Site.page.template['angular/ljUser.ng.tmpl'] = '<span\n    class=\"\n        ljuser\n        i-ljuser\n        i-ljuser-type-{{user.journaltype}}\n        \"\n    ng-class=\"{\n        \'i-ljuser-deleted\': user.is_invisible,\n        \'i-ljuser-nopopup noctxpopup\': user.noctxpopup,\n        \'i-ljuser-withalias\': user.alias,\n        \'i-ljuser-showalias\': user.showalias\n    }\"\n    data-ljuser=\"{{user.username}}\"\n    lj:user=\"{{user.username}}\"\n    ><!--\n\n    Userhead\n    --><a\n        class=\"i-ljuser-profile\"\n        ng-href=\"{{user.profile_url}}\"\n        ng-attr-target=\"{{user.target ? user.target : \'_self\'}}\"\n        ><!--\n        --><img\n            class=\"i-ljuser-userhead\"\n            ng-src=\"{{user.userhead_url}}\"\n            ><!--\n    --></a><!--\n\n    Username\n    --><a\n        class=\"i-ljuser-username\"\n        ng-href=\"{{user.journal_url}}\"\n        ng-attr-title=\"{{user.display_username || user.alias}}\"\n        ng-attr-target=\"{{user.target ? user.target : \'_self\'}}\"\n        ><b ng-bind=\"user.display_name || user.display_username\"></b></a><!--\n\n    Alias\n    --><span\n        class=\"i-ljuser-alias\"\n        ng-bind=\"user.alias\"\n        ></span><!--\n\n--></span>\n';
!function(){"use strict";function a(a,b,c,d,e,f,g){function h(a){var b=c.defer(),d=g.Cache.get(a);return d&&d.userhead_url?(b.resolve(d),b.promise):g.fetchUser(a,g.USERHEAD_FIELDS,{cache:!0,silent:!0})}function i(b,d){var i=c.defer(),l=a.$new();return h(b).then(function(){var a;l.user=angular.extend({},g.Cache.get(b),d||{}),a=e(k)(l),f(function(){i.resolve(j.empty().append(a).html()),l.$destroy()})}),i.promise}var j=angular.element("<div />"),k=d.get("ljUser.ng.tmpl");return{prepare:h,get:i}}function b(a,b,c){return{templateUrl:"ljUser.ng.tmpl",replace:!0,scope:!0,compile:function(d,e){var f=a(e.ljUserDynamic),g=a(e.ljUserDynamicOptions);return function(a){var d=g(a);a.$watch(function(){return f(a)},function(e){var f=e;a.user=angular.extend({username:f,display_username:f},d||{}),c.prepare(f).then(function(){a.$watch(function(){return b.Cache.get(f)},function(b){angular.extend(a.user,b)},!0)})})}}}}angular.module("LJ.User",["LJ.Api","LJ.Templates","Users"]),angular.module("LJ.User").factory("ljUser",a).directive("ljUserDynamic",b),a.$inject=["$rootScope","Api","$q","$templateCache","$compile","$timeout","Users"],b.$inject=["$parse","Users","ljUser"]}();;

/* file-end: js/core/angular/ljUser.js 
----------------------------------------------------------------------------------*/


/* ---------------------------------------------------------------------------------
   file-start: js/settings/services/filters/filters.js 
*/




!function(){"use strict";angular.module("GroupsAndFilters.Services.Filters",["LJ.Api","LJ.Options","Users"]).filter("filtersOrder",function(){return function(a){var b=a.slice(0);return b.sort(function(a,b){if(31===a.id)return-1;if(31===b.id)return 1;var c=a.name.toLowerCase(),d=b.name.toLowerCase();return c>d?1:-1}),b}}).factory("FilterGroupFactory",["$q","$timeout","Api","Options","Users",function(a,b,c,d,e){function f(){angular.extend(this,{MAX_COUNT:31,filters:[],key:"filters",rpc:{}},d.create({journal:LJ.get("remoteUser")}))}return f.prototype.toJSON=function(a){var b=angular.copy(a);return delete b.checked,delete b.users,b},f.prototype.nextId=function(){for(var a=null,b=this.filters.map(LJ.Function.get("id")),c=1,d=this.MAX_COUNT;d>c&&null===a;)-1===b.indexOf(c)&&(a=c),c+=1;return a},f.prototype.sync=function(a){var b={};return angular.isArray(a)||(a=[a]),b[this.key]=a.map(this.toJSON),b.journal=this.get("journal"),c.call(this.rpc.update,b)},f.prototype.fetch=function(a){var b=this,d={journal:this.get("journal")};return a=angular.extend(a||{},{cache:!1}),c.call(this.rpc.read,d,a).then(function(a){return b.filters=a[b.key],b.filters})},f.prototype._isNameUniq=function(a){var b=this.filters.map(function(a){return a.name.toLowerCase()});return a=a.toLowerCase(),-1===b.indexOf(a)},f.prototype.create=function(b){var d;return b=b.trim(),0===b.length?a.reject(LJ.ml("filters"===this.key?"api.error.filters.filter_name_not_specified":"api.error.groups.group_name_not_specified")):this._isNameUniq(b)?(d={id:this.nextId(),name:b,users:[],"public":!1,journal:this.get("journal")},this.filters.push(d),c.call(this.rpc.create,d)):a.reject("filters"===this.key?LJ.ml("api.error.filters.filter_already_exist",{name:b}):LJ.ml("api.error.groups.group_already_exist",{name:b}))},f.prototype.remove=function(a){var b=this,d={};return a=Array.isArray(a)?a:[a],d[this.key]=a.map(LJ.Function.get("id")),d.journal=this.get("journal"),a.forEach(function(a){b.filters.splice(b.filters.indexOf(a),1)}),c.call(this.rpc.remove,d)},f.prototype.getCount=function(){return c.call(this.rpc.count,{journal:this.get("journal")}).then(LJ.Function.get("count"))},f.prototype.by=function(a){var b=e.Cache.get(a);return b?this.filters.filter(function(b){return e.isUserInGroup(a,b.id)}):[]},f}]).factory("Filter",["FilterGroupFactory",function(a){function b(){this.rpc={create:"filters.create",read:"filters.list",update:"filters.update",remove:"filters.remove",count:"filters.count"},this.key="filters"}return b.prototype=new a,b.prototype._setPrivacy=function(a,b){return a=Array.isArray(a)?a:[a],a.forEach(LJ.Function.set("public","public"===b)),this.sync(a)},b.prototype.private=function(a){return this._setPrivacy(a,"private")},b.prototype.public=function(a){return this._setPrivacy(a,"public")},new b}]).factory("Group",["FilterGroupFactory",function(a){function b(){this.rpc={create:"groups.create",read:"groups.list",update:"groups.update",remove:"groups.remove",count:"groups.count"},this.key="groups"}return b.prototype=new a,new b}])}();;

/* file-end: js/settings/services/filters/filters.js 
----------------------------------------------------------------------------------*/


/* ---------------------------------------------------------------------------------
   file-start: js/settings/directives/filtersFor.js 
*/


LJ.injectStyle('.b-filterset{max-width:290px;font:14px/1.4 Arial,sans-serif;color:#000}.b-filterset B,.b-filterset CODE,.b-filterset DD,.b-filterset DIV,.b-filterset DT,.b-filterset EM,.b-filterset I,.b-filterset KBD,.b-filterset LABEL,.b-filterset LI,.b-filterset P,.b-filterset PRE,.b-filterset SPAN,.b-filterset STRONG,.b-filterset TD,.b-filterset TH{font-size:100%}.b-filterset .i-ljuser-userhead{vertical-align:top!important;margin:1px 0 0!important;border:none!important}.b-filterset .i-ljuser-username:active,.b-filterset .i-ljuser-username:hover,.b-filterset .i-ljuser-username:link,.b-filterset .i-ljuser-username:visited{color:#0051B7!important;text-decoration:none!important;border:none!important}.b-filterset .b-filterset-title{margin:0 1.142em .5em 0!important;font-weight:700!important;color:#222!important}.b-filterset .b-filterset-subtitle{margin:0 1.142em .5em 0!important;color:#222!important}.b-filterset-list{position:relative;z-index:1;overflow:auto;max-height:14em;min-width:220px;margin:0 0 .3em;padding:0;background-attachment:scroll;-moz-background-clip:border-box;background-clip:border-box;background-image:-webkit-radial-gradient(farthest-side at 50% 0,rgba(0,0,0,.1),transparent),-webkit-radial-gradient(farthest-side at 50% 100%,rgba(0,0,0,.1),transparent);background-image:-o-radial-gradient(farthest-side at 50% 0,rgba(0,0,0,.1),transparent),-o-radial-gradient(farthest-side at 50% 100%,rgba(0,0,0,.1),transparent);background-image:-moz-radial-gradient(farthest-side at 50% 0,rgba(0,0,0,.1),transparent),-moz-radial-gradient(farthest-side at 50% 100%,rgba(0,0,0,.1),transparent);background-image:radial-gradient(farthest-side at 50% 0,rgba(0,0,0,.1),transparent),radial-gradient(farthest-side at 50% 100%,rgba(0,0,0,.1),transparent);-moz-background-origin:padding-box;background-origin:padding-box;background-position:0 0,0 100%;background-repeat:no-repeat;-moz-background-size:100% 7px;background-size:100% 7px}.b-filterset-list:after,.b-filterset-list:before{position:relative;z-index:-1;display:block;content:\"\";height:14px;margin:0 0 -14px;background:-webkit-linear-gradient(top,#F4F5F6,#F4F5F6 30%,rgba(244,245,246,0));background:-moz-linear-gradient(top,#F4F5F6,#F4F5F6 30%,rgba(244,245,246,0));background:-o-linear-gradient(top,#F4F5F6,#F4F5F6 30%,rgba(244,245,246,0));background:linear-gradient(to bottom,#F4F5F6,#F4F5F6 30%,rgba(244,245,246,0))}.b-filterset-list:after{margin:-14px 0 0;background:-webkit-linear-gradient(top,rgba(228,229,233,0),#E4E5E9 70%,#E4E5E9);background:-moz-linear-gradient(top,rgba(228,229,233,0),#E4E5E9 70%,#E4E5E9);background:-o-linear-gradient(top,rgba(228,229,233,0),#E4E5E9 70%,#E4E5E9);background:linear-gradient(to bottom,rgba(228,229,233,0),#E4E5E9 70%,#E4E5E9)}.b-filterset-list LI{margin:0;padding:0;list-style-type:none}.b-filterset-list LI.loading{background:url(/img/preloader/preloader-blue-gray.gif?v=16423) 100% 50% no-repeat}.b-filterset-list LABEL{display:block;white-space:nowrap;line-height:1.333;font-size:.857em}.b-filterset-list LABEL:hover{background:#7292BD;color:#FFF}.b-filterset-addnew-input{display:block;margin:0 0 .5em;white-space:nowrap;line-height:1.333;font-size:.857em}.b-filterset-addnew{margin:.5em 0 0}.b-filterset-pseudo{font-size:.857em;color:#0051B7}.b-filterset-submit{text-align:right}.b-filterset-loader:after,.b-filterset-loader:before{display:inline-block;visibility:hidden;content:\'\';width:21px;height:21px;margin:-2px 0 0 4px;background:url(/img/preloader/preloader-blue-gray.gif?v=16423) 50% 50% no-repeat;vertical-align:middle}.b-filterset-loader-after:before,.b-filterset-loader-before:after{display:none}.b-filterset-loading .b-filterset-loader-after:after,.b-filterset-loading .b-filterset-loader-before:before{visibility:visible}');
Site.page.template['angular/controlstrip/filters.ng.tmpl'] = '<div class=\"b-filterset-body\" ng-class=\"{ \'b-filterset-loading\': model.loading }\">\n    <ul class=\"b-filterset-section b-filterset-list\">\n        <li ng-repeat=\"filter in filters | filtersOrder\" ng-class=\"{ \'loading\': loading[filter.id] }\">\n            <label>\n                <input\n                    ng-checked=\"checked = isActive(filter.id)\"\n                    ng-change=\"toggleFilter(filter.id, checked)\"\n                    ng-model=\"checked\"\n                    type=\"checkbox\"\n                    class=\"b-filterset-checkbox\"\n                    >{{filter.name}}\n            </label>\n        </li>\n\n        <li ng-show=\"model.showCreateDialog\">\n            <span class=\"b-filterset-addnew-input\" >\n                <form ng-submit=\"createFilter()\">\n                    <input\n                        ng-model=\"model.newFilter\"\n                        focus-and-select=\"model.showCreateDialog\"\n                        type=\"text\"\n                        />\n                    <input type=\"submit\" lj-ml=\"filterset.button.save\" lj-ml-attr=\"value\" />\n                </form>\n            </span>\n        </li>\n    </ul>\n\n    <div\n        ng-hide=\"model.showCreateDialog || isFiltersCountReached()\"\n        class=\"b-filterset-section b-filterset-addnew\">\n        <span\n            ng-if=\"isFiltersFor\"\n            ng-click=\"model.showCreateDialog = true\"\n            lj-ml=\"filterset.link.addnewfilter\"\n            class=\"b-filterset-pseudo b-pseudo\"\n            ></span>\n        <span\n            ng-if=\"isGroupsFor\"\n            ng-click=\"model.showCreateDialog = true\"\n            lj-ml=\"filterset.link.addnewgroup\"\n            class=\"b-filterset-pseudo b-pseudo\"\n            ></span>\n    </div>\n</div>\n';
!function(){"use strict";function a(a,b,c,d,e,f){function g(){return Array.isArray(a.usernames)?a.usernames:[a.usernames]}a.loading={},a.filters=[],c.fetch({cache:!0}).then(function(b){a.filters=b}),a.model={newFilter:"",showCreateDialog:!1},a.toggleFilter=function(b,c){var e;f.clear(),a.loading[b]=!0,e=c?d.addToGroup(b,g()):d.removeFromGroup(b,g()),e.then(function(){a.loading[b]=!1})},a.isActive=function(a){var b=g().every(function(b){return d.isUserInGroup(b,a)});return b},a.isCountReached=function(){return a.filters.length>=c.MAX_COUNT},a.createFilter=function(){var b=a.model.newFilter.trim();a.resetFilter(),0!==b.length&&(a.model.loading=!0,c.create(b).then(function(b){var c=b.filter;d.addToGroup(c.id,g()).then(function(){a.model.loading=!1})}))},a.resetFilter=function(){a.model.newFilter="",a.model.showCreateDialog=!1},a.$on("bubble:open:controlstrip",a.resetFilter)}angular.module("Filters.List",[]).controller("FiltersForCtrl",["$scope","$q","Filter","Users","Bubble","Messages",a]).controller("GroupsForCtrl",["$scope","$q","Group","Users","Bubble","Messages",a]).directive("filtersFor",[function(){return{controller:"FiltersForCtrl",scope:{usernames:"=filtersFor"},templateUrl:"filters.ng.tmpl",link:function(a){a.isFiltersFor=!0}}}]).directive("groupsFor",[function(){return{controller:"GroupsForCtrl",scope:{usernames:"=groupsFor"},templateUrl:"filters.ng.tmpl",link:function(a){a.isGroupsFor=!0}}}])}();;

/* file-end: js/settings/directives/filtersFor.js 
----------------------------------------------------------------------------------*/

Site.page.template['angular/controlstrip/controlstrip.ng.tmpl'] = '<div\n  class=\"b-filterset\"\n  ng-class=\"{ \'b-filterset-loading\': loading }\"\n  >\n\n  <!-- subscribe user -->\n  <div class=\"b-filterset-title\" ng-show=\"mode == \'subscribe\'\" lj-ml=\"filterset.title.subscribed.journal\" lj-ml-resolve=\"mlResolve\"></div>\n\n  <!-- add user -->\n  <div class=\"b-filterset-title\" ng-show=\"mode == \'add\'\" lj-ml=\"filterset.title.addfriend.journal\" lj-ml-resolve=\"mlResolve\"></div>\n  <div class=\"b-filterset-subtitle\" ng-show=\"mode == \'add\'\" lj-ml=\"filterset.subtitle.addfriend.journal\" lj-ml-resolve=\"mlResolve\"></div>\n\n  <!-- subscribe community -->\n  <div class=\"b-filterset-title\" ng-show=\"mode == \'watch\'\" lj-ml=\"filterset.title.subscribed.community\" lj-ml-resolve=\"mlResolve\"></div>\n\n  <!-- join community -->\n  <div class=\"b-filterset-title\" ng-show=\"mode == \'join\' || mode == \'joinSubscribed\'\" lj-ml=\"filterset.title.join\"></div>\n  <div class=\"b-filterset-subtitle\" ng-show=\"mode == \'join\'\" lj-ml=\"filterset.subtitle.join\" lj-ml-resolve=\"mlResolve\"></div>\n  <div class=\"b-filterset-section b-filterset-submit\" ng-show=\"mode == \'join\'\">\n      <div class=\"b-ljbutton b-filterset-loader b-filterset-loader-before\">\n          <input type=\"submit\" lj-ml=\"filterset.submit.subscribe\" lj-ml-attr=\"value\" ng-click=\"subscribeAfterJoin()\" />\n      </div>\n  </div>\n\n  <!-- filters section -->\n  <!-- Notice: extra div here is because of bug in AngularJS: https://github.com/angular/angular.js/issues/3981 -->\n\n  <div ng-show=\"mode !== \'join\'\">\n    <div\n      class=\"b-filterset-subtitle b-filterset-loader b-filterset-loader-after\"\n      lj-ml=\"filterset.subtitle.filters\"\n      ></div>\n      <div filters-for=\"username\"></div>\n  </div>\n</div>\n';
!function(a){"use strict";function b(a){LJ.Track.event("Relations","Menu",a)}angular.module("Relations.Menu",["LJ.Templates","LJ.Bubble","LJ.Directives","LJ.User","LJ.Messages","GroupsAndFilters.Services.Filters","Users","Filters.List"]).value("$anchorScroll",null).controller("MenuCtrl",["$scope","Bubble","$timeout","$q","ljUser","Filter","Users","Relations","Messages",function(c,d,e,f,g,h,i,j,k){function l(a,b){var d;switch(b&&n(b),a){case"addFriend":d=j.toggleFriend(s,!0,{wait:!0});break;case"removeFriend":d=j.toggleFriend(s,!1,{wait:!0});break;case"join":d=j.toggleMember(s,!0,{wait:!0});break;case"leave":d=j.toggleMember(s,!1,{wait:!0});break;case"subscribe":d=j.toggleSubscription(s,!0,{wait:!0});break;case"unsubscribe":d=j.toggleSubscription(s,!1,{wait:!0})}return d["finally"](o).then(function(b){return ContextualPopup.currentElement===r.find(".ljuser img").get(0)&&ContextualPopup.hide(),b.error?f.reject(b.error.message):(b.message&&(b.message.body=b.message.content,k.add(b.message)),"undefined"!=typeof b.controlstrip_status&&(c.status=b.controlstrip_status),"subscribe"===a||"addFriend"===a||"join"===a&&b.is_subscribedon?m():void(c.filters=[]))},function(a){k.error({body:a})})}function m(){var a,b=i.Cache.get(s);return b.is_subscribedon?(a=b.filtermask?f.defer().resolve():i.fetchUser(s,{filtermask:1}),f.all({filters:h.fetch({cache:!0}),user:a}).then(function(a){c.filters=a.filters})):f.reject()}function n(a){p&&o(),p=(new Hourglass).setEvent(a).show()}function o(){p&&(p.remove(),p=null)}var p,q,r=a(".w-cs-status"),s=LJ.get("journal.username");i.set({type:"subscriptions"}),c.username=s,c.filters=[],c.status=LJ.get("controlstrip.status"),i.Cache.add(LJ.get("journal")),ContextualPopup.showNote=angular.identity,q=f.defer(),c.mlResolve={promise:q.promise},g.get(s,{noctxpopup:!0}).then(function(a){q.resolve({username:a})}),c.$watch(function(){return i.Cache.get(s)},function(a){c.states=LJ.Object.pick(a,"is_friend","is_member","is_subscribedon","is_invite_sent")},!0),c.toggleLoading=function(a){c.loading=a},LJ.Event.on("relations.change",function(){e(k.clear)}),c.subscribe=function(a){a.preventDefault(),b("subscribe"),l("subscribe",a).then(function(){c.states.is_subscribedon&&(c.mode="subscribe",d.open("controlstrip","unsubscribe"))})},c.unsubscribe=function(a){a.preventDefault(),b("unsubscribe"),l("unsubscribe",a)},c.addFriend=function(a){a.preventDefault(),b("add friend"),l("addFriend",a).then(function(){c.states.is_friend&&(c.mode="add",d.open("controlstrip","removeFriend"))})},c.removeFriend=function(a){a.preventDefault(),b("remove friend"),l("removeFriend",a)},c.watch=function(a){a.preventDefault(),b("subscribe to community"),l("subscribe",a).then(function(){c.states.is_subscribedon&&(c.mode="watch",d.open("controlstrip","unwatch"))})},c.unwatch=function(a){a.preventDefault(),b("unsubscribe from community"),l("unsubscribe",a)},c.join=function(a){a.preventDefault(),b("join community"),l("join",a).then(function(){c.states.is_member&&(c.mode=c.states.is_subscribedon?"joinSubscribed":"join",d.open("controlstrip","leave"))})},c.leave=function(a){a.preventDefault(),b("leave community"),l("leave",a)},c.subscribeAfterJoin=function(){c.toggleLoading(!0),b("subscribe to community (after join)"),l("subscribe").then(function(){c.toggleLoading(!1),c.mode="watch"})}}])}(jQuery);;

/* file-end: js/relations/menu.js 
----------------------------------------------------------------------------------*/

!function(a){"use strict";function b(){var b,c,d,e;LJ.get("remoteUser")&&(b=a(".s-header .s-header-journal-filter, #lj_controlstrip_new .w-cs-filter-inner"),0!==b.length&&(c=a("#sortByPoster"),d=c.find("[name=poster]"),e=c.find("[type=image]"),b.bubble({target:".s-header .w-cs-filter-icon, #lj_controlstrip_new .w-cs-filter-icon",showOn:"click",closeControl:!0,classNames:{containerAddClass:"b-bubble-filter"}}),d.input(function(){this.value.length?e.css("opacity",1).prop("disabled",!1):e.css("opacity",0).prop("disabled",!0)}),c.on("submit",function(a){d.val().length||a.preventDefault()})))}function c(){a(".s-header input[placeholder], #lj_controlstrip_new input[placeholder]").labeledPlaceholder()}function d(){b(),c(),LJ.Flags.isEnabled("new_friends_and_subscriptions")&&!e&&angular.bootstrap(a("[data-controlstrip]"),["Relations.Menu"]),function(){function b(a){var b=a.split(",").map(Number);return new Date(b[0],b[1],b[2])}var c=a(".s-header .w-cs-i-calendar a, #lj_controlstrip_new .w-cs-i-calendar a"),d=/^\/friends/.test(location.pathname),e=LJ.get("current_journal.url_journal"),f=LJ.get("controlstrip.calendar.earlyDate"),g=LJ.get("controlstrip.calendar.lastDate");c.length&&(c.calendar({showOn:"click",closeControl:!0,bubbleClass:!0,dayRef:e+"/"+(d?"friends/":"")+"%Y/%M/%D",allRefs:d,startMonth:f?b(LJ.get("controlstrip.calendar.earlyDate")):new Date,endMonth:g?b(LJ.get("controlstrip.calendar.lastDate")):new Date,classNames:{container:"w-cs-calendar"},ml:{caption:LJ.ml("web.controlstrip.view.calendar")}}).on("daySelected",function(a){a.preventDefault()}),d||c.calendarEvents({fetchOnFirstDisplay:!0}))}(),a(".b-loginpopup").bubble({target:".i-auth-control",closeControl:!1,showOn:"click"}),a("input.text").labeledPlaceholder(),a("html").trigger("controlstrip-initialized")}var e=Boolean("undefined"!=typeof document.documentMode&&document.documentMode<8);a(function(){return 0!==a(".s-header, #lj_controlstrip_new").length||"xcolibur"===Site.page.scheme?void d():void a.get(LiveJournal.getAjaxUrl("controlstrip"),{user:LJ.get("currentJournal")},function(b){a(".body-content").length?a(b).prependTo(".body-content"):(a("html").removeClass("html-adaptive"),a(b).appendTo(document.body)),d()})}),a(function(){function b(b){var c=a("."+f.showElem+":not("+b+")");a(c).removeClass(f.showElem)}function c(){var b=a("."+f.showElem);b.length>0?a(e.bodyElem).addClass(f.showFader):a(e.bodyElem).removeClass(f.showFader)}function d(){var b=a("."+f.showElem);g.catchBlur=b.length>0?!0:!1}var e={bodyElem:a("body"),controls:a(".js--show-elem"),controlsHover:a(".js--show-elem-by-hover"),fader:a(".b-fader")},f={control:"js--show-elem",controlHover:"js--show-elem-by-hover",showElem:"js--is-shown",showFader:"js--show-fader",catchBlur:"js--catch-blur"},g={catchBlur:!1};a(document).on("click",function(){g.catchBlur&&b()}),a(e.controlsHover).hover(function(){var b=a(this).find("."+f.control),c={selector:a(b).data("elem")};a(c.selector).addClass(f.showElem)},function(){var b=a(this).find("."+f.control),c={selector:a(b).data("elem")};a(c.selector).removeClass(f.showElem),a(this).addClass(f.controlHover)}),a(e.controls).on("click",function(e){var g={selector:a(this).data("elem"),isShowFader:a(this).data("fader")||!1,isUseBlur:a(this).data("blur")||!1};b(g.selector),a(g.selector).toggleClass(f.showElem),a(this).parent().hasClass(f.controlHover)&&a(this).parent().removeClass(f.controlHover),g.isShowFader&&c(),g.isUseBlur&&d(),e.stopPropagation(),e.preventDefault()}),a(e.fader).on("click",function(){b(),a(e.bodyElem).removeClass(f.showFader)})})}(jQuery);;

/* file-end: js/controlstrip.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.lj.journalPromoStrip.js 
*/

!function(a){"use strict";a.widget("lj.journalPromoStrip",a.lj.basicWidget,{options:{selectors:{popupInfo:".journalpromo-popup-content-info",popupDelete:".journalpromo-popup-content-delete",button:"#journalpromo-popup-btn",iconClose:".b-journalpromo-actions-close",options:".b-journalpromo-header-options",promoItem:".b-journalpromo-item",iconDelete:".b-journalpromo-actions-delete",info:".journalpromo-popup-info-action",spinner:".journalpromo-popup-spinner",error:".journalpromo-popup-info-error",errorContent:".journalpromo-popup-info-error-content",ban:"#journalpromo-user-ban"},classNames:{iconInfo:".journalpromo-info-icon",iconDelete:".b-journalpromo-actions-delete",noPromo:"b-journalpromo-item-nopromotion"},template:"<dt><a href='{rules_link}'>{subject}</a> {ljuser}</dt><dd>{body}</dd>"},_create:function(){var b=this;a.lj.basicWidget.prototype._create.apply(this),this._el("spinner"),this._el("info"),this._el("button"),this._el("iconClose"),this._el("error"),b._el("promoItem"),this._el("iconDelete"),this._el("popupDelete"),this._el("errorContent"),this._el("iconDelete")[0]&&(this._deleteBubble=this._popupDelete.bubble({target:this._cl("iconDelete"),showOn:"click"})),this._el("popupInfo").bubble({target:this._cl("iconInfo"),showOn:"hover",closeControl:!1,showDelay:500}),this._bindControls()},_toggleSpinner:function(a){this._spinner.toggle(a),this._info.toggle(!a)},_toggleError:function(a,b){this._error.toggle(a),this._info.toggle(!a),b&&this._errorContent.text(b)},_updateBlock:function(a){a.object[0].object_url?this._promoItem.html(this.options.template.supplant({rules_link:a.object[0].object_url,subject:a.object[0].subject,body:a.object[0].body,ljuser:a.object[0].ljuser_display})):this._promoItem.html('<span class="b-journalpromo-item-message">'+a.object[0].body+"</span>").addClass(this._cl("noPromo"))},_closeClick:function(){var a=this;return"#__debug"===location.hash?this._debug():(a._toggleSpinner(!0),void LJ.Api.call("journalpromo.admin_cancel",{object_url:a.options.url,user:Site.currentJournal,get_slot:1,ban_user:document.getElementById("journalpromo-user-ban").checked},function(b){if(a._toggleSpinner(!1),console.dir(b),b.error&&b.error.data&&b.error.data.entry)return a._updated=b.error.data.entry[0],a._toggleError(!0,b.error.message),void console.error(b.error.message);if(!b.error&&b.entry){var c=b.entry[0];if(!c||!c.object||!c.object[0])return void console.error("Wrong data",b);a._updateBlock(c),a._iconDelete.hide()}a._deleteBubble.bubble("hide")}))},_disableClick:function(){var a=this;LJ.Api.call("journalpromo.disable_promo_announce",{journal:LJ.get("currentJournal")},function(b){b.error||a.element.slideUp("fast")})},_bindControls:function(){var b=this;a.lj.basicWidget.prototype._bindControls.apply(this),this._button.on("click",this._closeClick.bind(this)),this._iconClose.on("click",this._disableClick.bind(this)),this._deleteBubble&&this._deleteBubble.bind("bubblehide",function(){b._toggleError(!1),b._updated&&(b._updateBlock(b._updated),b._iconDelete.hide())})},_debug:function(){var a=this;a._toggleSpinner(!0),setTimeout(function(){a._toggleSpinner(!1),a._toggleError(!0,"Sample error")},1e3)}})}(jQuery,window);;

/* file-end: js/jquery/jquery.lj.journalPromoStrip.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.lj.calendar.js 
*/

/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.lj.inlineCalendar.js 
*/

!function(a){function b(a,b){b=b||!1;var c=a.getDate().toString();1===c.length&&(c="0"+c),b&&(c="");var d=a.getMonth().toString();return 1===d.length&&(d="0"+d),parseInt(a.getFullYear().toString()+d+c,10)}function c(a,c){return b(c,!0)>=b(a[0],!0)&&b(c,!0)<=b(a[1],!0)}function d(c,d,e){this.initialize=function(a){this.tbody=this.catchTableStructure(a)},this.modelChanged=function(b,d,f){var g=e.longMonth?e.ml.monthNamesLong:e.ml.monthNamesShort;this.tbody.detach(),this.fillDates(b,d);for(var h in f)f.hasOwnProperty(h)&&c[h][f[h]?"removeClass":"addClass"](this.disabledStyle(h));var i=e.monthRef?a("<a>",{href:LJ.Util.Date.format(b,e.monthRef),text:g[b.getMonth()]+(e.monthWithYear?" "+b.getFullYear():"")}):g[b.getMonth()],j=e.yearRef?a("<a>",{href:LJ.Util.Date.format(b,e.yearRef),text:b.getFullYear()}):b.getFullYear();c.monthLabel.empty().append(i),c.yearLabel.empty().append(j),this.tbody.appendTo(c.table)},this.catchTableStructure=function(b){var d=c.tbody[0];c.daysCells=[],c.daysSpans=[];for(var e,f,g,h=d.rows.length,i=6-h,j="<tr>",k=0;7>k;++k)j+="<td><span></span></td>";for(j+="</tr>";i-->0;)a(j).hide().appendTo(c.tbody);for(h=6,c.lastRow=jQuery(d.rows[d.rows.length-1]),b=new Date(b),e=0;h>e;++e)for(f=0,g=d.rows[e].cells.length;g>f;++f){var l=jQuery(d.rows[e].cells[f]),m=l.children(),n=m.text().trim();n&&(b.setDate(n),l.data("isActive",!0),l.data("day",b)),c.daysCells.push(l),c.daysSpans.push(m)}return jQuery(d)},this.fillDates=function(a,b){function d(a){var c=a.getFullYear(),d=a.getMonth(),e=a.getDate();return b&&b[c]&&b[c][d]&&b[c][d][e]}var f=new Date(a);f.setDate(1);var g;g=e.startAtSunday?f.getDay():0===f.getDay()?6:f.getDay()-1,f.setDate(1-g);for(var h=0,i=c.daysCells.length;i>h;++h){var j=c.daysCells[h],k=c.daysSpans[h];this.formDayString(f,j,k,d(f),this.isActiveDate(f,a)),f.setDate(f.getDate()+1)}f.setDate(f.getDate()-1),f.getDate()<7?c.lastRow.css("display",""):c.lastRow.css("display","none")},this.isActiveDate=function(a,c){var d=!0;return d=c.getFullYear()===a.getFullYear()&&c.getMonth()===a.getMonth(),d&&(e.activeFrom||e.activeUntil)&&(d=e.activeFrom&&b(e.activeFrom)<=b(a)||e.activeUntil&&b(e.activeUntil)>=b(a)),d},this.formDayString=function(c,f,g,h,i){c=new Date(c);var j=b(c)===b(e.currentDate);if(f.data("day",c),f.data("isActive",i),f.data("hasEvents",h),f[j?"addClass":"removeClass"](d.current),f.removeClass(d.cellHover),i)if(h||e.allRefs){var k=!0;e.allRefs&&"object"==typeof e.allRefs&&(e.allRefs.from&&c<e.allRefs.from&&(k=!1),e.allRefs.to&&c>e.allRefs.to&&(k=!1)),k?(f.removeClass(d.inactive),g.html(a("<a />",{html:c.getDate(),href:LJ.Util.Date.format(c,e.dayRef),target:"_self"}))):(f.removeClass(d.inactive),g.html(c.getDate()))}else f.removeClass(d.inactive),g.html(c.getDate());else f.addClass(d.inactive),g.html(c.getDate())},this.disabledStyle=function(a){return"prevMonth"===a||"prevYear"===a?d.prevDisabled:d.nextDisabled}}var e={dayRef:"/%Y/%M/%D",monthRef:"",yearRef:"",allRefs:!1,currentDate:new Date,activeUntil:null,activeFrom:null,startMonth:new Date(1900,0,1),endMonth:new Date(2050,0,1),startAtSunday:"0"===LJ.ml("date.format.offset")||!1,dateFormat:"%Y-%M-%D",defaultTitle:"Calendar",longMonth:!1,events:null,displayedMonth:null,dateChange:null,selectors:{table:"table",title:"h5",tbody:"tbody",month:".cal-nav-month",year:".cal-nav-year",monthSelect:".cal-nav-month-select",yearSelect:".cal-nav-year-select",prevMonth:".cal-nav-month .cal-nav-prev",nextMonth:".cal-nav-month .cal-nav-next",prevYear:".cal-nav-year .cal-nav-prev",nextYear:".cal-nav-year .cal-nav-next",monthLabel:".cal-nav-month .cal-month",yearLabel:".cal-nav-year .cal-year"},classNames:{container:"",inactive:"other",future:"other",current:"current",weekend:"weekend",nextDisabled:"cal-nav-next-dis",prevDisabled:"cal-nav-prev-dis",cellHover:"hover",longMonth:"sidebar-cal-longmonth"},mlPrefix:{monthNamesShort:["monthNames","date.month.{name}.short"],monthNamesLong:["monthNames","date.month.{name}.long"],dayNamesShort:["dayNames","date.day.{name}.short"]},ml:{monthNames:["january","february","march","april","may","june","july","august","september","october","november","december"],dayNames:["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],caption:"Calendar"}},f={options:{},_create:function(){this._preInit(),this._initialize(),this._postInit()},_preInit:function(){var b=a[this.namespace][this.widgetName].getDefaults();this.options=jQuery.extend(!0,{},b,this.options),this._prepareMLVars()},_prepareMLVars:function(){var a,b=function(a,b){return LJ.ml(a.supplant({name:b}))};for(var c in this.options.mlPrefix)this.options.mlPrefix.hasOwnProperty(c)&&(a=this.options.mlPrefix[c],this.options.ml[c]=this.options.ml[a[0]].map(b.bind(null,a[1])))},_initialize:function(){this.options.displayedMonth||(this.options.displayedMonth=new Date(this.options.currentDate)),this._events=this.options.events,this._hideTimer=null,this._nodes=this._nodes||{container:this.element,root:this.element},this._invalidateTimer=null,this.element.hasClass(this.options.classNames.longMonth)&&(this.options.longMonth=!0),this._bindNodes(),this.options.startMonth.setDate(1),this._view=new(this._getView())(this._nodes,this.options.classNames,this.options),this._view.initialize(this.options.currentDate),this._nodes.table.hasClass("monday")&&this._setOption("startAtSunday",!1),this._nodes.monthSelect.val(this.options.displayedMonth.getMonth()),this._nodes.yearSelect.val(this.options.displayedMonth.getFullYear()),this._bindEvents()},_postInit:function(){},_getView:function(){return d},_bindNodes:function(){for(var a in this.options.selectors)!this.options.selectors.hasOwnProperty(a)||a in this._nodes||(this._nodes[a]=this._nodes.container.find(this.options.selectors[a]));var b=LJ.Util.Date.parse(this._nodes.table.attr("data-date"),this.options.dateFormat);b&&(this.options.displayedMonth=b)},destroy:function(){a.Widget.prototype.destroy.apply(this,arguments)},_bindEvents:function(){var b=this,c=this._getSwitcherStates(this.options.currentDate),d=function(a){return function(c){c.preventDefault(),c.stopPropagation();var d=b._getSwitcherStates(b.options.currentDate);d[a]&&b["_"+a]()}};for(var e in c)c.hasOwnProperty(e)&&this._nodes[e].click(d(e));this._nodes.monthSelect.change(function(){var a=new Date(b.options.currentDate);a.setMonth(this.value),b._setOption("currentDate",a)}),this._nodes.yearSelect.change(function(){var a=new Date(b.options.currentDate);a.setFullYear(this.value),b._setOption("currentDate",a)}),this._nodes.tbody.delegate("td","click",function(c){b._cellSelectedEvent(a(this),c)})},_switchMonth:function(a){var b=jQuery.Event("dateChange");b.moveForward=a>0,b.switchType=12===Math.abs(a)?"year":1===Math.abs(a)?"month":null,b.date=new Date(this.options.displayedMonth.getFullYear(),this.options.displayedMonth.getMonth()+a,1),this._nodes.root.trigger(b),this._setOption("displayedMonth",b.date)},_prevMonth:function(){this._switchMonth(-1)},_nextMonth:function(){this._switchMonth(1)},_prevYear:function(){this._switchMonth(-12)},_nextYear:function(){this._switchMonth(12)},_cellSelectedEvent:function(a,b){(!a.data("isActive")||this._cellSelected(a.data("day")))&&(b.stopPropagation(),b.preventDefault())},_cellSelected:function(a){var b=jQuery.Event("daySelected");return this._nodes.root.trigger(b,[a,LJ.Util.Date.format(a,this.options.dateFormat)]),b.isDefaultPrevented()||this._setOption("currentDate",a),!b.isDefaultPrevented()},_fitDate:function(a){a=new Date(a);var d=[this.options.startMonth,this.options.endMonth];return c(d,a)||(a=new Date(b(a,!0)<b(d[0],!0)?d[0]:d[1])),a},_getSwitcherStates:function(){var a=this.options.displayedMonth,b=new Date(a.getFullYear(),0,1),c=new Date(a.getFullYear(),11,1);return{prevMonth:this._isActivePrev(a)!==!1,prevYear:this._isActivePrev(b)!==!1,nextMonth:this._isActiveNext(a)!==!1,nextYear:this._isActiveNext(c)!==!1}},_isActiveNext:function(a){return this._isActiveDate(a,1)},_isActivePrev:function(a){return this._isActiveDate(a,-1)},_isActiveDate:function(a,b){var d=new Date(a);return d.setMonth(d.getMonth()+b),d.setDate(1),c([this.options.startMonth,this.options.endMonth],d)},_invalidateDisplay:function(){var a=this;clearTimeout(this._invalidateTimer),setTimeout(function(){a._view.modelChanged(a.options.displayedMonth,a._events,a._getSwitcherStates())},50)},_setOption:function(a,c){switch(a){case"currentDate":this.options.currentDate=this._fitDate(c);var d=jQuery.Event("currentDateChange"),e=new Date(this.options.currentDate);this._nodes.root.trigger(d,[e,LJ.Util.Date.format(e,this.options.dateFormat)]),this._setOption("displayedMonth",c),this._invalidateDisplay();break;case"activeFrom":this.options.activeFrom=new Date(c),this._invalidateDisplay();break;case"activeUntil":this.options.activeUntil=new Date(c),this._invalidateDisplay();break;case"title":this._title=c,this._nodes.title.html(c);break;case"events":this._events=c,this._invalidateDisplay();break;case"displayedMonth":var f=this._fitDate(new Date(c)),g=b(f,!0)===b(this.options.displayedMonth,!0);g||(this.options.displayedMonth=this._fitDate(new Date(c)),this._nodes.monthSelect.val(this.options.displayedMonth.getMonth()),this._nodes.yearSelect.val(this.options.displayedMonth.getFullYear()),this._invalidateDisplay());break;case"startMonth":this.options.startMonth=new Date(c),this._invalidateDisplay();break;case"endMonth":this.options.endMonth=new Date(c),this._invalidateDisplay();break;case"startAtSunday":this.options.startAtSunday=!!c;break;case"monthWithYear":this.options.monthWithYear=Boolean(c);break;case"dayRef":this.options.dayRef=c,this._invalidateDisplay()}},getElement:function(a){return a in this._nodes?this._nodes[a]:null}};a.widget("lj.inlineCalendar",f),jQuery.extend(a.lj.inlineCalendar,{getDefaults:function(){return e},setDefaults:function(a){a&&jQuery.extend(!0,e,a)}})}(jQuery);;

/* file-end: js/jquery/jquery.lj.inlineCalendar.js 
----------------------------------------------------------------------------------*/

!function(a,b){var c,d={showOn:"click",closeControl:!0,showCellHovers:!1,hoverDelay:400,align:"center",events:null,displayedMonth:null,bubbleClass:!1,selectors:{tmpl:".appwidget-calendar .calendar"},classNames:{showCellHovers:"all-days",popup:"b-bubble-calendar"},templates:{calendar:'<div class="popup-inner calendar" style="display: none;"> 						<p class="cal-nav"> 							<span class="cal-nav-month"> 								<i class="cal-nav-prev"></i> 								<span class="cal-month"></span> 								<i class="cal-nav-next cal-nav-next-dis"></i> 							</span> 							<span class="cal-nav-year"> 								<i class="cal-nav-prev cal-nav-prev"></i> 								<span class="cal-year"></span> 								<i class="cal-nav-next cal-nav-next-dis"></i> 							</span> 						</p> 						<table class="calendar-table" cellspacing="0" cellpadding="0"> 							<thead> 								<tr> 									{{each days}} 										<th class="calendar-cell calendar-cell--header {{if $index % 7 === weekend1 || $index % 7 === weekend2}} weekend{{/if}}">${day}</th> 									{{/each}} 								</tr> 							</thead> 							<tbody> 								{{each cells}} 								{{if $index % 7 === 0}}<tr>{{/if}} 								<td class="calendar-cell {{if $index % 7 === weekend1 || $index % 7 === weekend2}}weekend{{/if}}"><span></span></td> 								{{if $index % 7 === 6}}</tr>{{/if}} 								{{/each}} 							</tbody> 						</table></div>'}},e={options:{},_initialize:function(){c||(c=this._buildDOM()),this._nodes={container:c.clone(),root:this.element},a.lj.inlineCalendar.prototype._initialize.apply(this),this._invalidateDisplay()},_bindNodes:function(){a.lj.inlineCalendar.prototype._bindNodes.apply(this);var b=this;this._nodes.container.bubble({classNames:{containerAddClass:this.options.bubbleClass?this.options.classNames.popup:""},target:this._nodes.root,align:this.options.align,closeControl:this.options.closeControl,showOn:this.options.showOn,closeOnContentClick:!1}).bind("bubbleshow",function(){b._trigger("show")}).bind("bubblehide",function(){b._trigger("hide")}).addClass(this.options.classNames.container),this._nodes.input=this.options.input?this.options.input:this._nodes.root.is("[type=text]")?this._nodes.root:a(),this._nodes.input.mask&&this._nodes.input.mask("?dddd-dd-dd",{placeholder:" "}),this._nodes.input.input(this._parseInputValue.bind(this));var c=LJ.Util.Date.parse(this._nodes.input.val(),this.options.dateFormat);c&&(this.options.currentDate=c),this.options.showCellHovers&&this._nodes.table.addClass(this.options.classNames.showCellHovers)},destroy:function(){this._nodes.container.bubble("destroy"),a.lj.inlineCalendar.prototype.destroy.apply(this)},_buildDOM:function(){var a=this.options.ml.dayNamesShort.map(function(a){return{day:a}}),b=0,c=6,d=function(a,b){for(var c=[];a--;)c.push(b);return c};this.options.startAtSunday||(a[7]=a[0],a.shift(),b=5);for(var e=[],f=[],g=this.options.endMonth.getFullYear(),h=this.options.startMonth.getFullYear();g>=h;)e.push({year:g--});f=this.options.ml.monthNamesLong.map(function(a){return{month:a}});var i={caption:this.options.ml.caption,days:a,months:f,years:e,cells:d(42,{}),weekend1:b,weekend2:c};return-1!==this.options.templates.calendar.indexOf(" ")?jQuery.tmpl(this.options.templates.calendar,i):LJ.UI.template(this.options.templates.calendar,i)},_parseInputValue:function(){var a=LJ.Util.Date.parse(this._nodes.input.val(),this.options.dateFormat);a&&this._cellSelected(a)},_cellSelectedEvent:function(c,d){var e=this;a.lj.inlineCalendar.prototype._cellSelectedEvent.call(this,c,d),e.options.showCellHovers&&c.data("isActive")&&e._nodes.container.bubble("hide"),"a"==d.target.tagName.toLowerCase()&&(b.location.href=d.target.href)},_invalidateDisplay:function(){this._view.modelChanged(this.options.displayedMonth,this._events,this._getSwitcherStates())},_setOption:function(b,c){switch(a.lj.inlineCalendar.prototype._setOption.call(this,b,c),b){case"currentDate":this._nodes.input.val(LJ.Util.Date.format(this.options.currentDate,this.options.dateFormat))}}};a.widget("lj.calendar",a.lj.inlineCalendar,e),jQuery.extend(a.lj.calendar,{getDefaults:function(){return jQuery.extend(!0,{},a.lj.inlineCalendar.getDefaults(),d)},setDefaults:function(a){a&&jQuery.extend(d,a)}})}(jQuery,window);;

/* file-end: js/jquery/jquery.lj.calendar.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/jquery/jquery.mask.js 
*/

!function(a){var b=(a.browser.msie?"paste":"input")+".mask",c=void 0!=window.orientation;a.mask={definitions:{d:"[0-9]",w:"[A-Za-z]","*":"[A-Za-z0-9Ð°-ÑÐ-Ð¯]"}},a.fn.extend({unmask:function(){return this.trigger("unmask")},mask:function(d,e){if(!d&&this.length>0){var f=a(this[0]),g=f.data("tests");return a.map(f.data("buffer"),function(a,b){return g[b]?a:null}).join("")}e=a.extend({placeholder:"_",completed:null},e);var h=a.mask.definitions,g=[],i=d.length,j=null,k=d.length;return a.each(d.split(""),function(a,b){"?"==b?(k--,i=a):h[b]?(g.push(new RegExp(h[b])),null==j&&(j=g.length-1)):g.push(null)}),this.each(function(){function f(a){for(;++a<=k&&!g[a];);return a}function l(a){for(;!g[a]&&--a>=0;);for(var b=a;k>b;b++)if(g[b]){t[b]=e.placeholder;var c=f(b);if(!(k>c&&g[b].test(t[c])))break;t[b]=t[c]}q(),s.caret(Math.max(j,a))}function m(a){for(var b=a,c=e.placeholder;k>b;b++)if(g[b]){var d=f(b),h=t[b];if(t[b]=c,!(k>d&&g[d].test(h)))break;c=h}}function n(b){var d=a(this).caret(),e=b.keyCode;return u=16>e||e>16&&32>e||e>32&&41>e,d.start-d.end==0||u&&8!=e&&46!=e||p(d.start,d.end),8==e||46==e||c&&127==e?(l(d.start+(46==e?0:-1)),!1):27==e?(s.val(v),s.caret(0,r()),!1):void 0}function o(b){if(u)return u=!1,8==b.keyCode?!1:null;b=b||window.event;var c=b.charCode||b.keyCode||b.which,d=a(this).caret();if(b.ctrlKey||b.altKey||b.metaKey)return!0;if(c>=32&&125>=c||c>186){var h=f(d.start-1);if(k>h){var i=String.fromCharCode(c);if(g[h].test(i)){m(h),t[h]=i,q();var d=f(h);a(this).caret(d),e.completed&&d==k&&e.completed.call(s)}}}return!1}function p(a,b){for(var c=a;b>c&&k>c;c++)g[c]&&(t[c]=e.placeholder)}function q(){return s.val(t.join("")).val()}function r(a){for(var b=s.val(),c=-1,d=0,f=0;k>d;d++)if(g[d]){for(t[d]=e.placeholder;f++<b.length;){var h=b.charAt(f-1);if(g[d].test(h)){t[d]=h,c=d;break}}if(f>b.length)break}else t[d]==b.charAt(f)&&d!=i&&(f++,c=d);return!a&&i>c+1?(s.val(""),p(0,k)):(a||c+1>=i)&&(q(),a||s.val(s.val().substring(0,c+1))),i?d:j}var s=a(this),t=a.map(d.split(""),function(a){return"?"!=a?h[a]?e.placeholder:a:void 0}),u=!1,v=s.val();s.data("buffer",t).data("tests",g),s.attr("readonly")||s.one("unmask",function(){s.unbind(".mask").removeData("buffer").removeData("tests")}).bind("focus.mask",function(){v=s.val();var a=r();q(),setTimeout(function(){a==d.length?s.caret(0,a):s.caret(a)},0)}).bind("blur.mask",function(){r(),s.val()!=v&&s.change()}).bind("keydown.mask",n).bind("keypress.mask",o).bind(b,function(){setTimeout(function(){s.caret(r(!0))},0)}),r()})}})}(jQuery);;

/* file-end: js/jquery/jquery.mask.js 
----------------------------------------------------------------------------------*/
/* ---------------------------------------------------------------------------------
   file-start: js/ljlive/main.js 
*/

LJ.injectStyle('.b-ljtimes-wrapper{position:fixed;top:auto;right:auto;bottom:0;left:0;width:100%;margin:0;padding:0;z-index:2999;font-size:0;background:#FFF}@media all and (max-width:650px){.b-ljtimes-wrapper{display:none}}.b-ljtimes-lwrapper{position:fixed;bottom:0;left:0}.i-ljtimes-border{position:absolute;top:-1px;left:0;display:block;overflow:hidden;width:100%;height:1px;background:#CCC;font:0/0 serif}.i-ljtimes-bl,.i-ljtimes-br{position:absolute;top:0;left:50%;display:block;font:0/0 serif;width:3000px;height:10px;background:url(/img/ljtimes/border.png?v=9478)}.i-ljtimes-bl{margin:0 0 0 -3030px}.i-ljtimes-br{margin:0 0 0 30px}.b-ljtimes-lwrapper .i-ljtimes-border{display:none}.i-ljtimes-btn{overflow:hidden;position:absolute;top:-17px;left:14px;width:46px;height:17px;background:url(/img/ljtimes/button.png?v=10067) no-repeat;font:0/0 serif}.b-ljtimes-lwrapper .i-ljtimes-btn{bottom:auto;top:0;left:50%;height:24px;width:60px;margin:0 0 0 -30px;background:0 0}.i-ljtimes-drag{display:block;position:absolute;top:0;left:0;width:60px;height:5px;font:0/0 serif;cursor:row-resize}.b-ljtimes-lwrapper .i-ljtimes-drag{top:16px;height:8px;background:url(/img/ljtimes/down.png?v=10005) no-repeat;cursor:pointer}.i-ljtimes-click{overflow:hidden;display:block;position:absolute;top:5px;left:0;width:46px;height:18px;font:0/0 serif;cursor:pointer}.b-ljtimes-lwrapper .i-ljtimes-click{top:0;width:60px;height:16px;background:url(/img/ljtimes/arrow.png?v=10005) no-repeat}.b-ljtimes-inbox{position:fixed;bottom:33px;right:0;width:300px;font:11px/1.2 Arial,sans-serif;color:#000;z-index:999}.b-ljtimes-inbox-head{display:block;margin:0;padding:7px 10px;text-align:center;font-weight:400}.b-ljtimes-inbox-item{display:block;margin:0;padding:5px 10px 7px;list-style:none;border-top:1px solid #C1C1C1}.b-ljtimes-inbox-item:first-child{border:0}.b-ljtimes-inbox-item B{font-weight:400}.b-ljtimes-inbox-item IMG{vertical-align:-5px!important}.b-ljtimes-inbox A:link,.b-ljtimes-inbox A:visited{color:#41789C!important;text-decoration:underline!important;border:0!important}.b-ljtimes-inbox A:active,.b-ljtimes-inbox A:hover{color:#41789C!important;text-decoration:none!important;border:0!important}.b-ljtimes-inbox .i-popup-arr{left:auto;right:15px;margin:0}.b-ljtimes-update{position:fixed;bottom:33px;right:0;width:380px;font:11px/1.2 Arial,sans-serif;z-index:9999}.b-ljtimes-update .b-popup{position:static}.b-ljtimes-logged-label{display:block;margin:0;padding:0}.b-ljtimes-logged-input{overflow:hidden;display:block;margin:1px 0 7px;padding:1px}.b-ljtimes-logged .i-ljtimes-text{width:330px;margin:0;padding:2px 1px;font:12px/1.2 Arial,sans-serif}.b-ljtimes-logged .i-ljtimes-textarea{width:330px;height:65px;margin:0;padding:2px 1px;font:12px/1.2 Arial,sans-serif}.b-ljtimes-logged .i-ljtimes-tags{float:left;width:180px}.b-ljtimes-logged-submit{float:right;margin:0}.b-ljtimes-success{color:#000}.b-ljtimes-success .b-popup-inner{padding:30px}.b-ljtimes-success-title{display:block;margin:0 0 10px;font:700 15px/1.2 Arial,sans-serif;text-align:center}.b-ljtimes-success-body{display:block;line-height:1.4;text-align:center}.b-ljtimes-login{color:#000;font-size:12px}.b-ljtimes-login-form{position:relative;overflow:hidden;display:block;margin:0;padding:0;text-align:left}.b-ljtimes-logged-head,.b-ljtimes-login-head{display:block;margin:0 0 5px;padding:0;font:700 14px/1.2 Arial,sans-serif;color:#000}.b-ljtimes-login-input{float:left;margin:0;padding:20px 5px 20px 1px;list-style:none;line-height:1.2}.b-ljtimes-login .i-ljtimes-text{width:115px;margin:0 0 5px;padding:2px 1px;font:12px/1.2 Arial,sans-serif}.b-ljtimes-login .i-ljtimes-submit{vertical-align:-6px}.b-ljtimes-login-create{position:absolute;top:0;left:0}.b-ljtimes-login-remember{position:absolute;top:45px;left:0}.b-ljtimes-login-lostinfo{position:absolute;top:48px;left:158px}.b-ljtimes-login-connect{margin:0;padding:0;text-align:left}.b-ljtimes-login-connect IMG{border:0;margin:0 3px 0 0}.b-ljtimes-update A:link,.b-ljtimes-update A:visited{color:#41789C!important;text-decoration:underline!important;border:0!important}.b-ljtimes-update A:active,.b-ljtimes-update A:hover{color:#41789C!important;text-decoration:none!important;border:0!important}.b-ljtimes-bubble{position:absolute;left:14px;width:292px;margin:0;padding:0;font:12px/1.2 Arial,sans-serif;color:#000;text-align:left}.b-ljtimes-bubble-bg,.b-ljtimes-bubble-close,.b-ljtimes-bubble-top{display:block;position:absolute;margin:0;padding:0;font:0/0 serif}.b-ljtimes-bubble-top{top:0;left:0;width:292px;height:7px;background:url(/img/ljtimes/bubble-top.png?v=10269) no-repeat}.b-ljtimes-bubble-content{overflow:hidden;position:relative;top:7px;margin:0;padding:8px 15px 22px}.b-ljtimes-bubble-head{position:relative;display:block;margin:0 20px 5px 0;padding:0;font-weight:700;z-index:2}.b-ljtimes-bubble-p{position:relative;display:block;z-index:2}.b-ljtimes-bubble-bg{bottom:0;left:0;width:292px;height:357px;background:url(/img/ljtimes/bubble-bg.png?v=10269) no-repeat;z-index:1}.b-ljtimes-bubble-close{top:8px;right:16px;width:12px;height:12px;background:url(/img/ljtimes/bubble-close.gif?v=10269) no-repeat;cursor:pointer;z-index:3}.b-ljtimes-suggest,.b-ljtimes-suggestbbl{position:fixed;bottom:33px;right:0;width:380px;font:11px/1.2 Arial,sans-serif;color:#000;z-index:999}.b-ljtimes-suggest .i-ljtimes-text{width:245px;margin:0 0 5px;padding:2px 1px;font:12px/1.2 Arial,sans-serif}.b-ljtimes-suggest-alert{margin:0 0 5px;padding:0;font:11px/1.2 Arial,sans-serif}.b-ljtimes-suggestbbl-alert{margin:0 0 5px;padding:0;font:12px/1.2 Arial,sans-serif}.b-ljtimes-suggest-input .i-ljtimes-submit{vertical-align:0}.p-footer-lite #ljtime_bottom,.p-nofooter #ljtime_bottom{height:21px!important}.p-footer-lite.ljtimes-minimized #ljtime_bottom{height:0!important}');
!function(a){"use strict";function b(){var b={lang:LJ.get("locale"),is_paid:LJ.get("journal.is_paid"),country:LJ.get("country"),v:LJ.get("v")};return LJ.get("remote")&&(b.origin=location.origin,b.noncyr=LJ.get("remote_is_sup")?0:1,"undefined"!=typeof LJ.get("journal.id")&&(b.journalid=LJ.get("journal.id")),"undefined"!=typeof LJ.get("entry.ditemid")&&(b.entryditemid=LJ.get("entry.ditemid"))),e&&(b.branding=!0),a("<iframe />",{width:"100%",height:c,frameborder:0,src:LiveJournal.constructUrl(f+"/discovery/times",b),id:"ljtime_iframe"}).hide()}var c=50,d=a("<div />",{id:"ljlive","class":"b-ljtimes-wrapper b-ljtimes-wrapper_v2"}),e=LJ.get("ljlive.branding_template"),f=LJ.get(LJ.get("remote")?"siteroot":"statprefix"),g=b();d.append(g),e&&d.append(a.parseHTML(e)),a(window).on("message",function(a){a=a.originalEvent,a.origin===f&&("ljlive ready"===a.data&&LJ.Event.trigger("ljlive:ready"),"ljlive close"===a.data&&LJ.Event.trigger("ljlive:close"))}),LJ.Event.on("ljlive:ready",function(){g.show()}),LJ.Event.on("ljlive:close",function(){LJ.Api.call("discovery.close"),a("#ljlive, #ljlive_bottom").remove(),a("body").removeClass("p-ljtimes"),d=null,g=null}),a(function(){var b=!LJ.get("journal")||LJ.get("scheme");a("[data-ljlive]").replaceWith(d),b||d.after(a("<div />",{id:"ljtime_bottom",height:c}))})}(jQuery);;

/* file-end: js/ljlive/main.js 
----------------------------------------------------------------------------------*/
