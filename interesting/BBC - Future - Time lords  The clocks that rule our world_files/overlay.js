define(["jquery-1","gelui-1/core","jssignals-1","gelui-1/widget","cssp!gelui-1/overlay"],function(e,c,b,d){var a=function(f,h){f=e(f);this._options=e.extend(true,{animation:"none",closeOnClick:false,closeOnEscape:true,closeOnScroll:false,parentNode:e("body"),role:"dialog"},h);f.appendTo(this.option("parentNode"));this.wrap(f,{role:this.option("role")});this.$wrapper.container.attr("tabindex",0);this.signals={show:new b.Signal(),aftershow:new b.Signal(),hide:new b.Signal(),afterhide:new b.Signal(),optionchange:new b.Signal()};var g=this;this.signals.optionchange.add(function(i){if(i.name==="animation"){g._options.animation=i.value}});this.hide(false)};e.extend(a.prototype,d);a.prototype.name="overlay";a.prototype.show=function(g){var h={animArg:g},f=this;this.signals.show.dispatch(h);if(h.defaultPrevented!==true){this.hideFlash();this._showStart(h)}return this};a.prototype._showStart=function(g){var f=this;this.$wrapper.removeAttr("aria-hidden");this._isShown=true;if(g.animArg===false||this.option("animation")==="none"){this.$wrapper.container.show();this._showComplete(g)}else{if(this.option("animation")==="fade"){this.$wrapper.container.fadeIn(200,function(){f._showComplete(g)})}else{if(this.option("animation")==="slide"){this.$wrapper.container.slideDown(200,function(){f._showComplete(g)})}}}};a.prototype._showComplete=function(g){this.addState("shown");var f=this;if(this.option("closeOnClick")){setTimeout(function(){e("body").bind("click",{overlay:f},f._closeOnClick)},0)}if(this.option("closeOnEscape")){e("body").bind("keypress",{overlay:f},f._closeOnEscape)}if(this.option("closeOnScroll")){e(window).bind("scroll",{overlay:f},f._close)}this.$wrapper.find(".gelui-panel-close").bind("click",{overlay:f},f._close);this.signals.aftershow.dispatch(g)};a.prototype.hide=function(f){var g={animArg:f};this.signals.hide.dispatch(g);if(g.defaultPrevented!==true){e("body").unbind("click",this._closeOnClick);this._hideStart(g)}return this};a.prototype._hideStart=function(g){var f=this;this.$wrapper.attr("aria-hidden","true");this._isShown=false;if(g.animArg===false||this.option("animation")==="none"){this.$wrapper.container.hide();this._hideComplete(g)}else{if(this.option("animation")==="fade"){this.$wrapper.container.fadeOut(200,function(){f._hideComplete(g)})}else{if(this.option("animation")==="slide"){this.$wrapper.container.slideUp(200,function(){f._hideComplete(g)})}}}};a.prototype._hideComplete=function(f){this.removeState("shown");if(this.option("closeOnClick")){e("body").unbind("click",this._closeOnClick)}if(this.option("closeOnEscape")){e("body").unbind("keypress",this._closeOnEscape)}if(this.option("closeOnScroll")){e(window).unbind("scroll",this._close)}this.$wrapper.find(".gelui-panel-close").unbind("click",this._close);this.signals.afterhide.dispatch(f)};a.prototype.toggleShow=function(f,h,g){if(this._isShown){this.hide(f,h,g)}else{this.show(f,h,g)}return this};a.prototype.isShown=function(){return this._isShown};a.prototype.hideFlash=function(){var h=this,i="",g=this.getUid(),f=e("embed, object").not(this.$wrapper.container.find("embed, object"));f.each(function(){var k=e(this),j;j=k.css("visibility");i=(this._geluiOverlayHidBy||"");if(i===""&&j!=="hidden"){this._geluiOverlayOriginalVisibility=j;k.css("visibility","hidden")}if(i.indexOf("["+g+"]")===-1){this._geluiOverlayHidBy=i+"["+g+"]"}});if(f.length&&!this._doShowFlash){h._doShowFlash=true;h.signals.afterhide.add(function(){h.showFlash()},null,-1)}this._hiddenElements=f;return this};a.prototype.showFlash=function(){var h="",g=this.getUid();if(!this._hiddenElements||this._hiddenElements.length===0){return}var f=this._hiddenElements;f.each(function(){var i=e(this);h=(this._geluiOverlayHidBy||"");if(~h.indexOf("["+g+"]")){h=h.replace("["+g+"]","");this._geluiOverlayHidBy=h}if(h==""){i.css("visibility",this._geluiOverlayOriginalVisibility)}});return this};a.prototype._closeOnClick=function(f){if(e.inArray(f.data.overlay.$wrapper[0],e(f.target).parents().toArray())===-1){f.data.overlay.hide()}};a.prototype._closeOnEscape=function(f){if(f.keyCode===c.keyCode.ESCAPE){f.data.overlay.hide()}};a.prototype._close=function(f){f.data.overlay.hide()};a.prototype.nextTo=function(j,h,m){var i=e(j),k,o,l=this.$wrapper.container.outerWidth(),g=this.$wrapper.container.outerHeight(),p=i.offset(),n=i.outerWidth(),f=i.outerHeight();switch(h){case"top":k=p.left-(l/2)+(n/2);o=p.top-g;break;case"bottom":k=p.left-(l/2)+(n/2);o=p.top+f;break;case"left":k=p.left-l;o=p.top-(g/2)+(f/2);break;case"right":k=p.left+n;o=p.top-(g/2)+(f/2);break;default:case"over":k=p.left-(l/2)+(n/2);o=p.top-(g/2)+(f/2);break}switch(m){case"left":k=p.left;break;case"right":k=p.left+n-l;break;case"top":o=p.top;break;case"bottom":o=p.top+f-g;break;default:case"centre":break}this.$wrapper.container.css({left:k,top:o});return this};return a});